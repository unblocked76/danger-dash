GRPH=function(){throw new Error("Not allows init!")};if(Graphics){GRPH.LEFT=Graphics.LEFT;GRPH.HCENTER=Graphics.HCENTER;GRPH.RIGHT=Graphics.RIGHT;GRPH.TOP=Graphics.TOP;GRPH.VCENTER=Graphics.VCENTER;GRPH.BOTTOM=Graphics.BOTTOM;GRPH.LEFT_TOP=Graphics.LEFT|Graphics.TOP;GRPH.LEFT_VCENTER=Graphics.LEFT|Graphics.VCENTER;GRPH.LEFT_BOTTOM=Graphics.LEFT|Graphics.BOTTOM;GRPH.HCENTER_TOP=Graphics.HCENTER|Graphics.TOP;GRPH.HCENTER_VCENTER=Graphics.HCENTER|Graphics.VCENTER;GRPH.HCENTER_BOTTOM=Graphics.HCENTER|Graphics.BOTTOM;GRPH.RIGHT_TOP=Graphics.RIGHT|Graphics.TOP;GRPH.RIGHT_VCENTER=Graphics.RIGHT|Graphics.VCENTER;GRPH.RIGHT_BOTTOM=Graphics.RIGHT|Graphics.BOTTOM}else{throw new Error("Graphics is required")}(function(b,c){a.temp_int=null;a.temp_short=null;a.temp_byte=null;a.transform_int=null;a.transform_short=null;a.temp=null;a._graphics=null;a._customGraphics=null;a._graphicsWidth=GLLibConfig.screenWidth;a._graphicsHeight=GLLibConfig.screenHeight;a._customGraphicsWidth=0;a._customGraphicsHeight=0;a._customGraphicsAlpha=0;a._customGraphicsClipX=0;a._customGraphicsClipY=0;a._customGraphicsClipW=0;a._customGraphicsClipH=0;a._renderToTilesetBackBufferEnabled=0;a.s_frame_image_bHasAlpha=0;a._frame_image_temp=null;a._images_count=0;a._images_size=0;a.midp2_flags=[Sprite.TRANS_NONE,Sprite.TRANS_MIRROR,Sprite.TRANS_MIRROR_ROT180,Sprite.TRANS_ROT180,Sprite.TRANS_ROT90,Sprite.TRANS_MIRROR_ROT90,Sprite.TRANS_MIRROR_ROT270,Sprite.TRANS_ROT270,];a.TRANSFORM_FLIP_X=[1,0,3,2,6,7,4,5];a.TRANSFORM_FLIP_Y=[2,3,0,1,5,4,7,6];a.TRANSFORM_ROT_90=[4,5,6,7,3,2,1,0];a.s_resizeType=0;a._rectX1=0;a._rectY1=0;a._rectX2=0;a._rectY2=0;a.s_rc=LowAPI.Gen_Array([4],0);a.s_gcEnabled=true;a.s_debugSkipPaintModule=false;a.s_moduleMask=0;a.s_moduleBufferState=0;a.MODULE_STATE_MODULE_ID_MASK=65535;a.MODULE_STATE_PALETTE_MASK=268369920;a.MODULE_STATE_PALETTE_SHIFT=16;a.MODULE_STATE_DISABLE_MASK=(2147483648).castToInt();a.MODULE_STATE_INIT_MASK=(a.MODULE_STATE_MODULE_ID_MASK|a.MODULE_STATE_PALETTE_MASK);a.k_cCanBreakLine="|";a._useLineBreakChar=false;a._lineBreakChar="";a.s_drawTextBottomToTop=false;a.m_bMarkerCallbackEnabled=false;a.m_bMarkerCallbackID=-1;a.m_bMarkerCallbackVisible=false;a.m_bMarkerCallbackLastID=-1;a.m_bMarkerCallbackLastPosX=0;a.m_bMarkerCallbackLastPosY=0;a.m_bMarkerCallbackLastVisible=false;a.m_bEnableFreeWrap=false;a.BSPRITE_v005=(1503).castToShort();a.SUPPORTED_VERSION=a.BSPRITE_v005;a.BS_MODULES=(1<<0);a.BS_MODULES_XY=(1<<1);a.BS_MODULES_IMG=(1<<2);a.BS_MODULE_IMAGES_TC_BMP=(1<<3);a.BS_MODULES_WH_SHORT=(1<<4);a.BS_MODULES_XY_SHORT=(1<<5);a.BS_MODULES_USAGE=(1<<6);a.BS_IMAGE_SIZE_INT=(1<<7);a.BS_FRAMES=(1<<8);a.BS_FM_OFF_SHORT=(1<<10);a.BS_NFM_SHORT=(1<<11);a.BS_SKIP_FRAME_RC=(1<<12);a.BS_FRAME_COLL_RC=(1<<13);a.BS_FM_PALETTE=(1<<14);a.BS_FRAME_RECTS=(1<<15);a.BS_ANIMS=(1<<16);a.BS_NO_AF_START=(1<<17);a.BS_AF_OFF_SHORT=(1<<18);a.BS_NAF_SHORT=(1<<19);a.BS_FM_INDEX_SHORT=(1<<20);a.BS_AF_INDEX_SHORT=(1<<21);a.BS_EXTRA_FLAGS=(1<<22);a.BS_MODULE_IMAGES_FX=(1<<23);a.BS_MODULE_IMAGES=(1<<24);a.BS_PNG_CRC=(1<<25);a.BS_KEEP_PAL=(1<<26);a.BS_TRANSP_FIRST=(1<<27);a.BS_TRANSP_LAST=(1<<28);a.BS_SINGLE_IMAGE=(1<<29);a.BS_MULTIPLE_IMAGES=(1<<30);a.BS_GIF_HEADER=(1<<31);a.BS_DEFAULT_MIDP2=(a.BS_MODULES|a.BS_FRAMES|a.BS_ANIMS|a.BS_MODULE_IMAGES);a.BS_DEFAULT_NOKIA=(a.BS_DEFAULT_MIDP2);a.BS_DEFAULT_MIDP1=(a.BS_MODULES|a.BS_MODULES_XY|a.BS_FRAMES|a.BS_ANIMS);a.BS_DEFAULT_MIDP1b=(a.BS_MODULES|a.BS_FRAMES|a.BS_ANIMS|a.BS_MODULE_IMAGES|a.BS_PNG_CRC);a.BS_DEFAULT_MIDP1c=(a.BS_MODULES|a.BS_MODULES_XY|a.BS_FRAMES|a.BS_ANIMS|a.BS_SINGLE_IMAGE);a.BS_EX0_FM_FREE_ROTATE_SCALE=(1<<0);a.BS_EX0_AF_FREE_ROTATE_SCALE=(1<<1);a.BS_EX0_MULTIPAL_IMAGE=(1<<2);a.BS_EX0_MULTI_IMAGE=(1<<3);a.BS_EX0_FM_BLEND_MODE=(1<<4);a.BS_EX0_MODULE_IMAGES_USED=(1<<5);a.BS_EX0_MMAPPINGS=(1<<17);a.BS_EX0_MM_OFFSET=(1<<18);a.BS_EX0_MM_OFFSET_SHORT=(1<<19);a.BS_EX0_SINGLE_IMAGE_INDEX=(1<<20);a.PIXEL_FORMAT_8888=(34952).castToShort();a.PIXEL_FORMAT_4444=(17476).castToShort();a.PIXEL_FORMAT_1555=(21781).castToShort();a.PIXEL_FORMAT_0565=(25861).castToShort();a.PIXEL_FORMAT_0332=(12803).castToShort();a.PIXEL_FORMAT_8808=(34824).castToShort();a.ENCODE_FORMAT_I2=512;a.ENCODE_FORMAT_I4=1024;a.ENCODE_FORMAT_I16=5632;a.ENCODE_FORMAT_I256=22018;a.ENCODE_FORMAT_I64RLE=25840;a.ENCODE_FORMAT_I127RLE=10225;a.ENCODE_FORMAT_I256RLE=22258;a.ENCODE_FORMAT_A8_I32=(933).castToShort();a.ENCODE_FORMAT_A32_I8=(1443).castToShort();a.ENCODE_FORMAT_A256_I64=(41060).castToShort();a.ENCODE_FORMAT_A256_I128=(41256).castToShort();a.ENCODE_FORMAT_A256_I256=(42338).castToShort();a.ENCODE_FORMAT_A256_I64RLE=(42560).castToShort();a.ENCODE_FORMAT_A256_I127RLE=(41255).castToShort();a.ENCODE_FORMAT_A256_I256RLE=(41558).castToShort();a.FLAG_FLIP_X=1;a.FLAG_FLIP_Y=2;a.FLAG_ROT_90=4;a.FLAG_USER0=16;a.FLAG_USER1=32;a.FLAG_HYPER_FM=16;a.FLAG_INDEX_EX_MASK=192;a.INDEX_MASK=1023;a.INDEX_EX_MASK=768;a.INDEX_EX_SHIFT=2;a.FLAG_OFFSET_FM=16;a.FLAG_OFFSET_AF=32;a.OPERATION_DRAW=0;a.OPERATION_COMPUTERECT=1;a.OPERATION_RECORD=2;a.OPERATION_MARK=3;a.OPERATION_NUM=4;a.RESIZE_NONE=0;a.RESIZE_CREATERGB=1;a.RESIZE_DRAW_ON_MUTABLE=2;a.RESIZE_NOT_CACHED=3;a.MD_IMAGE=0;a.MD_RECT=1;a.MD_FILL_RECT=2;a.MD_ARC=3;a.MD_FILL_ARC=4;a.MD_MARKER=5;a.MD_TRIANGLE=6;a.MD_FILL_TRIANGLE=7;a.MD_LINE=8;a.MD_FILL_RECT_GRAD=9;a.MAX_TRANSFORMATION_FLAGS=8;a.FLAG_USE_CACHE_RGB=(1<<0);a.FLAG_USE_MODULE_MASK=(1<<1);a.FLAG_FORCE_SHORT_FRAME_RC=(1<<2);a.FLAG_USE_PAL_INDEX_CACHE=(1<<3);a.FLAG_FORCE_CURRENT_PAL=(1<<4);a.FLAG_USE_MARKER_CALLBACK=(1<<5);a.ALPHA_NONE=0;a.ALPHA_TRANSPARENT=1;a.ALPHA_FULL=2;a.ALPHA_INDEX=3;a.RENDER_TO_TILESET_BACKBUFFER_LAYER_MASK=65535;a.RENDER_TO_TILESET_BACKBUFFER_FORCE_MASK=1048576;a.RENDER_TO_TILESET_BACKBUFFER_ENABLE_MASK=16777216;a.k_blend_normal=0;a.k_blend_average=1;a.k_blend_multiply=2;a.k_blend_screen=3;a.k_blend_darken=4;a.k_blend_lighten=5;a.k_blend_difference=6;a.k_blend_negation=7;a.k_blend_exclusion=8;a.k_blend_overlay=9;a.k_blend_hardLight=10;a.k_blend_softLight=11;a.k_blend_xFader=12;a.k_blend_colorDodge=13;a.k_blend_colorDodge2=14;a.k_blend_colorBurn=15;a.k_blend_inverseColorDodge=16;a.k_blend_inverseColorBurn=17;a.k_blend_softDodge=18;a.k_blend_softBurn=19;a.k_blend_reflect=20;a.k_blend_glow=21;a.k_blend_freeze=22;a.k_blend_heat=23;a.k_blend_additive=24;a.k_blend_substractive=25;a.k_blend_interpolation=26;a.k_blend_stamp=27;a.k_blend_xor=28;a.k_blend_gllibMultiplicative=29;a._poolCacheStack=null;a._poolCacheStackIndex=null;a._poolCacheStackMax=null;a._poolCacheSprites=null;a.s_BCI_supportsCacheEffects=GLLibConfig.sprite_useCacheEffectReflection;a.s_BCI_effects=null;a.BCI_EFFECT_REFLECTION=1;a.BCI_EFFECT_NUM=2;a.BCI_EFFECT_PARAM_TYPE=0;a.BCI_REFLECTION_PARAM_NEW=1;a.BCI_REFLECTION_PARAM_DIRECTION=2;a.BCI_REFLECTION_PARAM_ALPHA_START=3;a.BCI_REFLECTION_PARAM_ALPHA_END=4;a.BCI_REFLECTION_PARAM_PERCENT=5;a.BCI_REFLECTION_PARAM_MODULE_START=6;a.BCI_REFLECTION_PARAM_MODULE_END=7;a.BCI_REFLECTION_PARAM_MODULE_END_ID=8;a.BCI_REFLECTION_PARAM_CACHE_ID=9;a.BCI_REFLECTION_PARAM_NUM=10;a.s_isConvertEncodeTMPBufOn=false;a.s_convertEncodeTMPBuffer=null;a.s_convertEncodeExtraBufferSize=10;a._old_pal=0;a._text_w=0;a._text_h=0;a._text_leftCornerOffX=0;a._text_leftCornerOffY=0;a.s_MapChar=null;a._warpTextInfo=null;a.WRAP_TEXT_FORMATTING_MASK_PALETTE=4095;a.WRAP_TEXT_FORMATTING_FLAG_IS_BOLD=4096;a.WRAP_TEXT_FORMATTING_FLAG_IS_UNDERLINED=8192;a._index1=-1;a._index2=-1;a._indexMax=-1;a.k_itoa_buffer_size=33;a._itoa_buffer=null;a.PAL_ORIGINAL=-1;a.PAL_INVISIBLE=0;a.PAL_RED_YELLOW=1;a.PAL_BLUE_CYAN=2;a.PAL_GREEN=3;a.PAL_GREY=4;a.PAL_BLEND_BLACK=5;a.record_index=-1;a.record_frame=-1;a._operation=a.OPERATION_DRAW;function a(){this._nModules=0;this._modules_x_byte=null;this._modules_y_byte=null;this._modules_x_short=null;this._modules_y_short=null;this._modules_w_scaled=null;this._modules_h_scaled=null;this._modules_w_short=null;this._modules_h_short=null;this._modules_w_byte=null;this._modules_h_byte=null;this._modules_extra_info=null;this._modules_extra_pointer=null;this._frames_nfm_byte=null;this._frames_nfm_short=null;this._frames_fm_start=null;this._frames_rc=null;this._frames_rc_short=null;this._frames_col=null;this._frames_col_short=null;this._frames_rects=null;this._frames_rects_short=null;this._frames_rects_start=null;this._fmodules=null;this._fmodules_id_byte=null;this._fmodules_id_short=null;this._fmodules_flags=null;this._fmodules_ox_short=null;this._fmodules_oy_short=null;this._fmodules_ox_byte=null;this._fmodules_oy_byte=null;this._fmodules_pal=null;this._fmodules_blend_mode=null;this._fmodules_blend_opacity=null;this._anims_naf_byte=null;this._anims_naf_short=null;this._anims_af_start=null;this._aframes=null;this._aframes_frame_byte=null;this._aframes_frame_short=null;this._aframes_time=null;this._aframes_ox_short=null;this._aframes_oy_short=null;this._aframes_ox_byte=null;this._aframes_oy_byte=null;this._aframes_flags=null;this._map=null;this._map_offset_short=null;this._map_offset_byte=null;this._cur_map=0;this._frameMapping_index=null;this._frameMapping_config_sprite=null;this._frameMapping_config_palId=null;this._frameMapping_config_frameOff=null;this._modules_data=null;this._modules_data_off_short=null;this._modules_data_off_int=null;this._modules_data_array=null;this._bs_flags=0;this._bs_extraFlags0=0;this._pal_short=null;this._pal_int=null;this._transp=null;this._pal_data=null;this._palettes=0;this._loadedPalettes=0;this._colors=null;this._crt_pal=0;this._alpha=false;this._multiAlpha=false;this._flags=0;this._data_format=0;this._i64rle_color_mask=null;this._i64rle_color_bits=null;this._modules_image_shortAAA=null;this._module_image_imageAAA=null;this._module_image_intAAA=null;this._module_image_imageAA=null;this._module_image_byteAA=null;this._frame_image_intAAA=null;this._frame_image_imageAAA=null;this._frame_image_byteAAA=null;this._frame_image_byteAA=null;this._module_types=null;this._module_img=null;this._module_colors_byte=null;this._module_colors_int=null;this._modules_usage=null;this._number_image=0;this._pal_data_array=null;this._cachedFrameIsOpaque=false;this._palTransparencyIndex=-1;this._cur_pool=-1;this._palBlend_srcA=-1;this._palBlend_srcB=-1;this._palBlend_dest=-1;this._palBlend_current=-1;this._palBlend_UseOneColor=false;this._palBlend_ModuleState=null;this._bRotatedFont=false;this._nLineHeight=0;this._nLineSpacing=0;this._nCharSpacing=0;this._nSpaceWidth=0;this._nCharYOffset=0;this._nFontAscent=0;this._bUnderline=false;this._bBold=false;this._pMapChar=a.s_MapChar;this._pMapCharShort=null;this._nDivider=0;this._pMapCharInt=null;this._nDividerInt=0;this.m_scaleAccelerator=-1;this._isExtraPaletteExist=false;this._aryPrecomputedImages=null;this._aryPrecomputedX=null;this._aryPrecomputedY=null;this._aryPrecomputedSizeX=null;this._aryPrecomputedSizeY=null;this._aryPrecomputedImgX=null;this._aryPrecomputedImgY=null;this._aryPrecomputedFlags=null;this._frame_data=null}a.prototype.unload=function(){if(GLLibConfig.sprite_useModuleXYShort){this._modules_y_short=null;this._modules_x_short=null}else{this._modules_x_byte=null;this._modules_y_byte=null}if(GLLibConfig.sprite_useModuleWHShort){this._modules_w_short=null;this._modules_h_short=null}else{this._modules_w_byte=null;this._modules_h_byte=null}if(GLLibConfig.sprite_forceShortIndexForFModules){this._fmodules_id_short=null}else{if(GLLibConfig.sprite_allowShortIndexForFModules){this._fmodules_id_short=null;this._fmodules_id_byte=null}else{this._fmodules_id_byte=null}}if(GLLibConfig.sprite_forceShortNumOfFModules){this._frames_nfm_short=null}else{if(GLLibConfig.sprite_allowShortNumOfFModules){this._frames_nfm_short=null;this._frames_nfm_byte=null}else{this._frames_nfm_byte=null}}if(GLLibConfig.sprite_forceShortIndexForAFrames){this._aframes_frame_short=null}else{if(GLLibConfig.sprite_allowShortIndexForAFrames){this._aframes_frame_short=null;this._aframes_frame_byte=null}else{this._aframes_frame_byte=null}}if(GLLibConfig.sprite_forceShortNumOfAFrames){this._anims_naf_short=null}else{if(GLLibConfig.sprite_allowShortNumOfAFrames){this._anims_naf_short=null;this._anims_naf_byte=null}else{this._anims_naf_byte=null}}this._frames_fm_start=null;this._frames_rc=null;this._frames_rc_short=null;this._frames_col=null;this._frames_col_short=null;this._frames_rects=null;this._frames_rects_short=null;this._frames_rects_start=null;this._fmodules=null;this._anims_af_start=null;this._aframes=null;if(this._map!=null){for(var d=0;d<this._map.length;d++){this._map[d]=null}this._map=null}if(this._map_offset_byte!=null){for(var d=0;d<this._map_offset_byte.length;d++){this._map_offset_byte[d]=null}this._map_offset_byte=null}if(this._map_offset_short!=null){for(var d=0;d<this._map_offset_short.length;d++){this._map_offset_short[d]=null}this._map_offset_short=null}if(this._transp!=null){for(var d=0;d<this._transp.length;d++){this._transp[d]=null}this._transp=null}if(GLLibConfig.sprite_useCreateRGB){if(this._pal_int!=null){for(var d=0;d<this._pal_int.length;d++){this._pal_int[d]=null}this._pal_int=null}}this.FreeCachedModules()};a.prototype.InitMultipleModuleTypes=function(d){if(this._module_types==null){this._module_types=[];for(var e=0;e<d;e++){this._module_types[e]=a.MD_IMAGE}}if(GLLibConfig.sprite_useModuleColorAsByte){if(this._module_colors_byte==null){this._module_colors_byte=LowAPI.Gen_Array([d],0)}}else{if(this._module_colors_int==null){this._module_colors_int=LowAPI.Gen_Array([d],0)}}};a.prototype.LoadModules=function(k,y){this._nModules=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("nModules = "+this._nModules)}if(this._nModules>0){if(GLLibConfig.sprite_useModuleXYShort&&((this._bs_flags&a.BS_MODULES_XY_SHORT)!=0)){this._modules_x_short=[];this._modules_y_short=[]}else{if(GLLibConfig.sprite_useModuleXY&&((this._bs_flags&a.BS_MODULES_XY)!=0)){this._modules_x_byte=[];this._modules_y_byte=[]}}if(GLLibConfig.sprite_useModuleWHShort){this._modules_w_short=[];this._modules_h_short=[]}else{this._modules_w_byte=[];this._modules_h_byte=[]}var z=0;var d=0;var f=null;if(GLLibConfig.sprite_useMultipleModuleTypes){if((this._bs_flags&a.BS_MODULES_IMG)!=0){this._module_img=LowAPI.Gen_Array([this._nModules],0)}}var r=false;var q=false;var p=false;var w=false;var n=false;var e=false;var h=false;for(var v=0;v<this._nModules;v++){w=false;n=false;h=false;if(GLLibConfig.sprite_useMultipleModuleTypes){if(((y[k])&255)==0){k+=(1);r=false;q=true;p=true;if((this._bs_flags&a.BS_MODULES_IMG)!=0){this._module_img[v]=(y[k++])}}else{if(((y[k])&255)==255){if(!(!GLLibConfig.sprite_disableModuleType_Rect)){Assert(false,"Sprite contains a RECT MODULE TYPE, so you can't set sprite_disableModuleType_Rect")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_RECT;r=true;q=false;p=true}else{if(((y[k])&255)==254){if(!(!GLLibConfig.sprite_disableModuleType_FillRect)){Assert(false,"Sprite contains a FILL RECT MODULE TYPE, so you can't set sprite_disableModuleType_FillRect")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_FILL_RECT;r=true;q=false;p=true}else{if(((y[k])&255)==253){if(!(!GLLibConfig.sprite_disableModuleType_Marker)){Assert(false,"Sprite contains a MARKER MODULE TYPE, so you can't set sprite_disableModuleType_Marker")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_MARKER;r=false;q=false;p=true}else{if(((y[k])&255)==252){if(!(!GLLibConfig.sprite_disableModuleType_Arc)){Assert(false,"Sprite contains a ARC MODULE TYPE, so you can't set sprite_disableModuleType_Arc")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_ARC;r=true;q=false;p=true;w=true}else{if(((y[k])&255)==251){if(!(!GLLibConfig.sprite_disableModuleType_FillArc)){Assert(false,"Sprite contains a FILL ARC MODULE TYPE, so you can't set sprite_disableModuleType_FillArc")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_FILL_ARC;r=true;q=false;p=true;w=true}else{if(((y[k])&255)==250){if(!(!GLLibConfig.sprite_disableModuleType_Triangle)){Assert(false,"Sprite contains a TRIANGLE MODULE TYPE, so you can't set sprite_disableModuleType_Triangle")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_TRIANGLE;r=true;q=false;p=false;n=true}else{if(((y[k])&255)==249){if(!(!GLLibConfig.sprite_disableModuleType_FillTriangle)){Assert(false,"Sprite contains a FILL TRIANGLE MODULE TYPE, so you can't set sprite_disableModuleType_FillTriangle")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_FILL_TRIANGLE;r=true;q=false;p=false;n=true}else{if(((y[k])&255)==248){if(!(!GLLibConfig.sprite_disableModuleType_Line)){Assert(false,"Sprite contains a LINE MODULE TYPE, so you can't set sprite_disableModuleType_Line")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_LINE;r=true;q=false;p=true;n=false}else{if(((y[k])&255)==247){if(!(!GLLibConfig.sprite_disableModuleType_FillRectGradient)){Assert(false,"Sprite contains a FILL RECT GRAD MODULE TYPE, so you can't set sprite_disableModuleType_FillRectGradient")}k+=(1);this.InitMultipleModuleTypes(this._nModules);this._module_types[v]=a.MD_FILL_RECT_GRAD;r=true;h=true;q=false;p=true;n=false}else{Assert(false,"Invalid module type : "+((y[k])&255)+"   module #"+v)}}}}}}}}}}}else{if(((y[k])&255)==0){k+=(1);r=false;q=true;p=true}else{if(GLLibConfig.sprite_convertMarkersToImageTypes&&((y[k])&255)==253){k+=(1);r=false;q=true;p=true;e=true;Dbg("Warning: Converting from ASprite.MD_MARKER to ASprite.MD_IMAGE!!")}else{Assert(false,"Invalid module type : "+((y[k])&255)+"   module #"+v)}}}if(GLLibConfig.sprite_useMultipleModuleTypes){if(r){if(GLLibConfig.sprite_useModuleColorAsByte){this._module_colors_byte[v]=(y[k++]);k+=(3)}else{this._module_colors_int[v]=(((y[k++]&255))+((y[k++]&255)<<8)+((y[k++]&255)<<16)+((y[k++]&255)<<24))}}if(h){if(f==null){f=LowAPI.Gen_Array([this._nModules],null)}var j=LowAPI.Gen_Array([3],0);var u=(((y[k++]&255))+((y[k++]&255)<<8)+((y[k++]&255)<<16)+((y[k++]&255)<<24));j[0]=(u&65535).castToShort();j[1]=((u>>16)&65535).castToShort();j[2]=(y[k++]);f[v]=j;z++;d+=3}}if(q){if(GLLibConfig.sprite_useModuleXYShort&&((this._bs_flags&a.BS_MODULES_XY_SHORT)!=0)){this._modules_x_short[v]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());this._modules_y_short[v]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort())}else{if(GLLibConfig.sprite_useModuleXY&&((this._bs_flags&a.BS_MODULES_XY)!=0)){this._modules_x_byte[v]=(y[k++]);this._modules_y_byte[v]=(y[k++])}}}if(p){if(GLLibConfig.sprite_useModuleWHShort){if((this._bs_flags&a.BS_MODULES_WH_SHORT)==0){this._modules_w_short[v]=(((y[k++])&255).castToShort());this._modules_h_short[v]=(((y[k++])&255).castToShort())}else{this._modules_w_short[v]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());this._modules_h_short[v]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort())}}else{this._modules_w_byte[v]=(y[k++]);this._modules_h_byte[v]=(y[k++])}if(GLLibConfig.sprite_convertMarkersToImageTypes&&!GLLibConfig.sprite_useMultipleModuleTypes&&e){if(GLLibConfig.sprite_useModuleWHShort){this._modules_w_short[v]=0;this._modules_h_short[v]=0}else{this._modules_w_byte[v]=0;this._modules_h_byte[v]=0}}}if(GLLibConfig.sprite_useMultipleModuleTypes){if(w){if(f==null){f=LowAPI.Gen_Array([this._nModules],null)}var j=LowAPI.Gen_Array([2],0);j[0]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());j[1]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());f[v]=j;z++;d+=2}if(n){if(f==null){f=LowAPI.Gen_Array([this._nModules],null)}var j=LowAPI.Gen_Array([4],0);j[0]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());j[1]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());j[2]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());j[3]=((((y[k++]&255))+((y[k++]&255)<<8)).castToShort());f[v]=j;z++;d+=4}}}if(GLLibConfig.sprite_useMultipleModuleTypes){if(z>0){this._modules_extra_info=LowAPI.Gen_Array([d],0);this._modules_extra_pointer=LowAPI.Gen_Array([z<<1],0);var l=0;var A=0;var t;for(var s=0;s<this._nModules;s++){if((!GLLibConfig.sprite_disableModuleType_Arc&&(this._module_types[s]==a.MD_ARC))||(!GLLibConfig.sprite_disableModuleType_FillArc&&(this._module_types[s]==a.MD_FILL_ARC))){t=2}else{if((!GLLibConfig.sprite_disableModuleType_Triangle&&(this._module_types[s]==a.MD_TRIANGLE))||(!GLLibConfig.sprite_disableModuleType_FillTriangle&&(this._module_types[s]==a.MD_FILL_TRIANGLE))){t=4}else{if(!GLLibConfig.sprite_disableModuleType_FillRectGradient&&(this._module_types[s]==a.MD_FILL_RECT_GRAD)){t=3}else{t=-1}}}if(t>0){this._modules_extra_pointer[(l<<1)+0]=s;this._modules_extra_pointer[(l<<1)+1]=A;for(var o=0;o<t;o++){this._modules_extra_info[A]=f[s][o];A++}f[s]=null;l++}}}f=null}}return k};a.prototype.LoadFModules=function(h,e){var f=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("nFModules = "+f)}if(f>0){if(GLLibConfig.sprite_useSingleArrayForFMAF){this._fmodules=LowAPI.Gen_Array([f<<2],0);System.arraycopy(e,h,this._fmodules,0,this._fmodules.length);h+=this._fmodules.length}else{if((GLLibConfig.sprite_forceShortIndexForFModules)||(GLLibConfig.sprite_allowShortIndexForFModules&&(((this._bs_flags&a.BS_FM_INDEX_SHORT)!=0)))){this._fmodules_id_short=[]}else{this._fmodules_id_byte=[]}if(GLLibConfig.sprite_useFMOffShort||(GLLibConfig.sprite_allowFMOffShort&&((this._bs_flags&a.BS_FM_OFF_SHORT)!=0))){this._fmodules_ox_short=[];this._fmodules_oy_short=[]}else{this._fmodules_ox_byte=[];this._fmodules_oy_byte=[]}this._fmodules_flags=[];if(GLLibConfig.sprite_useFMPalette){if((this._bs_flags&a.BS_FM_PALETTE)!=0){this._fmodules_pal=[]}}if(GLLibConfig.sprite_useBSpriteExtraFlags&&GLLibConfig.sprite_useFMBlendMode&&((this._bs_extraFlags0&a.BS_EX0_FM_BLEND_MODE)!=0)){this._fmodules_blend_mode=[];this._fmodules_blend_opacity=[]}for(var d=0;d<f;d++){if((GLLibConfig.sprite_forceShortIndexForFModules||GLLibConfig.sprite_allowShortIndexForFModules)&&((this._bs_flags&a.BS_FM_INDEX_SHORT)!=0)){this._fmodules_id_short[d]=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort())}else{if(GLLibConfig.sprite_forceShortIndexForFModules){this._fmodules_id_short[d]=(((e[h++])&255)).castToShort()}else{this._fmodules_id_byte[d]=(e[h++])}}if(GLLibConfig.sprite_useFMOffShort||(GLLibConfig.sprite_allowFMOffShort&&((this._bs_flags&a.BS_FM_OFF_SHORT)!=0))){if((this._bs_flags&a.BS_FM_OFF_SHORT)!=0){this._fmodules_ox_short[d]=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort());this._fmodules_oy_short[d]=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort())}else{this._fmodules_ox_short[d]=((e[h++]));this._fmodules_oy_short[d]=((e[h++]))}}else{this._fmodules_ox_byte[d]=(e[h++]);this._fmodules_oy_byte[d]=(e[h++])}if(GLLibConfig.sprite_useFMPalette){if((this._bs_flags&a.BS_FM_PALETTE)!=0){this._fmodules_pal[d]=(e[h++])}}this._fmodules_flags[d]=(e[h++]);if(GLLibConfig.sprite_useBSpriteExtraFlags&&GLLibConfig.sprite_useFMBlendMode&&((this._bs_extraFlags0&a.BS_EX0_FM_BLEND_MODE)!=0)){this._fmodules_blend_mode[d]=(e[h++]);this._fmodules_blend_opacity[d]=(e[h++])}}}}return h};a.prototype.LoadFrames=function(j,f){if(GLLibConfig.sprite_useFrameRects&&(this._bs_flags&a.BS_FRAME_RECTS)!=0){var m=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort());if((this._bs_flags&a.BS_FM_OFF_SHORT)==0){this._frames_rects=[];System.arraycopy(f,j,this._frames_rects,0,m<<2);j+=m<<2}else{this._frames_rects_short=[];j=this.readArray2Short(f,j,this._frames_rects_short,0,m<<2,false,false)}}var l=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("nFrames = "+l+"    @ offset "+(j-2))}if(l>0){if((GLLibConfig.sprite_forceShortNumOfFModules)||(GLLibConfig.sprite_allowShortNumOfFModules&&(((this._bs_flags&a.BS_NFM_SHORT)!=0)))){this._frames_nfm_short=[]}else{this._frames_nfm_byte=[]}this._frames_fm_start=[];var d=0;if(GLLibConfig.sprite_useFrameRects&&(this._bs_flags&a.BS_FRAME_RECTS)!=0){this._frames_rects_start=[]}var k=0;for(var e=0;e<l;e++){if(GLLibConfig.sprite_debugLoading){Dbg("    "+e+"    @ offset "+j)}if((GLLibConfig.sprite_forceShortNumOfFModules||GLLibConfig.sprite_allowShortNumOfFModules)&&((this._bs_flags&a.BS_NFM_SHORT)!=0)){this._frames_nfm_short[e]=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort())}else{if(GLLibConfig.sprite_forceShortNumOfFModules){this._frames_nfm_short[e]=(((f[j++])&255)).castToShort()}else{this._frames_nfm_byte[e]=(f[j++])}}if(GLLibConfig.sprite_alwaysBsNoFmStart){this._frames_fm_start[e]=d;d+=this.GetFModules(e).castToShort()}else{this._frames_fm_start[e]=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort())}if(GLLibConfig.sprite_useFrameRects&&(this._bs_flags&a.BS_FRAME_RECTS)!=0){if((this._bs_flags&a.BS_FRAME_RECTS)!=0){this._frames_rects_start[e]=k;k+=(f[j++])}}}if(GLLibConfig.sprite_useFrameRects&&(this._bs_flags&a.BS_FRAME_RECTS)!=0){this._frames_rects_start[this._frames_rects_start.length-1]=k}if(!GLLibConfig.sprite_alwaysBsSkipFrameRc&&(this._bs_flags&a.BS_SKIP_FRAME_RC)==0){if(GLLibConfig.sprite_usePrecomputedFrameRect){var h=l<<2;if((this._bs_flags&a.BS_FM_OFF_SHORT)==0){this._frames_rc=[];for(var e=0;e<h;e++){this._frames_rc[e]=(f[j++])}}else{this._frames_rc_short=[];for(var e=0;e<h;e++){this._frames_rc_short[e]=((((f[j++]&255))+((f[j++]&255)<<8).castToShort()))}}}else{if((this._bs_flags&a.BS_FM_OFF_SHORT)==0){j+=(l<<2)}else{j+=(l<<3)}}}else{}if(GLLibConfig.sprite_useFrameCollRC&&((this._bs_flags&a.BS_FRAME_COLL_RC)!=0)){var h=l<<2;if((this._bs_flags&a.BS_FM_OFF_SHORT)==0){this._frames_col=[];for(var e=0;e<h;e++){this._frames_col[e]=(f[j++])}}else{this._frames_col_short=[];for(var e=0;e<h;e++){this._frames_col_short[e]=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort())}}}}return j};a.prototype.LoadAFrames=function(h,e){var f=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("nAFrames = "+f)}if(f>0){if(GLLibConfig.sprite_useSingleArrayForFMAF){this._aframes=LowAPI.Gen_Array([f*5],0);System.arraycopy(e,h,this._aframes,0,this._aframes.length);h+=this._aframes.length}else{if((GLLibConfig.sprite_forceShortIndexForAFrames)||(GLLibConfig.sprite_allowShortIndexForAFrames&&(((this._bs_flags&a.BS_AF_INDEX_SHORT)!=0)))){this._aframes_frame_short=[]}else{this._aframes_frame_byte=[]}this._aframes_time=[];if(GLLibConfig.sprite_useAfOffShort&&((this._bs_flags&a.BS_AF_OFF_SHORT)!=0)){this._aframes_ox_short=[];this._aframes_oy_short=[]}else{this._aframes_ox_byte=[];this._aframes_oy_byte=[]}this._aframes_flags=[];for(var d=0;d<f;d++){if((GLLibConfig.sprite_forceShortIndexForAFrames||GLLibConfig.sprite_allowShortIndexForAFrames)&&((this._bs_flags&a.BS_AF_INDEX_SHORT)!=0)){this._aframes_frame_short[d]=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort())}else{if(GLLibConfig.sprite_forceShortIndexForAFrames){this._aframes_frame_short[d]=(((e[h++])&255)).castToShort()}else{this._aframes_frame_byte[d]=(e[h++])}}this._aframes_time[d]=(e[h++]);if(GLLibConfig.sprite_useAfOffShort&&((this._bs_flags&a.BS_AF_OFF_SHORT)!=0)){this._aframes_ox_short[d]=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort());this._aframes_oy_short[d]=((((e[h++]&255))+((e[h++]&255)<<8)).castToShort())}else{this._aframes_ox_byte[d]=(e[h++]);this._aframes_oy_byte[d]=(e[h++])}this._aframes_flags[d]=(e[h++])}}}return h};a.prototype.LoadAnims=function(j,f){var h=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("nAnims = "+h)}if(h>0){if((GLLibConfig.sprite_forceShortNumOfAFrames)||(GLLibConfig.sprite_allowShortNumOfAFrames&&(((this._bs_flags&a.BS_NAF_SHORT)!=0)))){this._anims_naf_short=[]}else{this._anims_naf_byte=[]}this._anims_af_start=[];var e=0;for(var d=0;d<h;d++){if((GLLibConfig.sprite_forceShortNumOfAFrames||GLLibConfig.sprite_allowShortNumOfAFrames)&&((this._bs_flags&a.BS_NAF_SHORT)!=0)){this._anims_naf_short[d]=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort())}else{if(GLLibConfig.sprite_forceShortNumOfAFrames){this._anims_naf_short[d]=(((f[j++])&255)).castToShort()}else{this._anims_naf_byte[d]=(f[j++])}}if(GLLibConfig.sprite_alwaysBsNoAfStart){this._anims_af_start[d]=e;e+=this.GetAFrames(d).castToShort()}else{this._anims_af_start[d]=((((f[j++]&255))+((f[j++]&255)<<8)).castToShort())}}}return j};a.prototype.Load=function(d,j,p,h,f){var p=!LowAPI.isUndefined(p)?p:16777215;var h=!LowAPI.isUndefined(h)?h:1;var f=!LowAPI.isUndefined(f)?f:null;try{if(d==null){Assert(false,"Cant load sprite, file[] is null");return}if(GLLibConfig.sprite_debugLoading){Dbg("ASprite.Load("+d.length+" bytes, "+j+")..."+this)}var l=((((d[j++]&255))+((d[j++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("  bs_version = 0x"+Integer.toHexString(l))}if(!(l==a.SUPPORTED_VERSION)){Assert(false,"ASprite.Load.Invalid BSprite version !  GLLib supports only (0x"+Integer.toHexString(a.SUPPORTED_VERSION)+")    this sprite version (0x"+Integer.toHexString(l)+")")}this._bs_flags=(((d[j++]&255))+((d[j++]&255)<<8)+((d[j++]&255)<<16)+((d[j++]&255)<<24));if(GLLibConfig.sprite_debugLoading){Dbg("  bs_flags = 0x"+Integer.toHexString(this._bs_flags))}if(GLLibConfig.sprite_useBSpriteExtraFlags&&((this._bs_flags&a.BS_EXTRA_FLAGS)!=0)){this._bs_extraFlags0=(((d[j++]&255))+((d[j++]&255)<<8)+((d[j++]&255)<<16)+((d[j++]&255)<<24));if(GLLibConfig.sprite_debugLoading){Dbg("  bs_extra_flags0 = 0x"+Integer.toHexString(this._bs_extraFlags0))}}j=this.LoadModules(j,d);j=this.LoadFModules(j,d);j=this.LoadFrames(j,d);j=this.LoadAFrames(j,d);j=this.LoadAnims(j,d);if(this._nModules<=0){Warn("WARNING: sprite with num modules = "+this._nModules);return false}if(GLLibConfig.sprite_ModuleMapping_useModuleImages){if((this._bs_flags&a.BS_MODULE_IMAGES)!=0){j=this.LoadData_useModuleImages(j,d,p,h)}}if(GLLibConfig.sprite_useSingleImageForAllModules){if((this._bs_flags&a.BS_SINGLE_IMAGE)!=0){j=this.LoadData_useSingleImages(j,d,p,h)}}if(GLLibConfig.sprite_useBSpriteExtraFlags&&((this._bs_flags&a.BS_EXTRA_FLAGS)!=0)){if((this._bs_extraFlags0&a.BS_EX0_SINGLE_IMAGE_INDEX)!=0){j=this.LoadData_useSingleImageIndex(j,d,p,h)}}this._loadedPalettes=this._palettes;if(GLLibConfig.sprite_useModuleMapping){this._cur_map=-1;if((this._bs_extraFlags0&a.BS_EX0_MMAPPINGS)!=0){this.LoadModuleMappings(j,d)}else{this._map=[]}}if(GLLibConfig.sprite_usePrecomputedFrameRect&&(GLLibConfig.sprite_alwaysBsSkipFrameRc||(this._bs_flags&a.BS_SKIP_FRAME_RC)!=0)){var m=this.GetFrameCount();if(m>0){var n=0;if(((this._bs_flags&a.BS_FM_OFF_SHORT)==0)&&((this._flags&a.FLAG_FORCE_SHORT_FRAME_RC)==0)){this._frames_rc=[];for(var k=0;k<m;k++){this.GetFrameRect(a.s_rc,k,0,0,0);this._frames_rc[n++]=(a.s_rc[0]).castToByte();this._frames_rc[n++]=(a.s_rc[1]).castToByte();this._frames_rc[n++]=(a.s_rc[2]-a.s_rc[0]).castToByte();this._frames_rc[n++]=(a.s_rc[3]-a.s_rc[1]).castToByte()}}else{this._frames_rc_short=[];for(var k=0;k<m;k++){this.GetFrameRect(a.s_rc,k,0,0,0);this._frames_rc_short[n++]=(a.s_rc[0]).castToShort();this._frames_rc_short[n++]=(a.s_rc[1]).castToShort();this._frames_rc_short[n++]=(a.s_rc[2]-a.s_rc[0]).castToShort();this._frames_rc_short[n++]=(a.s_rc[3]-a.s_rc[1]).castToShort()}}}}else{if((this._flags&a.FLAG_FORCE_SHORT_FRAME_RC)!=0){Dbg("SetForceShortFrameRC: You need to enable sprite_alwaysBsSkipFrameRc or export the sprite with ASprite.BS_SKIP_FRAME_RC sprite flag to use this functionality!");this.SetForceShortFrameRC(false)}}if(GLLibConfig.sprite_debugLoading){Dbg("ASprite.Load --- ok!")}}catch(o){throw o}if(a.temp!=null){GetModuleRect(null,0,0,0,0)}};a.prototype.FreeCacheData=function(d){var d=!LowAPI.isUndefined(d)?d:true;if(GLLibConfig.sprite_useSingleImageForAllModules&&((this._bs_flags&a.BS_SINGLE_IMAGE)!=0)){this._pal_data=null}this._pal_data=null;this._pal_short=null;this._pal_int=null;if(GLLibConfig.sprite_useDoubleArrayForModuleData){if(d){if(this._modules_data_array!=null){for(var e=0;e<this._modules_data_array.length;e++){this._modules_data_array[e]=null}this._modules_data_array=null}}else{ReleaseUnmarkedModuleCompressedData(true)}}else{if(!(d)){Assert(false,"FreeCacheData: Param is FALSE, but can't free partial compressed data unless sprite_useDoubleArrayForModuleData is TRUE!")}this._modules_data=null;if(GLLibConfig.sprite_useModuleDataOffAsShort){this._modules_data_off_short=null}else{this._modules_data_off_int=null}}};a.prototype.LoadModuleMappings=function(n,k){if(GLLibConfig.sprite_useModuleMapping){var p=Mem_GetShort(k,n);n+=2;this._map=LowAPI.Gen_Array([p],null);if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET)!=0){if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET_SHORT)!=0){this._map_offset_short=LowAPI.Gen_Array([p],null)}else{this._map_offset_byte=LowAPI.Gen_Array([p],null)}}for(var e=0;e<p;e++){if(this._map[e]==null){this._map[e]=LowAPI.Gen_Array([this._nModules],0);for(var o=0;o<this._nModules;o++){this._map[e][o]=o.castToShort()}}if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET)!=0){if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET_SHORT)!=0){this._map_offset_short[e]=LowAPI.Gen_Array([this._nModules<<1],0)}else{this._map_offset_byte[e]=LowAPI.Gen_Array([this._nModules<<1],0)}}var d=Mem_GetShort(k,n);n+=2;for(var j=0;j<d;j++){var m=Mem_GetShort(k,n);n+=2;var l=Mem_GetShort(k,n);n+=2;this._map[e][m]=l.castToShort();if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET)!=0){if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET_SHORT)!=0){var h=Mem_GetShort(k,n);n+=2;var f=Mem_GetShort(k,n);n+=2;this._map_offset_short[e][m<<1]=h.castToShort();this._map_offset_short[e][(m<<1)+1]=f.castToShort()}else{this._map_offset_byte[e][m<<1]=k[n++];this._map_offset_byte[e][(m<<1)+1]=k[n++]}}}}}return n};a.prototype.SetModuleMapping=function(h,k){if(GLLibConfig.sprite_useModuleMapping){if(!(((this._bs_extraFlags0&a.BS_EX0_MMAPPINGS)==0))){Assert(false,"Sprite Extra Flag Error: Using BS_MMAPPINGS flag in sprite and trying to SetModuleMapping manually - not supported!")}if((this._bs_extraFlags0&a.BS_EX0_MMAPPINGS)!=0){return}if(this._map[h]==null){this._map[h]=LowAPI.Gen_Array([this._nModules],0);for(var d=0;d<this._nModules;d++){this._map[h][d]=d.castToShort()}}if(k==null){return}var j=0;while(j<k.length){var f=((k[j++]&255)+((k[j++]&255)<<8));var e=((k[j++]&255)+((k[j++]&255)<<8));this._map[h][f]=e.castToShort()}}};a.prototype.GetCurrentMMapping=function(){if(GLLibConfig.sprite_useModuleMapping){return this._cur_map}return -1};a.prototype.GetMaxMMappingsLoaded=function(){var d=0;if(GLLibConfig.sprite_useModuleMapping){if(this._map!=null){if(this._map.length!=GLLibConfig.MAX_MODULE_MAPPINGS){return this._map.length}d=GLLibConfig.MAX_MODULE_MAPPINGS-1;while((d>=0)&&(this._map[d]==null)){d--}d++}}return d};a.prototype.SetFrameMapping=function(e,i,f){if(!(GLLibConfig.sprite_useFrameMapping)){Assert(false,"ASprite.SetFrameMapping: you should enable sprite_useFrameMapping for using this functionality.")}if(!(i<this.GetFrameCount())){Assert(false,"ASprite.SetFrameMapping: frame0 is out of bounds")}if(!(f<this.GetFrameCount())){Assert(false,"ASprite.SetFrameMapping: frame1 is out of bounds")}if(GLLibConfig.sprite_useFrameMapping){if(this._frameMapping_index==null){var h=this.GetFrameCount();this._frameMapping_index=LowAPI.Gen_Array([h],0);for(var d=0;d<h;d++){this._frameMapping_index[d]=-1}}for(var d=i;d<=f;d++){this._frameMapping_index[d]=e.castToByte()}}};a.prototype.GetAFrameTime=function(e,d){if(GLLibConfig.sprite_useSingleArrayForFMAF){return this._aframes[(this._anims_af_start[e]+d)*5+1]&255}else{return this._aframes_time[this._anims_af_start[e]+d]&255}};a.prototype.GetAFrameFlags=function(h,f,d){if(arguments.length===2){if(GLLibConfig.sprite_useSingleArrayForFMAF){return(this._aframes[((this._anims_af_start[h]+f)*5)+4]&15)}else{return(this._aframes_flags[(this._anims_af_start[h]+f)]&15)}}else{var e;if(GLLibConfig.sprite_useSingleArrayForFMAF){e=this._aframes[((this._anims_af_start[h]+f)*5)+4]&15}else{e=this._aframes_flags[(this._anims_af_start[h]+f)]&15}if((d&a.FLAG_FLIP_X)!=0){e=a.TRANSFORM_FLIP_X[e&7]|(e&~7)}if((d&a.FLAG_FLIP_Y)!=0){e=a.TRANSFORM_FLIP_Y[e&7]|(e&~7)}if((d&a.FLAG_ROT_90)!=0){e=a.TRANSFORM_ROT_90[e&7]|(e&~7)}return e}};a.prototype.GetAFrames=function(d){if(GLLibConfig.sprite_forceShortNumOfAFrames||(GLLibConfig.sprite_allowShortNumOfAFrames&&(((this._bs_flags&a.BS_NAF_SHORT)!=0)))){return this._anims_naf_short[d]}else{return this._anims_naf_byte[d]&255}};a.prototype.GetFModules=function(d){if(GLLibConfig.sprite_forceShortNumOfFModules||(GLLibConfig.sprite_allowShortNumOfFModules&&(((this._bs_flags&a.BS_NFM_SHORT)!=0)))){return this._frames_nfm_short[d]}else{return this._frames_nfm_byte[d]&255}};a.prototype.GetModuleType=function(d){if(GLLibConfig.sprite_useMultipleModuleTypes&&(this._module_types!=null)){return this._module_types[d]}else{return a.MD_IMAGE}};a.prototype.GetModuleX=function(d){if(GLLibConfig.sprite_useModuleXYShort&&((this._bs_flags&a.BS_MODULES_XY_SHORT)!=0)){return this._modules_x_short[d]&65535}else{if(GLLibConfig.sprite_useModuleXY&&((this._bs_flags&a.BS_MODULES_XY)!=0)){return this._modules_x_byte[d]&255}else{return 0}}};a.prototype.GetModuleY=function(d){if(GLLibConfig.sprite_useModuleXYShort&&((this._bs_flags&a.BS_MODULES_XY_SHORT)!=0)){return this._modules_y_short[d]&65535}else{if(GLLibConfig.sprite_useModuleXY&&((this._bs_flags&a.BS_MODULES_XY)!=0)){return this._modules_y_byte[d]&255}else{return 0}}};a.prototype.GetModuleWidth=function(d){if(GLLibConfig.sprite_useModuleWHShort){return this._modules_w_short[d]&65535}else{return this._modules_w_byte[d]&255}};a.prototype.GetModuleHeight=function(d){if(GLLibConfig.sprite_useModuleWHShort){return this._modules_h_short[d]&65535}else{return this._modules_h_byte[d]&255}};a.prototype.GetAFramesOX=function(){if(arguments){switch(arguments.length){case 1:return this._GetAFramesOX_1.apply(this,arguments);case 2:return this._GetAFramesOX_2.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._GetAFramesOX_1=function(d){if(GLLibConfig.sprite_useAfOffShort&&((this._bs_flags&a.BS_AF_OFF_SHORT)!=0)){return this._aframes_ox_short[d]}else{return this._aframes_ox_byte[d]}};a.prototype._GetAFramesOX_2=function(e,d){if(GLLibConfig.sprite_useSingleArrayForFMAF){var f=(this._anims_af_start[e]+d)*5;return this._aframes[f+2]}else{var f=this._anims_af_start[e]+d;return this.GetAFramesOX(f)}};a.prototype.GetAFramesOY=function(){if(arguments){switch(arguments.length){case 1:return this._GetAFramesOY_1.apply(this,arguments);case 2:return this._GetAFramesOY_2.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._GetAFramesOY_1=function(d){if(GLLibConfig.sprite_useAfOffShort&&((this._bs_flags&a.BS_AF_OFF_SHORT)!=0)){return this._aframes_oy_short[d]}else{return this._aframes_oy_byte[d]}};a.prototype._GetAFramesOY_2=function(e,d){if(GLLibConfig.sprite_useSingleArrayForFMAF){var f=(this._anims_af_start[e]+d)*5;return this._aframes[f+3]}else{var f=this._anims_af_start[e]+d;return this.GetAFramesOY(f)}};a.prototype.GetFModuleOX=function(d){if(GLLibConfig.sprite_useFMOffShort||(GLLibConfig.sprite_allowFMOffShort&&((this._bs_flags&a.BS_FM_OFF_SHORT)!=0))){return this._fmodules_ox_short[d]}else{return(this._fmodules_ox_byte[d])}};a.prototype.GetFModuleOY=function(d){if(GLLibConfig.sprite_useFMOffShort||(GLLibConfig.sprite_allowFMOffShort&&((this._bs_flags&a.BS_FM_OFF_SHORT)!=0))){return this._fmodules_oy_short[d]}else{return(this._fmodules_oy_byte[d])}};a.prototype.GetFrameWidth=function(d){if(GLLibConfig.sprite_usePrecomputedFrameRect){if(((this._bs_flags&a.BS_FM_OFF_SHORT)==0)&&((this._flags&a.FLAG_FORCE_SHORT_FRAME_RC)==0)){return(this._frames_rc[(d<<2)+2]&255)}else{return(this._frames_rc_short[(d<<2)+2]&65535)}}else{this.GetFrameRect(a.s_rc,d,0,0,0);return a.s_rc[2]-a.s_rc[0]}};a.prototype.GetFrameHeight=function(d){if(GLLibConfig.sprite_usePrecomputedFrameRect){if(((this._bs_flags&a.BS_FM_OFF_SHORT)==0)&&((this._flags&a.FLAG_FORCE_SHORT_FRAME_RC)==0)){return(this._frames_rc[(d<<2)+3]&255)}else{return(this._frames_rc_short[(d<<2)+3]&65535)}}else{this.GetFrameRect(a.s_rc,d,0,0,0);return a.s_rc[3]-a.s_rc[1]}};a.prototype.GetFrameMinX=function(d){if(GLLibConfig.sprite_usePrecomputedFrameRect){if(((this._bs_flags&a.BS_FM_OFF_SHORT)==0)&&((this._flags&a.FLAG_FORCE_SHORT_FRAME_RC)==0)){return(this._frames_rc[(d<<2)+0])}else{return(this._frames_rc_short[(d<<2)+0])}}else{this.GetFrameRect(a.s_rc,d,0,0,0);return a.s_rc[0]}};a.prototype.GetFrameMinY=function(d){if(GLLibConfig.sprite_usePrecomputedFrameRect){if(((this._bs_flags&a.BS_FM_OFF_SHORT)==0)&&((this._flags&a.FLAG_FORCE_SHORT_FRAME_RC)==0)){return(this._frames_rc[(d<<2)+1])}else{return(this._frames_rc_short[(d<<2)+1])}}else{this.GetFrameRect(a.s_rc,d,0,0,0);return a.s_rc[1]}};a.prototype.GetFrameModule=function(e,d){if(d!=c){return this._GetFrameModule_2(e,d)}else{if(e!=c){return this._GetFrameModule_1(e)}}throw new Error("InvalidArguments")};a.prototype._GetFrameModule_1=function(f){var e;var d=this.GetFrameModuleFlags(f);if(GLLibConfig.sprite_useSingleArrayForFMAF){e=this._fmodules[f]&255}else{if((GLLibConfig.sprite_forceShortIndexForFModules)||(GLLibConfig.sprite_allowShortIndexForFModules&&(((this._bs_flags&a.BS_FM_INDEX_SHORT)!=0)))){e=this._fmodules_id_short[f]}else{e=this._fmodules_id_byte[f]&255}}if(GLLibConfig.sprite_useIndexExFmodules&&!GLLibConfig.sprite_forceShortIndexForFModules&&(!GLLibConfig.sprite_allowShortIndexForFModules||(((this._bs_flags&a.BS_FM_INDEX_SHORT)==0)))){e|=((d&a.FLAG_INDEX_EX_MASK)<<a.INDEX_EX_SHIFT)}return e};a.prototype._GetFrameModule_2=function(f,d){var e=this.GetFrameModuleOffset(f,d);return this.GetFrameModule(e)};a.prototype.GetFrameModuleFlags=function(f,e,d){if(d!=c){return this._GetFrameModuleFlags_3(f,e,d)}else{if(e!=c){return this._GetFrameModuleFlags_2(f,e)}else{if(f!=c){return this._GetFrameModuleFlags_1(f)}}}throw new Error("InvalidArguments")};a.prototype._GetFrameModuleFlags_1=function(d){if(GLLibConfig.sprite_useSingleArrayForFMAF){return this._fmodules[d+3]&255}else{return this._fmodules_flags[d]&255}};a.prototype._GetFrameModuleFlags_2=function(f,d){var e=this.GetFrameModuleOffset(f,d);return this.GetFrameModuleFlags(e)};a.prototype._GetFrameModuleFlags_3=function(h,f,d){var e=this.GetFrameModuleFlags(h,f);if((d&a.FLAG_FLIP_X)!=0){e=a.TRANSFORM_FLIP_X[e&7]|(e&~7)}if((d&a.FLAG_FLIP_Y)!=0){e=a.TRANSFORM_FLIP_Y[e&7]|(e&~7)}if((d&a.FLAG_ROT_90)!=0){e=a.TRANSFORM_ROT_90[e&7]|(e&~7)}return e};a.prototype.GetFrameModuleOffset=function(e,d){if(GLLibConfig.sprite_useSingleArrayForFMAF){return(this._frames_fm_start[e]+d)<<2}else{return this._frames_fm_start[e]+d}};a.prototype.GetFrameModuleX=function(f,d){if(GLLibConfig.sprite_useSingleArrayForFMAF){var e=(this._frames_fm_start[f]+d)<<2;return this._fmodules[e+1]}else{return this.GetFModuleOX(this._frames_fm_start[f]+d)}};a.prototype.GetFrameModuleY=function(f,d){if(GLLibConfig.sprite_useSingleArrayForFMAF){var e=(this._frames_fm_start[f]+d)<<2;return this._fmodules[e+2]}else{return this.GetFModuleOY(this._frames_fm_start[f]+d)}};a.prototype.GetAnimFrame=function(e,d){var h;if(GLLibConfig.sprite_useSingleArrayForFMAF){var f=(this._anims_af_start[e]+d)*5;h=this._aframes[f]&255;if(GLLibConfig.sprite_useIndexExAframes){h|=((this._aframes[f+4]&a.FLAG_INDEX_EX_MASK)<<a.INDEX_EX_SHIFT)}}else{var f=this._anims_af_start[e]+d;if(GLLibConfig.sprite_forceShortIndexForAFrames||(GLLibConfig.sprite_allowShortIndexForAFrames&&(((this._bs_flags&a.BS_AF_INDEX_SHORT)!=0)))){h=this._aframes_frame_short[f]}else{h=this._aframes_frame_byte[f]&255}if(GLLibConfig.sprite_useIndexExAframes&&!GLLibConfig.sprite_forceShortIndexForAFrames&&(!GLLibConfig.sprite_allowShortIndexForAFrames||(((this._bs_flags&a.BS_AF_INDEX_SHORT)==0)))){h|=((this._aframes_flags[f]&a.FLAG_INDEX_EX_MASK)<<a.INDEX_EX_SHIFT)}}return h};a.prototype.GetFrameRect=function(e,k,f,d,m,l,i){if(arguments.length<6){i=true}if(arguments.length<5){l=false}if(GLLibConfig.sprite_usePrecomputedFrameRect&&(!i)){var o=this.GetFrameMinX(k);var n=this.GetFrameMinY(k);var p=this.GetFrameWidth(k);var r=this.GetFrameHeight(k);if((m&a.FLAG_FLIP_X)!=0){o=-o-p}if((m&a.FLAG_FLIP_Y)!=0){n=-n-r}if((m&a.FLAG_ROT_90)!=0){var h=o;o=-n-r;n=h;var j=p;p=r;r=j}a._rectX1=f+o;a._rectY1=d+n;a._rectX2=a._rectX1+p;a._rectY2=a._rectY1+r}else{var q=null;a._rectX1=Integer.MAX_VALUE;a._rectY1=Integer.MAX_VALUE;a._rectX2=Integer.MIN_VALUE;a._rectY2=Integer.MIN_VALUE;a._operation=a.OPERATION_COMPUTERECT;this.PaintFrame(q,k,f,d,m);a._operation=a.OPERATION_DRAW}e[0]=a._rectX1;e[1]=a._rectY1;e[2]=a._rectX2;e[3]=a._rectY2};a.prototype.GetModuleImageIndex=function(d){return this._module_img==null?0:this._module_img[d]};a.prototype.GetPalette=function(e,d){if(d!=c){return this._GetPalette_2(e,d)}else{if(e!=c){return this._GetPalette_1(e)}}throw new Error("InvalidArguments")};a.prototype._GetPalette_1=function(d){return this.GetPalette(0,d)};a.prototype._GetPalette_2=function(d,e){if((e>=0)&&(e<this._palettes)){if(GLLibConfig.sprite_useSingleImageForAllModules&&((this._bs_flags&a.BS_SINGLE_IMAGE)!=0)){return this.Palette_GetPaletteFromPNG(e)}else{if((this._pal_int!=null)&&(e<this._pal_int[d].length)){return this._pal_int[d][e]}}}return null};a.prototype.GetAnimationCount=function(){if(GLLibConfig.sprite_forceShortNumOfAFrames||(GLLibConfig.sprite_allowShortNumOfAFrames&&(((this._bs_flags&a.BS_NAF_SHORT)!=0)))){if(this._anims_naf_short==null){return 0}return this._anims_naf_short.length}else{if(this._anims_naf_byte==null){return 0}return this._anims_naf_byte.length}};a.prototype.GetFrameCount=function(){if(GLLibConfig.sprite_forceShortNumOfFModules||(GLLibConfig.sprite_allowShortNumOfFModules&&(((this._bs_flags&a.BS_NFM_SHORT)!=0)))){if(this._frames_nfm_short==null){return 0}return this._frames_nfm_short.length}else{if(this._frames_nfm_byte==null){return 0}return this._frames_nfm_byte.length}};a.prototype.GetFrames=function(){return this.GetFrameCount()};a.prototype.IsModuleDataValid=function(d){if(GLLibConfig.sprite_useDoubleArrayForModuleData){if(this._modules_data_array==null){return false}if(this._modules_data_array[d]==null){return false}}else{if(GLLibConfig.sprite_useModuleDataOffAsShort){if(this._modules_data_off_short==null){return false}}else{if(this._modules_data_off_int==null){return false}}if(this._modules_data==null){return false}}return true};a.prototype.GetModuleData=function(){if(arguments){switch(arguments.length){case 1:return this._GetModuleData_1.apply(this,arguments);case 2:return this._GetModuleData_2.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._GetModuleData_1=function(d){if(GLLibConfig.sprite_useDoubleArrayForModuleData){if(this._modules_data_array==null){return null}return this._modules_data_array[d]}else{return this._modules_data}};a.prototype._GetModuleData_2=function(e,d){if((this._modules_image_shortAAA!=null)&&(this._modules_image_shortAAA[d]!=null)){return this._modules_image_shortAAA[d][e]}return null};a.prototype.GetStartModuleData=function(d,e){if(GLLibConfig.sprite_useDoubleArrayForModuleData){return 0}else{if(GLLibConfig.sprite_useModuleDataOffAsShort){if(this._modules_data_off_short!=null){return this._modules_data_off_short[d]&65535}else{return -1}}else{if(this._modules_data_off_int!=null){return this._modules_data_off_int[d]}else{return -1}}}};a.prototype.GetFrameRectCount=function(d){if(GLLibConfig.sprite_useFrameRects){if(this._frames_rects_start!=null){return this._frames_rects_start[d+1]-this._frames_rects_start[d]}}return 0};a.GetPixelBuffer_int=function(){if(arguments){switch(arguments.length){case 1:return a._GetPixelBuffer_int_1.apply(this,arguments);case 3:return a._GetPixelBuffer_int_3.apply(this,arguments)}}throw new Error("InvalidArguments")};a._GetPixelBuffer_int_1=function(d){if((d==null)||(d!=a.temp_int)){if(GLLibConfig.sprite_usePaletteIndexCache&&(a._frame_image_temp!=null)&&(d!=a._frame_image_temp)&&((a.temp_int==null)||(GLLibConfig.sprite_tmpFrameBufferSize>GLLibConfig.TMP_BUFFER_SIZE))){return a._frame_image_temp}if(a.temp_int==null){a.temp_int=LowAPI.Gen_Array([GLLibConfig.TMP_BUFFER_SIZE],0)}return a.temp_int}else{if((d==null)||(d!=a.transform_int)){if(GLLibConfig.sprite_usePaletteIndexCache&&(a._frame_image_temp!=null)&&(d!=a._frame_image_temp)&&((a.transform_int==null)||((GLLibConfig.sprite_tmpFrameBufferSize>GLLibConfig.TMP_BUFFER_SIZE)&&(GLLibConfig.sprite_tmpFrameBufferSize>GLLibConfig.TMP_ALT_BUFFER_SIZE)))){return a._frame_image_temp}if(a.transform_int==null){if(GLLibConfig.TMP_ALT_BUFFER_SIZE>0){a.transform_int=LowAPI.Gen_Array([GLLibConfig.TMP_BUFFER_SIZE],0)}else{a.transform_int=LowAPI.Gen_Array([GLLibConfig.TMP_BUFFER_SIZE],0)}}return a.transform_int}}Dbg("GetPixelBuffer_int: Error - passed buffer equals both ASprite.temp_int AND ASprite.transform_int, this means ASprite.temp_int == ASprite.transform_int?!?!");return null};a.prototype.GetNumPalettes=function(){return this._palettes};a.prototype.GetNumColors=function(d){var d=!LowAPI.isUndefined(d)?d:0;return this._colors[d]};a.IsSingleFModuleCacheEnabled=function(){return GLLibConfig.sprite_useSingleFModuleCache&&((a.s_moduleBufferState&a.MODULE_STATE_DISABLE_MASK)==0)};a.prototype.GetModuleColor=function(d){if(GLLibConfig.sprite_useMultipleModuleTypes){if(this.GetModuleType(d)!=a.MD_IMAGE){if(GLLibConfig.sprite_useModuleColorAsByte){if(this._module_colors_byte!=null){return(this._module_colors_byte[d]).castToInt()}}else{if(this._module_colors_int!=null){return this._module_colors_int[d]}}}}else{Dbg("GetModuleColor: sprite_useMultipleModuleTypes is FALSE so no modules can have color!")}return 0};a.prototype.SetUseCacheRGB=function(d){if(GLLibConfig.sprite_useManualCacheRGBArrays){if(d){this._flags|=a.FLAG_USE_CACHE_RGB}else{this._flags&=~a.FLAG_USE_CACHE_RGB}}else{Dbg("SetUseCacheRGB: You need to enable sprite_useManualCacheRGBArrays to use this functionality!")}};a.prototype.SetModuleX=function(d,e){if(GLLibConfig.sprite_useModuleXYShort&&((this._bs_flags&a.BS_MODULES_XY_SHORT)!=0)){this._modules_x_short[d]=e.castToShort()}else{if(GLLibConfig.sprite_useModuleXY&&((this._bs_flags&a.BS_MODULES_XY)!=0)){this._modules_x_byte[d]=e.castToByte()}}};a.prototype.SetModuleY=function(d,e){if(GLLibConfig.sprite_useModuleXYShort&&((this._bs_flags&a.BS_MODULES_XY_SHORT)!=0)){this._modules_y_short[d]=e.castToShort()}else{if(GLLibConfig.sprite_useModuleXY&&((this._bs_flags&a.BS_MODULES_XY)!=0)){this._modules_y_byte[d]=e.castToByte()}}};a.prototype.SetModuleWidth=function(d,e){if(GLLibConfig.sprite_useModuleWHShort){this._modules_w_short[d]=e.castToShort()}else{this._modules_w_byte[d]=e.castToByte()}};a.prototype.SetModuleHeight=function(d,e){if(GLLibConfig.sprite_useModuleWHShort){this._modules_h_short[d]=e.castToShort()}else{this._modules_h_byte[d]=e.castToByte()}};a.prototype.SetFrameModule=function(i,e,f){var h,d;if(GLLibConfig.sprite_useSingleArrayForFMAF){h=(this._frames_fm_start[i]+e)<<2;d=this._fmodules[h+3]&255;this._fmodules[h]=f.castToByte()}else{h=this._frames_fm_start[i]+e;d=this._fmodules_flags[h]&255;if(GLLibConfig.sprite_forceShortIndexForFModules||(GLLibConfig.sprite_allowShortIndexForFModules&&(((this._bs_flags&a.BS_FM_INDEX_SHORT)!=0)))){this._fmodules_id_short[h]=f.castToShort()}else{this._fmodules_id_byte[h]=f.castToByte()}}};a.prototype.SetAFramesOX=function(f,e,d){if(GLLibConfig.sprite_useSingleArrayForFMAF){var h=(this._anims_af_start[f]+e)*5;this._aframes[h+2]=d.castToByte()}else{var h=this._anims_af_start[f]+e;if(GLLibConfig.sprite_useAfOffShort&&((this._bs_flags&a.BS_AF_OFF_SHORT)!=0)){this._aframes_ox_short[h]=d.castToShort()}else{this._aframes_ox_byte[h]=d.castToByte()}}};a.prototype.SetAFramesOY=function(e,d,h){if(GLLibConfig.sprite_useSingleArrayForFMAF){var f=(this._anims_af_start[e]+d)*5;this._aframes[f+3]=h.castToByte()}else{var f=this._anims_af_start[e]+d;if(GLLibConfig.sprite_useAfOffShort&&((this._bs_flags&a.BS_AF_OFF_SHORT)!=0)){this._aframes_oy_short[f]=h.castToShort()}else{this._aframes_oy_byte[f]=h.castToByte()}}};a.prototype.SetFModuleOX=function(e,d){if(GLLibConfig.sprite_useFMOffShort||(GLLibConfig.sprite_allowFMOffShort&&((this._bs_flags&a.BS_FM_OFF_SHORT)!=0))){this._fmodules_ox_short[e]=d.castToShort()}else{this._fmodules_ox_byte[e]=d.castToByte()}};a.prototype.SetFModuleOY=function(e,d){if(GLLibConfig.sprite_useFMOffShort||(GLLibConfig.sprite_allowFMOffShort&&((this._bs_flags&a.BS_FM_OFF_SHORT)!=0))){this._fmodules_oy_short[e]=d.castToShort()}else{this._fmodules_oy_byte[e]=d.castToByte()}};a.prototype.SetPaletteColor=function(){if(arguments){switch(arguments.length){case 3:return this._SetPaletteColor_3.apply(this,arguments);case 4:return this._SetPaletteColor_4.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._SetPaletteColor_3=function(d,f,e){this.SetPaletteColor(0,d,f,e)};a.prototype._SetPaletteColor_4=function(d,e,h,f){this.Palette_SetColor(d,e,h,f)};a.BlitARGB=function(P,i,u,D,r,p,o,e,q,w,n,M){if(!(P!=null)){Assert(false,"BlitARGB: Target is null!")}if(!(o!=null)){Assert(false,"BlitARGB: Source is null!")}if(!(P!=o)){Assert(false,"BlitARGB: Target is same as Source!")}if(!(P.length>=(i*u))){Assert(false,"BlitARGB: Target array is smaller than the dimensions indicate!")}if(!(o.length>=(e*q))){Assert(false,"BlitARGB: Target array is smaller than the dimensions indicate!")}if(e<=0||q<=0){return}var t,s;if((n&a.FLAG_ROT_90)!=0){(t)=(e);(e)=(q);(q)=(t)}var J=((r)>(0)?(r):(0));var f=((r+e)<(i)?(r+e):(i));var H=((p)>(0)?(p):(0));var d=((p+q)<(u)?(p+q):(u));J=((J)>(a._customGraphicsClipX)?(J):(a._customGraphicsClipX));f=((f)<(a._customGraphicsClipX+a._customGraphicsClipW)?(f):(a._customGraphicsClipX+a._customGraphicsClipW));H=((H)>(a._customGraphicsClipY)?(H):(a._customGraphicsClipY));d=((d)<(a._customGraphicsClipY+a._customGraphicsClipH)?(d):(a._customGraphicsClipY+a._customGraphicsClipH));if(J>f||H>d){return}var L=f-J;var l=d-H;var h=e-L;var m=0;var K=0;var I=0;var k=0;n&=(a.FLAG_FLIP_X|a.FLAG_FLIP_Y|a.FLAG_ROT_90);if((n&a.FLAG_ROT_90)!=0){(t)=(L);(L)=(l);(l)=(t);(t)=(e);(e)=(q);(q)=(t);h=e-L}if(n==0){m=1;K=i-L;I=((H)*i)+(J)-1;k=((H-p)*e)+(J-r)-1}else{if(n==a.FLAG_FLIP_X){m=-1;K=i+L;I=((H)*i)+(f);k=((H-p)*e)+(e-(f-r))-1}else{if(n==a.FLAG_FLIP_Y){m=1;K=-(i+L);I=((d-1)*i)+(J)-1;k=((q-(d-p))*e)+(J-r)-1}else{if(n==(a.FLAG_FLIP_X|a.FLAG_FLIP_Y)){m=-1;K=-(i-L);I=((d-1)*i)+f;k=((q-(d-p))*e)+(e-(f-r))-1}else{if(n==a.FLAG_ROT_90){m=i;K=-(i*L)-1;I=((H-1)*i)+(f)-1;k=((q-(f-r))*e)+(H-p)-1}else{if(n==(a.FLAG_ROT_90|a.FLAG_FLIP_X)){m=-i;K=(i*L)-1;I=((d)*i)+(f)-1;k=((q-(f-r))*e)+(e-(d-p))-1}else{if(n==(a.FLAG_ROT_90|a.FLAG_FLIP_Y)){m=i;K=-(i*L)+1;I=((H-1)*i)+(J);k=((J-r)*e)+(H-p)-1}else{if(n==(a.FLAG_ROT_90|a.FLAG_FLIP_X|a.FLAG_FLIP_Y)){m=-i;K=(i*L)+1;I=((d)*i)+(J);k=((J-r)*e)+(e-(d-p))-1}}}}}}}}s=l;if(w==a.ALPHA_NONE){while(--s>=0){t=L;while(--t>=0){I+=m;P[I]=o[++k]}I+=K;k+=h}}else{if(w==a.ALPHA_TRANSPARENT){while(--s>=0){t=L;while(--t>=0){I+=m;++k;if((o[k]&4278190080)!=0){P[I]=o[k]}}I+=K;k+=h}}else{if(D==a.ALPHA_NONE){var N,F,E,j;while(--s>=0){t=L;while(--t>=0){I+=m;N=(o[++k]>>24)&255;if(N==255){P[I]=o[k]}else{if(N==0){}else{j=(4278190080).castToInt();F=P[I]&16711935;E=o[k]&16711935;j|=((F+((((E-F)*N))>>8))&16711935);F=P[I]&65280;E=o[k]&65280;j|=((F+((((E-F)*N))>>8))&65280);P[I]=j}}}I+=K;k+=h}}else{if(w==a.ALPHA_INDEX){while(--s>=0){t=L;while(--t>=0){I+=m;if(o[++k]!=M){P[I]=o[k]}}I+=K;k+=h}}else{var O,N,F,E,C,j,v,z;while(--s>=0){t=L;while(--t>=0){I+=m;++k;O=(P[I]>>24)&255;N=(o[k]>>24)&255;if((O==0)||(N==255)){P[I]=o[k]}else{if(N==0){}else{if(O==255){j=(4278190080).castToInt();F=P[I]&16711935;E=o[k]&16711935;j|=((F+((((E-F)*N))>>8))&16711935);F=P[I]&65280;E=o[k]&65280;j|=((F+((((E-F)*N))>>8))&65280);P[I]=j}else{C=((255*255)-((255-O)*(255-N)))>>8;if(C==0){P[I]=0}else{O=(255-N)*O;F=(P[I]>>16)&255;E=(o[k]>>16)&255;j=LowAPI.Float2Int(((E*N)+((O*F)>>8))/C);F=(P[I]>>8)&255;E=(o[k]>>8)&255;v=LowAPI.Float2Int(((E*N)+((O*F)>>8))/C);F=P[I]&255;E=o[k]&255;z=LowAPI.Float2Int(((E*N)+((O*F)>>8))/C);if(j>255){j=255}if(v>255){v=255}if(z>255){z=255}P[I]=(C<<24)|(j<<16)|(v<<8)|(z)}}}}}I+=K;k+=h}}}}}};a.FillRectARGB=function(K,f,o,s,m,l,n,C,z){if(!(K!=null)){Assert(false,"FillRectARGB: Target is null!")}if(!(K.length>=(f*o))){Assert(false,"FillRectARGB: Target array is smaller than the dimensions indicate!")}if(n<=0||C<=0){return}var F=((m)>(0)?(m):(0));var e=((m+n)<(f)?(m+n):(f));var D=((l)>(0)?(l):(0));var d=((l+C)<(o)?(l+C):(o));F=((F)>(a._customGraphicsClipX)?(F):(a._customGraphicsClipX));e=((e)<(a._customGraphicsClipX+a._customGraphicsClipW)?(e):(a._customGraphicsClipX+a._customGraphicsClipW));D=((D)>(a._customGraphicsClipY)?(D):(a._customGraphicsClipY));d=((d)<(a._customGraphicsClipY+a._customGraphicsClipH)?(d):(a._customGraphicsClipY+a._customGraphicsClipH));if(F>e||D>d){return}var i=(z>>24)&255;if(i==0){return}var I=e-F;var k=d-D;var H=f-I;var E=(D*f)+(F)-1;l=k;if(i==255){while(--l>=0){m=I;while(--m>=0){K[++E]=z}E+=H}}else{var u=z&16711935;var t=z&65280;var j;if(s==a.ALPHA_NONE){i=255-i;while(--l>=0){m=I;while(--m>=0){++E;j=(4278190080).castToInt();j|=((u+(((((K[E]&16711935)-u)*i))>>8))&16711935);j|=((t+(((((K[E]&65280)-t)*i))>>8))&65280);K[E]=j}E+=H}}else{var J,v,r,p,q;while(--l>=0){m=I;while(--m>=0){++E;J=(K[E]>>24)&255;if(J==0){K[E]=z}else{if(J==255){i=255-i;j=(4278190080).castToInt();j|=((u+(((((K[E]&16711935)-u)*i))>>8))&16711935);j|=((t+(((((K[E]&65280)-t)*i))>>8))&65280);K[E]=j}else{r=((255*255)-((255-J)*(255-i)))>>8;if(r==0){K[E]=0}else{J=(255-i)*J;v=(K[E]>>16)&255;j=LowAPI.Float2Int(((((z>>16)&255)*i)+((J*v)>>8))/r);v=(K[E]>>8)&255;p=LowAPI.Float2Int(((((z>>8)&255)*i)+((J*v)>>8))/r);v=K[E]&255;q=LowAPI.Float2Int((((z&255)*i)+((J*v)>>8))/r);if(j>255){j=255}if(p>255){p=255}if(q>255){q=255}K[E]=(r<<24)|(j<<16)|(p<<8)|(q)}}}}E+=H}}}};a.DrawLineARGB=function(M,f,n,u,D,i,C,h,z){if(!(M!=null)){Assert(false,"DrawLineARGB: Target is null!")}if(!(M.length>=(f*n))){Assert(false,"DrawLineARGB: Target array is smaller than the dimensions indicate!")}var r=(z>>24)&255;if(r==0){return}var J=((a._customGraphicsClipX)>(0)?(a._customGraphicsClipX):(0));var H=((a._customGraphicsClipX+a._customGraphicsClipW)<(f)?(a._customGraphicsClipX+a._customGraphicsClipW):(f));var F=((a._customGraphicsClipY)>(0)?(a._customGraphicsClipY):(0));var E=((a._customGraphicsClipY+a._customGraphicsClipH)<(n)?(a._customGraphicsClipY+a._customGraphicsClipH):(n));H--;E--;if((((D)>(C)?(D):(C))<J)||(((D)<(C)?(D):(C))>H)||(((i)>(h)?(i):(h))<F)||(((i)<(h)?(i):(h))>E)){return}var p=C-D;var m=h-i;var I;var e=false;if(((m)<0?-(m):(m))>((p)<0?-(p):(p))){e=true;(I)=(D);(D)=(i);(i)=(I);(I)=(C);(C)=(h);(h)=(I);(I)=(J);(J)=(F);(F)=(I);(I)=(H);(H)=(E);(E)=(I)}if(D>C){(I)=(D);(D)=(C);(C)=(I);(I)=(i);(i)=(h);(h)=(I)}p=C-D;m=((h-i)<0?-(h-i):(h-i));var y=LowAPI.Float2Int(p/2);var K=(i<h)?1:-1;if(D<J){for(var l=D;l<J;l++){y-=m;if(y<0){i+=K;y+=p}}D=J}while(i<F||i>E){D++;y-=m;if(y<0){i+=K;y+=p}}C=((C)<(H)?(C):(H));C-=(D-1);var d,q,k;if(e){k=(D*f)+i;d=f;q=K}else{k=(i*f)+D;d=1;q=(K>0)?f:-f}if(r==255){while(--C>=0){M[k]=z;k+=d;y-=m;if(y<0){i+=K;k+=q;y+=p;if(i<F||i>E){break}}}}else{if(u==a.ALPHA_NONE){var j;while(--C>=0){j=(4278190080).castToInt();I=M[k]&16711935;j|=((I+(((((z&16711935)-I)*r))>>8))&16711935);I=M[k]&65280;j|=((I+(((((z&65280)-I)*r))>>8))&65280);M[k]=j;k+=d;y-=m;if(y<0){i+=K;k+=q;y+=p;if(i<F||i>E){break}}}}else{var j,o,s,t,w,v;while(--C>=0){var L=(M[k]>>24)&255;if(L==0){M[k]=z}else{if(L==255){j=(4278190080).castToInt();w=M[k]&16711935;j|=((w+(((((z&16711935)-w)*r))>>8))&16711935);w=M[k]&65280;j|=((w+(((((z&65280)-w)*r))>>8))&65280);M[k]=j}else{t=((255*255)-((255-L)*(255-r)))>>8;if(t==0){M[k]=0}else{L=(255-r)*L;w=(M[k]>>16)&255;v=(z>>16)&255;j=LowAPI.Float2Int(((v*r)+((L*w)>>8))/t);w=(M[k]>>8)&255;v=(z>>8)&255;o=LowAPI.Float2Int(((v*r)+((L*w)>>8))/t);w=M[k]&255;v=z&255;s=LowAPI.Float2Int(((v*r)+((L*w)>>8))/t);if(j>255){j=255}if(o>255){o=255}if(s>255){s=255}M[k]=(t<<24)|(j<<16)|(o<<8)|(s)}}}k+=d;y-=m;if(y<0){i+=K;k+=q;y+=p;if(i<F||i>E){break}}}}}};a.prototype.LoadPalettes=function(i,v,o,l,d,h){var e=null;var m=null;for(var r=0;r<this._palettes;r++){this._pal_int[d][r]=LowAPI.Gen_Array([l],0);m=this._pal_int[d][r];if((GLLibConfig.sprite_usePixelFormat8888)&&(o==a.PIXEL_FORMAT_8888)){for(var u=0;u<l;u++){var t=(((v[i++]&255))+((v[i++]&255)<<8)+((v[i++]&255)<<16)+((v[i++]&255)<<24));if((t&4278190080)!=(4278190080).castToInt()){this._alpha=true;if((t&4278190080)!=0){this._multiAlpha=true}}m[u]=(t).castToInt()}}else{if((GLLibConfig.sprite_usePixelFormat4444)&&(o==a.PIXEL_FORMAT_4444)){for(var u=0;u<l;u++){var s=((((v[i++]&255))+((v[i++]&255)<<8)).castToShort());if((s&61440)!=61440){this._alpha=true;if((s&61440)!=0){this._multiAlpha=true}}m[u]=(((s&61440)<<16)|((s&61440)<<12)|((s&3840)<<12)|((s&3840)<<8)|((s&240)<<8)|((s&240)<<4)|((s&15)<<4)|((s&15))).castToInt()}}else{if((GLLibConfig.sprite_usePixelFormat1555)&&(o==a.PIXEL_FORMAT_1555)){for(var u=0;u<l;u++){var f=((((v[i++]&255))+((v[i++]&255)<<8)).castToShort());var w=(4278190080).castToInt();if((f&32768)!=32768){w=0;this._alpha=true}var n=(w|((f&31744)<<9)|((f&992)<<6)|((f&31)<<3)).castToInt();if(n==16253176){n=16711935}m[u]=n}}else{if((GLLibConfig.sprite_usePixelFormat0565)&&(o==a.PIXEL_FORMAT_0565)){for(var u=0;u<l;u++){var k=((((v[i++]&255))+((v[i++]&255)<<8)).castToShort());var w=(4278190080).castToInt();if((k&65535)==63519){w=0;this._alpha=true}var n=(w|((k&63488)<<8)|((k&2016)<<5)|((k&31)<<3)).castToInt();if(n==16253176){n=16711935}m[u]=n}}else{if((GLLibConfig.sprite_usePixelFormat0332)&&(o==a.PIXEL_FORMAT_0332)){for(var u=0;u<l;u++){var j=(((v[i++])&255));var w=(4278190080).castToInt();if(j==192){w=0;this._alpha=true}m[u]=(w|((j&224)<<16)|((j&28)<<11)|((j&3)<<6)).castToInt()}}else{if((GLLibConfig.sprite_usePixelFormat0888)&&(o==a.PIXEL_FORMAT_8808)){this._multiAlpha=false;for(var u=0;u<l;u++){var q=(((v[i++])&255));q+=(((v[i++])&255)<<8);q+=(((v[i++])&255)<<16);if(q==16711935){this._alpha=true}else{q|=(4278190080).castToInt()}m[u]=q}}else{Assert(false,"Sprite Pixel Format Error: Unsupported format! Format ID: 0x"+Integer.toHexString(o))}}}}}}if(o==a.PIXEL_FORMAT_8888){if(!(GLLibConfig.sprite_usePixelFormat8888)){Assert(false,"Sprite Pixel Format Error: Using 8888 but it is not enabled! Set sprite_usePixelFormat8888 to TRUE!")}}else{if(o==a.PIXEL_FORMAT_8808){if(!(GLLibConfig.sprite_usePixelFormat0888)){Assert(false,"Sprite Pixel Format Error: Using 0888 but it is not enabled! Set sprite_usePixelFormat0888 to TRUE!")}}else{if(o==a.PIXEL_FORMAT_4444){if(!(GLLibConfig.sprite_usePixelFormat4444)){Assert(false,"Sprite Pixel Format Error: Using 4444 but it is not enabled! Set sprite_usePixelFormat4444 to TRUE!")}}else{if(o==a.PIXEL_FORMAT_1555){if(!(GLLibConfig.sprite_usePixelFormat1555)){Assert(false,"Sprite Pixel Format Error: Using 1555 but it is not enabled! Set sprite_usePixelFormat1555 to TRUE!")}}else{if(o==a.PIXEL_FORMAT_0565){if(!(GLLibConfig.sprite_usePixelFormat0565)){Assert(false,"Sprite Pixel Format Error: Using 0565 but it is not enabled! Set sprite_usePixelFormat0565 to TRUE!")}}else{if(o==a.PIXEL_FORMAT_0332){if(!(GLLibConfig.sprite_usePixelFormat0332)){Assert(false,"Sprite Pixel Format Error: Using 0332 but it is not enabled! Set sprite_usePixelFormat0332 to TRUE!")}}}}}}}}return i};a.prototype.LoadData_useModuleImages=function(j,h,s,i){if(((this._bs_flags&a.BS_MODULE_IMAGES)!=0)){if(j>=h.length){return j}var o=((((h[j++]&255))+((h[j++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("_pixel_format = 0x"+Integer.toHexString(o))}var l=1;if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){l=(((h[j++])&255)).castToByte()}var n;if(this._colors==null){this._colors=LowAPI.Gen_Array([l],0)}for(var p=0;p<l;p++){n=(((h[j++])&255));if(this._palettes!=n&&p>0){Assert(false,"You must use same palettes number for all images in sprite!")}this._palettes=n;if(GLLibConfig.sprite_debugLoading){Dbg("this._palettes = "+this._palettes)}if(!(this._palettes<=GLLibConfig.MAX_SPRITE_PALETTES)){Assert(false,"Sprite is using more palettes than MAX_SPRITE_PALETTES, please increase this value in GLLibConfig!")}var d=(((h[j++])&255));if(GLLibConfig.sprite_useEncodeFormatI256||GLLibConfig.sprite_useEncodeFormatI256RLE||GLLibConfig.sprite_useEncodeFormatA256_I256RLE){if(d==0){d=256}}this._colors[p]=d;if(GLLibConfig.sprite_debugLoading){Dbg("colors = "+d)}this.InitPalettesArray(l);j=this.LoadPalettes(j,h,o,d,p,s)}this._data_format=((((h[j++]&255))+((h[j++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("this._data_format = 0x"+Integer.toHexString(this._data_format))}if(((this._data_format==a.ENCODE_FORMAT_A256_I64RLE))||((GLLibConfig.sprite_useEncodeFormatA256_I127RLE)&&(this._data_format==a.ENCODE_FORMAT_A256_I127RLE))||((GLLibConfig.sprite_useEncodeFormatA256_I256RLE)&&(this._data_format==a.ENCODE_FORMAT_A256_I256RLE))||((GLLibConfig.sprite_useEncodeFormatA256_I64)&&(this._data_format==a.ENCODE_FORMAT_A256_I64))||((GLLibConfig.sprite_useEncodeFormatA256_I128)&&(this._data_format==a.ENCODE_FORMAT_A256_I128))||((GLLibConfig.sprite_useEncodeFormatA256_I256)&&(this._data_format==a.ENCODE_FORMAT_A256_I256))||((GLLibConfig.sprite_useEncodeFormatA8_I32)&&(this._data_format==a.ENCODE_FORMAT_A8_I32))||((GLLibConfig.sprite_useEncodeFormatA32_I8)&&(this._data_format==a.ENCODE_FORMAT_A32_I8))){this._alpha=true;this._multiAlpha=true}if(GLLibConfig.sprite_useEncodeFormatI64RLE){if(this._data_format==a.ENCODE_FORMAT_I64RLE||this._data_format==a.ENCODE_FORMAT_A256_I64RLE){if(this._i64rle_color_mask==null){this._i64rle_color_mask=LowAPI.Gen_Array([l],0);this._i64rle_color_bits=LowAPI.Gen_Array([l],0)}for(var p=0;p<l;p++){var r=this.GetNumColors(p)-1;this._i64rle_color_mask[p]=1;this._i64rle_color_bits[p]=0;while(r!=0){r>>=1;this._i64rle_color_mask[p]<<=1;this._i64rle_color_bits[p]++}this._i64rle_color_mask[p]--}}}if(this._nModules>0){if(GLLibConfig.sprite_debugLoading){Dbg("LoadData: Loading Module Offsets")}if(GLLibConfig.sprite_useDoubleArrayForModuleData){this._modules_data_array=LowAPI.Gen_Array([this._nModules],null)}else{if(GLLibConfig.sprite_useModuleDataOffAsShort){this._modules_data_off_short=LowAPI.Gen_Array([this._nModules],0)}else{this._modules_data_off_int=LowAPI.Gen_Array([this._nModules],0)}var k=0;var e=j;for(var f=0;f<this._nModules;f++){var q;if((this._bs_flags&a.BS_IMAGE_SIZE_INT)!=0){q=(((h[j++]&255))+((h[j++]&255)<<8)+((h[j++]&255)<<16)+((h[j++]&255)<<24))}else{q=((((h[j++]&255))+((h[j++]&255)<<8)).castToShort());if(!(q>=0)){Assert(false,"LoadingModules: module "+f+" size read as short is negative. You need to add BS_IMAGE_SIZE_INT to this sprites export flags")}}if(GLLibConfig.sprite_debugLoading){Dbg("    Module["+f+"] is located at offset "+k+" and has image data size: "+q)}if(GLLibConfig.sprite_useModuleDataOffAsShort){if(!(k<=65535)){Assert(false,"Module data offset is larger than a short! This means your sprite image data is larger than 64K and you need to set sprite_useModuleDataOffAsShort to FALSE.")}this._modules_data_off_short[f]=k.castToShort()}else{this._modules_data_off_int[f]=k}k+=q;j+=(q)}if(GLLibConfig.sprite_debugLoading){Dbg("LoadData: Loading Module Data")}j=(e);this._modules_data=LowAPI.Gen_Array([k],0)}for(var f=0;f<this._nModules;f++){var q;if((this._bs_flags&a.BS_IMAGE_SIZE_INT)!=0){q=(((h[j++]&255))+((h[j++]&255)<<8)+((h[j++]&255)<<16)+((h[j++]&255)<<24))}else{q=((((h[j++]&255))+((h[j++]&255)<<8)).castToShort());if(!(q>=0)){Assert(false,"LoadingModules: module "+f+" size read as short is negative. You need to add BS_IMAGE_SIZE_INT to this sprites export flags")}}if(GLLibConfig.sprite_debugLoading){Dbg("module["+f+"] size = "+q)}if(GLLibConfig.sprite_useDoubleArrayForModuleData){this._modules_data_array[f]=LowAPI.Gen_Array([q],0)}System.arraycopy(h,j,this.GetModuleData(f),this.GetStartModuleData(f,0),q);j+=q}}}return j};a.prototype.LoadData_useSingleImageIndex=function(i,e,r,h){var m=((((e[i++]&255))+((e[i++]&255)<<8)).castToShort());this._data_format=((((e[i++]&255))+((e[i++]&255)<<8)).castToShort());if(GLLibConfig.sprite_debugLoading){Dbg("_pixel_format = 0x"+Integer.toHexString(m))}var k=(((e[i++])&255)).castToByte();var l;if(this._colors==null){this._colors=LowAPI.Gen_Array([k],0)}for(var n=0;n<k;n++){l=(((e[i++])&255));if(this._palettes!=l&&n>0){Assert(false,"You must use same palettes number for all images in sprite!")}this._palettes=l;if(GLLibConfig.sprite_debugLoading){Dbg("this._palettes = "+this._palettes)}if(!(this._palettes<=GLLibConfig.MAX_SPRITE_PALETTES)){Assert(false,"Sprite is using more palettes than MAX_SPRITE_PALETTES, please increase this value in GLLibConfig!")}var d=(((e[i++])&255));if(GLLibConfig.sprite_useEncodeFormatI256||GLLibConfig.sprite_useEncodeFormatI256RLE||GLLibConfig.sprite_useEncodeFormatA256_I256RLE){if(d==0){d=256}}this._colors[n]=d;if(GLLibConfig.sprite_debugLoading){Dbg("colors = "+d)}this.InitPalettesArray(k);i=this.LoadPalettes(i,e,m,d,n,r)}for(var n=0;n<k;n++){var j=((((e[i++]&255))+((e[i++]&255)<<8)).castToShort());var f=((((e[i++]&255))+((e[i++]&255)<<8)).castToShort());var o=(((e[i++]&255))+((e[i++]&255)<<8)+((e[i++]&255)<<16)+((e[i++]&255)<<24));var q=this.GetNumPalettes();for(var p=0;p<q;p++){this.SetCurrentPalette(p);if(this._module_image_imageAA==null){this._module_image_imageAA=LowAPI.Gen_Array([q],null)}if(this._module_image_imageAA[p]==null){this._module_image_imageAA[p]=LowAPI.Gen_Array([this._nModules],null)}if(GLLibConfig.sprite_useCreateRGB&&this.DecodeImage_Algorithm(n,e,i,j,f)){this._module_image_imageAA[p][n]=Image.createRGBImage(a.temp_int,j,f,true)}}i+=o}if(!(GLLibConfig.sprite_useCreateRGB)){Assert(false,"You need to enable GLLibConfig.sprite_useCreateRGB for proper work of BS_SINGLE_IMAGE_INDEX flag")}this._bs_flags|=a.BS_SINGLE_IMAGE;return i};a.prototype.LoadData_useSingleImages=function(o,j,x,l){if(((this._bs_flags&a.BS_SINGLE_IMAGE)!=0)){if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){this._number_image=(j[o++]);this._pal_data_array=LowAPI.Gen_Array([this._number_image],null)}else{this._number_image=1}this._colors=LowAPI.Gen_Array([this._number_image],0);this._modules_data_array=LowAPI.Gen_Array([this._number_image],null);for(var p=0;p<this._number_image;p++){if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){var u=((((j[o++]&255))+((j[o++]&255)<<8)).castToShort());var r=((((j[o++]&255))+((j[o++]&255)<<8)).castToShort())}var v=0;if((this._bs_flags&a.BS_IMAGE_SIZE_INT)!=0){v=(((j[o++]&255))+((j[o++]&255)<<8)+((j[o++]&255)<<16)+((j[o++]&255)<<24))}else{v=((((j[o++]&255))+((j[o++]&255)<<8)).castToShort());if(!(v>=0)){Assert(false,"LoadingSingleImage: size read as short is negative. You need to add ASprite.BS_IMAGE_SIZE_INT to this sprites export flags")}}if(GLLibConfig.sprite_debugLoading){Dbg("png size = "+v)}var t=0;if(GLLibConfig.sprite_useDoubleArrayForModuleData){this._modules_data_array[p]=LowAPI.Gen_Array([v],0);System.arraycopy(j,o,this._modules_data_array[p],0,v);o+=v}else{if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){this._modules_data_array[p]=LowAPI.Gen_Array([v],0);System.arraycopy(j,o,this._modules_data_array[p],0,v);o+=v}else{this._modules_data=LowAPI.Gen_Array([v],0);System.arraycopy(j,o,this._modules_data,0,v);o+=v}}this._palettes=(((j[o++])&255));if(GLLibConfig.sprite_debugLoading){Dbg("this._palettes = "+this._palettes)}if(!(this._palettes<=GLLibConfig.MAX_SPRITE_PALETTES)){Assert(false,"Sprite is using more palettes than MAX_SPRITE_PALETTES, please increase this value in GLLibConfig!")}var q;var e;var n;var d=0;if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){d=(((j[o++])&255));if(d==0){d=256}if(GLLibConfig.sprite_debugLoading){Dbg("colors = "+d)}q=d*3+4;e=d+4;n=q+e;if(GLLibConfig.sprite_debugLoading){Dbg("pal_size = "+n)}this._pal_data_array[p]=LowAPI.Gen_Array([this._palettes*n],0);System.arraycopy(this._modules_data_array[p],41+t,this._pal_data_array[p],0,q);System.arraycopy(this._modules_data_array[p],41+q+8+t,this._pal_data_array[p],q,e);System.arraycopy(j,o,this._pal_data_array[p],n,(this._palettes-1)*n);o+=(this._palettes-1)*n}else{d=(((j[o++])&255));if(d==0){d=256}if(GLLibConfig.sprite_debugLoading){Dbg("colors = "+d)}q=d*3+4;e=d+4;n=q+e;if(GLLibConfig.sprite_debugLoading){Dbg("pal_size = "+n)}this._pal_data=LowAPI.Gen_Array([this._palettes*n],0);if(GLLibConfig.sprite_useDoubleArrayForModuleData){System.arraycopy(this._modules_data_array[0],41+t,this._pal_data,0,q);System.arraycopy(this._modules_data_array[0],41+q+8+t,this._pal_data,q,e)}else{System.arraycopy(this._modules_data,41+t,this._pal_data,0,q);System.arraycopy(this._modules_data,41+q+8+t,this._pal_data,q,e)}System.arraycopy(j,o,this._pal_data,n,(this._palettes-1)*n);o+=(this._palettes-1)*n;var m=q;for(var s=0;s<this._palettes;s++){for(var k=0;k<d;k++){var f=this._pal_data[m]&255;if(f!=255){this._alpha=true;if(f!=0){this._multiAlpha=true;break}}m++}m+=4+q}}this._colors[p]=d;if(GLLibConfig.sprite_debugLoading){Dbg("...read pal data")}}}return o};a.prototype.PFXCache_TryPaintModule=function(j,h,d,k,f){if(GLLibConfig.pfx_enableModuleCaching&&PFXCache_IsInited()){var i=PFX_GetFirstEnabledEffect();var e=PFX_GetParams(i);if(PFXCache_IsModuleCached(h,e,i)){DrawRegion(this._imgPFXModuleCache[h],0,0,this._imgPFXModuleCache[h].getWidth(),this._imgPFXModuleCache[h].getHeight(),a.midp2_flags[f],d,k,LEFT|TOP,false);return true}}return false};a.prototype.PFXCache_TryCacheAndPaintModule=function(k,e,m,l,j,h){if(GLLibConfig.pfx_enableModuleCaching&&PFXCache_IsInited()&&j!=null){var d=PFX_GetFirstEnabledEffect();var f=PFX_GetParams(d);var i=Image.createRGBImage(j,s_PFX_newSizeX,s_PFX_newSizeY,true);PFXCache_SetModuleImage(e,i,d,f);DrawRegion(this._imgPFXModuleCache[e],0,0,this._imgPFXModuleCache[e].getWidth(),this._imgPFXModuleCache[e].getHeight(),a.midp2_flags[h],m,l,LEFT|TOP,false);return true}return false};a.InitCachePool=function(d){if(GLLibConfig.sprite_useCachePool){a._poolCacheStack=LowAPI.Gen_Array([d],null);a._poolCacheSprites=LowAPI.Gen_Array([d],null);a._poolCacheStackIndex=LowAPI.Gen_Array([d],0);a._poolCacheStackMax=LowAPI.Gen_Array([d],0)}};a.InitPoolSize=function(d,f){if(GLLibConfig.sprite_useCachePool){a._poolCacheStackMax[d]=f;a._poolCacheStack[d]=LowAPI.Gen_Array([f],0);a._poolCacheSprites[d]=LowAPI.Gen_Array([f],null);for(var e=0;e<a._poolCacheStack[d].length;++e){a._poolCacheStack[d][e]=-1}}};a.ResetCachePool=function(d){if(GLLibConfig.sprite_useCachePool){a._poolCacheStack[d]=null;a._poolCacheSprites[d]=null;a._poolCacheStackIndex[d]=0;a._poolCacheStackMax[d]=0}};a.prototype.SetPool=function(d){if(GLLibConfig.sprite_useCachePool){this._cur_pool=d;if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA==null){this._module_image_intAAA=LowAPI.Gen_Array([this._palettes],null);for(var e=0;e<this._palettes;e++){this._module_image_intAAA[e]=LowAPI.Gen_Array([this._nModules],null)}}}else{if(this._module_image_imageAA==null){this._module_image_imageAA=LowAPI.Gen_Array([this._palettes],null);for(var e=0;e<this._palettes;e++){this._module_image_imageAA[e]=LowAPI.Gen_Array([this._nModules],null)}}}}};a.prototype.UpdatePoolCache=function(f,e,d){if(d!=c){return this._UpdatePoolCache_3(f,e,d)}else{if(e!=c){return this._UpdatePoolCache_2(f,e)}}throw new Error("InvalidArguments")};a.prototype._UpdatePoolCache_2=function(d,e){this.UpdatePoolCache(d,0,e)};a.prototype._UpdatePoolCache_3=function(e,m,f){if(GLLibConfig.sprite_useCachePool){if(this._cur_pool>=0){if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA[this._crt_pal][e]!=null){return}}else{if(this._module_image_imageAA[this._crt_pal][e]!=null){return}}var j=a._poolCacheStackIndex[this._cur_pool];var h=a._poolCacheStack[this._cur_pool][j];var i=h>>10;var k=h&1023;if(h>=0){var l=a._poolCacheSprites[this._cur_pool][j];if(l!=null){if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){l._module_image_intAAA[i][k]=null}else{l._module_image_imageAA[i][k]=null}}}var d=((e&1023)+(this._crt_pal<<10)).castToShort();a._poolCacheStack[this._cur_pool][j]=d;a._poolCacheSprites[this._cur_pool][j]=this;a._poolCacheStackIndex[this._cur_pool]=(a._poolCacheStackIndex[this._cur_pool]+1)%a._poolCacheStackMax[this._cur_pool];if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if((this._module_image_intAAA[this._crt_pal][e]==null)||(this._module_image_intAAA[this._crt_pal][e].length!=m)){this._module_image_intAAA[this._crt_pal][e]=LowAPI.Gen_Array([m],0)}System.arraycopy(f,0,this._module_image_intAAA[this._crt_pal][e],0,m)}else{this._module_image_imageAA[this._crt_pal][e]=f}}}};a.prototype.PaletteBlending_InitDynamic=function(e,d,i,h,f){PaletteBlending_InitStatic(e,d,i,h,f);return this._palBlend_dest};a.prototype.PaletteBlending_SynchCache=function(){};a.prototype.PaletteBlending_BuildPalette=function(){if(arguments){switch(arguments.length){case 1:return this._PaletteBlending_BuildPalette_1.apply(this,arguments);case 5:if(typeof arguments[2]=="number"){return this._PaletteBlending_BuildPalette_5_1.apply(this,arguments)}else{return this._PaletteBlending_BuildPalette_5_2.apply(this,arguments)}}}throw new Error("InvalidArguments")};a.prototype._PaletteBlending_BuildPalette_1=function(d){return this.PaletteBlending_BuildPalette(d,this._palBlend_srcA,this._palBlend_srcB,this._palBlend_dest,this._palBlend_UseOneColor)};a.prototype._PaletteBlending_BuildPalette_5_1=function(l,o,n,e,p){if(!((l>=0)&&(l<=255))){Assert(false,"PaletteBlending: Blend value must be [0,255]!")}if(!((o>=0)&&(o<this._palettes))){Assert(false,"PaletteBlending: Palette parameter 1 must be a valid palette")}if(!((e>=0)&&(e<this._palettes))){Assert(false,"PaletteBlending: Palette parameter 3 must be a valid palette")}if(!p){if(!((n>=0)&&(n<this._palettes))){Assert(false,"PaletteBlending: Palette parameter 2 must be a valid palette")}}var h=false;var k=this.GetPalette(0,o);var m=this.GetPalette(0,e);var i,f;var d=this.GetNumColors(0);if(!p){var j=this.GetPalette(0,n);h=this.PaletteBlending_BuildPalette(l,d,k,j,m)}else{i=((n)&16711935)*l;f=((n>>8)&16711935)*l;l=256-l;while(--d>=0){if((k[d]&16777215)==16711935){h=true;m[d]=16711935}else{m[d]=(((k[d]&16711935)*l+i)>>8)&16711935;m[d]|=((((k[d]>>8)&16711935)*l+f)&4278255360).castToInt();if((m[d]&4278190080)!=(4278190080).castToInt()){h=true}}}}return h||this._alpha};a.prototype._PaletteBlending_BuildPalette_5_2=function(m,o,k,j,n){if(!((m>=0)&&(m<=255))){Assert(false,"PaletteBlending: Blend value must be [0,255]!")}if(!((k!=null)&&(k.length>=o))){Assert(false,"PaletteBlending: Palette array palA must be a valid palette with min size: "+o)}if(!((j!=null)&&(j.length>=o))){Assert(false,"PaletteBlending: Palette array palB must be a valid palette with min size: "+o)}if(!((n!=null)&&(n.length>=o))){Assert(false,"PaletteBlending: Palette array palR must be a valid palette with min size: "+o)}var e=false;var l,p;var f,d;var h=o;while(--h>=0){l=k[h];if((l&16777215)==16711935){e=true;n[h]=16711935}else{p=j[h];f=l&16711935;d=p&16711935;n[h]=(f+(((d-f)*m)>>8))&16711935;f=(l>>8)&16711935;d=(p>>8)&16711935;n[h]|=(((f<<8)+((d-f)*m))&4278255360).castToInt();if((n[h]&4278190080)!=(4278190080).castToInt()){if((n[h]&4278190080)!=(4278190080).castToInt()){e=true}}}}return e};a.prototype.DecodeImage_int=function(e){throw new Error("lnthieu: To opt performance, pls using DecodeImage_JSCanvas");if(GLLibConfig.sprite_useCreateRGB){if(this.IsModuleDataValid(e)){var d=this.GetModuleImageIndex(e);if(this.DecodeImage_Algorithm(d,this.GetModuleData(e),this.GetStartModuleData(e,0),this.GetModuleWidth(e),this.GetModuleHeight(e))){return a.temp_int}}}else{Dbg("DecodeImage_int: sprite_useCreateRGB is FALSE, can't use this function!")}return null};a.prototype.DecodeImage_JSCanvas=function(p,d,l,v,o,j){var s=0;var m=o*j;var i=null;if(GLLibConfig.sprite_useCreateRGB){i=this.GetPalette(d,this.GetCurrentPalette(d));if(i==null){Warn("DecodeImage_JSImageData# palette is null");return false}}else{throw new Error("DecodeImage_JSImageData# not supported now!")}var f=p.getContext("2d").getImageData(0,0,p.width,p.height);var t=0;var z=0;var y=0;var h=function(C,B,n,A){var D=B*4;if(n){f.data[D+0]=(C>>16)&255;f.data[D+1]=(C>>8)&255;f.data[D+2]=(C>>0)&255;if(!A){f.data[D+3]=255}}if(A){f.data[D+3]=(C>>24)&255}};var k=function(D){var E=D*4;var C=f.data[E+0];var B=f.data[E+1];var n=f.data[E+2];var A=f.data[E+3];return(A<<24)|(C<<16)|(B<<8)|(n)};if((GLLibConfig.sprite_useEncodeFormatI64RLE)&&(this._data_format==a.ENCODE_FORMAT_I64RLE)){while(s<m){var u=l[v++]&255;t=i[u&this._i64rle_color_mask[d]];u>>=this._i64rle_color_bits[d];while(u-->=0){h(t,s++,true,true)}}}else{if((GLLibConfig.sprite_useEncodeFormatI127RLE)&&(this._data_format==a.ENCODE_FORMAT_I127RLE)){while(s<m){var u=l[v++]&255;if(u>127){var q=l[v++]&255;t=i[q];u-=128;while(u-->0){h(t,s++,true,true)}}else{h(i[u],s++,true,true)}}}else{if((GLLibConfig.sprite_useEncodeFormatI256RLE)&&(this._data_format==a.ENCODE_FORMAT_I256RLE)){var u;v--;s--;m--;while(s<m){u=l[++v];if(u<0){u+=128;do{h(i[l[++v]&255],++s,true,true)}while(--u>0)}else{t=i[l[++v]&255];do{h(t,++s,true,true)}while(--u>0)}}}else{if((GLLibConfig.sprite_useEncodeFormatI16)&&(this._data_format==a.ENCODE_FORMAT_I16)){m+=((m&1)==0)?0:2;m=m>>1;while(--m>=0){var u=l[v++];t=i[(u>>4)&15];h(t,s++,true,true);t=i[(u)&15];h(t,s++,true,true)}}else{if((GLLibConfig.sprite_useEncodeFormatI4)&&(this._data_format==a.ENCODE_FORMAT_I4)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_I4");m+=((m&3)==0)?0:4;m=m>>2;while(--m>=0){var u=l[v++];if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=i[(u>>6)&3];a.temp_int[s++]=i[(u>>4)&3];a.temp_int[s++]=i[(u>>2)&3];a.temp_int[s++]=i[(u)&3]}else{a.temp_byte[s++]=((u>>6)&3).castToByte();a.temp_byte[s++]=((u>>4)&3).castToByte();a.temp_byte[s++]=((u>>2)&3).castToByte();a.temp_byte[s++]=((u)&3).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatI2)&&(this._data_format==a.ENCODE_FORMAT_I2)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_I2");m+=((m&7)==0)?0:8;m=m>>3;while(--m>=0){var u=l[v++];if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=i[(u>>7)&1];a.temp_int[s++]=i[(u>>6)&1];a.temp_int[s++]=i[(u>>5)&1];a.temp_int[s++]=i[(u>>4)&1];a.temp_int[s++]=i[(u>>3)&1];a.temp_int[s++]=i[(u>>2)&1];a.temp_int[s++]=i[(u>>1)&1];a.temp_int[s++]=i[(u)&1]}else{a.temp_byte[s++]=((u>>7)&1).castToByte();a.temp_byte[s++]=((u>>6)&1).castToByte();a.temp_byte[s++]=((u>>5)&1).castToByte();a.temp_byte[s++]=((u>>4)&1).castToByte();a.temp_byte[s++]=((u>>3)&1).castToByte();a.temp_byte[s++]=((u>>2)&1).castToByte();a.temp_byte[s++]=((u>>1)&1).castToByte();a.temp_byte[s++]=((u)&1).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatI256)&&(this._data_format==a.ENCODE_FORMAT_I256)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_I256");while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=i[l[v++]&255]}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I256)&&(this._data_format==a.ENCODE_FORMAT_A256_I256)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_A256_I256");while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=((l[v++]&255)<<24)|(i[l[v++]&255]&16777215)}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatA8_I32)&&(this._data_format==a.ENCODE_FORMAT_A8_I32)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_A8_I32");while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=((l[v]&224)<<24)|(i[l[v]&31]&16777215)}else{a.temp_byte[s++]=(l[v]&255).castToByte()}v++}}else{if((GLLibConfig.sprite_useEncodeFormatA32_I8)&&(this._data_format==a.ENCODE_FORMAT_A32_I8)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_A32_I8");while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=((l[v]&248)<<24)|(i[l[v]&7]&16777215)}else{a.temp_byte[s++]=(l[v]&255).castToByte()}v++}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I64)&&(this._data_format==a.ENCODE_FORMAT_A256_I64)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_A256_I64");var x=0;while(s<m){switch(x){case 0:a.temp_int[s]=((l[v]&252)>>2);s++;break;case 1:a.temp_int[s]=((l[v]&3)<<4);v++;a.temp_int[s]=(((l[v]&240)>>4)|a.temp_int[s]);s++;break;case 2:a.temp_int[s]=((l[v]&15)<<2);v++;a.temp_int[s]=(((l[v]&192)>>6)|a.temp_int[s]);s++;break;case 3:a.temp_int[s]=(l[v]&63);s++;v++;x=-1;break}x++}s=0;while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=((l[v++]&255)<<24)|(i[a.temp_int[s]&255]&16777215);s++}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I128)&&(this._data_format==a.ENCODE_FORMAT_A256_I128)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_A256_I128");var x=0;while(s<m){switch(x){case 0:a.temp_int[s]=((l[v]&254)>>1);s++;break;case 1:a.temp_int[s]=((l[v]&1)<<6);v++;a.temp_int[s]=(((l[v]&252)>>2)|a.temp_int[s]);s++;break;case 2:a.temp_int[s]=((l[v]&3)<<5);v++;a.temp_int[s]=(((l[v]&248)>>3)|a.temp_int[s]);s++;break;case 3:a.temp_int[s]=((l[v]&7)<<4);v++;a.temp_int[s]=(((l[v]&240)>>4)|a.temp_int[s]);s++;break;case 4:a.temp_int[s]=((l[v]&15)<<3);v++;a.temp_int[s]=(((l[v]&224)>>5)|a.temp_int[s]);s++;break;case 5:a.temp_int[s]=((l[v]&31)<<2);v++;a.temp_int[s]=(((l[v]&192)>>6)|a.temp_int[s]);s++;break;case 6:a.temp_int[s]=((l[v]&63)<<1);v++;a.temp_int[s]=(((l[v]&128)>>7)|a.temp_int[s]);s++;break;case 7:a.temp_int[s]=(l[v]&127);v++;s++;x=-1;break}x++}s=0;while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=((l[v++]&255)<<24)|(i[a.temp_int[s]&255]&16777215);s++}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((this._data_format==a.ENCODE_FORMAT_A256_I64RLE)){while(s<m){var u=l[v++]&255;t=i[u&this._i64rle_color_mask[d]];u>>=this._i64rle_color_bits[d];while(u-->=0){h(t,s++,true,true)}}s=0;while(s<m){var w=l[v++]&255;if(w==254){var r=l[v++]&255;w=l[v++]&255;while(r-->0){var e=k(s);e=(w<<24)|(e&16777215);h(e,s++,true,true)}}else{var e=k(s);e=(w<<24)|(e&16777215);h(e,s++,true,true)}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I127RLE)&&(this._data_format==a.ENCODE_FORMAT_A256_I127RLE)){throw new Error("DecodeImage_JSImageData# ENCODE_FORMAT_A256_I127RLE");while(s<m){var u=l[v++]&255;if(u>127){var q=l[v++]&255;if(GLLibConfig.sprite_useCreateRGB){t=i[q]}else{y=(q).castToByte()}u-=128;while(u-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=t}else{a.temp_byte[s++]=y}}}else{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=i[u]}else{a.temp_byte[s++]=(u).castToByte()}}}s=0;while(s<m){var w=l[v++]&255;if(w==254){var r=l[v++]&255;w=l[v++]&255;while(r-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}else{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I256RLE)&&(this._data_format==a.ENCODE_FORMAT_A256_I256RLE)){while(s<m){var u=l[v++]&255;if(u>127){u-=128;while(u-->0){h(i[l[v++]&255],s++,true,false)}}else{if(GLLibConfig.sprite_useCreateRGB){t=i[l[v++]&255]}else{y=(l[v++]&255).castToByte()}while(u-->0){h(t,s++,true,false)}}}s=0;while(s<m){var w=l[v++]&255;if(w==254){var r=l[v++]&255;w=l[v++]&255;while(r-->0){h((w<<24),s++,false,true)}}else{h((w<<24),s++,false,true)}}}else{switch(this._data_format){case a.ENCODE_FORMAT_I2:Dbg("    -. ASprite.ENCODE_FORMAT_I2");break;case a.ENCODE_FORMAT_I4:Dbg("    -. ASprite.ENCODE_FORMAT_I4");break;case a.ENCODE_FORMAT_I16:Dbg("    -. ASprite.ENCODE_FORMAT_I16");break;case a.ENCODE_FORMAT_I256:Dbg("    -. ASprite.ENCODE_FORMAT_I256");break;case a.ENCODE_FORMAT_I64RLE:Dbg("    -. ASprite.ENCODE_FORMAT_I64RLE");break;case a.ENCODE_FORMAT_I127RLE:Dbg("    -. ASprite.ENCODE_FORMAT_I127RLE");break;case a.ENCODE_FORMAT_I256RLE:Dbg("    -. ASprite.ENCODE_FORMAT_I256RLE");break;case a.ENCODE_FORMAT_A256_I64RLE:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I64RLE");break;case a.ENCODE_FORMAT_A256_I127RLE:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I127RLE");break;case a.ENCODE_FORMAT_A256_I256RLE:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I256RLE");break;case a.ENCODE_FORMAT_A256_I64:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I64");break;case a.ENCODE_FORMAT_A256_I128:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I128");break;case a.ENCODE_FORMAT_A256_I256:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I256");break;case a.ENCODE_FORMAT_A8_I32:Dbg("    -. ASprite.ENCODE_FORMAT_A8_I32");break;case a.ENCODE_FORMAT_A32_I8:Dbg("    -. ASprite.ENCODE_FORMAT_A32_I8");break}Assert(false,"ERROR : sprite encoding for "+Integer.toHexString(this._data_format)+" is not enabled. Check sprite_useEncodeFormat in GllibConfiguration")}}}}}}}}}}}}}}}p.getContext("2d").putImageData(f,0,0);return true};a.prototype.DecodeImage_Algorithm=function(d,l,v,o,k){var s=0;var m=o*k;if(GLLibConfig.sprite_useCreateRGB){if(a.temp_int==null){a.temp_int=LowAPI.Gen_Array([GLLibConfig.TMP_BUFFER_SIZE],0)}if(!(o*k<=a.temp_int.length)){Assert(false,"DecodeImage_Algorithm: Module WxH > ASprite.temp_int.length ("+o+" x "+k+" = "+o*k+" > "+a.temp_int.length+")! Either decrease module size or increase GLLibConfig.TMP_BUFFER_SIZE!")}}else{if(a.temp_byte==null){a.temp_byte=LowAPI.Gen_Array([GLLibConfig.TMP_BUFFER_SIZE],0)}if(!(o*k<=a.temp_byte.length)){Assert(false,"DecodeImage_Algorithm: Module WxH > ASprite.temp_byte.length ("+o+" x "+k+" = "+o*k+" > "+a.temp_byte.length+")!  Either decrease module size or increase GLLibConfig.TMP_BUFFER_SIZE!")}}var j=null;if(GLLibConfig.sprite_useCreateRGB){j=this.GetPalette(d,this.GetCurrentPalette(d));if(j==null){return false}}var t=0;var B=0;var z=0;if((GLLibConfig.sprite_useEncodeFormatI64RLE)&&(this._data_format==a.ENCODE_FORMAT_I64RLE)){while(s<m){var u=l[v++]&255;if(GLLibConfig.sprite_useCreateRGB){t=j[u&this._i64rle_color_mask[d]]}else{z=(u&this._i64rle_color_mask[d]).castToByte()}u>>=this._i64rle_color_bits[d];while(u-->=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=t}else{a.temp_byte[s++]=z}}}}else{if((GLLibConfig.sprite_useEncodeFormatI127RLE)&&(this._data_format==a.ENCODE_FORMAT_I127RLE)){while(s<m){var u=l[v++]&255;if(u>127){var p=l[v++]&255;if(GLLibConfig.sprite_useCreateRGB){t=j[p]}else{z=(p).castToByte()}u-=128;while(u-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=t}else{a.temp_byte[s++]=z}}}else{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=j[u]}else{a.temp_byte[s++]=(u).castToByte()}}}}else{if((GLLibConfig.sprite_useEncodeFormatI256RLE)&&(this._data_format==a.ENCODE_FORMAT_I256RLE)){var u;v--;s--;m--;while(s<m){u=l[++v];if(u<0){u+=128;do{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[++s]=j[l[++v]&255]}else{a.temp_byte[++s]=(l[++v]&255).castToByte()}}while(--u>0)}else{if(GLLibConfig.sprite_useCreateRGB){t=j[l[++v]&255]}else{z=(l[++v]&255).castToByte()}do{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[++s]=t}else{a.temp_byte[++s]=z}}while(--u>0)}}}else{if((GLLibConfig.sprite_useEncodeFormatI16)&&(this._data_format==a.ENCODE_FORMAT_I16)){m+=((m&1)==0)?0:2;m=m>>1;while(--m>=0){var u=l[v++];if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=j[(u>>4)&15];a.temp_int[s++]=j[(u)&15]}else{a.temp_byte[s++]=((u>>4)&15).castToByte();a.temp_byte[s++]=((u)&15).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatI4)&&(this._data_format==a.ENCODE_FORMAT_I4)){m+=((m&3)==0)?0:4;m=m>>2;while(--m>=0){var u=l[v++];if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=j[(u>>6)&3];a.temp_int[s++]=j[(u>>4)&3];a.temp_int[s++]=j[(u>>2)&3];a.temp_int[s++]=j[(u)&3]}else{a.temp_byte[s++]=((u>>6)&3).castToByte();a.temp_byte[s++]=((u>>4)&3).castToByte();a.temp_byte[s++]=((u>>2)&3).castToByte();a.temp_byte[s++]=((u)&3).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatI2)&&(this._data_format==a.ENCODE_FORMAT_I2)){m+=((m&7)==0)?0:8;m=m>>3;while(--m>=0){var u=l[v++];if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=j[(u>>7)&1];a.temp_int[s++]=j[(u>>6)&1];a.temp_int[s++]=j[(u>>5)&1];a.temp_int[s++]=j[(u>>4)&1];a.temp_int[s++]=j[(u>>3)&1];a.temp_int[s++]=j[(u>>2)&1];a.temp_int[s++]=j[(u>>1)&1];a.temp_int[s++]=j[(u)&1]}else{a.temp_byte[s++]=((u>>7)&1).castToByte();a.temp_byte[s++]=((u>>6)&1).castToByte();a.temp_byte[s++]=((u>>5)&1).castToByte();a.temp_byte[s++]=((u>>4)&1).castToByte();a.temp_byte[s++]=((u>>3)&1).castToByte();a.temp_byte[s++]=((u>>2)&1).castToByte();a.temp_byte[s++]=((u>>1)&1).castToByte();a.temp_byte[s++]=((u)&1).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatI256)&&(this._data_format==a.ENCODE_FORMAT_I256)){while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=j[l[v++]&255]}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I256)&&(this._data_format==a.ENCODE_FORMAT_A256_I256)){while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=((l[v++]&255)<<24)|(j[l[v++]&255]&16777215)}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatA8_I32)&&(this._data_format==a.ENCODE_FORMAT_A8_I32)){while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=((l[v]&224)<<24)|(j[l[v]&31]&16777215)}else{a.temp_byte[s++]=(l[v]&255).castToByte()}v++}}else{if((GLLibConfig.sprite_useEncodeFormatA32_I8)&&(this._data_format==a.ENCODE_FORMAT_A32_I8)){while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=((l[v]&248)<<24)|(j[l[v]&7]&16777215)}else{a.temp_byte[s++]=(l[v]&255).castToByte()}v++}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I64)&&(this._data_format==a.ENCODE_FORMAT_A256_I64)){var A=0;while(s<m){switch(A){case 0:a.temp_int[s]=((l[v]&252)>>2);s++;break;case 1:a.temp_int[s]=((l[v]&3)<<4);v++;a.temp_int[s]=(((l[v]&240)>>4)|a.temp_int[s]);s++;break;case 2:a.temp_int[s]=((l[v]&15)<<2);v++;a.temp_int[s]=(((l[v]&192)>>6)|a.temp_int[s]);s++;break;case 3:a.temp_int[s]=(l[v]&63);s++;v++;A=-1;break}A++}s=0;while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=((l[v++]&255)<<24)|(j[a.temp_int[s]&255]&16777215);s++}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I128)&&(this._data_format==a.ENCODE_FORMAT_A256_I128)){var A=0;while(s<m){switch(A){case 0:a.temp_int[s]=((l[v]&254)>>1);s++;break;case 1:a.temp_int[s]=((l[v]&1)<<6);v++;a.temp_int[s]=(((l[v]&252)>>2)|a.temp_int[s]);s++;break;case 2:a.temp_int[s]=((l[v]&3)<<5);v++;a.temp_int[s]=(((l[v]&248)>>3)|a.temp_int[s]);s++;break;case 3:a.temp_int[s]=((l[v]&7)<<4);v++;a.temp_int[s]=(((l[v]&240)>>4)|a.temp_int[s]);s++;break;case 4:a.temp_int[s]=((l[v]&15)<<3);v++;a.temp_int[s]=(((l[v]&224)>>5)|a.temp_int[s]);s++;break;case 5:a.temp_int[s]=((l[v]&31)<<2);v++;a.temp_int[s]=(((l[v]&192)>>6)|a.temp_int[s]);s++;break;case 6:a.temp_int[s]=((l[v]&63)<<1);v++;a.temp_int[s]=(((l[v]&128)>>7)|a.temp_int[s]);s++;break;case 7:a.temp_int[s]=(l[v]&127);v++;s++;A=-1;break}A++}s=0;while(--m>=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=((l[v++]&255)<<24)|(j[a.temp_int[s]&255]&16777215);s++}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if((this._data_format==a.ENCODE_FORMAT_A256_I64RLE)){while(s<m){var u=l[v++]&255;if(GLLibConfig.sprite_useCreateRGB){t=j[u&this._i64rle_color_mask[d]]}else{z=(u&this._i64rle_color_mask[d]).castToByte()}u>>=this._i64rle_color_bits[d];while(u-->=0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=t}else{a.temp_byte[s++]=z}}}s=0;while(s<m){var w=l[v++]&255;if(w==254){var q=l[v++]&255;w=l[v++]&255;while(q-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}else{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I127RLE)&&(this._data_format==a.ENCODE_FORMAT_A256_I127RLE)){while(s<m){var u=l[v++]&255;if(u>127){var p=l[v++]&255;if(GLLibConfig.sprite_useCreateRGB){t=j[p]}else{z=(p).castToByte()}u-=128;while(u-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=t}else{a.temp_byte[s++]=z}}}else{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=j[u]}else{a.temp_byte[s++]=(u).castToByte()}}}s=0;while(s<m){var w=l[v++]&255;if(w==254){var q=l[v++]&255;w=l[v++]&255;while(q-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}else{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}}else{if((GLLibConfig.sprite_useEncodeFormatA256_I256RLE)&&(this._data_format==a.ENCODE_FORMAT_A256_I256RLE)){while(s<m){var u=l[v++]&255;if(u>127){u-=128;while(u-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=j[l[v++]&255]}else{a.temp_byte[s++]=(l[v++]&255).castToByte()}}}else{if(GLLibConfig.sprite_useCreateRGB){t=j[l[v++]&255]}else{z=(l[v++]&255).castToByte()}while(u-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s++]=t}else{a.temp_byte[s++]=z}}}}s=0;while(s<m){var w=l[v++]&255;if(w==254){var q=l[v++]&255;w=l[v++]&255;while(q-->0){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}else{if(GLLibConfig.sprite_useCreateRGB){a.temp_int[s]=(w<<24)|(a.temp_int[s]&16777215);s++}}}}else{switch(this._data_format){case a.ENCODE_FORMAT_I2:Dbg("    -. ASprite.ENCODE_FORMAT_I2");break;case a.ENCODE_FORMAT_I4:Dbg("    -. ASprite.ENCODE_FORMAT_I4");break;case a.ENCODE_FORMAT_I16:Dbg("    -. ASprite.ENCODE_FORMAT_I16");break;case a.ENCODE_FORMAT_I256:Dbg("    -. ASprite.ENCODE_FORMAT_I256");break;case a.ENCODE_FORMAT_I64RLE:Dbg("    -. ASprite.ENCODE_FORMAT_I64RLE");break;case a.ENCODE_FORMAT_I127RLE:Dbg("    -. ASprite.ENCODE_FORMAT_I127RLE");break;case a.ENCODE_FORMAT_I256RLE:Dbg("    -. ASprite.ENCODE_FORMAT_I256RLE");break;case a.ENCODE_FORMAT_A256_I64RLE:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I64RLE");break;case a.ENCODE_FORMAT_A256_I127RLE:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I127RLE");break;case a.ENCODE_FORMAT_A256_I256RLE:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I256RLE");break;case a.ENCODE_FORMAT_A256_I64:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I64");break;case a.ENCODE_FORMAT_A256_I128:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I128");break;case a.ENCODE_FORMAT_A256_I256:Dbg("    -. ASprite.ENCODE_FORMAT_A256_I256");break;case a.ENCODE_FORMAT_A8_I32:Dbg("    -. ASprite.ENCODE_FORMAT_A8_I32");break;case a.ENCODE_FORMAT_A32_I8:Dbg("    -. ASprite.ENCODE_FORMAT_A32_I8");break}Assert(false,"ERROR : sprite encoding for "+Integer.toHexString(this._data_format)+" is not enabled. Check sprite_useEncodeFormat in GllibConfiguration")}}}}}}}}}}}}}}}if(GLLibConfig.sprite_useBugFixImageOddSize){if(GLLibConfig.sprite_useCreateRGB){t=0;for(var r=0;r<j.length;r++){if((j[r]>>24)==0){t=r.castToInt();break}}}else{z=0;for(var r=0;r<j.length;r++){if((j[r]>>24)==0){z=r.castToByte();break}}}var f=o+(o%2);var e=k+(k%2);if(e!=k){for(var i=0;i<f;i++){if(GLLibConfig.sprite_useCreateRGB){a.temp_int[k*f+i]=t}else{a.temp_byte[k*f+i]=z}}}for(var h=k-1;h>=0;h--){if(GLLibConfig.sprite_useCreateRGB){System.arraycopy(a.temp_int,o*h,a.temp_int,f*h,o);if(f!=o){a.temp_int[h*f+o]=t}}else{System.arraycopy(a.temp_byte,o*h,a.temp_byte,f*h,o);if(f!=o){a.temp_byte[h*f+o]=z}}}}return true};a.prototype.DecodeImageToByteArray=function(C,f,l,k){if(!this.IsModuleDataValid(f)){return}var D=this.GetModuleWidth(f);var B=this.GetModuleHeight(f);if(C==null){return}var z=C;var h;if(l==true){h=4}else{h=3}var A=this.GetModuleImageIndex(f);if(!this.DecodeImage_Algorithm(A,this.GetModuleData(f),this.GetStartModuleData(f,0),D,B)){return}if(GLLibConfig.sprite_useCreateRGB){z=LowAPI.Gen_Array([D*B*h],0);for(var P=0;P<B;P++){for(var R=0;R<D;R++){var G=(R+P*D);z[G*h+0]=((a.temp_int[G]>>0)&255).castToByte();z[G*h+1]=((a.temp_int[G]>>8)&255).castToByte();z[G*h+2]=((a.temp_int[G]>>16)&255).castToByte();if(h==4){z[G*h+3]=((a.temp_int[G]>>24)&255).castToByte()}}}}else{return}var d=D>>1;var e=B>>1;var F=0,E=0;var s,Q,w,L=0;var q,O,v,K=0;var p,N,u,J=0;var o,M,t,I=0;var H,m,T,U;var n=0;if(k){for(var P=0;P<e;P++){for(var R=0;R<d;R++){var S=(P*2*h)*D+(R*2*h);s=z[S]&255;Q=z[S+1]&255;w=z[S+2]&255;if(h==4){L=z[S+3]&255}S+=h;q=z[S]&255;O=z[S+1]&255;v=z[S+2]&255;if(h==4){K=z[S+3]&255}S=((P*2+1)*h)*D+(R*2*h);p=z[S]&255;N=z[S+1]&255;u=z[S+2]&255;if(h==4){J=z[S+3]&255}S+=h;o=z[S]&255;M=z[S+1]&255;t=z[S+2]&255;if(h==4){I=z[S+3]&255}H=(s+q+p+o)>>2;m=(Q+O+N+M)>>2;T=(w+v+u+t)>>2;U=(L+K+J+I)>>2;z[n++]=(H&255).castToByte();z[n++]=(m&255).castToByte();z[n++]=(T&255).castToByte();if(h==4){z[n++]=(U&255).castToByte()}}}}};a.ConvertEncoding_I256_I256RLE=function(r,h,q,j,k){if(!(r!=null)){Assert(false,"ConvertEncoding_I256_I256RLE: inArray array is null!")}if(!(j!=null)){Assert(false,"ConvertEncoding_I256_I256RLE: out array is null!")}if(!(h+q<=r.length)){Assert(false,"ConvertEncoding_I256_I256RLE: inArray array size does not match passed size and offset!")}var l=0;var o=1;var i=l;var n=0;var p=(255).castToByte();var e=a.GetPixelBuffer_int(null);h--;var m=k;var d;while(--q>=0){var f=r[++h];if(i==l){if(p==f){n--;if(n>0){j[m]=(128|n).castToByte();d=-1;do{j[++m]=e[++d].castToByte()}while(--n>0);++m}i=o;n=2}else{if(n==127){j[m]=(128|n).castToByte();d=-1;do{j[++m]=e[++d].castToByte()}while(--n>0);++m;n=0}e[n++]=f}}else{if(p!=f||n==127){j[m++]=n.castToByte();j[m++]=p;i=l;e[0]=f;n=1}else{n++}}p=f}if(i==l){if(n>0){j[m]=(128|n).castToByte();d=-1;do{j[++m]=e[++d].castToByte()}while(--n>0);++m}}else{j[m++]=n.castToByte();j[m++]=p}return(m-k)};a.prototype.ConvertCompressedData_I256_I256RLE=function(d,f){if(this._modules_data_array==null){return}if(this._data_format!=a.ENCODE_FORMAT_I256){Dbg("ConvertCompressedData: No action done. Unsupported source encoding conversion: 0x"+Integer.toHexString(this._data_format)+". Only I256 is currently supported)!");return}var p=null;var j=a.s_isConvertEncodeTMPBufOn;var h=null;if(GLLibConfig.sprite_useDoubleArrayForModuleData){if(d){if(f==null){if(j){f=a.s_convertEncodeTMPBuffer}else{f=LowAPI.Gen_Array([GLLibConfig.TMP_BUFFER_SIZE],0)}}else{j=false}}for(var k=0;k<this._nModules;k++){try{h=this._modules_data_array[k];if(h!=null){if(d){if(j){var n=h.length;if(a.s_convertEncodeTMPBuffer==null||a.s_convertEncodeTMPBuffer.length<(n+a.s_convertEncodeExtraBufferSize)){a.s_convertEncodeTMPBuffer=LowAPI.Gen_Array([n+a.s_convertEncodeExtraBufferSize],0);f=a.s_convertEncodeTMPBuffer}}}else{f=h}var o=ConvertEncoding_I256_I256RLE(h,0,h.length,f,0);p=LowAPI.Gen_Array([o],0);System.arraycopy(f,0,p,0,o);this._modules_data_array[k]=null;this._modules_data_array[k]=p}}catch(m){Assert(false,"ConvertCompressedData (double array): Module "+k+" caused an exception during conversion!\n        Either use the SAFE option, or modify the source sprite module until this error goes away.")}}}else{if(!d){f=this._modules_data}else{if(f==null){f=LowAPI.Gen_Array([this._modules_data.length],0)}}var l=0;for(var k=0;k<this._nModules;k++){try{var o=ConvertEncoding_I256_I256RLE(this._modules_data,this.GetStartModuleData(k,0),GetLenModuleData(k,0),f,l);if(GLLibConfig.sprite_useModuleDataOffAsShort){this._modules_data_off_short[k]=l.castToShort()}else{this._modules_data_off_int[k]=l}l+=o}catch(m){Assert(false,"ConvertCompressedData (single array): Module "+k+" caused an exception during conversion!\n        Either use the SAFE option, or modify the source sprite and move this module further down the list of modules!")}}p=LowAPI.Gen_Array([l],0);System.arraycopy(f,0,p,0,l);this._modules_data=null;this._modules_data=p}this._data_format=a.ENCODE_FORMAT_I256RLE};a.SetCharCanBreakLine=function(d){if(!GLLibConfig.sprite_useCanBreakLine&&!GLLibConfig.sprite_useBitmapFont){Dbg("SetCharCanBreakLine: will not have any effect unless sprite_useCanBreakLine, or sprite_useBitmapFont are set.")}else{a.k_cCanBreakLine=d}};a.GetCurrentStringWidth=function(){return a._text_w};a.prototype.SetCharMap=function(m){if(GLLibConfig.sprite_newTextRendering&&GLLibConfig.sprite_useIntCharMap){this._nDividerInt=m[0];this._pMapCharInt=LowAPI.Gen_Array([this._nDividerInt],null);var f=1;for(var h=0;h<this._nDividerInt;h++){this._pMapCharInt[h]=LowAPI.Gen_Array([2],0);this._pMapCharInt[h][0]=m[f++];this._pMapCharInt[h][1]=m[f++]}for(var h=f;h<m.length;){var d=m[h++];var k=m[h++];var l=LowAPI.Gen_Array([k*2+2],0);l[0]=this._pMapCharInt[d][0];l[1]=this._pMapCharInt[d][1];for(var e=0;e<k;e++){l[e*2+2]=m[h++];l[e*2+3]=m[h++]}this._pMapCharInt[d]=l}this.SetDefaultFontMetrics()}else{if(!GLLibConfig.sprite_newTextRendering){Dbg("SetCharMap: sprite_newTextRendering is FALSE so the character map can not be a int[]!")}if(!GLLibConfig.sprite_useIntCharMap){Dbg("SetCharMap: sprite_useIntCharMap is FALSE so the character map can not be a int[]!")}}};a.prototype.GetCharFrame=function(h){if(GLLibConfig.sprite_useIntCharMap){if(this._pMapCharInt==null){Dbg("ERROR: this._pMapCharInt is null!!! Did you set the Char Map?");return 0}}else{if(this._pMapCharShort==null){Dbg("ERROR: this._pMapCharShort is null!!! Did you set the Char Map?");return 0}}if(GLLibConfig.sprite_useIntCharMap){var d=h%this._nDividerInt;if(this._pMapCharInt[d][0]==h){return this._pMapCharInt[d][1]}else{var e=2;var f=this._pMapCharInt[d].length;while(e<f&&this._pMapCharInt[d][e]!=h){e+=2}if(e>=f){if(GLLibConfig.sprite_debugErrors){Dbg("Character not available 1: char value = "+h+" and actual char = '"+(h.castToChar())+"'")}return 1}else{return this._pMapCharInt[d][e+1]}}}else{var d=h%this._nDivider;if(this._pMapCharShort[d][0]==h){return this._pMapCharShort[d][1]}else{var e=2;var f=this._pMapCharShort[d].length;while(e<f&&this._pMapCharShort[d][e]!=h){e+=2}if(e>=f){if(GLLibConfig.sprite_debugErrors){Dbg("Character not available 2: char value = "+h+" and actual char = '"+(h.castToChar())+"'")}return 1}else{return this._pMapCharShort[d][e+1]}}}};a.prototype.SetDefaultFontMetrics=function(){var d=0;this._nFontAscent=-this.GetFrameModuleY(0,0);d=this.GetFrameModuleY(0,1);this._nLineHeight=this._nFontAscent+d;this.SetLineSpacingToDefault();this.SetSpaceWidthToDefault()};a.prototype.GetLineSpacing=function(){return this._nLineSpacing};a.prototype.SetLineSpacingToDefault=function(){if(GLLibConfig.sprite_newTextRendering){this._nLineSpacing=this.GetFrameModuleY(0,2)-this.GetFrameModuleY(0,1)}else{this._nLineSpacing=(this.GetModuleHeight(0)>>1)}};a.prototype.GetFontHeight=function(){if(GLLibConfig.sprite_newTextRendering){return this._nLineHeight}else{if(GLLibConfig.sprite_useModuleWHShort){return this._modules_h_short[0]&255}else{return this._modules_h_byte[0]&255}}};a.prototype.GetSpaceWidth=function(){return this._nSpaceWidth};a.prototype.SetSpaceWidthToDefault=function(){if(GLLibConfig.sprite_newTextRendering){this._nSpaceWidth=this.GetFrameModuleX(this.GetCharFrame((32).castToShort()),0)}else{this._nSpaceWidth=this.GetModuleWidth(0)}};a.prototype.GetCharSpacing=function(){return this._nCharSpacing};a.prototype.GetLineHeight=function(){return this._nLineHeight};a.GetWrapInfo_GetLineDataSize=function(){var d=2;if(GLLibConfig.sprite_bufferTextPageFormatting){d++}if(GLLibConfig.sprite_allowRotatedFont){d++}return d};a.GetWrapInfo_LineStart=function(e,d){var f=d*a.GetWrapInfo_GetLineDataSize()+1;return e[f]};a.GetWrapInfo_LineWidth=function(e,d){var f=(d*a.GetWrapInfo_GetLineDataSize())+2;return e[f]};a.GetWrapInfo_LineHeight=function(e,d){var f;if(GLLibConfig.sprite_bufferTextPageFormatting){f=(d*a.GetWrapInfo_GetLineDataSize())+4}else{f=(d*a.GetWrapInfo_GetLineDataSize())+3}return e[f]};a.prototype.WraptextB=function(n,u,p,o){if(a._warpTextInfo==null){a._warpTextInfo=LowAPI.Gen_Array([GLLibConfig.MAX_WRAP_TEXT_INFO],0)}var d=n.length;var l=0;var x=1;var A=0;var f=this._bBold;var e=this._bUnderline;var h=this._crt_pal;var m=false;var q=0;var t=this._bBold;var z=this._bUnderline;var v=this._crt_pal;var E=0;if(GLLibConfig.sprite_bufferTextPageFormatting){if(!(v<a.WRAP_TEXT_FORMATTING_MASK_PALETTE)){Assert(false,"Warning: WrapTextB formatting can only save palettes up to "+a.WRAP_TEXT_FORMATTING_MASK_PALETTE)}E=v&a.WRAP_TEXT_FORMATTING_MASK_PALETTE;E|=(t?a.WRAP_TEXT_FORMATTING_FLAG_IS_BOLD:0);E|=(z?a.WRAP_TEXT_FORMATTING_FLAG_IS_UNDERLINED:0)}var D=0;var j=0;for(var y=0;y<d;y++){var C=n.charAt(y).castToInt();if(C==32||(GLLibConfig.sprite_useCanBreakLine&&(C==a.k_cCanBreakLine))){if(!GLLibConfig.sprite_useCanBreakLine||(C==32)){l+=this.GetSpaceWidth().castToShort()}A=y.castToShort();f=t;m=true;q=0;if(GLLibConfig.sprite_bufferTextPageFormatting){e=z;h=v}if(l>u&&!o){m=false;var k=A;while(k>=0&&(n.charAt(k)==" "||(GLLibConfig.sprite_useCanBreakLine&&(n.charAt(k)==a.k_cCanBreakLine)))){if(!GLLibConfig.sprite_useCanBreakLine||n.charAt(k)==" "){l-=this.GetSpaceWidth().castToShort()}k--}while((A<d)&&((n.charAt(A)==" ")||(GLLibConfig.sprite_useCanBreakLine&&(n.charAt(A)==a.k_cCanBreakLine)))){A++}A--;y=A;t=f;a._warpTextInfo[x++]=(A+1).castToShort();a._warpTextInfo[x++]=(l-q).castToShort();if(GLLibConfig.sprite_bufferTextPageFormatting){a._warpTextInfo[x++]=E.castToShort();if(!(v<a.WRAP_TEXT_FORMATTING_MASK_PALETTE)){Assert(false,"Warning: WrapTextB formatting can only save palettes up to "+a.WRAP_TEXT_FORMATTING_MASK_PALETTE)}z=e;v=h;E=h&a.WRAP_TEXT_FORMATTING_MASK_PALETTE;E|=(f?a.WRAP_TEXT_FORMATTING_FLAG_IS_BOLD:0);E|=(e?a.WRAP_TEXT_FORMATTING_FLAG_IS_UNDERLINED:0)}if(GLLibConfig.sprite_allowRotatedFont){if(this._bRotatedFont){a._warpTextInfo[x]=D.castToShort();D=0;j=0}x++}l=0}else{if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){j=D;D+=GetCharHeight(this.GetCharFrame(C))}}continue}else{if(GLLibConfig.sprite_fontBackslashChangePalette&&C==92){y++;if(!GLLibConfig.sprite_fontDisableBackslashChangePaletteEffect){var r=n.charAt(y).castToInt();if(r==94){if(!GLLibConfig.sprite_fontDisableUnderlineBoldEffect){t=!t}}else{if(GLLibConfig.sprite_bufferTextPageFormatting){if(r==95){if(!GLLibConfig.sprite_fontDisableUnderlineBoldEffect){z=!z}}else{C=r&255;C-=48;if(C<this._palettes){v=C}}}}}continue}else{if(C==10){a._warpTextInfo[x++]=y.castToShort();a._warpTextInfo[x++]=l.castToShort();l=0;q=0;if(GLLibConfig.sprite_bufferTextPageFormatting){a._warpTextInfo[x++]=E.castToShort();if(!(v<a.WRAP_TEXT_FORMATTING_MASK_PALETTE)){Assert(false,"Warning: WrapTextB formatting can only save palettes up to "+a.WRAP_TEXT_FORMATTING_MASK_PALETTE)}E=v&a.WRAP_TEXT_FORMATTING_MASK_PALETTE;E|=(t?a.WRAP_TEXT_FORMATTING_FLAG_IS_BOLD:0);E|=(z?a.WRAP_TEXT_FORMATTING_FLAG_IS_UNDERLINED:0)}if(GLLibConfig.sprite_allowRotatedFont){if(this._bRotatedFont){a._warpTextInfo[x]=D.castToShort();D=0;j=0}x++}continue}else{if(C<32){if(C==1){y++;continue}else{if(C==2){y++;C=n.charAt(y).castToInt()}else{continue}}}else{if(GLLibConfig.sprite_newTextRendering){C=this.GetCharFrame(C)}else{C=this._pMapChar[C]&255}}}}}var w;if(GLLibConfig.sprite_newTextRendering){if(C>this.GetFrameCount()){if(GLLibConfig.sprite_debugErrors){Dbg("Character not available: c = "+C)}C=0}w=this.GetCharWidth(C)+this.GetCharSpacing();if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){D+=GetCharHeight(C)}}else{if(C>=this.GetFModules(0)){if(GLLibConfig.sprite_debugErrors){Dbg("Character not available: c = "+C)}C=0}w=this.GetCharWidth(C)+this.GetCharSpacing()}if(t){w++}q+=w.castToShort();l+=w.castToShort();if(l>u){var B=o||!m;if(B){l-=w.castToShort();A=(y-1).castToShort()}m=false;var k=A;while(k>=0&&(n.charAt(k)==" "||(GLLibConfig.sprite_useCanBreakLine&&(n.charAt(k)==a.k_cCanBreakLine)))){if(!GLLibConfig.sprite_useCanBreakLine||(n.charAt(k)==" ")){l-=this.GetSpaceWidth().castToShort()}k--}if(B){f=t;e=z;h=v;q=0}a._warpTextInfo[x++]=(A+1).castToShort();a._warpTextInfo[x++]=(l-q).castToShort();if(GLLibConfig.sprite_bufferTextPageFormatting){a._warpTextInfo[x++]=E.castToShort();if(!(v<a.WRAP_TEXT_FORMATTING_MASK_PALETTE)){Assert(false,"Warning: WrapTextB formatting can only save palettes up to "+a.WRAP_TEXT_FORMATTING_MASK_PALETTE)}z=e;v=h;E=h&a.WRAP_TEXT_FORMATTING_MASK_PALETTE;E|=(f?a.WRAP_TEXT_FORMATTING_FLAG_IS_BOLD:0);E|=(e?a.WRAP_TEXT_FORMATTING_FLAG_IS_UNDERLINED:0)}if(GLLibConfig.sprite_allowRotatedFont){if(this._bRotatedFont){a._warpTextInfo[x]=j.castToShort();D=0;j=0}x++}l=0;y=A;t=f}}a._warpTextInfo[x++]=d.castToShort();a._warpTextInfo[x++]=l.castToShort();if(GLLibConfig.sprite_bufferTextPageFormatting){a._warpTextInfo[x++]=E.castToShort()}if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){if(this._bRotatedFont){a._warpTextInfo[x]=D.castToShort()}x++}a._warpTextInfo[0]=LowAPI.Float2Int(x/a.GetWrapInfo_GetLineDataSize()).castToShort();return a._warpTextInfo};a.prototype.DrawPageB=function(D,t,F,q,p,w,l,o,A,r){var d=F[0];var i=this.GetLineHeight();if(l==-1){l=d}if(w+l>d){l=d-w}var m=this.GetLineSpacing()+i;if((o&GRPH.BOTTOM)!=0){p-=(m*(l-1))}else{if((o&GRPH.VCENTER)!=0){p-=(m*(l-1))>>1}}a._old_pal=this._crt_pal;var G=this._bBold;var C=this._bUnderline;if(A>=0){a._indexMax=(w>0)?a.GetWrapInfo_LineStart(F,w-1):0;a._indexMax+=A}var h=GetClipY(D);var f=h+GetClipHeight(D);h-=m;f+=m;var v=0;if(r){for(var z=d-1;z>=w;z--,v++){if(v>l-1){break}a._index1=(z>0)?a.GetWrapInfo_LineStart(F,z-1):0;a._index2=a.GetWrapInfo_LineStart(F,z);if(a._index1<t.length&&t.charAt(a._index1)=="\n"){a._index1++}var n=q;var u=p+v*m;if(u<h){continue}else{if(u>f){break}}if((o&(GRPH.RIGHT|GRPH.HCENTER|GRPH.BOTTOM|GRPH.VCENTER))!=0){if((o&GRPH.RIGHT)!=0){n-=a.GetWrapInfo_LineWidth(F,z)}else{if((o&GRPH.HCENTER)!=0){n-=a.GetWrapInfo_LineWidth(F,z)>>1}}if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){if((o&GRPH.RIGHT)!=0){u-=a.GetWrapInfo_LineHeight(F,z)}else{if((o&GRPH.HCENTER)!=0){u-=(a.GetWrapInfo_LineHeight(F,z)>>1)}}}if((o&GRPH.BOTTOM)!=0){if(GLLibConfig.sprite_newTextRendering){u-=this.GetLineHeight()}else{u-=this.GetModuleHeight(1)}}else{if((o&GRPH.VCENTER)!=0){if(GLLibConfig.sprite_newTextRendering){u-=this.GetLineHeight()>>1}else{u-=this.GetModuleHeight(1)>>1}}}}if(GLLibConfig.sprite_bufferTextPageFormatting){var B=GetWrapInfo_LineFormat(F,z).castToInt();this._bBold=(B&a.WRAP_TEXT_FORMATTING_FLAG_IS_BOLD)!=0;this._bUnderline=(B&a.WRAP_TEXT_FORMATTING_FLAG_IS_UNDERLINED)!=0;this.SetCurrentPalette(B&a.WRAP_TEXT_FORMATTING_MASK_PALETTE)}this.DrawString(D,t,n,u,0,false)}}else{for(var z=w;z<d;z++,v++){if(v>l-1){break}a._index1=(z>0)?a.GetWrapInfo_LineStart(F,z-1):0;a._index2=a.GetWrapInfo_LineStart(F,z);if(a._index1<t.length&&t.charAt(a._index1)=="\n"){a._index1++}var n=q;var u=p+v*m;if(u<h){continue}else{if(u>f){break}}if((o&(GRPH.RIGHT|GRPH.HCENTER|GRPH.BOTTOM|GRPH.VCENTER))!=0){if((o&GRPH.RIGHT)!=0){n-=a.GetWrapInfo_LineWidth(F,z)}else{if((o&GRPH.HCENTER)!=0){n-=a.GetWrapInfo_LineWidth(F,z)>>1}}if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){if((o&GRPH.RIGHT)!=0){u-=a.GetWrapInfo_LineHeight(F,z)}else{if((o&GRPH.HCENTER)!=0){u-=(a.GetWrapInfo_LineHeight(F,z)>>1)}}}if((o&GRPH.BOTTOM)!=0){if(GLLibConfig.sprite_newTextRendering){u-=this.GetLineHeight()}else{u-=this.GetModuleHeight(1)}}else{if((o&GRPH.VCENTER)!=0){if(GLLibConfig.sprite_newTextRendering){u-=this.GetLineHeight()>>1}else{u-=this.GetModuleHeight(1)>>1}}}}if(GLLibConfig.sprite_bufferTextPageFormatting){var B=GetWrapInfo_LineFormat(F,z).castToInt();this._bBold=(B&a.WRAP_TEXT_FORMATTING_FLAG_IS_BOLD)!=0;this._bUnderline=(B&a.WRAP_TEXT_FORMATTING_FLAG_IS_UNDERLINED)!=0;this.SetCurrentPalette(B&a.WRAP_TEXT_FORMATTING_MASK_PALETTE)}this.DrawString(D,t,n,u,0,false)}}a._index1=-1;a._index2=-1;a._indexMax=-1;this._crt_pal=a._old_pal;if(GLLibConfig.sprite_bufferTextPageFormatting){this._bBold=G;this._bUnderline=C}if(GLLibConfig.sprite_useDrawStringSleep){try{Thread.sleep(GLLibConfig.SLEEP_DRAWSTRINGB)}catch(E){}}};a.prototype.UpdateStringSize=function(d){if(typeof d=="string"){this.UpdateStringOrCharsSize(d,null)}else{this.UpdateStringOrCharsSize(null,d)}};a.prototype.UpdateStringOrCharsSize=function(u,q){if(u==null&&q==null){return}a._text_w=0;if((GLLibConfig.sprite_allowRotatedFont&&GLLibConfig.sprite_newTextRendering&&this._bRotatedFont)||(GLLibConfig.sprite_allowCharYOffset&&GLLibConfig.sprite_newTextRendering&&(this._nCharYOffset!=0))){a._text_h=0}else{a._text_h=this.GetLineHeight()}var h=0;var d=0;var e=0;var n=0;var j=0;if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){a._text_leftCornerOffX=0;a._text_leftCornerOffY=0}var r=u!=null;var m;var k;m=((a._index1>=0)?a._index1:0);if(r){k=((a._index2>=0)?a._index2:u.length)}else{k=((a._index2>=0)?a._index2:q.length)}var l=this._bBold;for(var f=m;f<k;f++){var p=((r)?(u).charAt((f)):(q)[(f)]).castToInt();if(GLLibConfig.sprite_fontBackslashChangePalette&&p==92){f++;if(!GLLibConfig.sprite_fontDisableBackslashChangePaletteEffect){if(((r)?(u).charAt((f)):(q)[(f)])=="^"){if(!GLLibConfig.sprite_fontDisableUnderlineBoldEffect){l=!l}}}continue}else{if(p>32){if(!GLLibConfig.sprite_useBitmapFont&&(a._useLineBreakChar&&p==a._lineBreakChar)){continue}if(GLLibConfig.sprite_newTextRendering){p=this.GetCharFrame(p)}else{if(GLLibConfig.sprite_debugErrors){if(this._pMapChar==null){Dbg("ERROR: this._pMapChar is null !!!")}}p=this._pMapChar[p]&255}}else{if(GLLibConfig.sprite_useCanBreakLine&&(p==a.k_cCanBreakLine)){continue}else{if(p==32){h+=this.GetSpaceWidth();if(GLLibConfig.sprite_newTextRendering){if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){d+=Math.abs(GetCharHeight(this.GetCharFrame(p)))}else{if(GLLibConfig.sprite_allowCharYOffset&&(this._nCharYOffset!=0)){d+=Math.abs(this._nCharYOffset)}}}continue}else{if(p==10){if((GLLibConfig.sprite_allowRotatedFont&&GLLibConfig.sprite_newTextRendering&&this._bRotatedFont)||(GLLibConfig.sprite_allowCharYOffset&&GLLibConfig.sprite_newTextRendering&&(this._nCharYOffset!=0))){if(h>a._text_w){a._text_w=h;if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){n=e}}if(d>a._text_h){a._text_h=d;j=e}e++;if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){h=e*GetCharHSpacing()}else{h=0}d=0}else{if(h>a._text_w){a._text_w=h}h=0;a._text_h+=this.GetLineSpacing()+this.GetLineHeight()}continue}else{if(p==1){f++;continue}else{if(p==2){f++;p=((r)?(u).charAt((f)):(q)[(f)]).castToInt()}else{continue}}}}}}}if(GLLibConfig.sprite_newTextRendering){if(GLLibConfig.sprite_debugErrors){if(p>this.GetFrameCount()){Dbg("Character not available: c = "+p);p=0}}h+=this.GetCharWidth(p)+this.GetCharSpacing();if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){d+=Math.abs(GetCharHeight(p))}else{d+=Math.abs(this._nCharYOffset)}}else{if(GLLibConfig.sprite_debugErrors){if(p>=this.GetFModules(0)){Dbg("Character not available: c = "+p);p=0}}h+=this.GetCharWidth(p)+this.GetCharSpacing()}if(l){h++}}if((GLLibConfig.sprite_allowRotatedFont&&GLLibConfig.sprite_newTextRendering&&this._bRotatedFont)||(GLLibConfig.sprite_allowCharYOffset&&GLLibConfig.sprite_newTextRendering&&(this._nCharYOffset!=0))){if(h>a._text_w){a._text_w=h;if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){n=e}}if(d>a._text_h){a._text_h=d;j=e}e++}else{if(h>a._text_w){a._text_w=h}}if(GLLibConfig.sprite_newTextRendering){if(a._text_w>0){a._text_w-=this.GetCharSpacing()}if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){var o=e*(this.GetLineSpacing()+this.GetLineHeight());var t=e*GetCharHSpacing();a._text_h+=o;a._text_w+=((e-n)*GetCharHSpacing());a._text_leftCornerOffX=a._text_w-t;a._text_leftCornerOffY=a._text_h-o;if(this.GetFrameModuleY(0,0)>=0){a._text_leftCornerOffY=-a._text_leftCornerOffY}}else{if(GLLibConfig.sprite_allowCharYOffset&&(this._nCharYOffset!=0)){var o=e*(this.GetLineSpacing()+this.GetLineHeight());a._text_h+=o-Math.abs(this._nCharYOffset);a._text_leftCornerOffX=a._text_w;a._text_leftCornerOffY=a._text_h-o;if(this._nCharYOffset>0){a._text_leftCornerOffY=-a._text_leftCornerOffY}}}}else{if((GLLibConfig.sprite_useSingleArrayForFMAF)&&(a._text_w>0)){a._text_w-=this._fmodules[1]}else{if(a._text_w>0){a._text_w-=this.GetCharSpacing()}}}};a.prototype.DrawString=function(h,f,e,d,l,k,j){if(j!=c){return this._DrawString_7(h,f,e,d,l,k,j)}else{if(k!=c){var i=typeof f;if(i=="string"){if(typeof k=="number"){return this._DrawString_6_2(h,f,e,d,l,k)}else{return this._DrawString_6_4(h,f,e,d,l,k)}}else{if(typeof k=="number"){return this._DrawString_6_1(h,f,e,d,l,k)}else{return this._DrawString_6_3(h,f,e,d,l,k)}}}else{if(l!=c){if(typeof f=="string"){return this._DrawString_5_2(h,f,e,d,l)}else{return this._DrawString_5_1(h,f,e,d,l)}}}}throw new Error("InvalidArguments")};a.prototype._DrawString_6_1=function(i,f,d,j,e,h){a._indexMax=h;this.DrawString(i,String.byteArray2Text(f),d,j,e,true);a._indexMax=-1};a.prototype._DrawString_6_2=function(i,h,d,j,e,f){a._indexMax=f;this.DrawString(i,h,d,j,e,true);a._indexMax=-1};a.prototype._DrawString_5_1=function(h,f,d,i,e){this.DrawString(h,String.byteArray2Text(f),d,i,e,true)};a.prototype._DrawString_5_2=function(h,f,d,i,e){this.DrawString(h,f,d,i,e,true)};a.prototype._DrawString_6_3=function(i,h,d,j,f,e){this.DrawString(i,String.byteArray2Text(h),d,j,f,e)};a.prototype._DrawString_7=function(i,h,d,k,f,e,j){this.DrawStringOrChars(i,h,null,d,k,f,e,j)};a.prototype._DrawString_6_4=function(i,h,d,j,f,e){this.DrawStringOrChars(i,h,null,d,j,f,e,true)};a.prototype.DrawStringOrChars=function(B,r,d,p,n,l,m,w){var w=!LowAPI.isUndefined(w)?w:true;if(r==null&&d==null){return}if(GLLibConfig.sprite_newTextRendering){n+=this._nFontAscent;if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){p-=this.GetFrameModuleX(0,0)}}else{if(GLLibConfig.sprite_useSingleArrayForFMAF){n-=this._fmodules[2]}else{n-=this.GetFModuleOY(0)}}var o=(r!=null);if(w){this.UpdateStringOrCharsSize(r,d)}if((l&(GRPH.RIGHT|GRPH.HCENTER|GRPH.BOTTOM|GRPH.VCENTER))!=0){if(!w){this.UpdateStringOrCharsSize(r,d)}if((GLLibConfig.sprite_allowRotatedFont&&GLLibConfig.sprite_newTextRendering&&this._bRotatedFont)||(GLLibConfig.sprite_allowCharYOffset&&GLLibConfig.sprite_newTextRendering&&(this._nCharYOffset!=0))){if((l&GRPH.RIGHT)!=0){p-=a._text_leftCornerOffX;n+=a._text_leftCornerOffY}else{if((l&GRPH.HCENTER)!=0){p-=(a._text_leftCornerOffX>>1);n+=(a._text_leftCornerOffY>>1)}}if((l&GRPH.BOTTOM)!=0){p-=(a._text_w-a._text_leftCornerOffX);n-=(a._text_h-Math.abs(a._text_leftCornerOffY))}else{if((l&GRPH.VCENTER)!=0){p-=((a._text_w-a._text_leftCornerOffX)>>1);n-=((a._text_h-Math.abs(a._text_leftCornerOffY))>>1)}}}else{if((l&GRPH.RIGHT)!=0){p-=a._text_w}else{if((l&GRPH.HCENTER)!=0){p-=a._text_w>>1}}if((l&GRPH.BOTTOM)!=0){n-=a._text_h}else{if((l&GRPH.VCENTER)!=0){n-=a._text_h>>1}}}}var k=p;var u=n;var e=u;var h,q,z;if(m){a._old_pal=this._crt_pal}var j;var f;j=((a._index1>=0)?a._index1:0);if(o){f=((a._index2>=0)?a._index2:r.length)}else{f=((a._index2>=0)?a._index2:d.length)}if(a._indexMax>=0){if(f>a._indexMax){f=a._indexMax}}var t=false;for(var A=j;A<f;A++){var C=((o)?(r).charAt((A)):(d)[(A)]).castToInt();if(GLLibConfig.sprite_fontBackslashChangePalette&&C==92){A++;if(!GLLibConfig.sprite_fontDisableBackslashChangePaletteEffect){var v=((o)?(r).charAt((A)):(d)[(A)]).castToInt();if(v==95){if(!GLLibConfig.sprite_fontDisableUnderlineBoldEffect){this._bUnderline=!this._bUnderline}}else{if(v==94){if(!GLLibConfig.sprite_fontDisableUnderlineBoldEffect){this._bBold=!this._bBold}}else{C=v&255;this.SetCurrentPalette(C-48)}}}continue}else{if(GLLibConfig.sprite_useCanBreakLine&&(C==a.k_cCanBreakLine)){continue}else{if(C>32){if(!GLLibConfig.sprite_useBitmapFont&&(a._useLineBreakChar&&C==a._lineBreakChar)){continue}if(GLLibConfig.sprite_newTextRendering){C=this.GetCharFrame(C)}else{if(GLLibConfig.sprite_debugErrors){if(this._pMapChar==null){Dbg("ERROR: this._pMapChar is null !!!")}}C=this._pMapChar[C]&255}}else{if(C==32){if(this._bUnderline){if(GLLibConfig.sprite_newTextRendering){z=this.GetCharFrame(95);h=k+((this.GetSpaceWidth()-this.GetCharWidth(z))>>1);this.PaintFrame(B,z,h,u,0)}else{z=this._pMapChar[95]&255;h=k+((this.GetSpaceWidth()-this.GetCharWidth(z))>>1);this.PaintFModule(B,0,z,h,u,0)}}k+=this.GetSpaceWidth();if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){u+=GetCharHeight(this.GetCharFrame(C))}else{if(GLLibConfig.sprite_allowCharYOffset&&(this._nCharYOffset!=0)){u+=this._nCharYOffset}}continue}else{if(C==10){if((GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont)||(GLLibConfig.sprite_allowCharYOffset&&(this._nCharYOffset!=0))){if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){p+=GetCharHSpacing()}k=p;u=e+this.GetLineSpacing()+this.GetLineHeight();e=u}else{k=p;u+=this.GetLineSpacing()+this.GetLineHeight()}continue}else{if(C==1){A++;var v=((o)?(r).charAt((A)):(d)[(A)]).castToInt();if(v<this._palettes){this.SetCurrentPalette(v)}if(v==255){this._crt_pal=a._old_pal}continue}else{if(C==2){A++;C=((o)?(r).charAt((A)):(d)[(A)]).castToInt()}else{continue}}}}}}}if(GLLibConfig.sprite_debugErrors){if(GLLibConfig.sprite_newTextRendering){if(C>this.GetFrameCount()){Dbg("Character not available: c = "+C);C=0}}else{if(C>=this.GetFModules(0)){Dbg("Character not available: c = "+C);C=0}}}if(GLLibConfig.sprite_newTextRendering){this.PaintFrame(B,C,k,u,0);if(this._bUnderline){z=this.GetCharFrame(95);h=k+((this.GetCharWidth(C)-this.GetCharWidth(z))>>1);this.PaintFrame(B,z,h,u,0)}if(this._bBold){k++;this.PaintFrame(B,C,k,u,0)}k+=this.GetCharWidth(C)+this.GetCharSpacing();if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){u+=GetCharHeight(C)}else{if(GLLibConfig.sprite_allowCharYOffset&&(this._nCharYOffset!=0)){u+=this._nCharYOffset}}}else{if(this._bUnderline){z=this._pMapChar[95]&255;h=k+((this.GetCharWidth(C)-this.GetCharWidth(z))>>1);this.PaintFModule(B,0,z,h,u,0)}this.PaintFModule(B,0,C,k,u,0);k+=this.GetCharWidth(C)+this.GetCharSpacing()}}if(m){this._crt_pal=a._old_pal}};a.prototype.GetCharWidth=function(e){if(GLLibConfig.sprite_newTextRendering){if(GLLibConfig.sprite_allowRotatedFont&&this._bRotatedFont){return(this.GetFrameModuleX(e,0)-this.GetFrameModuleX(0,1))}return this.GetFrameModuleX(e,0)}else{var d;if(GLLibConfig.sprite_useSingleArrayForFMAF){d=(this._fmodules[e<<2]&255)}else{if(GLLibConfig.sprite_forceShortIndexForFModules||(GLLibConfig.sprite_allowShortIndexForFModules&&(((this._bs_flags&a.BS_FM_INDEX_SHORT)!=0)))){d=this._fmodules_id_short[e]}else{d=this._fmodules_id_byte[e]&255}}if(d>=this._nModules){if(GLLibConfig.sprite_debugErrors){Dbg("Character module not available: c = "+e+"  m = "+(d>>1))}return 0}if(GLLibConfig.sprite_useSingleArrayForFMAF){return this.GetModuleWidth(d)-this._fmodules[(e<<2)+1]}else{return this.GetModuleWidth(d)-this.GetFModuleOX(e)}}};a.prototype.SetCurrentPalette=function(e,d){if(d!=c){return this._SetCurrentPalette_2(e,d)}else{if(e!=c){return this._SetCurrentPalette_1(e)}}throw new Error("InvalidArguments")};a.prototype._SetCurrentPalette_1=function(d){this.SetCurrentPalette(0,d)};a.prototype._SetCurrentPalette_2=function(e,d){if((d<this._palettes)&&(d>=0)){this._crt_pal=d}else{return}if(!(this.IsPaletteDataSet(e,d))){Assert(false,"SetCurrentPalette: palette data is not allocated!")}};a.prototype.InitPalettesArray=function(d){if(this._pal_int==null){this._pal_int=LowAPI.Gen_Array([d,GLLibConfig.MAX_SPRITE_PALETTES],null)}};a.prototype.AllocatePaletteArray=function(d,f,e){this._pal_int[d][f]=LowAPI.Gen_Array([e],0)};a.prototype.GetCurrentPalette=function(){return this._crt_pal};a.GenPalette=function(k,e,h){if(k<0){return e}if(k==a.PAL_INVISIBLE){return null}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_RED_YELLOW))!=0&&k==a.PAL_RED_YELLOW){for(var j=0;j<e.length;j++){h[j]=(e[j]|16724736)&(4294967040).castToInt()}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_BLUE_CYAN))!=0&&k==a.PAL_BLUE_CYAN){for(var j=0;j<e.length;j++){h[j]=(e[j]|13311)&(4278255615).castToInt()}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_GREEN))!=0&&k==a.PAL_GREEN){for(var j=0;j<e.length;j++){h[j]=(e[j]|0)&(4278255360).castToInt()}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_GREY))!=0&&k==a.PAL_GREY){for(var j=0;j<e.length;j++){var m=(e[j]&16711680)>>16;var l=(e[j]&65280)>>8;var d=(e[j]&255);m=LowAPI.Float2Int((m+l+d)/3)&255;h[j]=(e[j]&(4278190080).castToInt())|(m<<16)|(m<<8)|(m)}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_BLEND_BLACK))!=0&&k==a.PAL_BLEND_BLACK){for(var j=0;j<e.length;j++){var f=(e[j]&(4278190080).castToInt());var m=(e[j]&16515072)>>2;var l=(e[j]&64512)>>2;var d=(e[j]&252)>>2;h[j]=(f|m|l|d)}}return h};a.GenPalette=function(k,e,h){if(k<0){return e}if(k==a.PAL_INVISIBLE){return null}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_RED_YELLOW))!=0&&k==a.PAL_RED_YELLOW){for(var j=0;j<e.length;j++){h[j]=((e[j]|3888)&65520).castToShort()}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_BLUE_CYAN))!=0&&k==a.PAL_BLUE_CYAN){for(var j=0;j<e.length;j++){h[j]=((e[j]|63)&61695).castToShort()}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_GREEN))!=0&&k==a.PAL_GREEN){for(var j=0;j<e.length;j++){h[j]=((e[j]|0)&61680).castToShort()}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_GREY))!=0&&k==a.PAL_GREY){for(var j=0;j<e.length;j++){var m=(e[j]&3840)>>8;var l=(e[j]&240)>>4;var d=(e[j]&15);m=LowAPI.Float2Int((m+l+d)/3)&15;h[j]=((e[j]&61440)|(m<<8)|(m<<4)|(m)).castToShort()}}if((GLLibConfig.sprite_useGenPalette&(1<<a.PAL_BLEND_BLACK))!=0&&k==a.PAL_BLEND_BLACK){for(var j=0;j<e.length;j++){var f=(e[j]&61440);var m=(e[j]&3840)>>2;var l=(e[j]&240)>>2;var d=(e[j]&15)>>2;h[j]=(f|m|l|d).castToShort()}}return h};a.GenPalette=function(h,d,e){if(h==a.PAL_INVISIBLE){return null}for(var f=0;f<d.length;f++){var j=((d[f]&61440)<<12)|((d[f]&3840)<<8)|((d[f]&240)<<4)|((d[f]&15));e[f]=j&(4294967295).castToInt()}if(h<0){return e}else{return GenPalette(h,e,e)}};a.prototype.IsExtraPaletteExist=function(){return this._isExtraPaletteExist};a.prototype.AllocateExtraPalette=function(j){var j=!LowAPI.isUndefined(j)?j:this._palettes;if(!(j>=0)){Assert(false,"AllocateExtraPalette: invalid palette("+j+") passed")}if(!(j<GLLibConfig.MAX_SPRITE_PALETTES)){Assert(false,"AllocateExtraPalette: Sprite is using more palettes than MAX_SPRITE_PALETTES, please increase this value in GLLibConfig!")}if(!((this._bs_flags&a.BS_MULTIPLE_IMAGES)==0)){Assert(false,"AllocateExtraPalette do not supported multiple images sprites")}var f=this.GetNumColors(0);if(GLLibConfig.sprite_useSingleImageForAllModules&&((this._bs_flags&a.BS_SINGLE_IMAGE)!=0)){if(j<this._palettes){return j}var e=f*3+4;var k=f+4;var i=e+k;var d=this._palettes;this._palettes=j+1;var h=LowAPI.Gen_Array([this._palettes*i],0);System.arraycopy(this._pal_data,0,h,0,d*i);this._pal_data=h}else{this.AllocatePaletteArray(0,j,f);if(this.AllocateExtraCache(j)<0){if(j>=this._palettes){this._palettes=j+1}}}return j};a.prototype.AllocateExtraIndexPalette=function(){if(!((this._bs_flags&a.BS_MULTIPLE_IMAGES)==0)){Assert(false,"AllocateExtraIndexPalette do not supported multiple images sprites")}var e=this.AllocateExtraPalette();var d=this.GetNumColors(0);for(var f=0;f<d;f++){this.SetPaletteColor(0,e,f,f)}return e};a.prototype.Palette_CopyAndApplyAlpha=function(e,n,k,j,o,d){if(!((j>=0)&&(j<=255))){Assert(false,"Palette_CopyAndApplyAlpha: Blend value must be [0,255]!")}if(!((n>=0)&&(n<this._palettes))){Assert(false,"Palette_CopyAndApplyAlpha: Palette parameter 1 must be a valid palette")}if(!((k>=0)&&(k<this._palettes))){Assert(false,"Palette_CopyAndApplyAlpha: Palette parameter 2 must be a valid palette")}var f=false;var m=this.GetPalette(e,n);var q=this.GetPalette(e,k);var h,p;if(d){for(var l=this._colors[e];--l>=0;){if((m[l]&16777215)==16711935){f=true;q[l]=16711935}else{h=((m[l]&(4278190080).castToInt())>>24)&255;p=(h*j)>>8;if(p!=255){f=true}q[l]=(p<<24)|m[l]&16777215}}}else{if(o){p=(j<<24);for(var l=this._colors[e];--l>=0;){if((m[l]&16777215)==16711935){f=true;q[l]=16711935}else{q[l]=(p)|m[l]&16777215}}}else{p=(j<<24);for(var l=this._colors[e];--l>=0;){q[l]=(p)|m[l]&16777215}}}return f||this._alpha};a.prototype.Palette_SetColor=function(){if(arguments){switch(arguments.length){case 3:return this._Palette_SetColor_3.apply(this,arguments);case 4:return this._Palette_SetColor_4.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._Palette_SetColor_3=function(d,f,e){this.Palette_SetColor(0,d,f,e)};a.prototype._Palette_SetColor_4=function(d,e,h,f){if(!(e>=0)){Assert(false,"Palette_SetColor: Error: palette ID is negative!"+e)}if(!(e<this._palettes)){Assert(false,"Palette_SetColor: Error: palette ID is greater than available palettes!"+e)}if(!(h>=0)){Assert(false,"Palette_SetColor: Error: color index is negative!"+h)}if(!(this._pal_int!=null)){Assert(false,"Palette_SetColor: Palettes are null!")}if(!(this._pal_int[d][e]!=null)){Assert(false,"Palette_SetColor: Palette["+e+"] is null!!")}if(!(this._pal_int[d][e].length>h)){Assert(false,"Palette_SetColor: Error: color index is greater than this palette has!"+h)}this._pal_int[d][e][h]=f};a.prototype.Palette_GetPaletteFromPNG=function(e){if(this._pal_data!=null){var h=this.GetNumColors(0);var f=h*3+4;var m=h+4;var l=f+m;var d=e*l;var k=[];for(var j=0;j<h;j++){k[j]=(((this._pal_data[d]&255)<<16)|((this._pal_data[d+1]&255)<<8)|(this._pal_data[d+2]&255));d+=3}d+=4;for(var j=0;j<h;j++){k[j]=(k[j]|((this._pal_data[d++]&255)<<24)).castToInt()}return k}return null};a.prototype.IsPaletteDataSet=function(){if(arguments){switch(arguments.length){case 1:return this._IsPaletteDataSet_1.apply(this,arguments);case 2:return this._IsPaletteDataSet_2.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._IsPaletteDataSet_1=function(d){return this.IsPaletteDataSet(0,d)};a.prototype._IsPaletteDataSet_2=function(d,e){if(!(e>=0)){Assert(false,"DeallocatePalette: invalid palette("+e+") passed")}if(!(e<GLLibConfig.MAX_SPRITE_PALETTES)){Assert(false,"DeallocatePalette: palId("+e+") is bigger then MAX_SPRITE_PALETTES. Increase this value in GLLibConfig!")}if(e>=this._palettes){return false}if(GLLibConfig.sprite_useSingleImageForAllModules&&((this._bs_flags&a.BS_SINGLE_IMAGE)!=0)){return true}else{if(this._pal_int==null){return true}return this.GetPalette(d,e)!=null}};a.prototype.MarkTransformedModules=function(d,e){};a.prototype.MarkOperation=function(e,d){if(GLLibConfig.sprite_useOperationMark){if(a._operation==a.OPERATION_MARK){this._modules_usage[e]|=(1<<(d&7)).castToByte();return true}}return false};a.prototype.CheckOperation=function(i,l,j,e,k,h,f,d){if(i==null){Dbg("ERROR        : CheckOperation img is null");return false}if(GLLibConfig.sprite_useOperationRecord){if(a._operation==a.OPERATION_DRAW){return true}else{if(a._operation==a.OPERATION_RECORD){this._aryPrecomputedImages[a.record_frame][a.record_index]=i;this._aryPrecomputedX[a.record_frame][a.record_index]=l.castToShort();this._aryPrecomputedY[a.record_frame][a.record_index]=j.castToShort();this._aryPrecomputedSizeX[a.record_frame][a.record_index]=e.castToShort();this._aryPrecomputedSizeY[a.record_frame][a.record_index]=k.castToShort();this._aryPrecomputedFlags[a.record_frame][a.record_index]=h;if(!GLLibConfig.sprite_ModuleMapping_useModuleImages){this._aryPrecomputedImgX[a.record_frame][a.record_index]=f.castToShort();this._aryPrecomputedImgY[a.record_frame][a.record_index]=d.castToShort()}a.record_index++;return false}else{return false}}}else{return true}};a.prototype.readArray2Short=function(j,l,k,m,d,e,h){for(var f=0;f<d;f++){k[f+m]=e?(j[l++]):((((j[l++]&255))+((j[l++]&255)<<8)).castToShort())}return l};a.prototype.BuildFrameIndexTable=function(h,d){var d=!LowAPI.isUndefined(d)?d:h;var e=this.IsExtraPaletteExist()?this._palettes-1:this.AllocateExtraIndexPalette();this._isExtraPaletteExist=true;this.SetUseCacheRGB(true);if(this._frame_data==null){this._frame_data=LowAPI.Gen_Array([this.GetFrameCount()],null)}this.InitPalTransparentIndex(0);var j=(d==-1)?(this.GetFrameCount()-1):d;for(var f=h;f<=j;f++){this._frame_data[f]=this.BuildByteFrameRGB(f,e,null,true)}this.SetUseCacheRGB(false)};a.prototype.GetFrameIndexTable=function(d){return this._frame_data[d]};a.prototype.IsFrameIndexTableBuild=function(d){if(typeof d!="undefined"){return(this._frame_data!=null)&&(this._frame_data[d]!=null)}else{return this._frame_data!=null}};a.prototype.PaintFrameScaledA6=function(W,f,H,G,s,Q,Y,C,U){if(arguments.length<9){U=false}if(Q<0||Y<0){return}var T=this.GetCurrentPalette();var I,V,P,O;var l,o,n,m,E,z;var F=a.GetPixelBuffer_int(null);var D=null;var u=null;var e=null;var R=(this._frame_data!=null&&this._frame_data[f]!=null);D=this.GetPalette(0,T);if(R){u=this._frame_data[f]}else{e=this.GetFrameRGB(f)}I=this.GetFrameWidth(f);V=this.GetFrameHeight(f);P=this.GetFrameMinX(f);O=this.GetFrameMinY(f);n=LowAPI.Float2Int((P*Q)/100);m=LowAPI.Float2Int((O*Y)/100);E=LowAPI.Float2Int(((I+P)*Q)/100);z=LowAPI.Float2Int(((V+O)*Y)/100);l=E-n;o=z-m;if(U){n=0;m=0}if(l==0){return}if(o==0){return}var L=GetClipX();var J=GetClipY();var N=GetClipWidth();var X=GetClipHeight();var r=LowAPI.Float2Int(Math_IntToFixedPoint(I)/l);var p=LowAPI.Float2Int(Math_IntToFixedPoint(V)/o);var B=1;var k=0;var q=l;var j=false;var d=false;G+=m;if((s&a.FLAG_FLIP_X)!=0){j=true;if(!C){H-=q+n}}else{H+=n}if((s&a.FLAG_FLIP_Y)!=0){d=true;if(!C){G-=k+m}}var M=0;var K=0;if((H>=L+N)||(H+q<=L)||(G>=J+X)||(G+o<=J)){return}if(H<L){var A=(L-H);q-=A;M=LowAPI.Float2Int((A*100)/Q);H=L}if(H+q>N+L){q=N+L-H}var v=0;if(G<J){v=(J-G);K=LowAPI.Float2Int((v*100)/Y);V-=K;G=J;o-=v;v=0}if(G+o>X+J){o=X+J-G}k=LowAPI.Float2Int(F.length/q);k=Math_Min((o-v),k);B=LowAPI.Float2Int((o-v)/k);M=Math_IntToFixedPoint(M);K=Math_IntToFixedPoint(K);for(var S=0;S<B;S++){if(R){K=this.ScaleBlockIndexTable(F,u,D,M,K,I,V,q,k,r,p,j,d)}else{K=this.ScaleBlockRGB(F,e,M,K,I,V,q,k,r,p,j,d)}DrawRGB(W,F,0,q,H,G+S*k,q,k,true)}var t=o-k*B;if(t>0){if(R){this.ScaleBlockIndexTable(F,u,D,M,K,I,V,q,t,r,p,j,d)}else{this.ScaleBlockRGB(F,e,M,K,I,V,q,t,r,p,j,d)}DrawRGB(W,F,0,q,H,G+B*k,q,t,true)}return};a.prototype.ScaleBlockIndexTable=function(o,s,w,f,e,t,C,k,q,E,D,p,n){var v=0,u=0,d=-1;var i,B=0,A=k,m;var z=f,y=e;var j=0;var r;for(var x=0;x<q;x++){if(n){u=C-1-(y>>GLLibConfig.math_fixedPointBase)}else{u=y>>GLLibConfig.math_fixedPointBase}if(p){i=(u+1)*t-1}else{i=u*t}j=z;m=B;r=B+k;if(d==u){System.arraycopy(o,B-k,o,B,k)}else{if(p){while(B<r){v=j>>GLLibConfig.math_fixedPointBase;var l=s[i-v]&255;if(l==255){o[B]=0}else{o[B]=w[l]}B++;j+=E}}else{while(B<r){v=j>>GLLibConfig.math_fixedPointBase;var l=s[v+i]&255;if(l==255){o[B]=0}else{o[B]=w[l]}B++;j+=E}}}B=m+A;y+=D;d=u}return y};a.prototype.ScaleBlockRGB=function(n,p,f,e,s,z,k,q,C,B,o,m){var u=0,t=0,d=-1;var i,A=0,y=k,l;var x=f,w=e;var j=0;var r;for(var v=0;v<q;v++){if(m){t=z-1-(w>>GLLibConfig.math_fixedPointBase)}else{t=w>>GLLibConfig.math_fixedPointBase}if(o){i=(t+1)*s-1}else{i=t*s}j=x;l=A;r=A+k;if(d==t){System.arraycopy(n,A-k,n,A,k)}else{if(o){while(A<r){u=j>>GLLibConfig.math_fixedPointBase;n[A]=p[i-u];A++;j+=C}}else{while(A<r){u=j>>GLLibConfig.math_fixedPointBase;n[A]=p[u+i];A++;j+=C}}}A=l+y;w+=B;d=t}return w};a.prototype.FreeModuleData=function(){this._modules_x_byte=null;this._modules_y_byte=null;this._modules_x_short=null;this._modules_y_short=null;this._modules_w_scaled=null;this._modules_h_scaled=null;this._modules_w_short=null;this._modules_h_short=null;this._modules_w_byte=null;this._modules_h_byte=null;this._modules_extra_info=null;this._modules_extra_pointer=null;this._frames_nfm_byte=null;this._frames_nfm_short=null;this._frames_fm_start=null;this._frame_image_intAAA=null;this._fmodules_id_byte=null;this._fmodules_id_short=null;this._fmodules_flags=null;this._fmodules_ox_byte=null;this._fmodules_oy_byte=null;this._fmodules_ox_short=null;this._fmodules_oy_short=null;this._modules_data=null;this._modules_data_array=null;this._modules_data_off_int=null;this._modules_data_off_short=null;this._module_types=null;this._module_colors_int=null;this._module_colors_byte=null;a._warpTextInfo=null};a.prototype.DrawYPerspective=function(T,d,y,x,X,W,V,U,A){if(x<=y||U<X||V<W){return}var M=0;var L=0;var E=GLLibConfig.screenWidth;var D=GLLibConfig.screenHeight;if(x<=M||y>=E){return}var R=this.GetCurrentPalette();var K=this.GetFrameWidth(d);var S=this.GetFrameHeight(d);var u=x-y;var m=u;var l=Math_IntToFixedPoint(K);var H;H=LowAPI.Float2Int(l/m);var C=0;if((A&a.FLAG_FLIP_X)!=0){C=l-Math_IntToFixedPoint(1);H=-H}var N=LowAPI.Float2Int(Math_IntToFixedPoint(W-X)/m);var n=LowAPI.Float2Int(Math_IntToFixedPoint(V-U)/m);var t=0;if(W!=X){t=LowAPI.Float2Int(Math_IntToFixedPoint(m)/Math_Abs(W-X))}var O=Math_IntToFixedPoint(X);var r=Math_IntToFixedPoint(U);if(y<M){var k=M-y;u-=k;C+=H*k;if(C<0||C>=l){return}O+=N*k;r+=n*k;X=Math_FixedPointToInt(O);U=Math_FixedPointToInt(r);y=M}var B=Math_FixedPointToInt(C);if(B<0||B>=K||u<=0){return}if(x>E){var k=x-E;u-=k;W=Math_FixedPointToInt(Math_IntToFixedPoint(W)-N*k);V=Math_FixedPointToInt(Math_IntToFixedPoint(V)-n*k);x=E}if(X>=D){var j=X-D+1;var k=Math_FixedPointToInt(j*t);u-=k;y+=k;C+=H*k;if(C<0||C>=l){return}r+=n*k;U=Math_FixedPointToInt(r);X=D-1;O=Math_IntToFixedPoint(X)}if(W>=D){var j=W-D+1;var k=Math_FixedPointToInt(j*t);u-=k;x=y+u;V=Math_FixedPointToInt(Math_IntToFixedPoint(V)-n*k);W=D-1}if(u<=0){return}var o=Math.min(X,W);if(o<L){o=L}var J=Math.max(V,U);if(J>D){J=D}var p=J-o;if(p<=0){return}rgbTemp=a.GetPixelBuffer_int(null);colorTable=null;colorIndexData=null;rgbData=null;isIndexed=(this._frame_data!=null&&this._frame_data[d]!=null);colorTable=this.GetPalette(0,R);if(isIndexed){colorIndexData=this._frame_data[d]}else{rgbData=this.GetFrameRGB(d)}var f=p;var s=LowAPI.Float2Int(rgbTemp.length/f);var G=LowAPI.Float2Int((x-y)/s);var e,F,P,q;var I,z;e=X;q=U;for(var Q=0;Q<G;Q++){F=LowAPI.Float2Int(X+((W-X)*s*(Q+1))/u);P=LowAPI.Float2Int(U+((V-U)*s*(Q+1))/u);I=Math_Min(e,F);z=Math_Max(P,q);if(I<L){I=L}if(z>D){z=D}f=z-I;O=Math_IntToFixedPoint(e);r=Math_IntToFixedPoint(q);if(colorIndexData!=null){C=this.PrepareYPerspectiveBlockIT(rgbTemp,colorTable,colorIndexData,s,f,K,S,C,y+s*Q,y+s*(Q+1),I,z,O,r,H,N,n)}else{C=PrepareYPerspectiveBlockRGB(rgbTemp,rgbData,s,f,K,S,C,y+s*Q,y+s*(Q+1),I,z,O,r,H,N,n)}DrawRGB(T,rgbTemp,0,s,y+s*Q,I,s,f,true);e=F;q=P}var v=u-s*G;if(v>0){F=W;P=V;I=Math_Min(e,F);z=Math_Max(P,q);if(I<L){I=L}if(z>D){z=D}f=z-I;O=Math_IntToFixedPoint(e);r=Math_IntToFixedPoint(q);if(colorIndexData!=null){C=this.PrepareYPerspectiveBlockIT(rgbTemp,colorTable,colorIndexData,v,f,K,S,C,y+s*G,x,I,z,O,r,H,N,n)}else{C=PrepareYPerspectiveBlockRGB(rgbTemp,rgbData,v,f,K,S,C,y+s*G,x,I,z,O,r,H,N,n)}DrawRGB(T,rgbTemp,0,v,y+s*G,I,v,f,true)}};a.prototype.PrepareYPerspectiveBlockIT=function(q,A,E,f,r,v,F,k,H,G,K,I,s,x,d,e,m){var l;var z=k>>GLLibConfig.math_fixedPointBase,n;var y,u=0;var L;var J,B,C;var p=Math_FixedPointToInt(s),t=Math_FixedPointToInt(x);for(var D=H;D<G;++D){if(t<K||p>=I){continue}J=D-H;for(C=p-K-1;C>=0;--C){q[J]=0;J+=f}J=(r-1)*f+D-H;for(C=I-t-1;C>=0;--C){q[J]=0;J-=f}if(p<t){n=D-H;y=0;L=0;l=LowAPI.Float2Int(Math_IntToFixedPoint(F)/(t-p));if(p<K){J=l*(K-p);y+=J;p=K}else{n+=f*(p-K)}if(t>I){t=I}var o=E[z]&255;if(o==255){B=0}else{B=A[o]}for(;p<t;++p){u=y>>GLLibConfig.math_fixedPointBase;if(L!=u){z+=(u-L)*v;o=E[z]&255;if(o==255){B=0}else{B=A[o]}L=u}q[n]=B;n+=f;y+=l}}s+=e;x+=m;k+=d;p=s>>GLLibConfig.math_fixedPointBase;t=x>>GLLibConfig.math_fixedPointBase;z=k>>GLLibConfig.math_fixedPointBase;if(z<0){z=0;k=0}else{if(z>=v){z=v-1;k=z<<GLLibConfig.math_fixedPointBase}}}return k};a.prototype.InitPalTransparentIndex=function(e){var d=this.GetPalette(0,e);for(var f=0;f<d.length;f++){if((d[f]&4278190080)==0){this._palTransparencyIndex=f;break}}};a.prototype.BuildCacheImages=function(t,f,d,v){this.AllocateCacheArrays(t);if(a.s_BCI_supportsCacheEffects&&(a.s_BCI_effects!=null)){BCI_InitCacheEffect(t)}if(GLLibConfig.sprite_debugLoading){Dbg("BuildCacheImages("+t+", "+f+", "+d+", "+v+")... "+this)}if(this._nModules==0){return}if(d==-1){d=this._nModules-1}if(GLLibConfig.sprite_ModuleMapping_useModuleImages){if((this._bs_flags&(a.BS_MODULE_IMAGES|a.BS_MODULE_IMAGES_TC_BMP))!=0){if(v>=0){for(var w=f;w<=d;w++){if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){this._module_image_intAAA[t][w]=this._module_image_intAAA[v][w]}else{this._module_image_imageAA[t][w]=this._module_image_imageAA[v][w]}}}else{var u;var m;var l;var q=this._crt_pal;this._crt_pal=t;for(var w=f;w<=d;w++){if(GLLibConfig.sprite_useMultipleModuleTypes){if(this.GetModuleType(w)!=a.MD_IMAGE){continue}}var r=this.GetModuleWidth(w);var o=this.GetModuleHeight(w);var p=r*o;if(r<=0||o<=0){continue}if(false){var h;h=this.DecodeImage_int(w);if(h==null){continue}if(!a.s_BCI_supportsCacheEffects||(a.s_BCI_effects==null)){this.SetCache(h,r,o,t,w)}else{BCI_SetCacheWithEffect(h,r,o,t,w)}h=null}else{var n=CreateImage(r,o);var j=n.m_image.getHTMLCanvasElement();var z=this.DecodeImage_JSCanvas(j,this.GetModuleImageIndex(w),this.GetModuleData(w),this.GetStartModuleData(w,0),this.GetModuleWidth(w),this.GetModuleHeight(w));if(z){this._module_image_imageAA[t][w]=n}}}this._crt_pal=q}}}if(GLLibConfig.sprite_useSingleImageForAllModules&&((this._bs_flags&a.BS_SINGLE_IMAGE)!=0)){try{if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA[t]==null){this._module_image_intAAA[t]=LowAPI.Gen_Array([1],null)}}else{if(this._module_image_imageAA[t]==null){if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){this._module_image_imageAA[t]=LowAPI.Gen_Array([this._number_image],null)}else{this._module_image_imageAA[t]=LowAPI.Gen_Array([1],null)}}}var s=this.GetModuleData(0);if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){for(var w=0;w<this._number_image;w++){var k=this.GetNumColors(w)*3+4;var y=this.GetNumColors(w)+4;System.arraycopy(this._pal_data_array[w],t*(k+y),this._modules_data_array[w],41,k);System.arraycopy(this._pal_data_array[w],t*(k+y)+k,this._modules_data_array[w],41+k+8,y)}}else{var k=this.GetNumColors(0)*3+4;var y=this.GetNumColors(0)+4;System.arraycopy(this._pal_data,t*(k+y),s,41,k);System.arraycopy(this._pal_data,t*(k+y)+k,s,41+k+8,y)}if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){this._module_image_intAAA[t][0]=LowAPI.Gen_Array([s.length],0);System.arraycopy(s,0,this._module_image_intAAA[t][0],0,s.length);if(GLLibConfig.sprite_debugUsedMemory){a._images_count++;a._images_size+=s.length}}else{if((this._bs_flags&a.BS_MULTIPLE_IMAGES)!=0){for(var w=0;w<this._number_image;w++){this._module_image_imageAA[t][w]=CreateImage(this._modules_data_array[w],0,this._modules_data_array[w].length)}}else{this._module_image_imageAA[t][0]=CreateImage(s,0,s.length)}}}catch(x){Err("BuildCacheImages - "+x)}}};a.prototype.PushCacheImagesToGL=function(){if(this._module_image_imageAA){for(var d=0,i=this._module_image_imageAA.length;d<i;d++){var e=this._module_image_imageAA[d];if(e){for(var f=0,h=e.length;f<h;f++){if(e[f]&&e[f].m_image){e[f].m_image.cacheAsTexture()}}}}}};a.prototype.SetCache=function(k,d,h,f,l){var e=d*h;if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if((this._module_image_intAAA[f][l]==null)||(this._module_image_intAAA[f][l].length!=e)){this._module_image_intAAA[f][l]=LowAPI.Gen_Array([e],0)}System.arraycopy(k,0,this._module_image_intAAA[f][l],0,e)}else{var j=false;for(var i=0;i<e;i++){if((k[i]&4278190080)!=(4278190080).castToInt()){j=true;break}}this._module_image_imageAA[f][l]=CreateRGBImage(k,d,h,j);if(GLLibConfig.sprite_removeOnePixelModule&&(this._module_image_imageAA[f][l].getHeight()==1)&&(this._module_image_imageAA[f][l].getWidth()==1)){this._module_image_imageAA[f][l]=null}}};a.prototype.BuildPaletteIndexCacheImages=function(q,o){if(!(GLLibConfig.sprite_usePaletteIndexCache)){Assert(false,"BuildPaletteIndexCacheImages: you must enable sprite_usePaletteIndexCache to use this.")}if(!(q>=0)){Assert(false,"BuildPaletteIndexCacheImages: Module index is "+q+", it can't be negative!")}if(this._nModules==0){return}if(o==-1){o=this._nModules-1}if(this._module_image_byteAA==null){this._module_image_byteAA=LowAPI.Gen_Array([this._nModules],null)}var t=this.GetCurrentPalette();var h=null;var p=null;var e=null;var m=null;var d=this.GetNumColors(0);this.SetCurrentPalette(0);h=LowAPI.Gen_Array([d],0);m=this.GetPalette(0,0);System.arraycopy(m,0,h,0,d);for(var l=d;--l>=0;){m[l]=l}for(var k=q;k<=o;k++){if(GLLibConfig.sprite_useMultipleModuleTypes){if(this.GetModuleType(k)!=a.MD_IMAGE){continue}}var j=this.GetModuleWidth(k);var f=this.GetModuleHeight(k);var s=j*f;if(this._module_image_byteAA[k]==null){this._module_image_byteAA[k]=LowAPI.Gen_Array([s],0)}var n=this.DecodeImage_int(k);var r=this._module_image_byteAA[k];for(var l=s;--l>=0;){r[l]=n[l].castToByte()}}this.SetCurrentPalette(t);System.arraycopy(h,0,m,0,d)};a.prototype.AllocateCacheArrays=function(d){if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA==null){this._module_image_intAAA=LowAPI.Gen_Array([this._palettes],null)}if(this._module_image_intAAA[d]==null){this._module_image_intAAA[d]=LowAPI.Gen_Array([this._nModules],null)}}else{if(this._module_image_imageAA==null){this._module_image_imageAA=LowAPI.Gen_Array([this._palettes],null)}if(this._module_image_imageAA[d]==null){this._module_image_imageAA[d]=LowAPI.Gen_Array([this._nModules],null)}}};a.prototype.AllocateExtraCache=function(){if(arguments){switch(arguments.length){case 0:return this._AllocateExtraCache_0.apply(this,arguments);case 1:return this._AllocateExtraCache_1.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._AllocateExtraCache_0=function(){var d=-1;if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA!=null){d=this._module_image_intAAA.length}}else{if(this._module_image_imageAA!=null){d=this._module_image_imageAA.length}}if(d>=0){return this.AllocateExtraCache(d)}return d};a.prototype._AllocateExtraCache_1=function(h){if(!(h>=0)){Assert(false,"AllocateExtraCache: cache id("+h+") must be >= 0.")}var j=-1;if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA!=null){j=h;if(j>=this._module_image_intAAA.length){var e=j+1;var d=this._module_image_intAAA;this._module_image_intAAA=LowAPI.Gen_Array([e],null);for(var f=d.length;--f>=0;){this._module_image_intAAA[f]=d[f]}}}}else{if(this._module_image_imageAA!=null){j=h;if(j>=this._module_image_imageAA.length){var e=j+1;var d=this._module_image_imageAA;this._module_image_imageAA=LowAPI.Gen_Array([e],null);for(var f=d.length;--f>=0;){this._module_image_imageAA[f]=d[f]}}}}if(j>-1){if(this._palettes<=j){this._palettes=j+1}this.AllocateCacheArrays(j)}return j};a.prototype.FreeCachedModules=function(){if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA!=null){for(var e=0;e<this._module_image_intAAA.length;e++){if(this._module_image_intAAA[e]!=null){for(var f=0;f<this._module_image_intAAA[e].length;f++){this._module_image_intAAA[e][f]=null}this._module_image_intAAA[e]=null}}this._module_image_intAAA=null}}else{if(this._module_image_imageAA!=null){for(var f=0;f<this._module_image_imageAA.length;f++){this._module_image_imageAA[f]=null}this._module_image_imageAA=null}}if(GLLibConfig.sprite_usePaletteIndexCache){if(this._module_image_byteAA!=null){for(var d=0;d<this._module_image_byteAA.length;d++){this._module_image_byteAA[d]=null}this._module_image_byteAA=null}}};a.prototype.BuildCacheFrames=function(l,h,f,i,e){if(arguments.length<5){e=0}if(arguments.length<4){i=false}if(!(h>=0)){Assert(false,"BuildCacheFrames: First frame index is "+h+", it can't be negative!")}if(!(l>=0)){Assert(false,"BuildCacheFrames: Palette index is "+l+", it can't be negative!")}if(!(l<this._palettes)){Assert(false,"BuildCacheFrames: Palette index is "+l+", its out of bounds! Current number of palettes is "+this._palettes+".")}var k=this.GetFrameCount();if(f==-1||f>=k){f=k-1}if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(!i){if(this._frame_image_intAAA==null){this._frame_image_intAAA=LowAPI.Gen_Array([this._palettes],null)}if(this._frame_image_intAAA[l]==null){this._frame_image_intAAA[l]=LowAPI.Gen_Array([k],null)}for(var d=h;d<=f;d++){this._frame_image_intAAA[l][d]=this.BuildFrameRGB(d,l,e)}}else{if(this._frame_image_byteAAA==null){this._frame_image_byteAAA=LowAPI.Gen_Array([this._palettes],null)}if(this._frame_image_byteAAA[l]==null){this._frame_image_byteAAA[l]=LowAPI.Gen_Array([k],null)}for(var d=h;d<=f;d++){this._frame_image_byteAAA[l][d]=this.BuildByteFrameRGB(d,l,e)}}}else{if(this._frame_image_imageAAA==null){this._frame_image_imageAAA=LowAPI.Gen_Array([this._palettes],null)}var m=this.GetCurrentMMapping()+1;if(this._frame_image_imageAAA[l]==null){var j=this.GetMaxMMappingsLoaded()+1;this._frame_image_imageAAA[l]=LowAPI.Gen_Array([j],null)}if(!(m<this._frame_image_imageAAA[l].length)){Assert(false,"BuildCacheFrames: module map "+(m-1)+" was not loaded the first time that was cached a frame for this sprite")}if(this._frame_image_imageAAA[l][m]==null){this._frame_image_imageAAA[l][m]=LowAPI.Gen_Array([k],null)}for(var d=h;d<=f;d++){this._frame_image_imageAAA[l][m][d]=this.BuildFrameImage(d,l,e)}}};a.prototype.PushCacheFramesToGL=function(){if(this._frame_image_imageAAA){for(var l=0,d=this._frame_image_imageAAA.length;l<d;l++){var k=this._frame_image_imageAAA[l];if(k){for(var m=0,i=k.length;m<i;m++){var j=k[m];if(j){for(var f=0,h=j.length;f<h;f++){var e=j[f];if(e&&e.m_image&&e.m_image.getHTMLCanvasElement().width!=0&&e.m_image.getHTMLCanvasElement().height!=0){e.m_image.cacheAsTexture()}}}}}}}};a.prototype.BuildFrameImage=function(d,r,f,m){if(f==c){f=0}if(r==c){r=this._crt_pal}if(m==c){m=false}if(false){var p=this.GetFrameWidth(d);var k=this.GetFrameHeight(d);if(p==0||k==0){return null}var l=this.BuildFrameRGB(d,r,f);if(l==null){return null}if((f&a.FLAG_ROT_90)!=0){return CreateRGBImage(l,k,p,a.s_frame_image_bHasAlpha)}else{return CreateRGBImage(l,p,k,a.s_frame_image_bHasAlpha)}}else{var p=this.GetFrameWidth(d);var k=this.GetFrameHeight(d);var o=this.GetFrameMinX(d);var n=this.GetFrameMinY(d);if(p==0||k==0){return null}if((f&a.FLAG_FLIP_X)!=0){o=-o-p}if((f&a.FLAG_FLIP_Y)!=0){n=-n-k}if((f&a.FLAG_ROT_90)!=0){var j=o;o=-n-k;n=j}o*=-1;n*=-1;var t=p*k;var e=f;if((f&a.FLAG_ROT_90)!=0){var s=p;p=k;k=s}var i;if(m){i=CreateImage(LowAPI.nextHighestPowerOfTwo(p),LowAPI.nextHighestPowerOfTwo(k))}else{i=CreateImage(p,k)}var q=GetGraphics(i);var j=this._crt_pal;this._crt_pal=r;this.PaintFrame(q,d,o,n,e);this._crt_pal=j;return i}};a.prototype.BuildFrameRGB=function(){if(arguments){switch(arguments.length){case 1:return this._BuildFrameRGB_1.apply(this,arguments);case 2:if(typeof arguments[1]=="number"){return this._BuildFrameRGB_2_1.apply(this,arguments)}else{return this._BuildFrameRGB_2_2.apply(this,arguments)}case 3:if(typeof arguments[2]=="number"){return this._BuildFrameRGB_3_1.apply(this,arguments)}else{return this._BuildFrameRGB_3_2.apply(this,arguments)}case 4:if(typeof arguments[3]==="boolean"){return this._BuildFrameRGB_4_2.apply(this,arguments)}else{return this._BuildFrameRGB_4_1.apply(this,arguments)}case 5:return this._BuildFrameRGB_5.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._BuildFrameRGB_1=function(d){return this.BuildFrameRGB(d,this._crt_pal,null)};a.prototype._BuildFrameRGB_2_1=function(e,d){return this.BuildFrameRGB(e,d,null)};a.prototype._BuildFrameRGB_3_1=function(f,d,e){return this.BuildFrameRGB(f,d,null,a.ALPHA_FULL,e)};a.prototype._BuildFrameRGB_2_2=function(e,d){return this.BuildFrameRGB(e,this._crt_pal,d)};a.prototype._BuildFrameRGB_3_2=function(f,d,e){return this.BuildFrameRGB(f,d,e,a.ALPHA_FULL)};a.prototype._BuildFrameRGB_4_1=function(f,d,e,h){return this.BuildFrameRGB(f,d,e,h,0)};a.prototype._BuildFrameRGB_5=function(n,t,d,j,k){var l=false;var m=this.GetFrameWidth(n);var v=this.GetFrameHeight(n);var q=this.GetFrameMinX(n);var o=this.GetFrameMinY(n);if((k&a.FLAG_FLIP_X)!=0){q=-q-m}if((k&a.FLAG_FLIP_Y)!=0){o=-o-v}if((k&a.FLAG_ROT_90)!=0){var x=q;q=-o-v;o=x}q*=-1;o*=-1;var r=m*v;if(m==0||v==0){return d}if(d==null||d.length<r){d=LowAPI.Gen_Array([r],0)}var x=this._crt_pal;this._crt_pal=t;var p=k;if(GLLibConfig.landscape_useRotatedModules){k=a.TRANSFORM_ROT_90[k&7]|(k&~7)}if(GLLibConfig.sprite_useCacheFramesWithCustomBlit){if(!(GLLibConfig.sprite_allowPixelArrayGraphics)){Assert(false,"BuildFrameRGB: sprite_useCacheFramesWithCustomBlit is set to TRUE but sprite_allowPixelArrayGraphics is FALSE, please enable it!")}if(this._isExtraPaletteExist){for(var u=0;u<r;u++){d[u]=this._palTransparencyIndex}}a.SetGraphics(d,m,v,j);this.PaintFrame(g,n,q,o,p);a.SetGraphics(null,0,0);a.s_frame_image_bHasAlpha=true}else{if((k&a.FLAG_ROT_90)!=0){var y=m;m=v;v=y}var s=CreateImage(m,v);var f=GetGraphics(s);f.setColor((4294902015).castToInt());f.fillRect(0,0,m,v);if((k&a.FLAG_ROT_90)!=0){SetGraphicsSize(v,m)}this.PaintFrame(f,n,q,o,p);if((k&a.FLAG_ROT_90)!=0){SetGraphicsSize(GetScreenWidth(),GetScreenHeight())}GetRGB(s,d,0,m,0,0,m,v);var e=GetDisplayColor(16711935);while(r>0){r--;if((d[r]&16777215)==e){d[r]=16711935;l=true}}a.s_frame_image_bHasAlpha=l}this._crt_pal=x;return d};a.prototype._BuildFrameRGB_4_2=function(h,d,e,f){var i=this._cachedFrameIsOpaque;this._cachedFrameIsOpaque=f;e=this.BuildFrameRGB(h,d,e);this._cachedFrameIsOpaque=i;return e};a.prototype.BuildByteFrameRGB=function(){if(arguments){switch(arguments.length){case 1:return this._BuildByteFrameRGB_1.apply(this,arguments);case 2:if(typeof arguments[1]=="number"){return this._BuildByteFrameRGB_2_1.apply(this,arguments)}else{return this._BuildByteFrameRGB_2_2.apply(this,arguments)}case 3:if(typeof arguments[2]=="number"){return this._BuildByteFrameRGB_3_1.apply(this,arguments)}else{return this._BuildByteFrameRGB_3_2.apply(this,arguments)}case 4:if(typeof arguments[3]==="boolean"){return this._BuildByteFrameRGB_4_2.apply(this,arguments)}else{return this._BuildByteFrameRGB_4_1.apply(this,arguments)}case 5:return this._BuildByteFrameRGB_5.apply(this,arguments)}}throw new Error("InvalidArguments")};a.prototype._BuildByteFrameRGB_1=function(d){return this.BuildByteFrameRGB(d,this._crt_pal,null)};a.prototype._BuildByteFrameRGB_3_1=function(f,d,e){return this.BuildByteFrameRGB(f,d,null,a.ALPHA_FULL,e)};a.prototype._BuildByteFrameRGB_2_1=function(e,d){return this.BuildByteFrameRGB(e,d,null)};a.prototype._BuildByteFrameRGB_2_2=function(e,d){return this.BuildByteFrameRGB(e,this._crt_pal,d)};a.prototype._BuildByteFrameRGB_3_2=function(f,d,e){return this.BuildByteFrameRGB(f,d,e,a.ALPHA_FULL)};a.prototype._BuildByteFrameRGB_4_1=function(f,d,e,h){return this.BuildByteFrameRGB(f,d,e,h,0)};a.prototype._BuildByteFrameRGB_5=function(l,d,j,m,e){var k=null;var h=this.BuildFrameRGB(l,d,j,m);if(h!=null){k=LowAPI.Gen_Array([h.length],0);for(var f=0;f<h.length;f++){k[f]=(h[f]&255).castToByte()}}return k};a.prototype._BuildByteFrameRGB_4_2=function(i,d,f,h){var j=this._cachedFrameIsOpaque;this._cachedFrameIsOpaque=h;var e=this.BuildByteFrameRGB(i,d,f);this._cachedFrameIsOpaque=j;return e};a.prototype.GetFrameRGB=function(f,d,e){if(arguments.length<3){e=false}if(arguments.length<2){d=this._crt_pal}if((this._frame_image_intAAA!=null)&&(this._frame_image_intAAA[d]!=null)){return this._frame_image_intAAA[d][f]}else{if(e){return this.BuildFrameRGB(f,d,0)}}return null};a.prototype.GetFrameImage=function(f,d){if(arguments.length<2){d=this._crt_pal}if((this._frame_image_imageAAA==null)||(this._frame_image_imageAAA[d]==null)){return null}var e=this.GetCurrentMMapping()+1;if(!(e<this._frame_image_imageAAA[d].length)){Assert(false,"GetFrameImage: module map "+(e-1)+" was not loaded the first time that was cached a frame for this sprite")}return this._frame_image_imageAAA[d][e][f]};a.prototype.IsFrameCached=function(f,d){var e=this.GetCurrentMMapping()+1;if((this._frame_image_imageAAA!=null)&&(this._frame_image_imageAAA[d]!=null)){if(!(e<this._frame_image_imageAAA[d].length)){Assert(false,"IsFrameCached: module map "+(e-1)+" was not loaded the first time that was cached a frame for this sprite")}}return((this._frame_image_imageAAA!=null)&&(this._frame_image_imageAAA[d]!=null)&&(this._frame_image_imageAAA[d][e][f]!=null))||((this._frame_image_intAAA!=null)&&(this._frame_image_intAAA[d]!=null)&&(this._frame_image_intAAA[d][f]!=null))||((this._frame_image_byteAAA!=null)&&(this._frame_image_byteAAA[d]!=null)&&(this._frame_image_byteAAA[d][f]!=null))||(GLLibConfig.sprite_usePaletteIndexCache&&(this._frame_image_byteAA!=null)&&(this._frame_image_byteAA[f]!=null))};a.prototype.FreeCachedFrames=function(){if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._frame_image_intAAA!=null){for(var e=0;e<this._frame_image_intAAA.length;e++){this._frame_image_intAAA[e]=null}}if(this._frame_image_byteAAA!=null){for(var e=0;e<this._frame_image_byteAAA.length;e++){this._frame_image_byteAAA[e]=null}}}else{if(this._frame_image_imageAAA!=null){for(var d=0;d<this._frame_image_imageAAA.length;d++){if(this._frame_image_imageAAA[d]!=null){for(var f=0;f<this._frame_image_imageAAA[d].length;f++){this._frame_image_imageAAA[d][f]=null}this._frame_image_imageAAA[d]=null}}this._frame_image_imageAAA=null}}if(GLLibConfig.sprite_usePaletteIndexCache){if(this._frame_image_byteAA!=null){for(var e=0;e<this._frame_image_byteAA.length;e++){this._frame_image_byteAA[e]=null}this._frame_image_byteAA=null}}if(GLLibConfig.sprite_useAsphaltFunctionality){if(this._frame_data!=null){for(var e=0;e<this._frame_data.length;e++){this._frame_data[e]=null}}}};a.prototype.BuildPaletteIndexCacheFrames=function(r,p){if(!(r>=0)){Assert(false,"BuildPaletteIndexCacheFrames: First frame index is "+r+", it can't be negative!")}if(!(GLLibConfig.sprite_usePaletteIndexCache)){Assert(false,"BuildPaletteIndexCacheFrames: you must enable sprite_usePaletteIndexCache to use this.")}if(!(GLLibConfig.sprite_useCachedFrames)){Assert(false,"BuildPaletteIndexCacheFrames: you must enable sprite_useCachedFrames to cache the frames.")}if(!(GLLibConfig.sprite_allowPixelArrayGraphics)){Assert(false,"BuildPaletteIndexCacheFrames: you must enable sprite_allowPixelArrayGraphics to cache the frames.")}if(!((this._bs_flags&a.BS_MULTIPLE_IMAGES)==0)){Assert(false,"BuildPaletteIndexCacheFrames do not supported multiple images sprites")}var t=this.GetFrameCount();if(p==-1||p>=t){p=t-1}if(this._frame_image_byteAA==null){this._frame_image_byteAA=LowAPI.Gen_Array([t],null)}if(a._frame_image_temp==null){a._frame_image_temp=LowAPI.Gen_Array([GLLibConfig.sprite_tmpFrameBufferSize],0)}var x=-1;var y=this.GetCurrentPalette();var o=null;var s=null;var d=null;var f=null;var e=this.GetNumColors(0);this.SetCurrentPalette(0);o=LowAPI.Gen_Array([e],0);f=this.GetPalette(0,0);System.arraycopy(f,0,o,0,e);for(var u=e;--u>=0;){if(f[u]==16711935){x=u;f[u]=x}else{f[u]=(u|4278190080)}}if(x==-1){x=0;Dbg("WARNING_BuildPaletteIndexCacheFrames(): Sprite does not contain transparent color (0x00FF00FF) in it's palette!")}this._flags&=~a.FLAG_USE_PAL_INDEX_CACHE;for(var k=r;k<=p;k++){var n=this.GetFrameWidth(k)*this.GetFrameHeight(k);if(!(n<=GLLibConfig.sprite_tmpFrameBufferSize)){Assert(false,"BuildPaletteIndexCacheFrames: Frame WxH > ASprite._frame_image_temp.length ("+this.GetFrameWidth(k)+" x "+this.GetFrameHeight(k)+" = "+this.GetFrameWidth(k)*this.GetFrameHeight(k)+" > "+a._frame_image_temp.length+")! Either decrease frame size or increase GLLibConfig.sprite_tmpFrameBufferSize!")}this._frame_image_byteAA[k]=LowAPI.Gen_Array([n],0);Mem_FillArray(a._frame_image_temp,x);var j=this.GetFrameWidth(k);var v=this.GetFrameHeight(k);var m=-this.GetFrameMinX(k);var l=-this.GetFrameMinY(k);a.SetGraphics(a._frame_image_temp,j,v,a.ALPHA_FULL);this.PaintFrame(g,k,m,l,0);a.SetGraphics(null,0,0);var q=this._frame_image_byteAA[k];for(var u=n;--u>=0;){q[u]=(a._frame_image_temp[u]&255).castToByte()}}this._flags|=a.FLAG_USE_PAL_INDEX_CACHE;this.SetCurrentPalette(y);System.arraycopy(o,0,f,0,e)};a.CheckVisibility=function(k,m,l,n,j){var f=GetClipX(k);var e=GetClipY(k);var i=GetClipWidth(k);var d=GetClipHeight(k);if((m+n<f)||(l+j<e)||(m>=f+i)||(l>=e+d)){return false}return true};a.SetGraphics=function(e,d,f,i){var i=!LowAPI.isUndefined(i)?i:a.ALPHA_FULL;Dbg("SetGraphics: Trying to set a custom pixel graphics context but sprite_allowPixelArrayGraphics is not enabled!!")};a.prototype.PaintAFrame=function(o,k,r,e,d,i){var q=0;var p=0;var h=this._anims_af_start[k]+r;var f;if((GLLibConfig.sprite_forceShortIndexForAFrames)||(GLLibConfig.sprite_allowShortIndexForAFrames&&(((this._bs_flags&a.BS_AF_INDEX_SHORT)!=0)))){f=this._aframes_frame_short[h]}else{if(GLLibConfig.sprite_useSingleArrayForFMAF){f=this._aframes[(h*5)]&255;if(GLLibConfig.sprite_useIndexExAframes){f|=((this._aframes[(h*5)+4]&a.FLAG_INDEX_EX_MASK)<<a.INDEX_EX_SHIFT)}}else{f=this._aframes_frame_byte[h]&255}}if(GLLibConfig.sprite_useIndexExAframes&&!GLLibConfig.sprite_forceShortIndexForAFrames&&(!GLLibConfig.sprite_allowShortIndexForAFrames||(((this._bs_flags&a.BS_AF_INDEX_SHORT)==0)))){f|=((this._aframes_flags[h]&a.FLAG_INDEX_EX_MASK)<<a.INDEX_EX_SHIFT)}var m;var n;var l;var j;if(GLLibConfig.sprite_useSingleArrayForFMAF){n=this.GetAFramesOX(k,r);l=this.GetAFramesOY(k,r);j=this._aframes[h*5+4]&255}else{n=this.GetAFramesOX(h);l=this.GetAFramesOY(h);j=this._aframes_flags[h]&15}if((i&a.FLAG_FLIP_X)!=0){j=a.TRANSFORM_FLIP_X[j&7]|(j&~7);n=-n}if((i&a.FLAG_FLIP_Y)!=0){j=a.TRANSFORM_FLIP_Y[j&7]|(j&~7);l=-l}if((i&a.FLAG_ROT_90)!=0){j=a.TRANSFORM_ROT_90[j&7]|(j&~7);m=n;n=-l;l=m}this.PaintFrame(o,f,e+n,d+l,j)};a.prototype.PaintFrame=function(h,f,e,d,j,i){if(i!=c){return this._PaintFrame_6(h,f,e,d,j,i)}else{if(j!=c){return this._PaintFrame_5(h,f,e,d,j)}}throw new Error("InvalidArguments")};a.prototype._PaintFrame_6=function(f,i,j,h,d,e){if(GLLibConfig.sprite_usePrecomputedFrameRect){if(((this._bs_flags&a.BS_FM_OFF_SHORT)==0)&&((this._flags&a.FLAG_FORCE_SHORT_FRAME_RC)==0)){a.s_rc[0]=this._frames_rc[(i<<2)];a.s_rc[1]=this._frames_rc[(i<<2)+1];a.s_rc[2]=(this._frames_rc[(i<<2)+2]&255)+a.s_rc[0];a.s_rc[3]=(this._frames_rc[(i<<2)+3]&255)+a.s_rc[1]}else{a.s_rc[0]=this._frames_rc_short[(i<<2)];a.s_rc[1]=this._frames_rc_short[(i<<2)+1];a.s_rc[2]=(this._frames_rc_short[(i<<2)+2]&65535)+a.s_rc[0];a.s_rc[3]=(this._frames_rc_short[(i<<2)+3]&65535)+a.s_rc[1]}}else{if(GLLibConfig.sprite_useFrameCollRC){if((this._bs_flags&a.BS_FM_OFF_SHORT)==0){a.s_rc[0]=this._frames_col[(i<<2)];a.s_rc[1]=this._frames_col[(i<<2)+1];a.s_rc[2]=(this._frames_col[(i<<2)+2]&255)+a.s_rc[0];a.s_rc[3]=(this._frames_col[(i<<2)+3]&255)+a.s_rc[1]}else{a.s_rc[0]=this._frames_col_short[(i<<2)];a.s_rc[1]=this._frames_col_short[(i<<2)+1];a.s_rc[2]=(this._frames_col_short[(i<<2)+2]&65535)+a.s_rc[0];a.s_rc[3]=(this._frames_col_short[(i<<2)+3]&65535)+a.s_rc[1]}}else{if(GLLibConfig.sprite_useOperationRect){this.GetFrameRect(a.s_rc,i,0,0,0)}else{this.PaintFrame(f,i,j,h,d);return}}}if((e&GRPH.LEFT)!=0){j-=a.s_rc[0]}else{if((e&GRPH.HCENTER)!=0){j-=a.s_rc[0]+((a.s_rc[2]-a.s_rc[0])>>1)}else{if((e&GRPH.RIGHT)!=0){j-=a.s_rc[2]}}}if((e&GRPH.TOP)!=0){h-=a.s_rc[1]}else{if((e&GRPH.VCENTER)!=0){h-=a.s_rc[1]+((a.s_rc[3]-a.s_rc[1])>>1)}else{if((e&GRPH.BOTTOM)!=0){h-=a.s_rc[3]}}}this.PaintFrame(f,i,j,h,d)};a.prototype._PaintFrame_5=function(i,f,e,d,h){if(GLLibConfig.sprite_useFrameMapping&&IsFrameMappingEnabled(f)){var m=GetFrameMappingConfigId(f);if(IsFrameMappingVisible(m)){var k=GetFrameMappingConfigSprite(m);var j=GetFrameMappingConfigPaletteId(m);var l=GetFrameMappingConfigFrameOff(m);k.SetCurrentPalette(j);k.PaintFrame(i,f+l,e,d,h)}}else{if(GLLibConfig.tileset_useRenderRedirectToBuffer&&(a._renderToTilesetBackBufferEnabled!=0)&&(a._operation==a.OPERATION_DRAW)){GLLibPlayer.Tileset_PaintSpriteFrame((a._renderToTilesetBackBufferEnabled&a.RENDER_TO_TILESET_BACKBUFFER_LAYER_MASK),this,f,e.castToInt(),d.castToInt(),h,0,0,(a._renderToTilesetBackBufferEnabled&a.RENDER_TO_TILESET_BACKBUFFER_FORCE_MASK)!=0)}else{this.PaintFrameExec(i,f,e,d,h)}}};a.prototype.PaintFrameExec=function(k,f,e,d,h){var n=-1;if(GLLibConfig.sprite_useCachedFrames&&(a._operation==a.OPERATION_DRAW)&&this.IsFrameCached(f,this._crt_pal)){if(GLLibConfig.sprite_allowModuleMarkerMasking&&((this._flags&a.FLAG_USE_MODULE_MASK)!=0)){Dbg("this.PaintFrame: Frame is cached but because module masking is enabled it is not being used!");n=this.GetFModules(f)}else{if(!this.PaintCachedFrame(k,f,e,d,h)){n=this.GetFModules(f)}}}else{n=this.GetFModules(f)}if(n>0){if(GLLibConfig.sprite_allowModuleMarkerMasking&&((this._flags&a.FLAG_USE_MODULE_MASK)!=0)){var m=0;for(var i=0;i<n;i++){var j=this.GetFrameModule(f,i);var l=this.GetModuleType(j);if(l==a.MD_MARKER&&(j<32)){m=(1<<j);continue}else{if((m&a.s_moduleMask)!=0){this.PaintFModule(k,f,i,e,d,h)}}}}else{for(var i=0;i<n;i++){this.PaintFModule(k,f,i,e,d,h)}}}};a.prototype.PaintFModule=function(q,m,l,j,i,f){var v,p,h,n,u;v=this.GetFrameModuleOffset(m,l);p=this.GetFrameModuleFlags(v);h=this.GetFrameModule(v);if(GLLibConfig.sprite_useFMPalette){if(((this._bs_flags&a.BS_FM_PALETTE)!=0)&&((this._flags&a.FLAG_FORCE_CURRENT_PAL)==0)){this._crt_pal=this._fmodules_pal[v]&255}}var o=0;if(GLLibConfig.sprite_useBSpriteExtraFlags&&GLLibConfig.sprite_useFMBlendMode){o=EnableFMBlendMode(v)}n=h;var t=0;var s=0;var k=0;var r=0;if(GLLibConfig.sprite_useModuleMapping){if((!GLLibConfig.sprite_useHyperFM)||((p&a.FLAG_HYPER_FM)==0)){if(this._cur_map>=0){if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET)!=0){if((this._bs_extraFlags0&a.BS_EX0_MM_OFFSET_SHORT)!=0){t=this._map_offset_short[this._cur_map][h<<1];s=this._map_offset_short[this._cur_map][(h<<1)+1]}else{t=this._map_offset_byte[this._cur_map][h<<1];s=this._map_offset_byte[this._cur_map][(h<<1)+1]}}h=this._map[this._cur_map][h]}}}if((!GLLibConfig.sprite_useHyperFM)||((p&a.FLAG_HYPER_FM)==0)){k=this.GetModuleWidth(h);r=this.GetModuleHeight(h)}var e=k;var d=r;if(GLLibConfig.sprite_useSingleArrayForFMAF){t+=this._fmodules[v+1];s+=this._fmodules[v+2]}else{t+=this.GetFModuleOX(v);s+=this.GetFModuleOY(v)}if((p&a.FLAG_ROT_90)!=0){u=k;k=r;r=u}if((f&a.FLAG_FLIP_X)!=0){p=a.TRANSFORM_FLIP_X[p&7]|(p&~7);t=-t-k}if((f&a.FLAG_FLIP_Y)!=0){p=a.TRANSFORM_FLIP_Y[p&7]|(p&~7);s=-s-r}if((f&a.FLAG_ROT_90)!=0){p=a.TRANSFORM_ROT_90[p&7]|(p&~7);u=t;t=-s-r;s=u}j+=t;i+=s;if((GLLibConfig.sprite_useHyperFM)&&((p&a.FLAG_HYPER_FM)!=0)){this.PaintFrame(q,h,j,i,(p&15))}else{this.PaintModule(q,n,j,i,(p&15),e,d)}if(GLLibConfig.sprite_useBSpriteExtraFlags&&GLLibConfig.sprite_useFMBlendMode){DisableFMBlendMode(o)}};a.prototype.PaintFrameScaled=function(h,f,e,d,k,j,i){if(i!=c){return this._PaintFrameScaled_GraphicsIIIIII(h,f,e,d,k,j,i)}else{if(j!=c){return this._PaintFrameScaled_GraphicsIIIII(h,f,e,d,k,j)}}throw new Error("InvalidArguments")};a.prototype._PaintFrameScaled_GraphicsIIIII=function(e,i,j,h,d,f){this.PaintFrameScaled(e,i,j,h,d,f,f)};a.prototype._PaintFrameScaled_GraphicsIIIIII=function(o,i,f,e,j,s,r){var p=LowAPI.Float2Int(f*s/100);var k=LowAPI.Float2Int(e*r/100);var m=o.getClipX();var l=o.getClipY();var n=o.getClipWidth();var h=o.getClipHeight();var d=o._getWidth();var q=o._getHeight();o.setClip(-d,-q,d*10,q*10);o._save();o.translate(f,e);o._scale(s/100,r/100);o.translate(-p,-k);this.PaintFrame(o,i,p,k,j);o.setClip(m,l,n,h);o._restore()};a.prototype.PaintCachedFrame=function(r,j,f,e,l){var n=false;var k=this.GetFrameWidth(j);var h=this.GetFrameHeight(j);var q=this.GetFrameMinX(j);var p=this.GetFrameMinY(j);if((l&a.FLAG_ROT_90)!=0){var o;(o)=(q);(q)=(p);(p)=(o)}if((l&a.FLAG_FLIP_X)!=0){q=-q-k}if((l&a.FLAG_FLIP_Y)!=0){p=-p-h}if((l&a.FLAG_ROT_90)!=0){var o=q;q=-p-h;p=o}f+=q;e+=p;var o;if(GLLibConfig.sprite_usePaletteIndexCache&&((this._flags&a.FLAG_USE_PAL_INDEX_CACHE)!=0)&&((this._frame_image_byteAA!=null)&&(this._frame_image_byteAA[j]!=null))){if(!PaintPaletteIndexCachedFramePFX(r,j,f,e,k,h,l)){var d=GetPalIndexCachedFrameRGB(j,this._crt_pal);DrawRGB(r,d,0,k,f,e,k,h,this._alpha,this._multiAlpha,l,this._palTransparencyIndex,false)}n=true}else{if(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0)){var d=this.GetFrameRGB(j,this._crt_pal);if(d!=null){if(!PaintCachedFramePFX(r,j,d,null,f,e,k,h,l)){DrawRGB(r,d,0,k,f,e,k,h,!this._cachedFrameIsOpaque,true,l,this._palTransparencyIndex,false)}n=true}else{var i=this.GetFrameImage(j,this._crt_pal);if(i!=null){if(l==0){DrawImage(r,i,f,e,LEFT|TOP,false);n=true}else{if(GLLibConfig.sprite_drawRegionFlippedBug){var m=Image.createImage(i,0,0,k,h,a.midp2_flags[l&7]);DrawImage(r,m,f,e,LEFT|TOP,false);n=true}else{DrawRegion(r,i,0,0,k,h,a.midp2_flags[l&7],f,e,LEFT|TOP,false);n=true}}}}}else{var i=this.GetFrameImage(j,this._crt_pal);if(i!=null){if(l==0){DrawImage(r,i,f,e,LEFT|TOP,false);n=true}else{if(GLLibConfig.sprite_drawRegionFlippedBug){var m=Image.createImage(i,0,0,k,h,a.midp2_flags[l&7]);DrawImage(r,m,f,e,LEFT|TOP,false);n=true}else{DrawRegion(r,i,0,0,k,h,a.midp2_flags[l&7],f,e,LEFT|TOP,false);n=true}}}else{var d=this.GetFrameRGB(j,this._crt_pal);if(d!=null){if(!PaintCachedFramePFX(r,j,d,null,f,e,k,h,l)){DrawRGB(r,d,0,k,f,e,k,h,!this._cachedFrameIsOpaque,true,l)}n=true}}}}return n};a.prototype.GetModuleExtraInfoOffset=function(e){if(this._modules_extra_pointer!=null){for(var d=0;d<this._modules_extra_pointer.length;d+=2){if(this._modules_extra_pointer[d]==e){return this._modules_extra_pointer[d+1]}}}return -1};a.prototype.PaintPrimitiveModule=function(J,e,z,v,n,m,l){var D=0;if(GLLibConfig.sprite_useModuleColorAsByte){D=this._module_colors_byte[e]}else{D=this._module_colors_int[e]}SetColor(J,D);switch(this._module_types[e]){case a.MD_FILL_RECT:if(!GLLibConfig.sprite_disableModuleType_FillRect){if(GLLibConfig.sprite_useModuleColorAsByte){FillRect(J,n,m,z,v)}else{if(((this._module_colors_int[e]&4278190080)==(4278190080).castToInt())||((this._module_colors_int[e]&4278190080)==0)){FillRect(J,n,m,z,v)}else{if(!GLLibConfig.sprite_disableModuleType_AlphaFillRect){AlphaRect_SetColor(this._module_colors_int[e]);AlphaRect_Draw(J,n,m,z,v)}}}}break;case a.MD_RECT:if(!GLLibConfig.sprite_disableModuleType_Rect){z--;v--;DrawRect(J,n,m,z,v)}break;case a.MD_ARC:case a.MD_FILL_ARC:if(!GLLibConfig.sprite_disableModuleType_Arc||!GLLibConfig.sprite_disableModuleType_FillArc){var A=this.GetModuleExtraInfoOffset(e);if(A!=-1){var d=this._modules_extra_info[A+0];var M=this._modules_extra_info[A+1];if((l&a.FLAG_FLIP_X)!=0){d=90-d}if((l&a.FLAG_FLIP_Y)!=0){d=-d;M=-M}if((l&a.FLAG_ROT_90)!=0){d=d-90}if(!GLLibConfig.sprite_disableModuleType_Arc&&(this._module_types[e]==a.MD_ARC)){DrawArc(J,n,m,z,v,d,M)}else{if(!GLLibConfig.sprite_disableModuleType_FillArc){FillArc(J,n,m,z,v,d,M)}}}}break;case a.MD_TRIANGLE:case a.MD_FILL_TRIANGLE:if(!GLLibConfig.sprite_disableModuleType_Triangle||!GLLibConfig.sprite_disableModuleType_FillTriangle){var A=this.GetModuleExtraInfoOffset(e);if(A!=-1){var q=this._modules_extra_info[A+0];var o=this._modules_extra_info[A+1];var F=this._modules_extra_info[A+2];var E=this._modules_extra_info[A+3];var j=n;var u=m;if((l&a.FLAG_FLIP_X)!=0){q=-q;F=-F;n+=(Math_Abs(q)>Math_Abs(F)?Math_Abs(q):Math_Abs(F))}if((l&a.FLAG_FLIP_Y)!=0){o=-o;E=-E;m+=(Math_Abs(o)>Math_Abs(E)?Math_Abs(o):Math_Abs(E))}if((l&a.FLAG_ROT_90)!=0){var t=(Math_Abs(o)>Math_Abs(E)?Math_Abs(o):Math_Abs(E));var k=m-u;m=u+(n-j);n=j-k+t;var N=q;q=-o;o=N;N=F;F=-E;E=N}if(!GLLibConfig.sprite_disableModuleType_Triangle&&(this._module_types[e]==a.MD_TRIANGLE)){DrawLine(J,n,m,n+q,m+o);DrawLine(J,n+q,m+o,n+F,m+E);DrawLine(J,n,m,n+F,m+E)}else{if(!GLLibConfig.sprite_disableModuleType_FillTriangle){FillTriangle(J,n,m,n+q,m+o,n+F,m+E)}}}}break;case a.MD_LINE:if(!GLLibConfig.sprite_disableModuleType_Line){var I=n;var H=n+z;var i=m;var f=m+v;var K;if((l&a.FLAG_FLIP_X)!=0){(K)=(I);(I)=(H);(H)=(K)}if((l&a.FLAG_FLIP_Y)!=0){(K)=(i);(i)=(f);(f)=(K)}if((l&a.FLAG_ROT_90)!=0){(K)=(I);(I)=(H);(H)=(K)}DrawLine(J,I,i,H,f)}break;case a.MD_FILL_RECT_GRAD:if(!GLLibConfig.sprite_disableModuleType_FillRectGradient){var A=this.GetModuleExtraInfoOffset(e);if(A!=-1){var C=this._module_colors_int[e];var B=this._modules_extra_info[A+0]&65535;B|=((this._modules_extra_info[A+1]<<16)&(4294901760).castToInt());var L=this._modules_extra_info[A+2];var r=0;var p=0;var s=z;var G=v;var K;if((l&a.FLAG_FLIP_X)!=0){if(L<2){(K)=(C);(C)=(B);(B)=(K)}}if((l&a.FLAG_FLIP_Y)!=0){if(L>1){(K)=(C);(C)=(B);(B)=(K)}}if(L==0){L=LEFT}else{if(L==1){L=RIGHT}else{if(L==2){L=TOP}else{L=BOTTOM}}}if((l&a.FLAG_ROT_90)!=0){if(L==LEFT){L=TOP}else{if(L==RIGHT){L=BOTTOM}else{if(L==TOP){L=RIGHT}else{if(L==BOTTOM){L=LEFT}}}}}DrawGradientRect(J,n+r,m+p,s,G,C,B,L)}}break;case a.MD_MARKER:break}};a.prototype.PaintModule=function(h,f,e,d,k,j,i){if(i!=c){return this._PaintModule_7(h,f,e,d,k,j,i)}else{if(j!=c){return this._PaintModule_6(h,f,e,d,k,j)}else{if(k!=c){return this._PaintModule_5(h,f,e,d,k)}}}throw new Error("InvalidArguments")};a.prototype._PaintModule_5=function(h,f,k,i,e){var d=this.GetModuleWidth(f);var j=this.GetModuleHeight(f);a.s_rc[0]=d;a.s_rc[1]=j;this.PaintModule(h,f,k,i,e,a.s_rc)};a.prototype._PaintModule_7=function(i,h,k,j,d,f,e){a.s_rc[0]=f;a.s_rc[1]=e;this.PaintModule(i,h,k,j,d,a.s_rc)};a.prototype._PaintModule_6=function(Z,h,T,S,y,w){var R=T;var P=S;var Y=y;if(GLLibConfig.sprite_useModuleMapping){if(this._cur_map>=0){h=this._map[this._cur_map][h]}}var q=w[0];var o=w[1];var O=q;var M=o;var e=O;var d=M;if((y&a.FLAG_ROT_90)!=0){var V=O;O=M;M=V}if(GLLibConfig.sprite_useMultipleModuleTypes){if((this.GetModuleType(h)!=a.MD_IMAGE)&&(Z!=null)){this.PaintPrimitiveModule(Z,h,O,M,R,P,Y);return}}if(GLLibConfig.sprite_useOperationRect){if(a._operation==a.OPERATION_COMPUTERECT){if(GLLibConfig.sprite_useMultipleModuleTypes){if(!GLLibConfig.sprite_disableModuleType_Marker&&this.GetModuleType(h)==a.MD_MARKER){T-=(O>>1);S-=(M>>1)}}if(T<a._rectX1){a._rectX1=T}if(S<a._rectY1){a._rectY1=S}if(T+O>a._rectX2){a._rectX2=T+O}if(S+M>a._rectY2){a._rectY2=S+M}return}}else{if(a._operation==a.OPERATION_COMPUTERECT){Assert(false,"Error: Trying to use COMPUTE RECT OPERATION but sprite_useOperationRect is FALSE!!!")}}if((O<=0)||(M<=0)){return}var G=null;var Q=null;var t=null;if(GLLibConfig.sprite_useSingleImageForAllModules){if(((this._bs_flags&a.BS_SINGLE_IMAGE)!=0)){if((y&a.FLAG_ROT_90)!=0){var V=O;O=M;M=V}if((this._bs_flags&a.BS_SINGLE_IMAGE)!=0){if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))){if(this._module_image_intAAA==null||this._module_image_intAAA[this._crt_pal]==null){this.BuildCacheImages(this._crt_pal,0,0,0)}if((y&15)!=0){Dbg("WARNING_PaintModule : Transformations requested : "+y+"   for module : "+h+" at ["+T+"x"+S+"]   src\\ASprite\\PM_SingleImage.jpp   "+14)}if(this.CheckOperation(this._module_image_intAAA[this._crt_pal][0],T,S,O,M,0,0,0)){DrawRGB(Z,this._module_image_intAAA[this._crt_pal][0],0,O,T,S,O,M,this._alpha,this._multiAlpha,0)}}else{if((this._module_image_imageAA==null)||(this._module_image_imageAA[this._crt_pal]==null)){this.BuildCacheImages(this._crt_pal,0,0,0)}var W=0;var U=0;if(GLLibConfig.sprite_useModuleXYShort&&((this._bs_flags&a.BS_MODULES_XY_SHORT)!=0)){W=this._modules_x_short[h];U=this._modules_y_short[h]}else{if(GLLibConfig.sprite_useModuleXY&&((this._bs_flags&a.BS_MODULES_XY)!=0)){W=(this._modules_x_byte[h]&255);U=(this._modules_y_byte[h]&255)}}if(GLLibConfig.sprite_useCacheFlipXY){var I=a.midp2_flags[y&7];if(I>2){I=0}Q=this._module_image_imageAA[this._crt_pal][I];if(a.midp2_flags[y&7]==2){W=Q.getWidth()-(W+O)}else{if(a.midp2_flags[y&7]==1){U=Q.getHeight()-(U+M)}}}else{var L=this.GetModuleImageIndex(h);var l=this.GetCurrentPalette(L);Q=this._module_image_imageAA[l][L]}if(GLLibConfig.sprite_useDrawRegionClipping){var C=Z.getClipX();var B=Z.getClipY();var E=Z.getClipWidth();var K=Z.getClipHeight();var A=T;var z=S;var F=T+O;var D=S+M;if(T<C){A=C}if(S<B){z=B}if(F>C+E){F=C+E}if(D>B+K){D=B+K}Z.setClip(A,z,F-A,D-z);if((y&15)!=0){Dbg("WARNING_PaintModule : Transformations requested : "+y+"   for module : "+h+" at ["+T+"x"+S+"]   src\\ASprite\\PM_SingleImage.jpp   "+170)}if(this.CheckOperation(Q,T,S,O,M,0,W,U)){DrawImage(Z,Q,T-W,S-U,LEFT|TOP,false)}Z.setClip(C,B,E,K)}else{if(this.CheckOperation(Q,T,S,O,M,a.midp2_flags[y&7],W,U)){if(GLLibConfig.sprite_drawRegionFlippedBug){var k=Image.createImage(Q,W,U,O,M,a.midp2_flags[y&7]);DrawImage(Z,k,T,S,LEFT|TOP,false)}else{if(GLLibConfig.sprite_removeOnePixelModule&&(O==1)&&(M==1)){return}DrawRegion(Z,Q,W,U,O,M,a.midp2_flags[y&7],T,S,LEFT|TOP,false)}}}}}}}if(GLLibConfig.sprite_ModuleMapping_useModuleImages){if((this._bs_flags&(a.BS_MODULE_IMAGES|a.BS_MODULE_IMAGES_TC_BMP))!=0){if((this._module_image_imageAA!=null)&&(this._module_image_imageAA[this._crt_pal]!=null)){Q=this._module_image_imageAA[this._crt_pal][h]}if((this._module_image_intAAA!=null)&&(this._module_image_intAAA[this._crt_pal]!=null)){G=this._module_image_intAAA[this._crt_pal][h]}if(GLLibConfig.sprite_usePaletteIndexCache){if((Q==null)&&(this._flags&a.FLAG_USE_PAL_INDEX_CACHE)!=0){if((this._module_image_byteAA==null)||(this._module_image_byteAA[h]==null)){BuildPaletteIndexCacheImages(h,h)}}}else{if(!((this._flags&a.FLAG_USE_PAL_INDEX_CACHE)==0)){Assert(false,"PaintModule: Using ASprite.FLAG_USE_PAL_INDEX_CACHE but sprite_usePaletteIndexCache is FALSE!")}}var x=this._alpha;if((GLLibConfig.sprite_useCacheRGBArrays)||(GLLibConfig.sprite_useManualCacheRGBArrays&&((this._flags&a.FLAG_USE_CACHE_RGB)!=0))||(GLLibConfig.sprite_usePaletteIndexCache&&(Q==null)&&((this._flags&a.FLAG_USE_PAL_INDEX_CACHE)!=0))){var r=true;if((G==null)&&((!GLLibConfig.sprite_usePaletteIndexCache)||((this._flags&a.FLAG_USE_PAL_INDEX_CACHE)==0))){G=this.DecodeImage_int(h);if(GLLibConfig.sprite_useARGBCachePool&&this._cur_pool>=0){this.UpdatePoolCache(h,O*M,G)}}if(pfx_useSpriteEffects&&(PFX_GetEnabledSpriteEffectsMask()!=0)){if(this.PFXCache_TryPaintModule(Z,h,T,S,y)){return}var u=GLLibConfig.pfx_enableModuleCaching&&PFXCache_IsInited();if(GLLibConfig.sprite_usePaletteIndexCache&&((this._flags&a.FLAG_USE_PAL_INDEX_CACHE)!=0)){var L=this.GetModuleImageIndex(h);var H=this.GetPalette(L,this.GetCurrentPalette(L));G=PFX_ProcessSpriteEffects(Z,this._module_image_byteAA[h],H,T,S,e,d,y,this._alpha,this._multiAlpha,!u&&!GLLibConfig.sprite_useCreateImageOnDrawPFX)}else{G=PFX_ProcessSpriteEffects(Z,G,T,S,e,d,u?0:y,x,this._multiAlpha,!u&&!GLLibConfig.sprite_useCreateImageOnDrawPFX)}if(this.PFXCache_TryCacheAndPaintModule(Z,h,T,S,G,y)){return}if(G==null){return}else{x=s_PFX_hasAlpha;y=0;T=s_PFX_newPosX;S=s_PFX_newPosY;O=s_PFX_newSizeX;M=s_PFX_newSizeY;e=O;d=M}if(GLLibConfig.sprite_useCreateImageOnDrawPFX){var j=CreateRGBImage(G,O,M,x);DrawImage(Z,j,T,S,LEFT|TOP,false);return}}else{if(GLLibConfig.sprite_usePaletteIndexCache&&((this._flags&a.FLAG_USE_PAL_INDEX_CACHE)!=0)){G=a.GetPixelBuffer_int(null);var L=this.GetModuleImageIndex(h);var J=this.GetPalette(L,this.GetCurrentPalette(L));var aa=this._module_image_byteAA[h];var n=aa.length;for(var X=n;--X>=0;){G[X]=J[aa[X]&255]}}}if(this.CheckOperation(G,T,S,O,M,y,0,0)){var p=true;DrawRGB(Z,G,0,e,T,S,e,d,x,x,y,this._palTransparencyIndex,p)}}else{if(true&&Q==null){if(this.IsModuleDataValid(h)){if((y&a.FLAG_ROT_90)!=0){var s=O;O=M;M=s}if(true){if(a._temp_image==c){a._temp_image=CreateImage(O,M)}else{a._temp_image.m_image.getHTMLCanvasElement().width=O;a._temp_image.m_image.getHTMLCanvasElement().height=M}Q=a._temp_image}else{Q=CreateImage(O,M)}var v=Q.m_image.getHTMLCanvasElement();var N=this.DecodeImage_JSCanvas(v,this.GetModuleImageIndex(h),this.GetModuleData(h),this.GetStartModuleData(h,0),this.GetModuleWidth(h),this.GetModuleHeight(h));if(!N){return}}else{Err("The module invaild")}}else{if(Q==null){var m=G;var r=true;if(m==null){r=false;m=this.DecodeImage_int(h)}if(m==null){if(GLLibConfig.sprite_debugErrors){Dbg("DecodeImage() FAILED !")}return}if(GLLibConfig.sprite_RGBArraysUseDrawRGB){var f=false;if(GLLibConfig.sprite_useCachePool&&this._cur_pool>=0){if(this._module_image_imageAA==null){this._module_image_imageAA=LowAPI.Gen_Array([this._palettes],null);for(var X=0;X<this._palettes;X++){this._module_image_imageAA[X]=LowAPI.Gen_Array([this._nModules],null)}}if((y&a.FLAG_ROT_90)!=0){Q=CreateRGBImage(m,M,O,this._alpha)}else{Q=CreateRGBImage(m,O,M,this._alpha)}this.UpdatePoolCache(h,Q);if(f){return}if(this.CheckOperation(Q,T,S,O,M,a.midp2_flags[y&7],0,0)){if(a.midp2_flags[y&7]==0){DrawImage(Z,Q,T,S,LEFT|TOP,false)}else{if((y&a.FLAG_ROT_90)!=0){DrawRegion(Z,Q,0,0,M,O,a.midp2_flags[y&7],T,S,LEFT|TOP,false)}else{DrawRegion(Z,Q,0,0,O,M,a.midp2_flags[y&7],T,S,LEFT|TOP,false)}}}return}if(f){return}DrawRGB(Z,m,0,e,T,S,e,d,x,x,y);return}else{if((y&a.FLAG_ROT_90)!=0){Q=CreateRGBImage(m,M,O,this._alpha)}else{Q=CreateRGBImage(m,O,M,this._alpha)}}}}O=q;M=o;this.UpdatePoolCache(h,Q);if(this.CheckOperation(Q,T,S,O,M,a.midp2_flags[y&7],0,0)){if(a.midp2_flags[y&7]==0){DrawImage(Z,Q,T,S,LEFT|TOP,false)}else{if(GLLibConfig.sprite_drawRegionFlippedBug){var k=Image.createImage(Q,0,0,O,M,a.midp2_flags[y&7]);DrawImage(Z,k,T,S,LEFT|TOP,false)}else{DrawRegion(Z,Q,0,0,O,M,a.midp2_flags[y&7],T,S,LEFT|TOP,false)}}}}}}};a._GetPixelBuffer_int_3=function(e,d,i){var f=null;if(GLLibConfig.sprite_useDynamicTransformBuffer){f=a.GetPixelBuffer_int(null);if(f==e){f=LowAPI.Gen_Array([d*i],0)}}else{f=a.GetPixelBuffer_int(e)}return f};b.ASprite=a})(window);