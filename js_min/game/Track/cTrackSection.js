(function(a){var c=2;function b(d){this.m_iGlobalIndex=d;this.m_iTrackID=0;this.m_iEnvironment=0;this.m_iNumMissions=0;this.m_iSubtrackID=0;this.m_nbSegment=0;this.m_maxObjsPerSegment=0;this.m_maxObjSegmentsExported=0;this.m_tabAng=null;this.m_roadBreak=null;this.m_tabInc=null;this.m_tabFlags=null;this.m_roadIndex=null;this.m_roadTypeIndex=null;this.m_roadStatus=null;this.m_roadCustomParam=null;this.m_roadMainIndex;this.m_offRoadProRightCircuit=null;this.m_offRoadProLeftCircuit=null;this.m_segmentSlant=null;this.m_f3dPaletteAnim=null;this.m_offRoadZone=null;this.m_offRoadTunnel=null;this.m_offRoadItem=null;this.m_offRoadOffsetX=null;this.m_offRoadOffsetY=null;this.m_offRoadItemPalette=null;this.m_offRoadItemParticlesState=null;this.m_offRoadItemTransformIndex=0;this.m_offRoadItemTransforms=null;this.m_offRoadItemAnim=null;this.m_offRoadItemAnimTime=null;this.m_missionID=4;this.m_missionItemData=null;this.m_missionItemNum=null;this.m_missionF3dObjAddData=null;this.m_missionF3dObjAddNum=null}b.prototype.Load_TrackData=function(){var y,x,t;this.m_nbSegment=Pack_Read16();this.m_maxObjSegmentsExported=Pack_readU8();this.m_maxObjsPerSegment=Pack_readU8();this.m_maxObjSegmentsExported=this.m_maxObjsPerSegment;this.m_iTrackID=Pack_readU8();this.m_iEnvironment=Pack_readU8();this.m_iNumMissions=Pack_readU8();this.m_iSubtrackID=Pack_readU8();var n=Pack_readU8();var h,f;var v=0;var p=0;this.m_roadIndex=[];this.m_roadStatus=[];this.m_roadCustomParam=[];for(y=0;y<this.m_nbSegment;y++){this.m_roadIndex[y]=-1;this.m_roadStatus[y]=TRACKSEGMENT_STATUS.NORMAL;this.m_roadCustomParam[y]=-1}for(y=0;y<n;y++){v=Pack_readU8();h=Pack_Read16();f=Pack_Read16();p=Pack_readU8();for(x=h;x<=f;x++){this.m_roadIndex[x]=v}}this.m_tabAng=[];this.m_roadBreak=[];this.m_tabInc=[];this.m_tabFlags=[];for(y=0;y<this.m_nbSegment;y++){var A=Pack_readS8();this.m_tabAng[y]=Math_DegreeToFixedPointAngle(A);x=Pack_Read16();t=(x>>7)&31;if(t>15){t-=32}this.m_tabInc[y]=Math_DegreeToFixedPointAngle(t);t=x&127;this.m_tabFlags[y]=t.castToByte()}Pack_Skip(10);for(y=0;y<this.m_nbSegment;y++){this.m_roadBreak[y]=Pack_readS8()==1}Pack_Skip(1);var e=Pack_readS16();if(e>0){for(y=0;y<e;){Pack_Skip(10);y+=5}}var w=Pack_Read16();if(w>0){Pack_Skip(w*4)}var s=Pack_Read16();if(s>0){for(y=0;y<(s*c);y+=c){Pack_Skip(8)}}this.m_offRoadProRightCircuit=[];this.m_offRoadProLeftCircuit=[];for(y=0;y<this.m_nbSegment;y++){this.m_offRoadProRightCircuit[y]=Pack_readU8();this.m_offRoadProLeftCircuit[y]=Pack_readU8()}var d=Pack_Read16();if(d==this.m_nbSegment){if(this.m_segmentSlant==null||this.m_segmentSlant.length!=this.m_nbSegment){this.m_segmentSlant=null;this.m_segmentSlant=LowAPI.Gen_Array([this.m_nbSegment],0)}for(y=0;y<this.m_nbSegment;y++){this.m_segmentSlant[y]=Pack_readS8()}}Pack_Skip(2*this.m_nbSegment);var r=this.m_nbSegment*(this.m_maxObjsPerSegment+MAX_MISSION_OBJS_PER_SEGMENT);this.m_offRoadItem=LowAPI.Gen_Array([r],0);this.m_offRoadItemParticlesState=LowAPI.Gen_Array([r],0);this.m_offRoadItemTransformIndex=0;this.m_offRoadItemTransforms=LowAPI.Gen_Array([this.m_nbSegment*2*2],0);this.m_offRoadOffsetX=LowAPI.Gen_Array([r],0);this.m_offRoadOffsetY=LowAPI.Gen_Array([r],0);if(BuildConf.k_use_f3d_palettes){this.m_offRoadItemPalette=LowAPI.Gen_Array([r],0)}if(BuildConf.k_use_palettes_anim){this.m_f3dPaletteAnim=LowAPI.Gen_Array([this.m_nbSegment],null)}var u;for(y=0;y<this.m_nbSegment*this.m_maxObjSegmentsExported;y++){u=Pack_Read32();var z=LowAPI.Float2Int(y/this.m_maxObjSegmentsExported);if(u!=0&&GetOffroadObjectType(u)!=(Game.k_area_type)){if(GetOffroadObjectType(u)==Game.k_item_type){Pack_Skip(5);continue}for(var q=0;q<this.m_maxObjsPerSegment;q++){var g=z*this.m_maxObjsPerSegment+q;if(this.m_offRoadItem[g]==0){this.m_offRoadItem[g]=u;var o=GetOffroadObjectIndex(u);s_f3dUsed[o]=true;this.m_offRoadOffsetX[g]=Pack_readS16();this.m_offRoadOffsetY[g]=Pack_readS16();if(BuildConf.k_use_f3d_palettes){this.m_offRoadItemPalette[g]=Pack_readU8()}else{Pack_Skip(1)}break}if(q==this.m_maxObjsPerSegment-1){Pack_Skip(5)}}}}this.m_offRoadZone=[];for(y=0;y<this.m_nbSegment;y++){this.m_offRoadZone[y]=Pack_readS8()}this.m_offRoadTunnel=[];for(y=0;y<this.m_nbSegment;y++){this.m_offRoadTunnel[y]=Pack_readS8()}var l=Pack_readU8();if(l>0){for(y=0;y<l;y++){var B=Pack_readU8()*4;Pack_Skip(B*2)}}x=Pack_Read16();if(x>0){Pack_Skip(x*4)}};b.prototype.InitMissionData=function(e){this.m_missionItemData=[];this.m_missionItemNum=[];this.m_missionF3dObjAddData=[];this.m_missionF3dObjAddNum=[];for(var d=0;d<e;d++){this.m_missionItemData[d]=null;this.m_missionItemNum[d]=0;this.m_missionF3dObjAddData=null;this.m_missionF3dObjAddNum[d]=0}};b.prototype.AddMissionItem=function(f,j){if(this.m_missionItemData[f]==null){this.m_missionItemData[f]=LowAPI.Gen_Array([MAX_MISSION_OBJS_PER_TRACKSECTION*k_item_data_length],0)}var k=this.m_missionItemNum[f]*k_item_data_length;for(var g=0;g<j.length;g++){this.m_missionItemData[f][k]=j[g];k++}this.m_missionItemNum[f]++;var h=j[k_item_f3d_index];s_f3dUsed[h]=true;if(h==DATA.OBJECTS_WALL_AVATAR){var d=j[k_item_seg_index];this.m_roadStatus[d]=TRACKSEGMENT_STATUS.FRIEND_WALL;for(var e=(d-1);e>(d-(1+FRIENDWALL_BULLETTIME_DURATION_SEGMENTS));e--){if(e<0){break}this.m_roadStatus[e]=TRACKSEGMENT_STATUS.SLOWDOWN_TIME}}};b.prototype.AppendToTrack=function(s){var n,h;var f=s.s_iNextMainTrackAppendSegment;var p;var v;var q=Math_Rand(0,this.m_iNumMissions);for(n=0;n<this.m_nbSegment;n++){s.s_roadIndex[f]=this.m_roadIndex[n];s.s_roadStatus[f]=this.m_roadStatus[n];s.s_roadCustomParam[f]=this.m_roadCustomParam[n];s.s_trackTabAng[f]=this.m_tabAng[n];s.s_trackTabInc[f]=this.m_tabInc[n];s.s_trackTabFlags[f]=this.m_tabFlags[n];s.s_trackRoadBreak[f]=this.m_roadBreak[n];s.s_trackSegEnvironment[f]=this.m_iEnvironment;s.s_offRoadProRightCircuit[f]=this.m_offRoadProRightCircuit[n];s.s_offRoadProLeftCircuit[f]=this.m_offRoadProLeftCircuit[n];s.s_f3dPaletteAnim[f]=this.m_f3dPaletteAnim[n];if(this.m_segmentSlant!=null){s.s_segmentSlant[f]=this.m_segmentSlant[n]}p=f*s_trackMaxObjSegmentsIngame;v=n*this.m_maxObjsPerSegment;for(h=0;h<this.m_maxObjsPerSegment;h++){s.s_offRoadItem[p]=this.m_offRoadItem[v];s.s_offRoadOffsetX[p]=this.m_offRoadOffsetX[v];s.s_offRoadOffsetY[p]=this.m_offRoadOffsetY[v];if(BuildConf.k_use_f3d_palettes){s.s_offRoadItemPalette[p]=this.m_offRoadItemPalette[v]}p++;v++}for(;h<s_trackMaxObjSegmentsIngame;h++){s.s_offRoadItem[p]=0;s.s_offRoadOffsetX[p]=0;s.s_offRoadOffsetY[p]=0;if(BuildConf.k_use_f3d_palettes){s.s_offRoadItemPalette[p]=0}p++}s.s_offRoadZone[f]=this.m_offRoadZone[n];if(BuildConf.k_use_texture_anim){var u=f*s_trackMaxObjSegmentsIngame;for(var d=0;d<s_trackMaxObjSegmentsIngame;d++){s.s_f3dTextureAnimData[u][cTrack.k_f3dTextureAnimKey]=-1;u++}}f++;if(f>=MAINTRACK_NUM_SEGMENTS){f=0}}var o=s.s_iNextMissionObjectID;if(this.m_missionItemNum.length>0){for(var m=0;m<this.m_missionItemNum[q];m++){var g=s.s_iNextMainTrackAppendSegment+this.m_missionItemData[q][(m*k_item_data_length)+k_item_seg_index];if(g>=MAINTRACK_NUM_SEGMENTS){g%=MAINTRACK_NUM_SEGMENTS}var l=this.m_missionItemData[q][(m*k_item_data_length)+k_item_f3d_index];if(l==-1){continue}var t;var r;var k;for(var e=s_trackMaxObjSegmentsIngame-1;e>=0;e--){t=g*s_trackMaxObjSegmentsIngame+e;if(s.s_offRoadItem[t]==0){r=s.AddMissionObjectToList(this.m_missionItemData[q],m);k=(Game.k_item_type<<28)|(q<<24)+r;s.s_offRoadItem[t]=k;break}}}s.track_preprocessMissionItems(o,this.m_missionItemNum[q])}s.s_iNextMainTrackAppendSegment+=this.m_nbSegment;if(s.s_iNextMainTrackAppendSegment>=MAINTRACK_NUM_SEGMENTS){s.s_iNextMainTrackAppendSegment%=MAINTRACK_NUM_SEGMENTS}s_iLastAggregatedTrackSection=this.m_iGlobalIndex};b.prototype.GetSegmentWithStatus=function(f){var d=-1;for(var e=0;e<this.m_nbSegment;e++){if(this.m_roadStatus[e]==f){d=e;break}}return d};b.prototype.Unload=function(){this.m_tabAng=null;this.m_roadBreak=null;this.m_tabInc=null;this.m_tabFlags=null;this.m_roadIndex=null;this.m_roadTypeIndex=null;this.m_roadStatus=null;this.m_offRoadProRightCircuit=null;this.m_offRoadProLeftCircuit=null;this.m_segmentSlant=null;this.m_offRoadZone=null;this.m_offRoadTunnel=null;this.m_offRoadItem=null;this.m_offRoadOffsetX=null;this.m_offRoadOffsetY=null;this.m_offRoadItemPalette=null;this.m_offRoadItemParticlesState=null;this.m_offRoadItemTransforms=null;if(this.m_offRoadItemAnim!=null){for(var e=0;e<this.m_offRoadItemAnim.length;e++){this.m_offRoadItemAnim[e]=null}}this.m_offRoadItemAnim=null;if(this.m_offRoadItemAnimTime!=null){for(var e=0;e<this.m_offRoadItemAnimTime.length;e++){this.m_offRoadItemAnimTime[e]=null}}this.m_offRoadItemAnimTime=null;this.m_missionItemNum=null;this.m_missionF3dObjAddNum=null;for(var d=0;d<this.m_missionItemData.length;d++){this.m_missionItemData[d]=null}for(var d=0;d<this.m_missionF3dObjAddData.length;d++){this.m_missionF3dObjAddData[d]=null}this.m_missionItemData=null;this.m_missionF3dObjAddData=null;this.m_missionItemNum=null;this.m_missionF3dObjAddNum=null};LowAPI.extendObject(a,{cTrackSection:b,},true)})(window);