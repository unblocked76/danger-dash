(function(ab,B){var o=0;var ag=1;var T=2;var aE=3;var s=26;var am=3;var D=0;var l=1;var n=2;var v=3;var ar=5;var V=[[[DATA.SPRITE_DATA_002_SKY,0,-90,90],[DATA.SPRITE_DATA_001_BG_SEA,0,0,140],[DATA.SPRITE_DATA_TREES_BG,0,0,210],],[[-1,0,0,90],],[[DATA.SPRITE_DATA_SKYNIGHT,0,-30,30],[DATA.SPRITE_DATA_BG_ALEXANDRIA,0,0,140],[DATA.SPRITE_DATA_TREES_BG,0,0,210],],];var j={SPRITE:0,FRAME:1,OFFSET_Y:2,SPEED_FACTOR:3};var af=[false,true,false];var N=0;var a=0;var z=0;var w=0;var I=0;var G=0;var aK=null;var q=null;var aM=0;function aU(){return(4278190080|((Pack_readU8())<<16)|((Pack_readU8()&255)<<8)|(Pack_readU8()&255))}function O(bg){var bf,bd,ba;Pack_Open(DATA.PACK_TRACKS);Pack_PositionAtData(bg);s_skyLayerColor=aU();s_skyLayerColor_01=aU();s_trackColorGround=aU();s_trackColorFogGround=aU();Pack_Skip(3);s_trackColorFog=aU();s_trackColorFogNight=aU();Pack_Skip(3);s_trackStartFog=Pack_Read16();aU();s_trackStartFog=(BuildConf.k_track_road_max_segment-5)*1000;s_trackRoadMapCoeff=Pack_Read16();Pack_Skip(2);Pack_Skip(2);s_trackRoadHalfWidth=Pack_Read16();s_trackOffRoadWidth=Pack_Read16();bf=Pack_readU8().castToByte();s_trackLaneCount=((bf&240)>>4).castToByte();s_trackLaneWidth=LowAPI.Float2Int((s_trackRoadHalfWidth*2)/s_trackLaneCount);Pack_Skip(3);Pack_Skip(3);Pack_Skip(2*3);var bh=Pack_readU8();if(bh!=0){for(bf=0;bf<bh;bf++){Pack_Skip(4)}}Pack_Skip(1);Pack_Skip(1);Pack_Skip(1);var bi=Pack_readU8();var a9=Pack_readU8();s_f3dUsed=LowAPI.Gen_Array([DATA.OBJECTS_MAX],false);s_offroadZoneNb=Pack_Read16();if(s_offroadZoneNb>0){s_offroadZoneDistance=LowAPI.Gen_Array([s_offroadZoneNb],0);s_offroadZoneType=LowAPI.Gen_Array([s_offroadZoneNb],0);s_offroadZoneColors=LowAPI.Gen_Array([s_offroadZoneNb,2],0);for(bf=0;bf<s_offroadZoneNb;bf++){s_offroadZoneDistance[bf]=Pack_Read16();s_offroadZoneType[bf]=Pack_readU8().castToByte();for(bd=0;bd<2;bd++){s_offroadZoneColors[bf][bd]=aU()}}}var bc=Pack_readU8();if(bc>0){s_offRoadPro=LowAPI.Gen_Array([bc*(OffRoadPro.k_num)],0);for(bf=0;bf<bc;bf++){s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_color1)]=aU();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_color2)]=aU();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_color3)]=aU();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_turn_angle_lost_per)]=Pack_readU8();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_speed_lost_per)]=Pack_readU8();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_speed_lost_delay)]=Pack_Read16();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_top_speed_lost_per)]=Pack_readU8();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_acceleration)]=Pack_readU8();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_deceleration)]=Pack_readU8();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_shake_enable)]=Pack_readU8();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_surface)]=Pack_readU8();s_offRoadPro[bf*(OffRoadPro.k_num)+(OffRoadPro.k_offset_y)]=Pack_readU8()}}var be=Pack_Read16();if(be>0){var a8;var bb;a8=LowAPI.Gen_Array([be],0);bb=LowAPI.Gen_Array([be],0);for(bf=0;bf<be;bf++){a8[bf]=Pack_readU8().castToByte();bb[bf]=Pack_Read16().castToShort()}}aM=Pack_Read16();aK=LowAPI.Gen_Array([aM],null);s_trackMaxObjSegmentsIngame=0;for(var bj=0;bj<aM;bj++){aK[bj]=new cTrackSection(bj);aK[bj].Load_TrackData();if(aK[bj].m_maxObjsPerSegment>s_trackMaxObjSegmentsIngame){s_trackMaxObjSegmentsIngame=aK[bj].m_maxObjsPerSegment}}aj();s_mainTrackNbSegment=MAINTRACK_NUM_SEGMENTS;bd=Pack_readS16();if(bd>0){for(bf=0;bf<bd;bf+=4){Pack_Skip(2);Pack_Skip(2);Pack_Skip(2);Pack_Skip(2)}}bd=Pack_readS16();if(bd>0){for(bf=0;bf<bd;bf+=4){Pack_Skip(2);Pack_Skip(2);Pack_Skip(2);Pack_Skip(2)}}Pack_Close()}function aA(){var a8;Pack_Open(DATA.PACK_OBJECTS);if(DATA.OBJECTS_MAX>0){s_f3dObjectsLength=LowAPI.Gen_Array([DATA.OBJECTS_MAX],0);s_f3dObjects=LowAPI.Gen_Array([DATA.OBJECTS_MAX],null);s_f3dObjectsTransformTo=LowAPI.Gen_Array([DATA.OBJECTS_MAX],null);s_f3dObjectsCollision=LowAPI.Gen_Array([DATA.OBJECTS_MAX],null);if(BuildConf.k_use_f3d_palettes){s_f3dPalettes=LowAPI.Gen_Array([DATA.OBJECTS_MAX],null)}for(a8=0;a8<DATA.OBJECTS_MAX;a8++){if(s_f3dUsed[a8]){a2(a8)}else{}}}Pack_Close()}function Z(){if(arguments){switch(arguments.length){case 2:return aL.apply(this,arguments);case 3:return aN.apply(this,arguments)}}throw new Error("InvalidArguments")}function aL(a9,a8){return a9|(a8<<16)}function aN(ba,a9,a8){return ba|(a8<<16)|(a9<<24)}function H(a8){return a8&65535}function a7(a8){return(a8>>24)&255}function Q(a8){return(a8>>16)&255}function a0(a9,bb,ba,a8){if(a9>255){a9=255}if(bb>255){bb=255}if(ba>255){ba=255}if(a8>255){a8=255}return(a9<<24)|(bb<<16)|(ba<<8)|a8}function aq(ba,a9,a8){if(ba>255){ba=255}if(a9>255){a9=255}if(a8>255){a8=255}return(ba<<16)|(a9<<8)|a8}function a2(by,bb){var bb=bb;if(arguments.length===1){bb=true}Pack_PositionAtData(by);Pack_Skip(2);s_f3dObjectsTransformTo[by]=LowAPI.Gen_Array([Pack_readU8().castToShort()],0);for(var bv=0;bv<s_f3dObjectsTransformTo[by].length;bv++){s_f3dObjectsTransformTo[by][bv]=Pack_Read16().castToShort()}var bg=Pack_readU8();var bx,bv;if(bg>0){s_f3dObjectsCollision[by]=LowAPI.Gen_Array([bg*Game.k_f3dObjects_collisions_length],0);for(bx=0;bx<s_f3dObjectsCollision[by].length;bx++){s_f3dObjectsCollision[by][bx]=Pack_Read16().castToShort()}}var bD=Pack_readU8();if(bD>0){for(var bu=0;bu<bD;bu++){Pack_Skip(2)}}var bw=Pack_readU8().castToByte();if(bw>0){for(bx=0;bx<bw;bx++){var bC=Pack_readU8().castToByte();for(bv=0;bv<bC;bv++){Pack_Skip(2)}}}var bt=Pack_readU8().castToByte();for(bx=0;bx<bt;bx++){var bi=Pack_readU8().castToByte();for(bv=0;bv<bi;bv++){Pack_Skip(2)}}Pack_Skip(1);Pack_Skip(1);Pack_Skip(1);s_f3dObjectsLength[by]=Pack_Read16();s_f3dObjects[by]=LowAPI.Gen_Array([s_f3dObjectsLength[by]],null);var bj=k_f3d_anim_type_none;var bc=0,bm=0;var bf=0;var bF=0;var bo=0;var bG=0;var bk=0;var bE=0;for(bx=0;bx<s_f3dObjectsLength[by];bx++){bv=Pack_readU8().castToByte();if(bv==k_f3d_cmd_set_color){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_set_color_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();var be=Pack_readU8().castToShort();var bl=Pack_readU8().castToShort();var bn=Pack_readU8().castToShort();bf=aq(be,bl,bn);s_f3dObjects[by][bx][k_f3d_command_r]=GetColorChannelR(bf).castToShort();s_f3dObjects[by][bx][k_f3d_command_g]=GetColorChannelG(bf).castToShort();s_f3dObjects[by][bx][k_f3d_command_b]=GetColorChannelB(bf).castToShort()}else{if(bv==k_f3d_cmd_set_day_night_color){}else{if(bv==k_f3d_cmd_set_anim){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_set_anim_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();var bd=Pack_Read32();bm=Pack_Read32().castToShort();bc=(bd>>16).castToShort();bj=(bd&65535).castToShort();var bs=Pack_readU8().castToShort();s_f3dObjects[by][bx][k_f3d_command_anim_idx]=bc;s_f3dObjects[by][bx][k_f3d_command_anim_time]=bm;s_f3dObjects[by][bx][k_f3d_command_anim_type]=bj;s_f3dObjects[by][bx][k_f3d_command_offset_skip]=bs}else{if(bv==k_f3d_cmd_set_texture){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_set_texture_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();var ba=Pack_Read32();var bq=Pack_Read32();s_f3dObjects[by][bx][k_f3d_command_texture_index]=(ba&65535).castToShort();s_f3dObjects[by][bx][k_f3d_command_texture_params]=((ba>>16)&65535).castToShort();s_f3dObjects[by][bx][k_f3d_command_texture_night_index]=(bq&65535).castToShort();s_f3dObjects[by][bx][k_f3d_command_texture_night_params]=((bq>>16)&65535).castToShort();bo=ba;bG=bq;bk=Q(ba);bE=Q(bq);var bA=H(ba);var a9=H(bq);var bB=a7(ba);var bh=a7(bq);if(bj!=k_f3d_anim_type_permanent){an(bA,bB,bk)}if(bj!=k_f3d_anim_type_none){if(bA==a9){aF(bA,bc,bm,bj)}}bj=k_f3d_anim_type_none}else{if(bv==k_f3d_cmd_rectangle){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_rectangle_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();s_f3dObjects[by][bx][k_f3d_command_x1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_x2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_rect_layer]=Pack_Read16().castToShort()}else{if(bv==k_f3d_cmd_custom_texture_rect){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_custom_texture_rect_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();s_f3dObjects[by][bx][k_f3d_command_x1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_x2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_rect_layer]=Pack_Read16().castToShort()}else{if(bv==k_f3d_cmd_bound_rect){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_rectangle_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();s_f3dObjects[by][bx][k_f3d_command_rect_layer]=Pack_Read16().castToShort()}else{if(bv==k_f3d_cmd_triangle){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_triangle_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();s_f3dObjects[by][bx][k_f3d_command_x1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_x2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_x3]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y3]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z3]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_layer]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_flags]=Pack_Read16().castToShort();if((s_f3dObjects[by][bx][k_f3d_command_flags]&(k_tri_flag_perspective|k_tri_flag_perspective_h))!=0){if(BuildConf.k_use_texture){var bz;ax(H(bo),bk);if(BuildConf.k_use_textures_day_night){ax(H(bG),bE)}}}}else{if(bv==k_f3d_cmd_line){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_line_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();s_f3dObjects[by][bx][k_f3d_command_x1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_x2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_line_layer]=Pack_Read16().castToShort()}else{if(bv==k_f3d_cmd_texture_rect){s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_texture_rect_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();s_f3dObjects[by][bx][k_f3d_command_x1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z1]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_x2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_y2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_z2]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_rect_layer]=Pack_Read16().castToShort();s_f3dObjects[by][bx][k_f3d_command_rect_flags]=Pack_Read16().castToShort();if(BuildConf.k_use_texture){var bz;ax(H(bo),bk);if(BuildConf.k_use_textures_day_night){ax(H(bG),bE)}}}else{if(bv==k_f3d_cmd_particles){var bp=Pack_readU8().castToShort();s_f3dObjects[by][bx]=LowAPI.Gen_Array([k_f3d_particles_datasize],0);s_f3dObjects[by][bx][k_f3d_command]=bv.castToShort();s_f3dObjects[by][bx][Game.k_f3d_command_particles_type]=bp;s_f3dObjects[by][bx][Game.k_f3d_command_particles_color_r]=Pack_readU8().castToShort();s_f3dObjects[by][bx][Game.k_f3d_command_particles_color_g]=Pack_readU8().castToShort();s_f3dObjects[by][bx][Game.k_f3d_command_particles_color_b]=Pack_readU8().castToShort();s_f3dObjects[by][bx][Game.k_f3d_command_particles_x]=Pack_Read16().castToShort();s_f3dObjects[by][bx][Game.k_f3d_command_particles_y]=Pack_Read16().castToShort();s_f3dObjects[by][bx][Game.k_f3d_command_particles_z]=Pack_Read16().castToShort();s_f3dObjects[by][bx][Game.k_f3d_command_particles_max_count]=Pack_Read16().castToShort()}}}}}}}}}}}}var br=Pack_readU8();if(BuildConf.k_use_f3d_palettes){s_f3dPalettes[by]=LowAPI.Gen_Array([br],null);for(bx=0;bx<br;bx++){var a8=Pack_readU8();s_f3dPalettes[by][bx]=LowAPI.Gen_Array([a8],0);for(bv=0;bv<a8;bv++){s_f3dPalettes[by][bx][bv]=aU()}}}else{for(bx=0;bx<br;bx++){var a8=Pack_readU8();for(bv=0;bv<a8;bv++){Pack_Skip(3)}}}if(s_f3dUsed!=null){for(bx=0;bx<s_f3dObjectsTransformTo[by].length;bx++){if(s_f3dObjectsTransformTo[by][bx]!=-1){if(!s_f3dUsed[s_f3dObjectsTransformTo[by][bx]]){s_f3dUsed[s_f3dObjectsTransformTo[by][bx]]=true;a2(s_f3dObjectsTransformTo[by][bx])}}}}}function aF(bb,ba,bd,a9){var be;var a8=false;for(var bc=0;bc<s_texturesAnimInfo[bb].length;bc+=v){if(s_texturesAnimInfo[bb][bc]==-1){s_texturesAnimInfo[bb][bc+D]=ba;s_texturesAnimInfo[bb][bc+l]=bd;s_texturesAnimInfo[bb][bc+n]=a9;a8=true;return}}}function an(ba,a9,a8){s_texturesFrameInfo[ba][a9]|=(1<<a8).castToByte()}function e(){var bf,be;var bk,bd,a9,a8,bb,bg;Pack_Open(DATA.PACK_TRACKS_MISSION);Pack_PositionAtData(0);bk=Pack_readU8();bd=Pack_readU8();s_missionF3dObjAddData=LowAPI.Gen_Array([bd],null);for(var bi=0;bi<aK.length;bi++){aK[bi].InitMissionData(bd)}for(var ba=0;ba<bd;ba++){Pack_readU8();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readS32();Pack_readU8();Pack_readU8();Pack_readS16();Pack_readS16();Pack_readS8();Pack_readS8();Pack_readS8();Pack_readS8();Pack_Read16();Pack_readS8();Pack_readS8();a9=Pack_readU8();for(var bh=0;bh<a9;bh++){Pack_Read16();Pack_readU8();Pack_Read16()}a8=Pack_Read16();var bc=LowAPI.Gen_Array([k_item_data_length],0);for(var bj=0;bj<a8;bj++){bc[k_item_type_id]=Pack_readU8();bc[k_item_f3d_index]=Pack_Read16().castToShort();bc[k_item_value]=Pack_Read16().castToShort();bc[k_item_circuit_index]=Pack_Read16().castToShort();bc[k_item_seg_index]=Pack_Read16().castToShort();bc[k_item_xposition]=Pack_Read16().castToShort();bc[k_item_yposition]=Pack_Read16().castToShort();bc[k_item_flipProperty]=Pack_readU8();bc[k_item_state]=k_item_state_enable;if(bc[k_item_circuit_index]>=0){aK[bc[k_item_circuit_index]].AddMissionItem(ba,bc)}}bb=Pack_readU8();if(bb>0){for(var bj=0;bj<bb;bj++){Pack_readU8();Pack_Read16();Pack_Read16();Pack_Read16()}}bg=Pack_readU8();if(bg>0){s_missionF3dObjAddData[ba]=LowAPI.Gen_Array([bg],0);for(var bj=0;bj<bg;bj++){s_missionF3dObjAddData[ba][bj]=Pack_Read32();Pack_Read16();Pack_Read16();Pack_readU8()}}}Pack_Close()}function aZ(){s_camDistOffsetFP=0;var a8;s_player._alive=true;ao();a4();s_bCamLockFollowUntilReachTarget=false;s_camHauReal=IDevice.k_camera_height+CAM_HEIGHT_OFFSET_INTRO;aW(true,IDevice.k_camera_height,CAM_HEIGHT_FOLLOW_SPEED_INTRO);ae();ad(2500,400,400,0);s_camIncOn=0;s_camCumuledCap=0;s_camCumuledHeight=0;s_camCapOn=0;s_camLatOn=s_player._segXOn;s_camLatOffset=0;s_iLastAggregatedTrackSection=-1;s_camPosOn=0;s_camSegOn=0;s_camOldSeg=s_camSegOn;s_cameraAngle=0;if(s_arrayTweaks[ITweaks.FIRST_TRACK_SECTION][0]>=0){aK[s_arrayTweaks[ITweaks.FIRST_TRACK_SECTION][0]].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main])}aH();b()}function b(){}function ax(a8,a9){s_texturePalettesToLoad[a8]=1<<a9}function aY(ba,a8){var a9=null;a9=Pack_ReadData(ba);var bb=new cSpriteEX();bb.Load(a9,0);s_textures[ba]=bb;a6(ba);a9=null;bb=null;return bb}function a6(be){r(be);var ba=s_textures[be].GetNumPalettes();for(var a8=0;a8<(ba*((FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS)-1));a8++){s_textures[be].AllocateExtraPalette()}var bb;for(var bc=(ba-1);bc>=0;bc--){bb=(bc*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS)+((FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS)-1);for(var a9=(NUM_ENVIRONMENTS-1);a9>=0;a9--){for(var a8=FOG_TEXTURE_PALETTES-1;a8>=0;a8--){if(bb!=0){s_textures[be].PaletteBlending_BuildPalette(LowAPI.Float2Int((a8*256)/FOG_TEXTURE_PALETTES),bc,R(a9),bb,true);bb--}}}}for(var a9=0;a9<s_texturesFrameInfo[be].length;a9++){if(s_texturesFrameInfo[be][a9]>=1){if((s_textures[be].GetFrameWidth(a9)==0)&&(s_textures[be].GetFrameHeight(a9)==0)){Err("buildTexture: WARNING!! Frame has 0 size - pls check this sprite")}for(var a8=0;a8<ba;a8++){if((s_texturesFrameInfo[be][a9]&(1<<a8))!=0){s_textures[be].BuildCacheFrameAsImage(a8*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS,a9,a9)}}}}if(IS_DEBUG_MODE){Dbg("-- LIST OF *UNUSED* TEXTURE FRAMES ");var bd=s_textures[be].GetFrames();Dbg("    - TEXTURE "+be+" - "+bd+" FRAMES");for(var a9=0;a9<bd;a9++){if(s_texturesFrameInfo[be][a9]==0){if((s_textures[be].GetFrameWidth(a9)==0)||(s_textures[be].GetFrameHeight(a9)==0)){Dbg("        - FRAME "+a9+" NOT USED")}else{Warn("        - FRAME "+a9+" NOT USED")}}}Dbg("-- END OF LIST")}s_textures[be].FreeModuleData();s_textures[be].FreeCachedModules();s_textures[be].FreeCachedFrames();s_textures[be].FreeCacheData()}function S(a8){s_textures[a8]=null}function U(a8){return(s_texturePalettesToLoad[a8]!=0)}function ao(){s_camOldSeg=s_camSegOn;s_camSegOn=s_player._segOn;s_camPosOn=s_player._segYOn-s_camera_distance;if(s_camPosOn<0){s_camPosOn+=Game.k_segment_length;s_camSegOn--;if(s_camSegOn<0){s_camSegOn+=s_mainTrackNbSegment}}s_camCapOn=0;s_camLatOn=s_player._segXOn;s_player._carAnim=0;s_viewProjCenterBase=IDevice.k_view_proj_center;s_camFocale=IDevice.k_camera_focale;s_camHau=IDevice.k_camera_height;s_camera_distance=IDevice.k_camera_distance;s_camCapOn=0;s_camCumuledCap=0;s_camCapOnOffset=0}function ae(){a=0;I=0;G=0}function aG(a8){w=a8}function ai(a8,a9){N=a8;a=a8;z=a9}function J(bc){var a9=0;if(a>0){a-=s_game_frameDT;if(a<0){a=0;a9=0}else{a9=LowAPI.Float2Int((z*a)/N)}}if(a9<w){a9=w}if(a9==0){I=0;G=0}else{I=Math_Rand(0,1+(a9*2))-a9;G=Math_Rand(0,1+(a9*2))-a9}s_camOldSeg=s_camSegOn;s_camSegOn=s_player._segOn+CHASE__camSegOn_MovIfCatched;s_camPosOn=s_player._segYOn-(s_camera_distance+s_camDistOffsetFP)+CHASE__camPosOn_MovIfCatched;ah();var bb=s_player._segOn;var ba=s_player._segYOn;var bd=-s_cTrack[s_player.m_iCurrentTrack].s_trackTabAng[bb]*3;s_camCapOnOffset=s_cameraAngle;s_viewProjCenter=s_viewProjCenterBase;if(s_camPosOn<0){s_camPosOn+=Game.k_segment_length;s_camSegOn--;if(s_camSegOn<0){s_camSegOn+=s_mainTrackNbSegment}s_camCapOn=(-(s_cTrack[s_player.m_iCurrentTrack].s_trackTabAng[bb]*(ba))>>Game.k_segment_base)+s_camCapOnOffset;s_camLatOn=s_camLatOffset+I;s_camLatOn-=Math_FixedPointToInt(Math_Sin(s_camCapOn)<<Game.k_segment_base);s_camLatOn-=Math_FixedPointToInt(Math_Sin(s_camCapOn+s_cTrack[s_player.m_iCurrentTrack].s_trackTabAng[bb])*ba)}else{s_camCapOn=((s_cTrack[s_player.m_iCurrentTrack].s_trackTabAng[bb]*(Game.k_segment_length-ba))>>Game.k_segment_base)+s_camCapOnOffset;s_camLatOn=s_camLatOffset}if(s_camOldSeg!=s_camSegOn){if(s_cTrack[s_iBifurcationTrack_Main].s_roadStatus[s_camOldSeg]==TRACKSEGMENT_STATUS.MAINTRACK_END){s_iBifurcationTrack_Main=s_player.m_iCurrentTrack}}var a8=0;if(s_camHauReal!=s_camHauTarget){a8=LowAPI.Float2Int((s_camHauTargetFollowSpeed*bc)/1000);if(a8==0){a8=1}if(s_camHauReal<s_camHauTarget){s_camHauReal+=a8;if(s_camHauReal>s_camHauTarget){s_camHauReal=s_camHauTarget}}else{s_camHauReal-=a8;if(s_camHauReal<s_camHauTarget){s_camHauReal=s_camHauTarget}}}s_camHau=s_camHauReal+G}function d(bc,ba,a9){if(arguments.length<3){a9=s_trackColorFogCurrent}var a8=0;var bb=ba;if(bc>s_trackStartFog){a8=LowAPI.Float2Int(((bc-s_trackStartFog)<<IDefine.PERCENT_BASE)/((BuildConf.k_track_road_max_segment<<Game.k_segment_base)-s_trackStartFog))}if(a8!=0){bb=InterpolateColor255(a9,ba,a8)}return bb}function X(ba){var a8=0;var a9=0;if(ba>s_trackStartFog){a8=LowAPI.Float2Int(((ba-s_trackStartFog)<<IDefine.PERCENT_BASE)/((BuildConf.k_track_road_max_segment<<Game.k_segment_base)-s_trackStartFog))}if(a8!=0){a9=(a8*FOG_TEXTURE_PALETTES)>>8}return a9}function aI(a8){s_trackStartFog=s_arrayEnvironment[IEnvironment.FOG_START_DIST][a8];s_trackColorFogGround=R(a8);s_trackColorFog=s_trackColorFogGround;s_trackColorFogNight=s_trackColorFogGround;s_trackColorFogCurrent=s_trackColorFogGround}function R(a8){return 4278190080|(s_arrayEnvironment[IEnvironment.FOG_COLOR_R][a8]<<16)|(s_arrayEnvironment[IEnvironment.FOG_COLOR_G][a8]<<8)|s_arrayEnvironment[IEnvironment.FOG_COLOR_B][a8]}function aa(a8){var a9=((s_iObjectFlags[a8]&(OBJECT_FLAG_NEEDSCLOSECLIPDIST))!=0);k_viewClip_F3D=a9?k_viewClip_F3D_close:k_viewClip_F3D_standard}function f(a8){return((a8>>16)&15)}function u(a8){return(a8&65535)}function ap(a8){return((a8>>28)&15)}function aO(bb,a8,ba,a9){track_iRoundEffect_PMiddle_Depth=bb;track_iRoundEffect_PMiddle_Height=a8;track_iRoundEffect_PFar_Depth=ba;track_iRoundEffect_PFar_Height=a9}function aD(ba){var a8=0;var a9=LowAPI.Float2Int((ba*s_math_F_1)/track_iRoundEffect_PFar_Depth);Math_Bezier2D(0,0,track_iRoundEffect_PMiddle_Depth,track_iRoundEffect_PMiddle_Height,track_iRoundEffect_PFar_Depth,track_iRoundEffect_PFar_Height,a9);a8=s_math_bezierY;return a8}function x(a8){for(var a9=0;a9<s_cTrack.length;a9++){s_cTrack[a9].s_iOffsetX+=a8}}function k(){aH();aB();s_raceTime+=s_dt;cActor.UpdateParticles(s_dt);var a8=s_player._speed;var a9=cActor.ActorLists_GetFirstActor(IActorLists.MAIN);while(a9!=null){a9._computedProjection=false;s_cTrack[a9.m_iCurrentTrack].Track_addActorToDrawList(a9,true);a9=cActor.ActorLists_GetNextActor(a9)}s_cTrack[s_iBifurcationTrack_Main].Track_updateF3dAnims();if(s_iBifurcationSegment!=-1){s_cTrack[s_iBifurcationTrack_Left].Track_updateF3dAnims();s_cTrack[s_iBifurcationTrack_Right].Track_updateF3dAnims()}if(BuildConf.k_use_texture_anim){s_cTrack[s_iBifurcationTrack_Main].Track_updateTextureAnims();if(s_iBifurcationSegment!=-1){s_cTrack[s_iBifurcationTrack_Left].Track_updateTextureAnims();s_cTrack[s_iBifurcationTrack_Right].Track_updateTextureAnims()}}if(BuildConf.k_use_palettes_anim){s_cTrack[s_iBifurcationTrack_Main].UpdatePaletteAnim(s_dt);if(s_iBifurcationSegment!=-1){s_cTrack[s_iBifurcationTrack_Left].UpdatePaletteAnim(s_dt);s_cTrack[s_iBifurcationTrack_Right].UpdatePaletteAnim(s_dt)}}aR();if(!s_didPlayTigersSound){playSound(SOUND_TYPE.START_TIGERS_SFX,false);s_didPlayTigersSound=true}}function aB(){var a8,bb,ba,a9;s_iBifurcationSegment=-1;s_cTrack[s_iBifurcationTrack_Main].ExtractWorld(true,s_camSegOn,s_camCapOn,-s_camLatOn,-s_camPosOn,-s_camHau);if(s_iBifurcationSegment!=-1){s_cTrack[s_iBifurcationTrack_Left].ExtractWorld(true,s_camSegOn,s_camCapOn,-s_camLatOn,-s_camPosOn,-s_camHau);s_cTrack[s_iBifurcationTrack_Right].ExtractWorld(true,s_camSegOn,s_camCapOn,-s_camLatOn,-s_camPosOn,-s_camHau)}}function aw(a8){a8++;if(a8>=s_mainTrackNbSegment){a8=0}return a8}function r(bc){var ba,be,bf;for(var bb=0;bb<s_texturesAnimInfo[bc].length;bb+=v){ba=s_texturesAnimInfo[bc][bb+D];if(ba!=-1){be=s_textures[bc].GetAFrames(ba);for(var a9=0;a9<be;a9++){bf=s_textures[bc].GetAnimFrame(ba,a9);var bd=s_textures[bc].GetNumPalettes();for(var a8=0;a8<bd;a8++){s_f3dUsed[bc]=true;an(bc,bf,a8)}}}}}function al(){s_iBulletTimeFrameDeltaReal=s_game_frameDT;s_game_frameDT=LowAPI.Float2Int((s_game_frameDT*s_iBulletTimeFactor_Percent)/100);if(s_game_frameDT<=0){s_game_frameDT=1}s_iBulletTimeFactor_Percent=100}function au(){s_game_frameDT=s_iBulletTimeFrameDeltaReal}function a4(){s_camFocale=IDevice.k_camera_focale;s_camera_height=IDevice.k_camera_height;s_camera_distance=IDevice.k_camera_distance;s_viewProjCenterBase=IDevice.k_view_proj_center;s_camHauReal=s_camera_height;s_camHau=s_camHauReal;s_camHauOffset=0;s_camera_distance_offset=0;s_viewProjCenter=s_viewProjCenterBase}function aW(ba,a8,a9){if(!s_bCamLockFollowUntilReachTarget){s_bCamLockFollowUntilReachTarget=ba;s_camHauTarget=a8;s_camHauTargetFollowSpeed=a9}}function ad(a8,bb,ba,a9){s_iCamDepthMovTime=a8;s_iCamDepthMovTimeTotal=a8;s_iCamDepthMovStartFP=bb;s_iCamDepthMovMidFP=ba;s_iCamDepthMovEndFP=a9}function ah(){if(s_iCamDepthMovTime>0){s_iCamDepthMovTime-=s_game_frameDT;if(s_iCamDepthMovTime<=0){s_iCamDepthMovTime=0;s_bIntroOver=true}var bb=LowAPI.Float2Int(((s_iCamDepthMovTimeTotal-s_iCamDepthMovTime)*s_math_F_1)/s_iCamDepthMovTimeTotal);Math_Bezier2D(0,s_iCamDepthMovStartFP,LowAPI.Float2Int(s_iCamDepthMovTimeTotal/2),s_iCamDepthMovMidFP,s_iCamDepthMovTimeTotal,s_iCamDepthMovEndFP,bb);s_camDistOffsetFP=s_math_bezierY}var a8=LowAPI.Float2Int((s_player._segXOn*s_arrayTweaks[ITweaks.CAMERA_HORIZONTAL_PLAYER_FOLLOW_PERCENT][0])/100);var ba=LowAPI.Float2Int(((a8-s_camLatOffset))/4);s_camLatOffset+=ba;if(s_camHauReal==s_camHauTarget){s_bCamLockFollowUntilReachTarget=false}else{var a9=LowAPI.Float2Int((s_camHauTargetFollowSpeed*s_game_frameDT)/1000);if(a9==0){a9=1}if(s_camHauReal<s_camHauTarget){s_camHauReal+=a9;if(s_camHauReal>=s_camHauTarget){s_camHauReal=s_camHauTarget;s_bCamLockFollowUntilReachTarget=false}}else{s_camHauReal-=a9;if(s_camHauReal<=s_camHauTarget){s_camHauReal=s_camHauTarget;s_bCamLockFollowUntilReachTarget=false}}s_camHau=s_camHauReal+G}}function aH(){var a8=s_camSegOn;for(var a9=0;a9<=BuildConf.k_track_road_max_segment;a9++){if(a8==s_cTrack[s_iBifurcationTrack_Main].s_iNextMainTrackAppendSegment){if(!i()){F()}}a8++;if(a8>=MAINTRACK_NUM_SEGMENTS){a8%=MAINTRACK_NUM_SEGMENTS}}}function i(){if(s_game_isTutorialAvailable){aK[a1(s_iCurrentEnvironment,SUBTRACK_ID_TUTO_STEP1+s_game_iTutorialStep)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);aK[a1(s_iCurrentEnvironment,SUBTRACK_ID_TUTO_CLEAN)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);return true}else{return false}}function F(){var a8;var bh=-1;var a9=-1;var be=-1;var ba;s_bJustGeneratedTigerPowerup=false;s_iLastEnvironment=s_iCurrentEnvironment;if(s_iIntroState==GAME_INTROSTATE_DISPLAYING_OPTIONS){bh=a1(s_iCurrentEnvironment,SUBTRACK_ID_INTRO);aK[bh].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);return}else{if(s_iIntroState==GAME_INTROSTATE_IN_HEADSTART){bh=a1(s_iCurrentEnvironment,SUBTRACK_ID_MOUNT_FRIENDLY);aK[bh].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);return}}if(false){var bf;bf=friendRecord_GetNextFriendWallIDToCreate(true);while(bf>=0){if(s_bFriendWallIncoming&&(s_game_run_time>=s_iMinTimeForWallCreation)){var bb;var bg;bb=a1(s_iCurrentEnvironment,SUBTRACK_ID_FRIEND_WALL);bg=aK[bb].GetSegmentWithStatus(TRACKSEGMENT_STATUS.FRIEND_WALL);if(bg>=0){aK[bb].m_roadCustomParam[bg]=bf}for(var bc=0;bc<3;bc++){aK[bb].AppendToTrack(s_cTrack[bc])}s_iMinTimeForWallCreation=s_game_run_time+1+s_arrayTweaks[ITweaks.MIN_TIME_INBETWEEN_FRIEND_WALL_SCORE][0];s_bFriendWallIncoming=true}bf=friendRecord_GetNextFriendWallIDToCreate(true)}}if(s_isRidingTiger){bh=a1(s_iCurrentEnvironment,SUBTRACK_ID_MOUNT_FRIENDLY);aK[bh].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main])}else{if(s_iDistInLevel>=s_arrayTweaks[ITweaks.DISTANCE_PER_LEVEL][0]){s_iDistInEnvironment+=s_iDistInLevel;s_iDistInPhase+=s_iDistInLevel;s_iDistInLevel=0;if(s_iDistInEnvironment>=s_arrayTweaks[ITweaks.DISTANCE_PER_ENVIRONMENT][0]){aK[a1(s_bEnvControlCheatsActivated?s_iCheatTrackControl_Env:s_iCurrentEnvironment,SUBTRACK_ID_ENVIRONMENT_CHANGE)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);h();s_iDistInEnvironment=0;if(s_iCurrentEnvironment==ENVIRONMENT.TEMPLE){aK[a1(s_iCurrentEnvironment,SUBTRACK_ID_INTERIOR_FIRST)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main])}}else{if(s_iTrackLevelsPassed>0){if((s_iCurrentEnvironment==ENVIRONMENT.TEMPLE)){aK[a1(s_iCurrentEnvironment,SUBTRACK_ID_INBETWEEN)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main])}else{C()}}}if(s_iDistInPhase>=s_arrayTweaks[ITweaks.DISTANCE_PER_PHASE][0]){s_iDistInPhase=0;s_iTrackPhase++;if(s_iTrackPhase>s_numTrackPhases){s_iTrackPhase=s_numTrackPhases}}a8=Math_Rand(0,100);be=0;for(var bc=0;bc<=s_numTrackLevels;bc++){be=bc;if(a8<s_arrayTrackPhaseDefs[s_iTrackPhase][bc]){break}a8-=s_arrayTrackPhaseDefs[s_iTrackPhase][bc]}s_iTrackLevel=be;if(!s_game_isTutorialAvailable){s_iTrackLevelsPassed++}}else{aK[a1(s_iCurrentEnvironment,SUBTRACK_ID_INBETWEEN)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main])}}if(!s_isRidingTiger){if(s_bLevelControlCheatsActivated){ba=s_iCheatLevelControl_Level}else{ba=s_iTrackLevel}a8=Math_Rand(0,100);for(var bc=0;bc<=s_maxTrackID;bc++){a9=bc;if(a8<s_arrayTrackLevelDefs[ba][bc]){break}a8-=s_arrayTrackLevelDefs[ba][bc]}bh=a1(s_bEnvControlCheatsActivated?s_iCheatTrackControl_Env:s_iCurrentEnvironment,a9);aK[bh].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main])}if(s_bJustGeneratedTigerPowerup){var bd=BuildConf.k_track_road_max_segment+1;while(bd>0){bh=a1(s_iCurrentEnvironment,SUBTRACK_ID_MOUNT_FRIENDLY);aK[bh].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);bd-=aK[bh].m_nbSegment}}}function a1(be,bd){var a9=-1;var bc;var a8=q[be][bd];if(a8!=null){bc=a8.length;a9=a8[Math_Rand(0,bc)].m_iGlobalIndex;if((s_iLastAggregatedTrackSection>=0)&&(aK[a9].m_iTrackID==aK[s_iLastAggregatedTrackSection].m_iTrackID)&&(aK[a9].m_iSubtrackID==aK[s_iLastAggregatedTrackSection].m_iSubtrackID)){var bb=false;for(var ba=0;ba<bc;ba++){if(a8[ba].m_iSubtrackID!=aK[s_iLastAggregatedTrackSection].m_iSubtrackID){bb=true;break}}if(bb){do{a9=a8[Math_Rand(0,bc)].m_iGlobalIndex}while(aK[a9].m_iSubtrackID==aK[s_iLastAggregatedTrackSection].m_iSubtrackID)}}}else{a9=0}return a9}function aj(){var a9=LowAPI.Gen_Array([NUM_ENVIRONMENTS,256],0);for(var bb=0;bb<aK.length;bb++){if(aK[bb]!=null){a9[aK[bb].m_iEnvironment][aK[bb].m_iTrackID]++}}q=LowAPI.Gen_Array([NUM_ENVIRONMENTS,256],null);for(var bb=0;bb<NUM_ENVIRONMENTS;bb++){for(var a8=0;a8<256;a8++){if(a9[bb][a8]>0){q[bb][a8]=LowAPI.Gen_Array([a9[bb][a8]],null)}else{q[bb][a8]=null}a9[bb][a8]=0}}for(var bb=0;bb<aK.length;bb++){if(aK[bb]!=null){var ba=a9[aK[bb].m_iEnvironment][aK[bb].m_iTrackID];q[aK[bb].m_iEnvironment][aK[bb].m_iTrackID][ba]=aK[bb];a9[aK[bb].m_iEnvironment][aK[bb].m_iTrackID]++}}}function C(){var bc=s_bEnvControlCheatsActivated?s_iCheatTrackControl_Env:s_iCurrentEnvironment;var a8;var ba;s_iBifurcationTrack_Left=(s_iBifurcationTrack_Main==0)?1:0;s_iBifurcationTrack_Right=(s_iBifurcationTrack_Main==2)?1:2;aK[a1(bc,SUBTRACK_ID_PRE_BIFURCATION)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);a8=s_cTrack[s_iBifurcationTrack_Main].s_iNextMainTrackAppendSegment;s_cTrack[s_iBifurcationTrack_Left].s_iNextMainTrackAppendSegment=a8;s_cTrack[s_iBifurcationTrack_Right].s_iNextMainTrackAppendSegment=a8;aK[a1(bc,SUBTRACK_ID_MAINTRACK_END)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Main]);aK[a1(bc,SUBTRACK_ID_CURVE_LEFT)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Left]);aK[a1(bc,SUBTRACK_ID_CURVE_RIGHT)].AppendToTrack(s_cTrack[s_iBifurcationTrack_Right]);s_cTrack[s_iBifurcationTrack_Main].s_roadStatus[a8]=TRACKSEGMENT_STATUS.MAINTRACK_END;s_cTrack[s_iBifurcationTrack_Left].s_roadStatus[a8]=TRACKSEGMENT_STATUS.BIFURCATION_START;s_cTrack[s_iBifurcationTrack_Right].s_roadStatus[a8]=TRACKSEGMENT_STATUS.BIFURCATION_START;ba=a8;do{ba--;if(ba<0){ba=MAINTRACK_NUM_SEGMENTS-1}s_cTrack[s_iBifurcationTrack_Left].s_roadStatus[ba]=TRACKSEGMENT_STATUS.IGNORE;s_cTrack[s_iBifurcationTrack_Right].s_roadStatus[ba]=TRACKSEGMENT_STATUS.IGNORE;if(ba==s_camSegOn){break}}while(true);var bb=s_cTrack[s_iBifurcationTrack_Main].s_trackSegEnvironment[a8];for(var a9=0;a9<BuildConf.k_track_road_max_segment;a9++){s_cTrack[s_iBifurcationTrack_Main].s_roadStatus[s_cTrack[s_iBifurcationTrack_Main].s_iNextMainTrackAppendSegment]=TRACKSEGMENT_STATUS.IGNORE;s_cTrack[s_iBifurcationTrack_Main].s_trackSegEnvironment[s_cTrack[s_iBifurcationTrack_Main].s_iNextMainTrackAppendSegment]=bb;s_cTrack[s_iBifurcationTrack_Main].s_iNextMainTrackAppendSegment++;if(s_cTrack[s_iBifurcationTrack_Main].s_iNextMainTrackAppendSegment>=MAINTRACK_NUM_SEGMENTS){s_cTrack[s_iBifurcationTrack_Main].s_iNextMainTrackAppendSegment=0}}var bd=LowAPI.Float2Int((s_trackRoadHalfWidth*2)/cActor.TRACK_LANES.NUMBER_OF_LANES);s_cTrack[s_iBifurcationTrack_Main].s_iOffsetX=0;s_cTrack[s_iBifurcationTrack_Left].s_iOffsetX=-2*bd;s_cTrack[s_iBifurcationTrack_Right].s_iOffsetX=2*bd}function aJ(){var a8;a8=(s_iEnvironmentLastFrame!=s_iCurrentEnvironment);return a8}function h(){if(s_bEnvControlCheatsActivated){s_iCurrentEnvironment=s_iCheatTrackControl_Env}else{if(s_bEnvironmentIsInterior[s_iCurrentEnvironment]){var a8;do{a8=Math_Rand(0,ENVIRONMENT.NUM_ENVS)}while((a8==s_iCurrentEnvironment)||s_bEnvironmentIsInterior[a8]);s_iCurrentEnvironment=a8}else{s_iCurrentEnvironment=ENVIRONMENT.TEMPLE}}}function aX(a9,bf,ba){if(ba==B){ba=true}if(ba){var be,bh;be=s_cTrack[s_iBifurcationTrack_Main].s_trackSegEnvironment[s_cTrack[s_iBifurcationTrack_Main].s_worldNum[BuildConf.k_track_road_max_segment-1]];bh=s_cTrack[s_iBifurcationTrack_Main].s_trackSegEnvironment[s_cTrack[s_iBifurcationTrack_Main].s_worldNum[0]];if(!af[be]){M(be)}else{if(!af[bh]){M(bh)}else{M(be)}}if(af[be]&&!af[bh]){var a8=av();var bb=s_cTrack[s_iBifurcationTrack_Main].s_roadX1[BuildConf.k_track_road_max_segment]+(s_cTrack[s_iBifurcationTrack_Main].s_roadL1[BuildConf.k_track_road_max_segment]/2);SetClip(g,bb-75,a8-100,150,100);M(be);SetClip(g,0,0,s_screenWidth,s_screenHeight)}}var bi;var bd;var bj;s_isBottomFillNeeded=false;s_iSegmentEnvironment=0;s_iSegmentFogColor=0;var bg=(s_iBifurcationSegment>=0);for(var bc=0;bc<BuildConf.k_track_road_max_segment;bc++){if(bf){bi=0;bd=bi+BuildConf.k_track_road_max_segment-1-bc;bj=s_cTrack[s_iBifurcationTrack_Main].s_worldNum[bd];s_iSegmentEnvironment=s_cTrack[s_iBifurcationTrack_Main].s_trackSegEnvironment[bj];s_iSegmentFogColor=R(s_cTrack[s_iBifurcationTrack_Main].s_trackSegEnvironment[bj]);if(bc>=BuildConf.k_track_road_max_segment-BuildConf.k_track_road_draw_objects_max_segment){if(bg){s_cTrack[s_iBifurcationTrack_Left].Track_drawOffRoad(true,bc,true,true);s_cTrack[s_iBifurcationTrack_Left].DrawWorld(true,bc);s_cTrack[s_iBifurcationTrack_Right].Track_drawOffRoad(true,bc,false,false);s_cTrack[s_iBifurcationTrack_Right].DrawWorld(true,bc)}s_cTrack[s_iBifurcationTrack_Main].Track_drawOffRoad(true,bc,!bg,false);s_cTrack[s_iBifurcationTrack_Main].DrawWorld(true,bc)}if(bg){if(s_iBifurcationSegment==bj){bg=false}}}if(a9){if(bc>0){s_cTrack[s_player.m_iCurrentTrack].Track_drawSegmentObjects(true,bc-1)}}}if(a9){s_cTrack[s_player.m_iCurrentTrack].Track_drawSegmentObjects(true,BuildConf.k_track_road_max_segment-1)}}function aR(){if(s_player._speed>=s_arrayTweaks[ITweaks.PLAYER_SPEEDLINES_SPEED][0]){cActor.GenerateSpeedEffectParticles()}}function av(){var a8;var a9;a8=0;a9=s_iBifurcationTrack_Main;if(s_cTrack[a9].s_roadStatus[s_cTrack[a9].s_worldNum[BuildConf.k_track_road_max_segment-1]]==TRACKSEGMENT_STATUS.IGNORE){a9=s_iBifurcationTrack_Left}if(a8<s_cTrack[a9].s_roadY1[BuildConf.k_track_road_max_segment]){a8=s_cTrack[a9].s_roadY1[BuildConf.k_track_road_max_segment]}return a8}function M(bi){var bb;var bg;var bf;var be;var ba;var bd=0;var bc;var bh;var a8;bg=V[bi];bb=Math_FixedPointAngleToDegree(s_camCumuledCap+((s_cTrack[s_iBifurcationTrack_Main].s_trackTabAng[s_player._segOn]*s_player._segYOn)>>Game.k_segment_base)-(s_camCapOnOffset<<1));be=av();if(s_isBottomFillNeeded){SetColor(GetColorDependingOnDayTime(s_trackColorGround));FillRectWrapper(s_gameRegion_left,s_cTrack[s_iBifurcationTrack_Main].s_roadY1[BuildConf.k_track_road_max_segment],s_screenWidth,GetScreenHeight()-s_cTrack[s_iBifurcationTrack_Main].s_roadY1[BuildConf.k_track_road_max_segment])}for(var a9=0;a9<bg.length;a9++){bf=0;a8=bg[a9][j.SPRITE];if(a8>=0){ba=s_ASpriteArray[a8];bd=bg[a9][j.FRAME]}else{ba=null}if(a9==0){bh=4278190080|(s_arrayEnvironment[IEnvironment.SKY_COLOR_R][bi]<<16)|(s_arrayEnvironment[IEnvironment.SKY_COLOR_G][bi]<<8)|s_arrayEnvironment[IEnvironment.SKY_COLOR_B][bi];SetColor(bh);FillRectWrapper(0,0,s_screenWidth,be+bg[a9][j.OFFSET_Y]-((a8>=0)?ba.GetFrameHeight(bd):0))}if(a8>=0){bc=ba.GetFrameWidth(bd);bf=LowAPI.Float2Int((bb*bg[a9][j.SPEED_FACTOR])/360)%bc;if((bf+bc)>0){bf-=bc}while(bf<s_screenWidth){ba.PaintFrame(g,bd,bf,be+bg[a9][j.OFFSET_Y],0);bf+=bc}}}SetClip(0,0,s_screenWidth,s_screenHeight)}var A=LowAPI.Gen_Array([8],0);var y=LowAPI.Gen_Array([8],0);var aP=0;var aT=0;var aS=1;var at=2;var P=0;var E=1;var aV=2;var W=3;var az=4;var aQ=0;var ay=1;var c=6;var a5=LowAPI.Gen_Array([3,at],0);function L(bk,bM,bu,bi,bK,bt,bh,bJ,bs,bg,br,bd,bm,bv,bH){if(bk!=LowAPI.Float2Int(bk)||bM!=LowAPI.Float2Int(bM)||bu!=LowAPI.Float2Int(bu)||bi!=LowAPI.Float2Int(bi)||bK!=LowAPI.Float2Int(bK)||bt!=LowAPI.Float2Int(bt)||bh!=LowAPI.Float2Int(bh)||bJ!=LowAPI.Float2Int(bJ)||bs!=LowAPI.Float2Int(bs)||bg!=LowAPI.Float2Int(bg)||br!=LowAPI.Float2Int(br)){throw new Error("Invalid")}if((bM>k_draw_distance&&bK>k_draw_distance&&bJ>k_draw_distance)||(bM<=k_viewClip_F3D&&bK<=k_viewClip_F3D&&bJ<=k_viewClip_F3D)){return}else{var bF,bE,bq,bo,bf,be,bl;var bc,bD,bb,bC,ba,bB,a9,bA;if((bm&(k_tri_flag_perspective))!=0){if(BuildConf.k_use_texture){if(bM<k_viewClip_F3D){bM=k_viewClip_F3D}if(bJ<k_viewClip_F3D){bF=bi-bk;bE=bh-bk;bq=bK-bM;bo=bJ-bM;if(bq==0||bo==0){return}bl=k_viewClip_F3D-bM;bi=bk+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bh=bk+(LowAPI.Float2Int((((bE)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bK=k_viewClip_F3D;bJ=k_viewClip_F3D}if(bK<(k_viewClip_F3D)){return}bc=LowAPI.Float2Int((k_middle_region_x)+((bk*s_camFocale)/bM));bD=LowAPI.Float2Int(s_viewProjCenter-((bu*s_camFocale)/bM));bb=LowAPI.Float2Int((k_middle_region_x)+((bi*s_camFocale)/bK));bC=LowAPI.Float2Int(s_viewProjCenter-((bt*s_camFocale)/bK));ba=bb;bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/bJ));a9=bc;bA=LowAPI.Float2Int(s_viewProjCenter-((br*s_camFocale)/bM));var bG=(bH&cTrack.k_offroad_item_flag_invert)!=0;var by=(bH&cTrack.k_offroad_item_f3d_flag_just_invert_position)!=0;if(bc>bb){if(bG){var bz=bc;bc=bb;bb=bz;bz=bD;bD=bC;bC=bz;bz=ba;ba=a9;a9=bz;bz=bB;bB=bA;bA=bz}else{return}}else{if(bc<bb){if(bG){return}}}if((bb<0)||(bc>=GLLibConfig.screenWidth)){return}var bp=H(bd);var a8=s_textures[H(bd)];var bn=a8.GetCachedFrameImage((Q(bd)*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS),a7(bd));if(bn!=null){var bx=bb-bc;var bw=ba-a9;if((bx==0)||(bw==0)||((bx>0)&&(bw<0))||((bx<0)&&(bw>0))){return}g.drawYPerspective(bn.m_image,bc,bb,bD,bC,bB,bA)}else{if(s_debug_bSwitchUseF3DFog){s_textures[H(bd)].SetCurrentPalette((Q(bd)*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS)+s_iSegmentEnvironment*FOG_TEXTURE_PALETTES+X(bM-Game.k_segment_length))}else{s_textures[H(bd)].SetCurrentPalette((Q(bd)*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS)+s_iSegmentEnvironment*FOG_TEXTURE_PALETTES)}s_textures[H(bd)].DrawYPerspective(g,a7(bd),bc,bb,bD,bC,bB,bA,(by?ASprite.FLAG_FLIP_X:0))}}return}else{if((bm&(k_tri_flag_perspective_h))!=0){if(BuildConf.k_use_texture){if(bK<k_viewClip_F3D){return}if(bM<k_viewClip_F3D){bF=bk-bi;bq=bK-bM;bf=bu-bt;bl=bK-k_viewClip_F3D;bM=k_viewClip_F3D;bk=bi+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bu=bt+(LowAPI.Float2Int((((bf)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase)}bb=LowAPI.Float2Int((k_middle_region_x)+((bi*s_camFocale)/bK));bC=LowAPI.Float2Int(s_viewProjCenter-((bt*s_camFocale)/bK));ba=LowAPI.Float2Int((k_middle_region_x)+((bh*s_camFocale)/bJ));bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/bJ));bc=LowAPI.Float2Int((k_middle_region_x)+((bk*s_camFocale)/bM));bD=LowAPI.Float2Int(s_viewProjCenter-((bu*s_camFocale)/bM));a9=LowAPI.Float2Int((k_middle_region_x)+((bg*s_camFocale)/bM));bA=LowAPI.Float2Int(s_viewProjCenter-((bu*s_camFocale)/bM));var bG=(bH&cTrack.k_offroad_item_flag_invert)!=0;var by=(bH&cTrack.k_offroad_item_f3d_flag_just_invert_position)!=0;if(ba>bb){if(bG){var bz;bz=ba;ba=bb;bb=bz;bz=bB;bB=bC;bC=bz;bz=bc;bc=a9;a9=bz;bz=bD;bD=bA;bA=bz}else{return}}var a8=s_textures[H(bd)];var bn=a8.GetCachedFrameImage((Q(bd)*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS),a7(bd));if(bn!=null){bB-=3;bA-=3;g.drawXPerspective(bn.m_image,bB,bA,ba,bb,bc,a9)}else{var bj=(Q(bd)*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS)+s_iSegmentEnvironment*FOG_TEXTURE_PALETTES;s_textures[H(bd)].DrawXPerspective(g,a7(bd),bC,bD,ba,a9,bc,bb,0,bj+X(bM+Game.Game.k_segment_length),bj+X(bM))}}return}else{SetColor(bd);if(bM<(k_viewClip_F3D)&&bK<(k_viewClip_F3D)){bF=bk-bh;bE=bi-bh;bq=bM-bJ;bo=bK-bJ;bf=bu-bs;be=bt-bs;bl=k_viewClip_F3D-bJ;bk=bh+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bi=bh+(LowAPI.Float2Int((((bE)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bu=bs+(LowAPI.Float2Int((((bf)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bt=bs+(LowAPI.Float2Int((((be)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bM=k_viewClip_F3D;bK=k_viewClip_F3D}else{if(bK<(k_viewClip_F3D)&&bJ<(k_viewClip_F3D)){bF=bi-bk;bE=bh-bk;bq=bK-bM;bo=bJ-bM;bf=bt-bu;be=bs-bu;bl=k_viewClip_F3D-bM;bi=bk+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bh=bk+(LowAPI.Float2Int((((bE)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bt=bu+(LowAPI.Float2Int((((bf)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bs=bu+(LowAPI.Float2Int((((be)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bK=k_viewClip_F3D;bJ=k_viewClip_F3D}else{if(bM<(k_viewClip_F3D)&&bJ<(k_viewClip_F3D)){bF=bk-bi;bE=bh-bi;bq=bM-bK;bo=bJ-bK;bf=bu-bt;be=bs-bt;bl=k_viewClip_F3D-bK;bk=bi+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bh=bi+(LowAPI.Float2Int((((bE)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bu=bt+(LowAPI.Float2Int((((bf)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bs=bt+(LowAPI.Float2Int((((be)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bM=k_viewClip_F3D;bJ=k_viewClip_F3D}else{var bL,bI;if(bM<(k_viewClip_F3D)){bF=bi-bk;bE=bh-bk;bq=bK-bM;bo=bJ-bM;bf=bt-bu;be=bs-bu;bl=k_viewClip_F3D-bM;bL=bk;bI=bu;bk=bk+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bu=bu+(LowAPI.Float2Int((((bf)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bc=LowAPI.Float2Int((k_middle_region_x)+((bk*s_camFocale)/k_viewClip_F3D));bD=LowAPI.Float2Int(s_viewProjCenter-((bu*s_camFocale)/k_viewClip_F3D));bb=LowAPI.Float2Int((k_middle_region_x)+((bi*s_camFocale)/bK));bC=LowAPI.Float2Int(s_viewProjCenter-((bt*s_camFocale)/bK));ba=LowAPI.Float2Int((k_middle_region_x)+((bh*s_camFocale)/bJ));bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/bJ));ak(bc,bD,bb,bC,ba,bB);bb=ba;bC=bB;bh=bL+(LowAPI.Float2Int((((bE)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bs=bI+(LowAPI.Float2Int((((be)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);ba=LowAPI.Float2Int((k_middle_region_x)+((bh*s_camFocale)/k_viewClip_F3D));bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/k_viewClip_F3D));ak(bc,bD,bb,bC,ba,bB);return}else{if(bK<(k_viewClip_F3D)){bF=bk-bi;bE=bh-bi;bq=bM-bK;bo=bJ-bK;bf=bu-bt;be=bs-bt;bl=k_viewClip_F3D-bK;bL=bi;bI=bt;bi=bi+(LowAPI.Float2Int((((bE)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bt=bt+(LowAPI.Float2Int((((be)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bc=LowAPI.Float2Int((k_middle_region_x)+((bk*s_camFocale)/bM));bD=LowAPI.Float2Int(s_viewProjCenter-((bu*s_camFocale)/bM));bb=LowAPI.Float2Int((k_middle_region_x)+((bi*s_camFocale)/k_viewClip_F3D));bC=LowAPI.Float2Int(s_viewProjCenter-((bt*s_camFocale)/k_viewClip_F3D));ba=LowAPI.Float2Int((k_middle_region_x)+((bh*s_camFocale)/bJ));bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/bJ));ak(bc,bD,bb,bC,ba,bB);ba=bb;bB=bC;bi=bL+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bt=bI+(LowAPI.Float2Int((((bf)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bb=LowAPI.Float2Int((k_middle_region_x)+((bi*s_camFocale)/k_viewClip_F3D));bC=LowAPI.Float2Int(s_viewProjCenter-((bt*s_camFocale)/k_viewClip_F3D));ak(bc,bD,bb,bC,ba,bB);return}else{if(bJ<(k_viewClip_F3D)){bF=bk-bh;bE=bi-bh;bq=bM-bJ;bo=bK-bJ;bf=bu-bs;be=bt-bs;bl=k_viewClip_F3D-bJ;bL=bh;bI=bs;bh=bh+(LowAPI.Float2Int((((bF)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bs=bs+(LowAPI.Float2Int((((bf)<<GLLibConfig.math_fixedPointBase)/bq)*bl)>>GLLibConfig.math_fixedPointBase);bc=LowAPI.Float2Int((k_middle_region_x)+((bk*s_camFocale)/bM));bD=LowAPI.Float2Int(s_viewProjCenter-((bu*s_camFocale)/bM));bb=LowAPI.Float2Int((k_middle_region_x)+((bi*s_camFocale)/bK));bC=LowAPI.Float2Int(s_viewProjCenter-((bt*s_camFocale)/bK));ba=LowAPI.Float2Int((k_middle_region_x)+((bh*s_camFocale)/k_viewClip_F3D));bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/k_viewClip_F3D));ak(bc,bD,bb,bC,ba,bB);bc=ba;bD=bB;bh=bL+(LowAPI.Float2Int((((bE)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);bs=bI+(LowAPI.Float2Int((((be)<<GLLibConfig.math_fixedPointBase)/bo)*bl)>>GLLibConfig.math_fixedPointBase);ba=LowAPI.Float2Int((k_middle_region_x)+((bh*s_camFocale)/k_viewClip_F3D));bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/k_viewClip_F3D));ak(bc,bD,bb,bC,ba,bB);return}}}}}}bc=LowAPI.Float2Int((k_middle_region_x)+((bk*s_camFocale)/bM));bD=LowAPI.Float2Int(s_viewProjCenter-((bu*s_camFocale)/bM));bb=LowAPI.Float2Int((k_middle_region_x)+((bi*s_camFocale)/bK));bC=LowAPI.Float2Int(s_viewProjCenter-((bt*s_camFocale)/bK));ba=LowAPI.Float2Int((k_middle_region_x)+((bh*s_camFocale)/bJ));bB=LowAPI.Float2Int(s_viewProjCenter-((bs*s_camFocale)/bJ));ak(bc,bD,bb,bC,ba,bB);return}}}}function p(){var bf=Integer.MAX_VALUE;var bl=Integer.MIN_VALUE;var bg=-1;var bp=-1;for(var bi=0;bi<aP;bi++){if(A[bi]>bl){bl=A[bi];bp=bi}if(A[bi]<bf){bf=A[bi];bg=bi}}if(bl==bf){var bd=Integer.MAX_VALUE;var bk=Integer.MIN_VALUE;for(var bi=0;bi<aP;bi++){if(y[bi]>bk){bk=y[bi]}if(y[bi]<bd){bd=y[bi]}}DrawLine(bf,bd,bl,bk);return}var bh=LowAPI.Gen_Array([aP],0);var bn=LowAPI.Gen_Array([aP],0);var bo=0;var bm=LowAPI.Gen_Array([aP],0);var a8=LowAPI.Gen_Array([aP],0);var bj=0;bm[bj]=A[bg];a8[bj]=y[bg];bj++;bh[bo]=A[bg];bn[bo]=y[bg];bo++;var ba=Math_FixedPoint_Divide(Math_IntToFixedPoint(y[bp])-Math_IntToFixedPoint(y[bg]),Math_IntToFixedPoint(A[bp])-Math_IntToFixedPoint(A[bg]));var a9=Math_IntToFixedPoint(A[bg]);for(var bi=0;bi<aP;bi++){if((bi==bg)||(bi==bp)){continue}var bb=Math_FixedPoint_Multiply(Math_IntToFixedPoint(A[bi])-a9,ba)+Math_IntToFixedPoint(y[bg]);var be=Math_IntToFixedPoint(y[bi]);if(be<bb){bh[bo]=A[bi];bn[bo]=y[bi];bo++}if(be>bb){bm[bj]=A[bi];a8[bj]=y[bi];bj++}}bm[bj]=A[bp];a8[bj]=y[bp];bj++;bh[bo]=A[bp];bn[bo]=y[bp];bo++;var bq=false;var bc=false;if(bj==3){FillTriangle(bm[0],a8[0],bm[1],a8[1],bm[2],a8[2]);bq=true}if(bo==3){FillTriangle(bh[0],bn[0],bh[1],bn[1],bh[2],bn[2]);bc=true}if((!bq)&&(bj>3)){Y(bm,a8,1,bj-1);for(var bi=1;bi<bj-1;bi++){FillTriangle(bm[0],a8[0],bm[bi],a8[bi],bm[bi+1],a8[bi+1])}}if((!bc)&&(bo>3)){Y(bh,bn,1,bo-1);for(var bi=1;bi<bo-1;bi++){FillTriangle(bh[0],bn[0],bh[bi],bn[bi],bh[bi+1],bn[bi+1])}}}function Y(a9,bd,bc,a8){for(var bb=bc;bb<a8+bc;bb++){for(var ba=bb;ba>bc&&a9[ba-1]>a9[ba];ba--){a3(a9,ba,ba-1);a3(bd,ba,ba-1)}}}function a3(a9,ba,a8){var bb=a9[ba];a9[ba]=a9[a8];a9[a8]=bb}function m(ba,bh,a9,bg,a8,bf,bi,bd){if(a8==bi){var bc=(ba-a9)*(bf-bd);if(bc==0){return}var be=LowAPI.Float2Int((-(ba-a9)*a8*(bd-bf))/bc);var bb=LowAPI.Float2Int(((bf-bd)*(ba*bg-bh*a9)-(bh-bg)*a8*(bd-bf))/bc);if(be<Math_Min(ba,a9)||be>Math_Max(ba,a9)){return}if(be<Math_Min(a8,bi)||be>Math_Max(a8,bi)){return}if(bb<Math_Min(bh,bg)||bb>Math_Max(bh,bg)){return}if(bb<Math_Min(bf,bd)||bb>Math_Max(bf,bd)){return}A[aP]=be;y[aP]=bb;aP++;return}else{if(bf==bd){var bc=-(bh-bg)*(a8-bi);if(bc==0){return}var be=LowAPI.Float2Int(((a8-bi)*(ba*bg-bh*a9)-(ba-a9)*bf*(a8-bi))/bc);var bb=LowAPI.Float2Int((-(bh-bg)*bf*(a8-bi))/bc);if(be<Math_Min(ba,a9)||be>Math_Max(ba,a9)){return}if(be<Math_Min(a8,bi)||be>Math_Max(a8,bi)){return}if(bb<Math_Min(bh,bg)||bb>Math_Max(bh,bg)){return}if(bb<Math_Min(bf,bd)||bb>Math_Max(bf,bd)){return}A[aP]=be;y[aP]=bb;aP++;return}}}function t(ba,bc,a9,bb,a8,bd){return(a8-a9)*(bb-bc)-(bd-bb)*(a9-ba)}function ac(ba,bh,a9,bg,a8,be,bi,bf){var bd=t(ba,bh,a9,bg,bi,bf)<0;var bc=t(a9,bg,a8,be,bi,bf)<0;var bb=t(a8,be,ba,bh,bi,bf)<0;if(bd==bc&&bc==bb&&bb==bd){A[aP]=bi;y[aP]=bf;aP++}}function K(ba,bc,a9,bb,a8,bd){if((a8<bc)&&(a8>ba)&&(bd<bb)&&(bd>a9)){A[aP]=a8;y[aP]=bd;aP++}}function ak(ba,bj,a9,bi,a8,bh){var bf=GetClipY();var bb=bf+GetClipHeight();var bg=GetClipX();var bc=bg+GetClipWidth();var bk=Math_Min(bj,Math_Min(bi,bh));var bd=Math_Max(bj,Math_Max(bi,bh));var bl=Math_Min(ba,Math_Min(a9,a8));var be=Math_Max(ba,Math_Max(a9,a8));if(be<=bg){return}if(bl>=bc){return}if(bd<=bf){return}if(bk>=bb){return}aP=0;K(bg,bc,bf,bb,ba,bj);K(bg,bc,bf,bb,a9,bi);K(bg,bc,bf,bb,a8,bh);if(aP==3){FillTriangle(A[0],y[0],A[1],y[1],A[2],y[2]);return}m(ba,bj,a9,bi,bg,bf,bg,bb);m(ba,bj,a9,bi,bg,bb,bc,bb);m(ba,bj,a9,bi,bc,bb,bc,bf);m(ba,bj,a9,bi,bc,bf,bg,bf);m(a9,bi,a8,bh,bg,bf,bg,bb);m(a9,bi,a8,bh,bg,bb,bc,bb);m(a9,bi,a8,bh,bc,bb,bc,bf);m(a9,bi,a8,bh,bc,bf,bg,bf);m(a8,bh,ba,bj,bg,bf,bg,bb);m(a8,bh,ba,bj,bg,bb,bc,bb);m(a8,bh,ba,bj,bc,bb,bc,bf);m(a8,bh,ba,bj,bc,bf,bg,bf);ac(ba,bj,a9,bi,a8,bh,bg,bf);ac(ba,bj,a9,bi,a8,bh,bg,bb);ac(ba,bj,a9,bi,a8,bh,bc,bb);ac(ba,bj,a9,bi,a8,bh,bc,bf);if(aP==3){FillTriangle(A[0],y[0],A[1],y[1],A[2],y[2]);return}if(aP>3){p()}}function aC(){if(BuildConf.k_use_texture){s_texturePalettesToLoad=LowAPI.Gen_Array([DATA.TEXTURES_MAX],0)}if(BuildConf.k_use_textures_day_night){s_texturesPalettesInfo=LowAPI.Gen_Array([DATA.TEXTURES_MAX,k_texture_frames_max],0)}s_texturesFrameInfo=LowAPI.Gen_Array([DATA.TEXTURES_MAX,k_texture_frames_max],0);s_texturesAnimInfo=LowAPI.Gen_Array([DATA.TEXTURES_MAX,ar*v],0);for(var a9=0;a9<s_texturesAnimInfo.length;a9++){for(var a8=0;a8<s_texturesAnimInfo[a9].length;a8++){s_texturesAnimInfo[a9][a8]=-1}}if(BuildConf.k_use_textures_day_night){s_texturesPalettesAmount=LowAPI.Gen_Array([DATA.TEXTURES_MAX],0);for(var a9=0;a9<DATA.TEXTURES_MAX;a9++){for(var a8=0;a8<s_texturesPalettesInfo[a9].length;a8++){s_texturesPalettesInfo[a9][a8]=-1}}}s_camera_height=IDevice.k_camera_height;s_camera_distance=IDevice.k_camera_distance;s_camera_distance_offset=0;s_viewProjCenterBase=IDevice.k_view_proj_center;s_gameRegion_top=0;s_gameRegion_left=0;s_gameRegion_right=s_screenWidth;s_gameRegion_bottom=s_screenHeight}LowAPI.extendObject(ab,{ReadColorStream:aU,Load_trackData:O,Load_F3DObjects:aA,getTextureCommand:Z,getTextureSriteIndex:H,getTextureFrame:a7,getTexturePalette:Q,ARGB2Int:a0,RGB2Int:aq,Load_ReadF3DObject:a2,AddTextureAnimInfo:aF,AddTextureFrameInfo:an,Load_missionsData:e,Track_initData:aZ,initGridLine:b,AddTextureToLoad:ax,loadTexture:aY,buildTexture:a6,UnloadTexture:S,IsTextureNeedToLoad:U,resetCamera:ao,Track_resetCameraShake:ae,Track_setMinimumShakeAmplitude:aG,Track_startCameraShake:ai,Track_updateCamera:J,GetFogColor:d,GetFogTexturePalIndex:X,SetFogColor:aI,track_GetEnvFogColor:R,track_setF3dClip:aa,GetOffroadObjectFlag:f,GetOffroadObjectIndex:u,GetOffroadObjectType:ap,Track_initRoundEffect:aO,Track_getRoundHeightOffset:aD,Track_displaceTrackOffset:x,Track_update:k,Track_extractWorld:aB,getNextSeg:aw,AnimInfo2FrameInfo:r,bulletTime_Begin:al,bulletTime_End:au,cam_SetVertFollowData:aW,cam_SetDepthFollowData:ad,cam_updateFollow:ah,track_AppendTrackSectionsIfNeeded:aH,tutorial_DecideAndApplySubTrackToAppend:i,track_GetRandomTrackSection:a1,track_IndexTrackSections:aj,track_AddBifurcation:C,track_HasChangedEnvironment:aJ,track_SetNextEnvironment:h,Track_draw:aX,speedFXUpdate:aR,Track_GetBackgroundBaseY:av,Track_drawBackground:M,Track_drawTriangle:L,FillTriangleWrapper:ak,Track_InitVars:aC,},true)})(window);