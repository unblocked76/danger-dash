(function(H,l){var x=0;var i=-1;var b={};b.GFX_BG=0;b.GFX_PORTRAIT=b.GFX_BG+1;b.GFX_LOCK=b.GFX_PORTRAIT+1;b.TXT_NAME=b.GFX_LOCK+1;b.TXT_DESC=b.TXT_NAME+1;b.BTN_BUY=b.TXT_DESC+1;b.BTN_BUY_ARTIFACTS=b.BTN_BUY+1;b.BTN_BUY_DIAMONDS=b.BTN_BUY_ARTIFACTS+1;b.SIZE=b.BTN_BUY_DIAMONDS+1;var c=new cScrollMenu(0,0,0,0,0,0,0);var o=[0,0,0,0];var C=0;var B=0;var t=-1;var s=0;function G(){G.__superclass__.call(this,G.ID,arguments);this.setListenerStateMessage(GameState.MESSAGE_INIT,this.INIT);this.setListenerStateMessage(GameState.MESSAGE_UPDATE,this.UPDATE);this.setListenerStateMessage(GameState.MESSAGE_PAINT,this.PAINT);this.setListenerStateMessage(GameState.MESSAGE_EXIT,this.EXIT)}LowAPI.extendClass(G,GameState);G.ID=GameState.genID();G.prototype.INIT=function(){guiMgr_SetLayerActiveStateAll(false);guiMgr_ResetAllGUILayers();Input_Init();guiMgr_ActivateGUILayer(GUI_LAYER.CHARACTERS,true);StopSound(SOUND_MODE.MUSIC)};G.prototype.UPDATE=function(){guiMgr_processInputAllGuiLayers();guiMgr_updateLayers()};G.prototype.PAINT=function(){guiMgr_PaintGUILayers()};G.prototype.EXIT=function(){guiMgr_ActivateGUILayer(GUI_LAYER.CHARACTERS,false)};function f(){if(!s_arrivedUpgradesThroughtAP){GameState.scheduleSwitchState(GameState_MENUMAIN.ID,true,true);playSound(SOUND_TYPE.BACK_SFX,false);guiMgr_ActivateGUILayer(GUI_LAYER.CHARACTERS,false)}else{s_arrivedUpgradesThroughtAP=false;playSound(SOUND_TYPE.BACK_SFX,false);guiMgr_ActivateGUILayer(GUI_LAYER.CHARACTERS,false);if(s_arrivedUpgradesFromSuggestion){s_arrivedUpgradesFromSuggestion=false;GameState.scheduleSwitchState(GameState_RESULTITEMSUGGESTION.ID,true,true)}else{if(s_arrivedUpgradesFromRanking){s_arrivedUpgradesFromRanking=false;switchStateThroughLoading(STATE_RESULTRANKING,LOADING_DISPLAY_TYPE.NONE,"Going to relics results screen...")}else{GameState.scheduleSwitchState(GameState_RESULTEXPLOITS2.ID)}}}}_register_gui_message(GameData.k_gameMenuCharacters,a);function a(K,J){if(K==GUI_MESSAGE_INITIALIZE){s_playerLastPointerMode=INPUT_FLAG_PRESSED;gui_ResetAllLayerButtonsPressedState();guiMgr_SetLayerInputBlockState(guiMgr_GetGUILayerIndex(guiMgr_iCurrentLayerType),true);guiMgr_SetLayerPaintBlockState(guiMgr_GetGUILayerIndex(guiMgr_iCurrentLayerType),true);updateCurrencyHUD();SetButtonEnabled(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_btnCharacters,false);r();SetTextAreaString(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_txtTitle,getString(TEXT.MAIN_SCREEN_CHARACTERS));i=s_game_characterIndex;SetButtonVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_btnExit,true);SetButtonVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_btnAddCoins,!false);SetButtonVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_btncoins,!false);SetGraphItemVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_coin,!false);SetGraphItemVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_promo,false);var M=canBuyNumUpgrade();SetGraphItemVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_Upgradebg,M>0);SetTextAreaVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_Txt_upgradeValue,M>0);SetTextAreaString(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_Txt_upgradeValue,""+M);c.SetVelocity(0,0,0);F(i);c.SetScrollOffsetX(-(s_game_characterIndex*c.GetElemSpacingX(0)))}if(K==GUI_MESSAGE_UPDATE){h();var M=canBuyNumUpgrade();SetGraphItemVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_Upgradebg,M>0);SetTextAreaVisibility(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_Txt_upgradeValue,M>0);SetTextAreaString(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_Txt_upgradeValue,""+M);var L=c.GetElementAt(240-C,400-B)}if(K==GUI_MESSAGE_AFTER_PAINT){k(false);if(i>=0){if(i>0){PaintGraphItem(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_leftarrow,0,0)}if(i<3){PaintGraphItem(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_rightarrow,0,0)}}else{PaintGraphItem(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_leftarrow,0,100);PaintGraphItem(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_gfx_rightarrow,0,100)}}if(K==GUI_MESSAGE_INPUT_EVENT){switch(J){case GameData.k_MenuCharacters_btnExit:f();break;case GameData.k_MenuCharacters_btnUpgrades:GameState.scheduleSwitchState(GameState_UPGRADES.ID,true,true);guiMgr_ActivateGUILayer(GUI_LAYER.CHARACTERS,false);playSound(SOUND_TYPE.SELECT_SFX,false);break;case GameData.k_MenuCharacters_btnCollections:msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,"CHARACTERS/ Collections/ Not implemented yet!");break;case GameData.k_MenuCharacters_btnAddCoins:msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,"CHARACTERS/ AddCoins/ Not implemented yet!");break;case GameData.k_MenuCharacters_btncoins:msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,"CHARACTERS/ Coins/ Not implemented yet!");break;case GameData.k_MenuCharacters_btn_Diamonds:msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,"CHARACTERS/ Diamonds/ Not implemented yet!");break}}}function u(){var J=-1;J=s_arrayCharacters.length;c.SetElementCounter(J);return J}function v(J){ResetLayerData(GameData.k_gameCharactersScrollItem);ResizeLayerNumElems(GameData.k_gameCharactersScrollItem,GetNumLayerElements(GameData.k_gameCharactersScrollItem)+b.SIZE*(J-1));var M=0;var L=0;for(var K=0;K<J;++K){if(K!=0){CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.GFX_BG,K*b.SIZE+b.GFX_BG);CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.TXT_NAME,K*b.SIZE+b.TXT_NAME);CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.GFX_PORTRAIT,K*b.SIZE+b.GFX_PORTRAIT);CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.GFX_LOCK,K*b.SIZE+b.GFX_LOCK);CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.TXT_DESC,K*b.SIZE+b.TXT_DESC);CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.BTN_BUY,K*b.SIZE+b.BTN_BUY);CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS,K*b.SIZE+b.BTN_BUY_ARTIFACTS);CloneLayerElemData(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS,K*b.SIZE+b.BTN_BUY_DIAMONDS);M=GetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_BG,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_BG,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.GFX_BG,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.GFX_BG,GtsData.GUI_POSY,L+c.GetElementPosY(K));M=GetParamValue(GameData.k_gameCharactersScrollItem,b.TXT_NAME,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.TXT_NAME,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.TXT_NAME,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.TXT_NAME,GtsData.GUI_POSY,L+c.GetElementPosY(K));M=GetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_PORTRAIT,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_PORTRAIT,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.GFX_PORTRAIT,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.GFX_PORTRAIT,GtsData.GUI_POSY,L+c.GetElementPosY(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.GFX_PORTRAIT,GtsData.GUI_GRAPHITEM_PALETTE,0);M=GetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_LOCK,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_LOCK,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.GFX_LOCK,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.GFX_LOCK,GtsData.GUI_POSY,L+c.GetElementPosY(K));M=GetParamValue(GameData.k_gameCharactersScrollItem,b.TXT_DESC,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.TXT_DESC,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.TXT_DESC,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.TXT_DESC,GtsData.GUI_POSY,L+c.GetElementPosY(K));M=GetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.BTN_BUY,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.BTN_BUY,GtsData.GUI_POSY,L+c.GetElementPosY(K));M=GetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.BTN_BUY_ARTIFACTS,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.BTN_BUY_ARTIFACTS,GtsData.GUI_POSY,L+c.GetElementPosY(K));M=GetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS,GtsData.GUI_POSX);L=GetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS,GtsData.GUI_POSY);SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.BTN_BUY_DIAMONDS,GtsData.GUI_POSX,M+c.GetElementPosX(K));SetParamValue(GameData.k_gameCharactersScrollItem,K*b.SIZE+b.BTN_BUY_DIAMONDS,GtsData.GUI_POSY,L+c.GetElementPosY(K))}p(K)}}function p(J){SetTextAreaString(GameData.k_gameCharactersScrollItem,b.TXT_NAME+J*b.SIZE,getString(TEXT.MAIN_CHARACTER_NAME_00+J));SetParamValue(GameData.k_gameCharactersScrollItem,J*b.SIZE+b.GFX_PORTRAIT,GtsData.GUI_GRAPHITEM_SPRITEID,DATA.SPRITE_DATA_PORTRAIT_00+J);if(d(J)){SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,true);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS+J*b.SIZE,false);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS+J*b.SIZE,false);SetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_PORTRAIT+J*b.SIZE,GtsData.GUI_GRAPHITEM_PALETTE,0);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_PALETTEPRESSED,1);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_OVERSPRITEID,-1);if(s_game_characterIndex==J){SetButtonText(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,getString(TEXT.MAIN_CHARACTER_ACTIVE));SetButtonEnabled(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,false);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_PALETTE,2);SetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_LOCK+J*b.SIZE,GtsData.GUI_GRAPHITEM_VISIBLE,0)}else{SetButtonText(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,getString(TEXT.MAIN_SHOP_SELECT));SetButtonEnabled(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,true);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_PALETTE,0);SetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_LOCK+J*b.SIZE,GtsData.GUI_GRAPHITEM_VISIBLE,0)}}else{SetButtonEnabled(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,true);if(w(J)){SetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_PORTRAIT+J*b.SIZE,GtsData.GUI_GRAPHITEM_PALETTE,1);if(J==1){SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,false);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS+J*b.SIZE,true);SetButtonText(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS+J*b.SIZE,""+GameVars_GetRecordValue(RMS_RECORD_ARTIFACTS+J-1)+"/"+j(J));SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS+J*b.SIZE,true);SetButtonText(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS+J*b.SIZE,""+text_GetFormatNumber(s_arrayTweaks[ITweaks.CHARACTER_COST_00+J][0]))}else{SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,true);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS+J*b.SIZE,false);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS+J*b.SIZE,false);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_OVERSPRITEID,DATA.SPRITE_DATA_ICONS_COLLECTABLE);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_PALETTE,5);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_PALETTEPRESSED,8);SetButtonText(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,""+text_GetFormatNumber(s_arrayTweaks[ITweaks.CHARACTER_COST_00+J][0]))}SetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_LOCK+J*b.SIZE,GtsData.GUI_GRAPHITEM_VISIBLE,1)}else{SetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_PORTRAIT+J*b.SIZE,GtsData.GUI_GRAPHITEM_PALETTE,0);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,true);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_ARTIFACTS+J*b.SIZE,false);SetButtonVisibility(GameData.k_gameCharactersScrollItem,b.BTN_BUY_DIAMONDS+J*b.SIZE,false);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_PALETTEPRESSED,1);SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_OVERSPRITEID,-1);SetButtonText(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,getString(TEXT.MAIN_CHARACTER_UNLOCK));SetParamValue(GameData.k_gameCharactersScrollItem,b.BTN_BUY+J*b.SIZE,GtsData.GUI_BUTTON_PALETTE,0);SetParamValue(GameData.k_gameCharactersScrollItem,b.GFX_LOCK+J*b.SIZE,GtsData.GUI_GRAPHITEM_VISIBLE,1)}}s_aArgumentStringArr[0]=""+s_arrayTweaks[ITweaks.CHARACTER_00_BONUS+J][0];SetTextAreaString(GameData.k_gameCharactersScrollItem,b.TXT_DESC+J*b.SIZE,getFormattedString(getString(TEXT.MAIN_CHARACTER_DESC_00+J),s_aArgumentStringArr,"#"))}function r(){GetRectAreaRect(s_gui_outRect,GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_rectScroll);var L=s_gui_outRect[2]-s_gui_outRect[0];var K=s_gui_outRect[3]-s_gui_outRect[1];c.Reset();c.SetRowLength(1);c.SetDirection(cScrollMenu.SCROLL_DIRECTION_HORIZONTAL);c.SetWindowWidth(GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_SCROLLDATA_WIDTH));c.SetWindowHeight(GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_SCROLLDATA_HEIGHT));var J=u();c.SetElemWidth(L+1);c.SetElemHeight(K+1);c.SetElemSpacingX(GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_SCROLLDATA_ELEMVERTSPACING)+L);c.SetElemSpacingY(K);v(J);c.SetLockStateX(false);c.SetLockStateY(true);C=s_gui_outRect[0];B=s_gui_outRect[1];o[0]=GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_POSX)+GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_SCROLLDATA_POSX);o[1]=GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_POSY)+GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_SCROLLDATA_POSY);o[2]=GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_SCROLLDATA_WIDTH);o[3]=GetParamValue(GameData.k_gameMenuCharacters,GameData.k_MenuCharacters_ScrollData,GtsData.GUI_SCROLLDATA_HEIGHT);c.Reset();t=-1;s=0}function h(){c.Update(s_game_frameDT);var J=Input_GetPointerPosX_SYNC();var R=Input_GetPointerPosY_SYNC();if(isPointInRectWH(J,R,o)){if(Input_IsPointerDragged_SYNC()){c.ApplyDisplacement(Input_GetDragOffsetX_SYNC(),Input_GetDragOffsetY_SYNC());if(((Input_GetDraggedPosX_SYNC()-Input_GetPressedPosX_SYNC())<0?-(Input_GetDraggedPosX_SYNC()-Input_GetPressedPosX_SYNC()):(Input_GetDraggedPosX_SYNC()-Input_GetPressedPosX_SYNC()))>SCROLL_ALLOWINPUTDRAG_THRESHOLD){s_bAllowInputInScroll=false}}if(Input_IsPointerPressed_SYNC()){s_bAllowInputInScroll=true}if(Input_CheckState_SYNC(INPUT_FLAG_DRAGGED|INPUT_FLAG_PRESSED)){if(Input_CheckState_SYNC(INPUT_FLAG_DRAGGED)&&s_playerLastPointerMode==INPUT_FLAG_PRESSED&&((Input_GetDragOffsetX_SYNC())<0?-(Input_GetDragOffsetX_SYNC()):(Input_GetDragOffsetX_SYNC()))>2){playSound(SOUND_TYPE.PLAYER_SIDE_MOVE_SFX,false);s_playerLastPointerMode=INPUT_FLAG_DRAGGED}else{if(Input_CheckState_SYNC(INPUT_FLAG_PRESSED)){s_playerLastPointerMode=INPUT_FLAG_PRESSED}}var K=c.GetElementAt(Input_GetPointerPosX_SYNC()-C,Input_GetPointerPosY_SYNC()-B);i=K;if((K>=0)){t=K;if(!s_bAllowInputInScroll){z(0,10000,10000,INPUT_FLAG_RELEASED)}else{z(K,0,0,INPUT_FLAG_RELEASED)}}}if(Input_CheckState_SYNC(INPUT_FLAG_RELEASED)){c.SetVelocity(Input_GetDragOffsetX_SYNC(),Input_GetDragOffsetY_SYNC(),4);var K=c.GetElementAt(240-C,400-B);game_Update_CheckInputHorizontallyAndVertically(s_arrayTweaks[ITweaks.MIN_SLIDE_TIME_GUI][0]);if(s_lastPlayerAction==PLAYER_ACTION.DRAG_LEFT){if(i<3){i++}}else{if(s_lastPlayerAction==PLAYER_ACTION.DRAG_RIGHT){if(i>0){i--}}else{i=K;if((K>=0)){s=K;if(!s_bAllowInputInScroll){z(0,10000,10000,INPUT_FLAG_RELEASED)}else{z(K,0,0,INPUT_FLAG_RELEASED)}}else{K=s}var M=c.GetElementPosX(K);var L=c.GetElementPosY(K);var O=-(M-c.m_scrollMenu_offsetX);var N=-(L-c.m_scrollMenu_offsetY);var Q=(O-c.m_scrollMenu_offsetX)/2;var P=0;c.SetVelocity(Q,P,4);t=-1}}game_ResetPlayerAction()}if(!Input_CheckState_SYNC(INPUT_FLAG_DRAGGED|INPUT_FLAG_PRESSED)){F(i);t=-1}}else{F(i);t=-1}}function F(Q){var N=Q;var M=c.GetElementPosX(N);var L=c.GetElementPosY(N);var K=-(M-c.m_scrollMenu_offsetX);var J=-(L-c.m_scrollMenu_offsetY);var P=(K-c.m_scrollMenu_offsetX);var O=0;c.SetVelocity(P,O,4)}function z(L,J,M,K){scroll_doElementClick(c,GameData.k_gameCharactersScrollItem,L,J,M,K)}function E(){var J=c.GetScrollOffsetX();var K=c.GetScrollOffsetY();PaintAllVisibleItems(GameData.k_gameCharactersScrollItem,J,K)}function k(K){gui_SetClip(o[0],o[1],o[2],o[3]);var J=0;var L=0;E();gui_RestoreClip();c.Paint(g,C,B);if(K){c.PaintScrollBar(g,SCROLLBAR_BACK,SCROLLBAR_FRONT,(o[0]+o[2]-1),o[1],7,o[3],o[2],o[3])}}function A(){var J=0;for(var K=0;K<s_arrayCharacters.length;K++){if(d(K)){J++}}return J}function d(K){var J=false;if(K==0){J=true}else{J=(GameVars_GetRecordValue(RMS_RECORD_CHARACTER_00+K)==1)}return J}function w(K){if(K==0){return false}else{if(d(K)){return false}else{if(K==1){var L=K-1;var J=(GameVars_GetRecordValue(RMS_RECORD_ARTIFACTS+L)>=j(K));return !J}else{return true}}}}function q(J){var K=s_game_characterIndex;GameVars_SetRecordValue(RMS_RECORD_CURRENT_CHARACTER,J,true);s_game_characterIndex=J;if(GameState.getCurrentState().ID==G.ID){p(K);p(J)}}function e(J){var K=A();Achievements_SetAchievementValue(IExploit.EX_T_ALL_CHARACTERS,K);CurrentExploits_SetExploitValue(IExploit.EX_T_ALL_CHARACTERS,K);GameVars_SetRecordValue(RMS_RECORD_CHARACTER_00+J,1,true);q(J)}function j(K){if(K==0){return 0}var J=K-1;return s_arrayArtifacts[J][isPremium()?IArtifact.PREMIUM_UNLOCK:IArtifact.UNLOCK]}function D(K,J){var L=s_arrayTweaks[ITweaks.CHARACTER_COST_00+K][0];x=K;if(J){msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,getString(TEXT.MAIN_NOT_ENOUGH_ARTIFACTS,IDefine.INDEX_MAIN))}else{s_msgBoxCostText=(getString(TEXT.MAIN_COST))+" "+text_GetFormatNumber(L);s_MsgBox_BUY_NO_Btn_Buy_currency=IAPMGR_COINS;I(K)}}function I(J){var L=s_arrayTweaks[ITweaks.CHARACTER_COST_00+J][0];if(DecodeInt(s_systemCoins)>=L){var K=s_arrayTweaks[ITweaks.CHARACTER_COST_00+J][0];s_systemCoins=EncodeInt(DecodeInt(s_systemCoins)-L);y(J);GameVars_SaveAll()}else{upgrades_ShowNotEnough(IAPMGR_COINS,L)}}function y(K){var J=K-1;var L=s_arrayTweaks[ITweaks.CHARACTER_COST_00+K][0];if(K==1){GameVars_SetRecordValue(RMS_RECORD_ARTIFACTS+J,j(K),false)}updateCurrencyHUD();if(K<2){CurrentExploits_SetExploitValue(IExploit.EX_T_GET_ARTIFACT,j(K));Achievements_SetAchievementValue(IExploit.EX_T_GET_ARTIFACT,j(K))}playSound(SOUND_TYPE.BUY_SFX,false);if(GameState.getCurrentState().ID==G.ID){p(K)}e(K)}function m(J){switch(J%b.SIZE){case GameData.k_CharactersScrollItem_btnBuyArtifacts:playSound(SOUND_TYPE.SELECT_SFX,false);D(i,true);break;case GameData.k_CharactersScrollItem_btnBuyDiamonds:playSound(SOUND_TYPE.SELECT_SFX,false);D(i,false);break;case GameData.k_CharactersScrollItem_btnBuy:if(i>-1){n(i)}break}}function n(J){if(w(J)){playSound(SOUND_TYPE.SELECT_SFX,false);D(J,false)}else{if(!d(J)){playSound(SOUND_TYPE.SELECT_SFX,false);e(J)}else{if(s_game_characterIndex!=J){q(J);playSound(SOUND_TYPE.SELECT_SFX,false)}}}}LowAPI.extendObject(H,{GameState_CHARACTERS:G,PlayerCharacters_ProcessItemClick:m,Characters_IsCharacterLocked:w,Characters_IsCharacterBought:d,Characters_NumberOfCharactersBought:A,buyCharacter:n,Characters_DoBuyCharacter:y,},true)})(window);