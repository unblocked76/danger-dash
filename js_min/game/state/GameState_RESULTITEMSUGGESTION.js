(function(e,b){var j={};j.INVALID=-1;j.UPGRADE=0;j.CHARACTER=1;var k=-1;var l=[-1,-1,-1];function d(){d.__superclass__.call(this,d.ID,arguments);this.setListenerStateMessage(GameState.MESSAGE_INIT,this.INIT);this.setListenerStateMessage(GameState.MESSAGE_UPDATE,this.UPDATE);this.setListenerStateMessage(GameState.MESSAGE_PAINT,this.PAINT);this.setListenerStateMessage(GameState.MESSAGE_EXIT,this.EXIT);this.setListenerStateMessage(GameState.MESSAGE_NAV_SHOP,this.MESSAGE_NAV_SHOP);this.setListenerStateMessage(GameState.MESSAGE_NAV_HOME,this.MESSAGE_NAV_HOME);this.setListenerStateMessage(GameState.MESSAGE_NAV_NEXT,this.MESSAGE_NAV_NEXT)}LowAPI.extendClass(d,GameState);d.ID=GameState.genID();d.prototype.INIT=function(){guiMgr_SetLayerActiveStateAll(false);guiMgr_ResetAllGUILayers();Input_Init();guiMgr_ActivateGUILayer(GUI_LAYER.RESULTS_TOP,true);SetTextAreaString(GameData.k_gameResults_Top,GameData.k_Results_Top_txt_bgbar,getString(TEXT.MAIN_DEBRIEFING_QUICKTIP));f();h();StopSound(SOUND_MODE.MUSIC)};d.prototype.UPDATE=function(){guiMgr_processInputAllGuiLayers();guiMgr_updateLayers()};d.prototype.PAINT=function(){guiMgr_PaintGUILayers()};d.prototype.EXIT=function(){guiMgr_ActivateGUILayer(GUI_LAYER.RESULTS_TOP,false);guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_POWER_SUBMENU,false);guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_CHARACTER_SUBMENU,false);s_showCantGoBack=false;s_showCantGoBack_Time=0};d.prototype.MESSAGE_NAV_SHOP=function(){StopAllSound();GameState.scheduleSwitchState(GameState_UPGRADES.ID,true,true);s_arrivedUpgradesThroughtAP=true;s_arrivedUpgradesFromSuggestion=true;playSound(SOUND_TYPE.SELECT_SFX,false)};d.prototype.MESSAGE_NAV_HOME=function(){playSound(SOUND_TYPE.SELECT_SFX,false);GameState.scheduleSwitchState(GameState_MENUMAIN.ID,true,true)};d.prototype.MESSAGE_NAV_NEXT=function(){playSound(cGame.SOUND_TYPE.SELECT_SFX,false);GameState.scheduleSwitchState(d.ID,true,true)};d.prototype.MESSAGE_BUY_ITEM=function(){h()};function h(){if(k==j.UPGRADE){guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_POWER_SUBMENU,true);guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_CHARACTER_SUBMENU,false);SetTextAreaVisibility(GameData.k_gameResults_Top,GameData.k_Results_Top_txt_allBought,false)}else{if(k==j.CHARACTER){guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_POWER_SUBMENU,false);guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_CHARACTER_SUBMENU,true);SetTextAreaVisibility(GameData.k_gameResults_Top,GameData.k_Results_Top_txt_allBought,false)}else{guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_POWER_SUBMENU,false);guiMgr_ActivateGUILayer(GUI_LAYER.UPGRADE_CHARACTER_SUBMENU,false);SetTextAreaVisibility(GameData.k_gameResults_Top,GameData.k_Results_Top_txt_allBought,true)}}}function f(){var p=c();var r=o();var q=-1;if(p==-1){if(r!=-1){q=j.CHARACTER}}else{if(r==-1){q=j.UPGRADE}else{q=((Math_Rand(0,2)==0)?j.UPGRADE:j.CHARACTER)}}if(q==j.UPGRADE){k=j.UPGRADE;l[0]=p}else{if(q==j.CHARACTER){k=j.CHARACTER;l[0]=r}else{k=-1;l[0]=-1}}}function c(){var q=-1;var s=-1;var t=0;var p=LowAPI.Gen_Array([s_arrayUpgrades.length],0);for(var r=0;r<s_arrayUpgrades.length;r++){if(!PlayerUpgrades_IsUpgradeMaxed(r)){p[t]=r;t++}}if(t>0){s=Math_Rand(0,t);q=p[s]}l[1]=-1;l[2]=-1;for(var u=1;u<3;u++){if(t>1){t--;for(var r=s;r<t;r++){p[r]=p[r+1]}s=Math_Rand(0,t);l[u]=p[s]}}return q}function o(){var q=-1;var s=0;var p=LowAPI.Gen_Array([s_arrayCharacters.length],0);for(var r=0;r<s_arrayCharacters.length;r++){if(!Characters_IsCharacterBought(r)){p[s]=r;s++}}if(s>0){q=p[Math_Rand(0,s)]}return q}var a=0;var n=GameData.k_Upgrade_Power_Submenu_gfxBg01-GameData.k_Upgrade_Power_Submenu_gfxBg00;_register_gui_message(GameData.k_gameUpgrade_Power_Submenu,m);function m(r,p){if(r==GUI_MESSAGE_INITIALIZE){for(var q=0;q<3;q++){g(q)}}if(r==GUI_MESSAGE_UPDATE){}if(r==GUI_MESSAGE_AFTER_PAINT){}if(r==GUI_MESSAGE_INPUT_EVENT){switch(p){case GameData.k_Upgrade_Power_Submenu_btnBuy00:if(!PlayerUpgrades_IsUpgradeMaxed(l[0])){a=0;PlayerUpgrades_BuyUpgrade(l[0]);g(0);GameState.getCurrentState().handleMessage(GameState.MESSAGE_BUY_ITEM)}break;case GameData.k_Upgrade_Power_Submenu_btnBuy01:if(!PlayerUpgrades_IsUpgradeMaxed(l[1])){a=1;PlayerUpgrades_BuyUpgrade(l[1]);g(1);GameState.getCurrentState().handleMessage(GameState.MESSAGE_BUY_ITEM)}break;case GameData.k_Upgrade_Power_Submenu_btnBuy02:if(!PlayerUpgrades_IsUpgradeMaxed(l[2])){a=2;PlayerUpgrades_BuyUpgrade(l[2]);g(2);GameState.getCurrentState().handleMessage(GameState.MESSAGE_BUY_ITEM)}break}}}function g(p){if(l[p]==-1){SetGraphItemVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxBg00+(p*n),false);SetTextAreaVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_txtName00+(p*n),false);SetGraphItemVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxProgress00+(p*n),false);SetGraphItemVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxIcon00+(p*n),false);SetButtonVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_btnBuy00+(p*n),false);SetTextAreaVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_txtPrice00+(p*n),false);SetGraphItemVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxPrice00+(p*n),false)}else{SetParamValue(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxIcon00+(p*n),GtsData.GUI_GRAPHITEM_FRAMEID,l[p]);SetTextAreaString(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_txtName00+(p*n),getString(TEXT.MAIN_UPGRADE_NAME_ANKH+l[p]));if(upgrade_needsPremiumCurrency(l[p])){SetParamValue(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxPrice00+(p*n),GtsData.GUI_GRAPHITEM_FRAMEID,ICONS_COLLECTABLE.FRAME_DIAMOND_ICON_SMALL)}else{SetParamValue(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxPrice00+(p*n),GtsData.GUI_GRAPHITEM_FRAMEID,ICONS_COLLECTABLE.FRAME_COIN_BUTTONS)}if(PlayerUpgrades_IsUpgradeMaxed(l[p])){SetTextAreaVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_txtPrice00+(p*n),false);SetGraphItemVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxPrice00+(p*n),false);SetButtonEnabled(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_btnBuy00+(p*n),false);SetButtonText(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_btnBuy00+(p*n),getString(TEXT.MAIN_BUTTON_MAX))}else{SetTextAreaVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_txtPrice00+(p*n),true);SetGraphItemVisibility(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxPrice00+(p*n),true);SetTextAreaString(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_txtPrice00+(p*n),""+text_GetFormatNumber(s_arrayUpgrades[l[p]][s_upgradeLevel[l[p]]+1][(isPremium()?IUpgrade.PREMIUM_COST:IUpgrade.COST)]));SetButtonEnabled(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_btnBuy00+(p*n),true)}SetParamValue(GameData.k_gameUpgrade_Power_Submenu,GameData.k_Upgrade_Power_Submenu_gfxProgress00+(p*n),GtsData.GUI_GRAPHITEM_FRAMEID,UI.FRAME_ITEM_GAUGE_0+s_upgradeLevel[l[p]]+1)}}_register_gui_message(GameData.k_gameUpgrade_Character_Submenu,i);function i(q,p){if(q==GUI_MESSAGE_INITIALIZE){SetTextAreaString(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_txtName,getString(TEXT.MAIN_CHARACTER_NAME_00+l[0]));SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_gfxPortrait,GtsData.GUI_GRAPHITEM_SPRITEID,DATA.SPRITE_DATA_SM_PORTRAIT_01+(l[0]-1));if(Characters_IsCharacterBought(l[0])){if(s_game_characterIndex==l[0]){SetButtonText(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,getString(TEXT.MAIN_CHARACTER_ACTIVE));SetButtonEnabled(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,false);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_PALETTE,2);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_OVERSPRITEID,-1)}else{SetButtonText(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,getString(TEXT.MAIN_SHOP_SELECT));SetButtonEnabled(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,true);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_PALETTE,0);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_OVERSPRITEID,-1)}}else{SetButtonEnabled(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,true);if(Characters_IsCharacterLocked(l[0])){SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_gfxPortrait,GtsData.GUI_GRAPHITEM_PALETTE,1);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_OVERSPRITEID,DATA.SPRITE_DATA_ICONS_COLLECTABLE);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_PALETTE,5);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_PALETTEPRESSED,8);SetButtonText(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,""+text_GetFormatNumber(s_arrayTweaks[ITweaks.CHARACTER_COST_00+l[0]][0]))}}s_aArgumentStringArr[0]=""+s_arrayTweaks[ITweaks.CHARACTER_00_BONUS+l[0]][0];SetTextAreaString(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_txtDesc,getFormattedString(getString(TEXT.MAIN_CHARACTER_DESC_00+l[0]),s_aArgumentStringArr,"#"))}if(q==GUI_MESSAGE_UPDATE){if(Characters_IsCharacterBought(l[0])){if(s_game_characterIndex==l[0]){SetButtonText(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,getString(TEXT.MAIN_CHARACTER_ACTIVE));SetButtonEnabled(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,false);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_PALETTE,2);SetParamValue(GameData.k_gameUpgrade_Character_Submenu,GameData.k_Upgrade_Character_Submenu_btnBuy,GtsData.GUI_BUTTON_OVERSPRITEID,-1)}}}if(q==GUI_MESSAGE_AFTER_PAINT){}if(q==GUI_MESSAGE_INPUT_EVENT){switch(p){case GameData.k_Upgrade_Character_Submenu_btnBuy:buyCharacter(l[0]);GloftJDMP.s_game.handleMessage(GameState.MESSAGE_BUY_ITEM);break}}}LowAPI.extendObject(e,{GameState_RESULTITEMSUGGESTION:d,},true)})(window);