(function(K,x){function R(){R.__superclass__.call(this,R.ID,arguments);this.setListenerStateMessage(GameState.MESSAGE_INIT,this.INIT);this.setListenerStateMessage(GameState.MESSAGE_UPDATE,this.UPDATE);this.setListenerStateMessage(GameState.MESSAGE_PAINT,this.PAINT);this.setListenerStateMessage(GameState.MESSAGE_EXIT,this.EXIT)}LowAPI.extendClass(R,GameState);R.ID=GameState.genID();var n=1;var T=2;var w=3;var s=-1;var af=10;var v;R.prototype.INIT=function(){s=-1;gui_ResetAllLayerButtonsPressedState();guiMgr_SetLayerInputBlockState(guiMgr_GetGUILayerIndex(guiMgr_iCurrentLayerType),true);guiMgr_SetLayerPaintBlockState(guiMgr_GetGUILayerIndex(guiMgr_iCurrentLayerType),true);L();guiMgr_SetLayerActiveStateAll(false);guiMgr_ResetAllGUILayers();Input_Init();guiMgr_ActivateGUILayer(GUI_LAYER.LEADERBOARDS,true);StopSound(SOUND_MODE.MUSIC)};R.prototype.UPDATE=function(){fbm_Update();if(s!=-1&&fbm_state==FBM_STATE_END){s=-1;if(oss_GetFacebookState()>0){SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_GetCoins,false);SetGraphItemVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_Gfx_coins,false);SetTextAreaVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_Txt_coins,false);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_Login,true);SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_Login,getString(TEXT.MAIN_FB_INVITE_BUTTON));an=k.MODE_ONLINE;SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,online_isOnlineEnabled());au();O(ae.STATE_START_GET_LEADERBOARD)}}aq();guiMgr_processInputAllGuiLayers();guiMgr_updateLayers()};R.prototype.PAINT=function(){guiMgr_PaintGUILayers()};R.prototype.EXIT=function(){guiMgr_ActivateGUILayer(GUI_LAYER.LEADERBOARDS,false)};function ah(){if(s!=-1&&fbm_state!=FBM_STATE_END){fbm_Exit()}else{GameState.scheduleSwitchState(GameState_MENUMAIN.ID,true,true);guiMgr_ActivateGUILayer(GUI_LAYER.LEADERBOARDS,false);playSound(SOUND_TYPE.BACK_SFX,false)}}var ap="jungle_scores_des";var k={};k.LEADER_RANK=0;k.LEADER_SCORE=k.LEADER_RANK+1;k.LEADER_CHARACTER=k.LEADER_SCORE+1;k.LEADER_NUM_FIELDS=k.LEADER_CHARACTER+1;k.MODE_OFFLINE=0;k.MODE_ONLINE=1;k.PERIOD_TOTAL=0;k.PERIOD_WEEK=1;k.PERIOD_DAY=2;k.DATA_SCORE=0;k.DATA_DISTANCE=1;k.IMG_PENDING=0;k.IMG_READY=1;k.IMG_UNAVAILABLE=-1;k.ALL_TIME=0;k.ME=1;k.FRIENDS=2;var b=["A01","A02","A03","A04","A05","A06","A07","A08","A09"];var t=[[1,10000,0],[2,1000,1],[3,100,2],[4,10,3],[5,9,0],[6,8,0],[7,7,0],[8,6,0],[9,5,0]];var U=5;var am=-1;var A=["","","","","","","","",""];var aa=[0,0,0,0,0,0,0,0,0];var F=0;var B=null;var J=false;var X=0;var an=k.MODE_OFFLINE;var ak=k.PERIOD_TOTAL;var at=k.DATA_SCORE;var ag="";var m=false;var ao=false;var l=0;var ai=0;var H=-1;var e="char";var C=15000;_register_gui_message(GameData.k_gameLeaderboards,j);function j(aA,ay){if(aA==GUI_MESSAGE_INITIALIZE){s_playerLastPointerMode=INPUT_FLAG_PRESSED;H=-1;gui_ResetAllLayerButtonsPressedState();guiMgr_SetLayerInputBlockState(guiMgr_GetGUILayerIndex(guiMgr_iCurrentLayerType),true);guiMgr_SetLayerPaintBlockState(guiMgr_GetGUILayerIndex(guiMgr_iCurrentLayerType),true);an=k.MODE_OFFLINE;if(online_isOnlineEnabled()){an=k.MODE_ONLINE}p();r();L();Z(false);au();var ax=false;if(an==k.MODE_OFFLINE){ax=false;ai=k.ALL_TIME}else{var az=h();ax=az;if(!az){SetTextAreaString(GameData.k_gameLeaderboards,GameData.k_Leaderboards_txtOffline,getString(TEXT.MAIN_LEADERBOARD_ALL_TIME))}}SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,ax);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,online_isOnlineEnabled());if(!ax){SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,GtsData.GUI_BUTTON_PALETTE,10);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,GtsData.GUI_BUTTON_PALETTEPRESSED,11);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,GtsData.GUI_BUTTON_PALETTE,10);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,GtsData.GUI_BUTTON_PALETTEPRESSED,11);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,GtsData.GUI_BUTTON_PALETTE,10);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,GtsData.GUI_BUTTON_PALETTEPRESSED,11)}P();O(ae.STATE_START_GET_LEADERBOARD)}if(aA==GUI_MESSAGE_UPDATE){ad()}if(aA==GUI_MESSAGE_AFTER_PAINT){M(true);var aw=am;if((aw==-1)&&(ai==k.ALL_TIME)){aw=U}if((aw!=-1)&&(aw<N.GetElementCounter())){var aC=N.GetElementPosY(aw,true);var aB=GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_HEIGHT)-N.GetElemHeight(aw);if(aC<0){aC=0}if(aC>aB){aC=aB}PaintAllVisibleItems(GameData.k_gameLeaderboardsScrollItem_Player,0,aC)}}if(aA==GUI_MESSAGE_INPUT_EVENT){switch(ay){case GameData.k_Leaderboards_btnExit:ah();break;case GameData.k_Leaderboards_btnPeriod:playSound(SOUND_TYPE.SELECT_SFX,false);if(ai==k.FRIENDS){SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,getString(TEXT.MAIN_LEADERBOARD_ALL_TIME));ai=k.ALL_TIME}else{if(ai==k.ALL_TIME){SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,getString(TEXT.MAIN_LEADERBOARD_ME));ai=k.ME}else{SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,getString(TEXT.MAIN_LEADERBOARD_FRIENDS));ai=k.FRIENDS}}O(ae.STATE_START_GET_LEADERBOARD);break;case GameData.k_Leaderboards_btnTop:playSound(SOUND_TYPE.SELECT_SFX,false);if(h()){q();O(ae.STATE_START_GET_LEADERBOARD)}else{msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,getString(TEXT.MAIN_LOGIN_TO_SEE_LEADERBOARD))}break;case GameData.k_Leaderboards_btnMe:playSound(SOUND_TYPE.SELECT_SFX,false);if(h()){au();O(ae.STATE_START_GET_LEADERBOARD)}else{msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,getString(TEXT.MAIN_LOGIN_TO_SEE_LEADERBOARD))}break;case GameData.k_Leaderboards_btnFriends:playSound(SOUND_TYPE.SELECT_SFX,false);if(h()){I();O(ae.STATE_START_GET_LEADERBOARD)}else{msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,getString(TEXT.MAIN_LOGIN_TO_SEE_LEADERBOARD))}break;case GameData.k_Leaderboards_BtnFacebook_Login:case GameData.k_Leaderboards_BtnFacebook_GetCoins:playSound(SOUND_TYPE.SELECT_SFX,false);fbm_Reset();if(oss_GetFacebookState()<0){s=n;if(ay==GameData.k_Leaderboards_BtnFacebook_GetCoins){fbm_LoginReward()}else{fbm_LoginNoMenu()}}else{s=w;fbm_Invite()}break}}}function P(){if(!D()){SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,false);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,false);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,GtsData.GUI_POSX,GLLibConfiguration.screenWidth/2)}}function D(){return online_isOnlineEnabled()}function aq(){switch(u){case ae.STATE_START_GET_LEADERBOARD:V();break;case ae.STATE_MIDDLE_GET_LEADERBOARD:i();break;case ae.STATE_END_GET_LEADERBOARD:var ax=false;for(var aw=0;aw<t.length;aw++){if(b[aw]==""){b[aw]=oss_GetFacebookName(A[aw]);ax=!false}}if(ax){Y()}break}}function V(){s_frameCounter++;if(an==k.MODE_OFFLINE){if(s_frameCounter>=ae.TIME_START){O(ae.STATE_MIDDLE_GET_LEADERBOARD)}else{}}else{l+=s_game_frameDT;if(oss_GetFacebookState()>0){if(fbm_post_state==FBM_POST_STATE_FAILED){m=false;gui_MsgBox_Loading_Close();msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,getString(TEXT.MAIN_ONLINE_ERROR),MSGBOX_CALLBACK.CONFIRM);O(ae.STATE_MIDDLE_GET_LEADERBOARD);fbm_post_state=FBM_POST_STATE_RETRY;return}if(fbm_post_state!=FBM_STATE_END){return}}oss_Update();var aw=oss_GetRequestState();if(aw==OSS_REQ_STATE.IN_PROGRESS){return}if(J){J=false;if(ai==k.ALL_TIME){oss_LoadLeaderboard(ap,"0",""+af,false,null,false,OSS_DEFAULT_TIMEOUT)}else{if(ai==k.ME){oss_LoadLeaderboard(ap,"0",""+af,true,null,false,OSS_DEFAULT_TIMEOUT)}else{if(ai==k.FRIENDS){oss_LoadFriendLeaderboard(ap,"0",""+af,"friend",false,OSS_DEFAULT_TIMEOUT)}}}return}if(aw!=OSS_REQ_STATE.IN_PROGRESS){if(aw==OSS_REQ_STATE.OK){ag=oss_GetRequestResult();m=true;l=0}else{m=false;gui_MsgBox_Loading_Close();msgBox_AddMsgBox(MSGBOX_TYPE.CONFIRM,getString(TEXT.MAIN_ONLINE_ERROR),MSGBOX_CALLBACK.CONFIRM)}O(ae.STATE_MIDDLE_GET_LEADERBOARD)}}}function h(){return oss_GetFacebookState()>0}function i(){s_frameCounter++;if(an==k.MODE_OFFLINE){O(ae.STATE_END_GET_LEADERBOARD)}else{l+=s_game_frameDT;if(!ao){aj();if(l>=C){ao=true}if(ao){var aw=false;var ay=false;var ax=-1;if((ai==k.FRIENDS)&&(am!=-1)){aw=true;ax=t[am][k.LEADER_RANK]}else{if((ai==k.ME)&&(am!=-1)){aw=true;ax=t[am][k.LEADER_RANK];H=ax}else{if(ai==k.ALL_TIME){if(am!=-1){aw=true;ax=t[am][k.LEADER_RANK]}else{ax=H;ay=true}}}}if(ax<0){Z(false)}else{if(ay){Leaderboards_SetPlayerInfoRank(ax)}else{z(ax,b[am],t[am][k.LEADER_SCORE],t[am][k.LEADER_CHARACTER],B)}}}}else{if(ai!=k.ME){gui_MsgBox_Loading_Close()}O(ae.STATE_END_GET_LEADERBOARD)}}}function y(){F=0;J=false;if(an==k.MODE_OFFLINE){}else{l=0;msgBox_AddMsgBox(MSGBOX_TYPE.LOADING,getString(TEXT.MAIN_IAP_GETTING_FEED));J=true}}function a(){s_frameCounter=0;if(an==k.MODE_OFFLINE){r();L();Y()}else{if(m){ar();L();Y();if(ai==k.FRIENDS){}else{if(ai==k.ALL_TIME){return}else{}}}}}function S(){if((ai==k.ME)){q();O(ae.STATE_START_GET_LEADERBOARD)}else{gui_MsgBox_Loading_Close();SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnExit,true);if(H!=-1){Z(true)}}}function O(aw){u=aw;switch(aw){case ae.STATE_START_GET_LEADERBOARD:y();break;case ae.STATE_MIDDLE_GET_LEADERBOARD:a();break;case ae.STATE_END_GET_LEADERBOARD:S();break}}var ae={};ae.STATE_GET_MY_RANK=0;ae.STATE_START_GET_LEADERBOARD=1;ae.STATE_MIDDLE_GET_LEADERBOARD=2;ae.STATE_END_GET_LEADERBOARD=3;ae.TIME_START=30;ae.TIME_MIDDLE=30;var u=-1;var E={};E.GFX_BG=0;E.GFX_CORNER=E.GFX_BG+1;E.TXT_NAME=E.GFX_CORNER+1;E.GFX_STAR=E.TXT_NAME+1;E.TXT_RANK=E.GFX_STAR+1;E.GFX_ICON=E.TXT_RANK+1;E.GFX_BORDER=E.GFX_ICON+1;E.TXT_SCORE=E.GFX_BORDER+1;E.SIZE=E.TXT_SCORE+1;var N=new cScrollMenu(0,0,0,0,0,0,0);var d=[0,0,0,0];var ac=0;var ab=0;var W=-1;var G=0;function o(aw){N.SetElementCounter(aw);return aw}function p(){if(an==k.MODE_OFFLINE||!h()){c();SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,getString(TEXT.MAIN_LEADERBOARDS_ALL_TIME));SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnValue,false);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,false);SetTextAreaVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_txtOffline,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,online_isOnlineEnabled());SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,GtsData.GUI_BUTTON_PALETTE,10);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,GtsData.GUI_BUTTON_PALETTEPRESSED,11);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,GtsData.GUI_BUTTON_PALETTE,10);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,GtsData.GUI_BUTTON_PALETTEPRESSED,11);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,GtsData.GUI_BUTTON_PALETTE,10);SetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,GtsData.GUI_BUTTON_PALETTEPRESSED,11);P()}else{c();ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnValue,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,false);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,true);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,false);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,false);SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,true);SetTextAreaVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_txtOffline,true);if(ak==k.PERIOD_TOTAL){SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,getString(TEXT.MAIN_LEADERBOARDS_ALL_TIME))}else{if(ak==k.PERIOD_WEEK){SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,getString(TEXT.MAIN_LEADERBOARDS_WEEKLY))}else{SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnPeriod,getString(TEXT.MAIN_LEADERBOARDS_DAILY))}}P()}}function c(){if(online_isOnlineEnabled()){if(false&&RMS_GetRecordValue(RMS_RECORD_FACEBOOK_REWARD_GIVEN)==0){SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_GetCoins,true);SetGraphItemVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_Gfx_coins,true);SetTextAreaVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_Txt_coins,true);s_aArgumentStringArr[0]=""+text_GetFormatNumber(s_arrayTweaks[isPremium()?ITweaks.PREMIUM_COINS_FACEBOOK_FIRST_CONNECT:ITweaks.COINS_FACEBOOK_FIRST_CONNECT][0]);SetTextAreaString(GameData.k_gameLeaderboards,GameData.k_Leaderboards_Txt_coins,getFormattedString(getString(TEXT.MAIN_FB_GET_COINS),s_aArgumentStringArr,"#"));var aw=GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_GetCoins,GtsData.GUI_POSX);gui_alignXTextAndIcon(GameData.k_gameLeaderboards,GameData.k_Leaderboards_Txt_coins,GameData.k_Leaderboards_Gfx_coins,aw,5)}else{if(oss_GetFacebookState()>0){SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_Login,getString(TEXT.MAIN_FB_INVITE_BUTTON))}else{SetButtonText(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_Login,getString(TEXT.MAIN_FB_LOGIN))}SetButtonVisibility(GameData.k_gameLeaderboards,GameData.k_Leaderboards_BtnFacebook_Login,true)}}}function aj(){if(an==k.MODE_OFFLINE){}else{if(!h()){for(var ax=0;ax<aa.length;ax++){aa[ax]=k.IMG_UNAVAILABLE}ao=true}else{var az=true;for(var ax=0;ax<aa.length;ax++){if(aa[ax]==k.IMG_PENDING){var ay=oss_GetFacebookPhotoState(A[ax]);if(ay==OSS_FB_ITEM_STATE.NOT_A_USER){aa[ax]=k.IMG_UNAVAILABLE}else{if(ay==OSS_FB_ITEM_STATE.READY){var aw=oss_GetFacebookPhoto(A[ax]);if(aw!=null){gui_setAvatarImageUser(oss_GetFacebookUserEx(A[ax]),ax);GUI_SetFacebookAvatarLoaded(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_ICON,ax);aa[ax]=k.IMG_READY;if(ax==am){B=aw}az=false}}else{if(ay==OSS_FB_ITEM_STATE.PHOTO_LOADING){az=false}else{az=false}}}}}ao=az}}}function ar(){am=-1;var aB;if(ag!=null){aB=ag;try{v=aB.total_entries;var ay=aB.data;var az=ay.length;var aD=0;var aw="";if(h()){aw=oss_MyFacebookCredential()}else{aw=oss_GetMyCredential()}var aE=0;t=LowAPI.Gen_Array([az,k.LEADER_NUM_FIELDS],0);b=LowAPI.Gen_Array([az],null);A=LowAPI.Gen_Array([az],null);aa=LowAPI.Gen_Array([az],0);U=az;for(var aA=0;aA<az;aA++){if(ay[aA]["credential"]==aw){aD=aA;am=aA;break}}for(var aA=0;aA<az;aA++){t[aA][k.LEADER_RANK]=parseInt(ay[aA]["rank"])+aE;t[aA][k.LEADER_SCORE]=parseInt(ay[aA]["score"]);try{t[aA][k.LEADER_CHARACTER]=parseInt(ay[aA]["char"])}catch(aC){t[aA][k.LEADER_CHARACTER]=0}A[aA]=ay[aA]["credential"];b[aA]=ay[aA]["display_name"];if(false){b[aA]=InboxProcessUnicodes(b[aA],true);b[aA]=InboxProcessUnicodes(b[aA],false)}if(oss_GetFacebookState()>0){var ax=oss_GetFacebookName(A[aA]);if(ax!=""){b[aA]=ax}}if(false&&A[aA].startsWith("anonymous:")){b[aA]=getString(TEXT.MAIN_ANONYMOUS_GUEST)+" "+A[aA].substring("anonymous:".length())}aa[aA]=k.IMG_PENDING}if(am>=0&&!h()){b[am]=getString(TEXT.MAIN_ANONYMOUS_ME)}ao=false}catch(aC){Err("GameState_LEADERBOARDS.js # Leaderboards_GetOnlineValues() - Error parsing friend scores JSon - "+aC);throw aC}}}function r(){X=s_arrayLeaderboards.length+1;t=LowAPI.Gen_Array([s_arrayLeaderboards.length+1,k.LEADER_NUM_FIELDS],0);b=LowAPI.Gen_Array([s_arrayLeaderboards.length+1],null);var ax=0;var aw=false;for(var ay=0;ay<s_arrayLeaderboards.length;ay++){if(!aw&&s_arrayLeaderboards[ay][0]<DecodeInt(s_systemScore)){t[ax][k.LEADER_RANK]=ax+1;t[ax][k.LEADER_SCORE]=DecodeInt(s_systemScore);t[ax][k.LEADER_CHARACTER]=s_systemScoreCharacter;b[ax]=getString(TEXT.MAIN_LEADERBOARDS_OFFLINE_NAME_PLAYER);am=ax;ax++;aw=true}t[ax][k.LEADER_RANK]=ax+1;t[ax][k.LEADER_SCORE]=s_arrayLeaderboards[ay][0];t[ax][k.LEADER_CHARACTER]=s_arrayLeaderboards[ay][1];b[ax]=getString(TEXT.MAIN_LEADERBOARDS_OFFLINE_NAME_00+ay);ax++}if(!aw){t[ax][k.LEADER_RANK]=ax+1;t[ax][k.LEADER_SCORE]=DecodeInt(s_systemScore);t[ax][k.LEADER_CHARACTER]=s_systemScoreCharacter;b[ax]=getString(TEXT.MAIN_LEADERBOARDS_OFFLINE_NAME_PLAYER);am=ax;ax++;aw=true}U=ax;z(t[am][k.LEADER_RANK],b[am],t[am][k.LEADER_SCORE],t[am][k.LEADER_CHARACTER],null);Z(true)}function al(aw){ResetLayerData(GameData.k_gameLeaderboardsScrollItem);ResizeLayerNumElems(GameData.k_gameLeaderboardsScrollItem,GetNumLayerElements(GameData.k_gameLeaderboardsScrollItem)+E.SIZE*(aw-1));var az=0;var ay=0;for(var ax=0;ax<aw;++ax){if(ax!=0){CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.GFX_BG,ax*E.SIZE+E.GFX_BG);CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.TXT_NAME,ax*E.SIZE+E.TXT_NAME);CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.GFX_STAR,ax*E.SIZE+E.GFX_STAR);CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.TXT_RANK,ax*E.SIZE+E.TXT_RANK);CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.GFX_ICON,ax*E.SIZE+E.GFX_ICON);CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.GFX_CORNER,ax*E.SIZE+E.GFX_CORNER);CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.GFX_BORDER,ax*E.SIZE+E.GFX_BORDER);CloneLayerElemData(GameData.k_gameLeaderboardsScrollItem,E.TXT_SCORE,ax*E.SIZE+E.TXT_SCORE);az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_BG,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_BG,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_BG,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_BG,GtsData.GUI_POSY,ay+N.GetElementPosY(ax));az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.TXT_NAME,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.TXT_NAME,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.TXT_NAME,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.TXT_NAME,GtsData.GUI_POSY,ay+N.GetElementPosY(ax));az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_STAR,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_STAR,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_STAR,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_STAR,GtsData.GUI_POSY,ay+N.GetElementPosY(ax));az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.TXT_RANK,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.TXT_RANK,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.TXT_RANK,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.TXT_RANK,GtsData.GUI_POSY,ay+N.GetElementPosY(ax));az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_ICON,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_ICON,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_ICON,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_ICON,GtsData.GUI_POSY,ay+N.GetElementPosY(ax));az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_CORNER,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_CORNER,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_CORNER,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_CORNER,GtsData.GUI_POSY,ay+N.GetElementPosY(ax));az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_BORDER,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_BORDER,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_BORDER,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.GFX_BORDER,GtsData.GUI_POSY,ay+N.GetElementPosY(ax));az=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.TXT_SCORE,GtsData.GUI_POSX);ay=GetParamValue(GameData.k_gameLeaderboardsScrollItem,E.TXT_SCORE,GtsData.GUI_POSY);SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.TXT_SCORE,GtsData.GUI_POSX,az+N.GetElementPosX(ax));SetParamValue(GameData.k_gameLeaderboardsScrollItem,ax*E.SIZE+E.TXT_SCORE,GtsData.GUI_POSY,ay+N.GetElementPosY(ax))}f(ax)}}function Y(){for(var aw=0;aw<U;aw++){f(aw)}}function f(aw){var ax=am==aw;if(b.length>aw){SetTextAreaString(GameData.k_gameLeaderboardsScrollItem,E.TXT_NAME+aw*E.SIZE,GetShortenedStringTextArea(b[aw],GameData.k_gameLeaderboardsScrollItem,E.TXT_NAME+aw*E.SIZE),true)}else{SetTextAreaString(GameData.k_gameLeaderboardsScrollItem,E.TXT_NAME+aw*E.SIZE,"")}if(t.length>aw){SetTextAreaString(GameData.k_gameLeaderboardsScrollItem,E.TXT_RANK+aw*E.SIZE,""+t[aw][k.LEADER_RANK]);SetTextAreaString(GameData.k_gameLeaderboardsScrollItem,E.TXT_SCORE+aw*E.SIZE,""+text_GetFormatNumber(t[aw][k.LEADER_SCORE]))}else{SetTextAreaString(GameData.k_gameLeaderboardsScrollItem,E.TXT_RANK+aw*E.SIZE,"");SetTextAreaString(GameData.k_gameLeaderboardsScrollItem,E.TXT_SCORE+aw*E.SIZE,"")}SetGraphItemVisibility(GameData.k_gameLeaderboardsScrollItem,E.GFX_CORNER+aw*E.SIZE,false);SetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_BG+aw*E.SIZE,GtsData.GUI_GRAPHITEM_FRAMEID,UI.FRAME_RANKINGITEM);if(t.length>aw){SetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_ICON+aw*E.SIZE,GtsData.GUI_GRAPHITEM_SPRITEID,DATA.SPRITE_DATA_PORTRAIT_00+t[aw][k.LEADER_CHARACTER]);SetParamValue(GameData.k_gameLeaderboardsScrollItem,E.GFX_ICON+aw*E.SIZE,GtsData.GUI_GRAPHITEM_FRAMEID,PORTRAIT_00.FRAME_CHARACTER_SHOP)}else{SetFacebookAvatarVisibility(GameData.k_gameLeaderboardsScrollItem,E.GFX_ICON+aw*E.SIZE,false)}if(an==k.MODE_OFFLINE||!h()){GUI_SetFacebookAvatarLoaded(GameData.k_gameLeaderboardsScrollItem,aw*E.SIZE+E.GFX_ICON,-1)}}function L(){GetRectAreaRect(s_gui_outRect,GameData.k_gameLeaderboards,GameData.k_Leaderboards_rectScroll);var az=s_gui_outRect[2]-s_gui_outRect[0];var ax=s_gui_outRect[3]-s_gui_outRect[1];N.Reset();N.SetRowLength(1);N.SetDirection(cScrollMenu.SCROLL_DIRECTION_VERTICAL);N.SetWindowWidth(GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_WIDTH));N.SetWindowHeight(GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_HEIGHT));var aw;if((am==-1)&&(ai==k.ALL_TIME)){aw=U;o(U+1)}else{aw=U;o(U)}N.SetElemWidth(az+1);N.SetElemHeight(ax+1);N.SetElemSpacingX(az);N.SetElemSpacingY(GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_ELEMVERTSPACING)+ax);al(aw);N.SetLockStateX(true);N.SetLockStateY(false);ac=s_gui_outRect[0];ab=s_gui_outRect[1];d[0]=GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_POSX)+GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_POSX);d[1]=GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_POSY)+GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_POSY);d[2]=GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_WIDTH);d[3]=GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_HEIGHT);N.Reset();W=-1;G=0;if(ai==k.ME){if(am!=-1){var ay=N.GetElementPosY(am,true)-(GetParamValue(GameData.k_gameLeaderboards,GameData.k_Leaderboards_ScrollData,GtsData.GUI_SCROLLDATA_HEIGHT)/2)|0+(N.GetElemHeight(am)/2)|0;N.SetScrollOffsetY(-ay)}}}function ad(){N.Update(s_game_frameDT);var ay=Input_GetPointerPosX_SYNC();var ax=Input_GetPointerPosY_SYNC();if(isPointInRectWH(ay,ax,d)){if(Input_IsPointerDragged_SYNC()){N.ApplyDisplacement(Input_GetDragOffsetX_SYNC(),Input_GetDragOffsetY_SYNC());if(((Input_GetDraggedPosY_SYNC()-Input_GetPressedPosY_SYNC())<0?-(Input_GetDraggedPosY_SYNC()-Input_GetPressedPosY_SYNC()):(Input_GetDraggedPosY_SYNC()-Input_GetPressedPosY_SYNC()))>SCROLL_ALLOWINPUTDRAG_THRESHOLD){s_bAllowInputInScroll=false}}if(Input_IsPointerPressed_SYNC()){s_bAllowInputInScroll=true}if(!s_bAllowInputInScroll){av(0,10000,10000,INPUT_FLAG_RELEASED)}else{if(Input_CheckState_SYNC(INPUT_FLAG_DRAGGED|INPUT_FLAG_PRESSED)){if(Input_CheckState_SYNC(INPUT_FLAG_DRAGGED)&&s_playerLastPointerMode==INPUT_FLAG_PRESSED&&((Input_GetDragOffsetY_SYNC())<0?-(Input_GetDragOffsetY_SYNC()):(Input_GetDragOffsetY_SYNC()))>2){playSound(SOUND_TYPE.PLAYER_SIDE_MOVE_SFX,false);s_playerLastPointerMode=INPUT_FLAG_DRAGGED}else{if(Input_CheckState_SYNC(INPUT_FLAG_PRESSED)){s_playerLastPointerMode=INPUT_FLAG_PRESSED}}var aw=N.GetElementAt(Input_GetPointerPosX_SYNC()-ac,Input_GetPointerPosY_SYNC()-ab);if((aw>=0)){W=aw;av(aw,0,0,INPUT_FLAG_RELEASED)}}if(Input_CheckState(INPUT_FLAG_RELEASED)){N.SetVelocity(Input_GetDragOffsetX_SYNC(),Input_GetDragOffsetY_SYNC(),4);var aw=N.GetElementAt(Input_GetPointerPosX_SYNC()-ac,Input_GetPointerPosY_SYNC()-ab);if((aw>=0)){G=aw;av(aw,0,0,INPUT_FLAG_RELEASED);N.ResetVelocity();W=-1}}}}}function av(ay,aw,az,ax){scroll_doElementClick(N,GameData.k_gameLeaderboardsScrollItem,ay,aw,az,ax)}function Q(){var aw=N.GetScrollOffsetX();var ax=N.GetScrollOffsetY();PaintAllVisibleItems(GameData.k_gameLeaderboardsScrollItem,aw,ax)}function M(ax){gui_SetClip(d[0],d[1],d[2],d[3]);var aw=0;var ay=0;Q();gui_RestoreClip();N.Paint(g,ac,ab);if(ax){N.PaintScrollBar(g,SCROLLBAR_BACK,SCROLLBAR_FRONT,(d[0]+d[2]-1),d[1],7,d[3],d[2],d[3])}}function I(){ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,true);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,true);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,false);SetTextAreaString(GameData.k_gameLeaderboards,GameData.k_Leaderboards_txtOffline,getString(TEXT.MAIN_LEADERBOARD_FRIENDS));ai=k.FRIENDS;P()}function au(){ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,true);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,false);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,true);SetTextAreaString(GameData.k_gameLeaderboards,GameData.k_Leaderboards_txtOffline,getString(TEXT.MAIN_LEADERBOARD_ME));ai=k.ME;P()}function q(){ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe);ResetElementData(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnTop,false);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnMe,true);SetButtonEnabled(GameData.k_gameLeaderboards,GameData.k_Leaderboards_btnFriends,true);SetTextAreaString(GameData.k_gameLeaderboards,GameData.k_Leaderboards_txtOffline,getString(TEXT.MAIN_LEADERBOARD_ALL_TIME));ai=k.ALL_TIME;P()}function Z(aw){SetGraphItemVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxBg,aw);SetGraphItemVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxCorner,aw);SetTextAreaVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_txtName,aw);SetGraphItemVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxProgressBg,aw);SetTextAreaVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_txtRank,aw);SetFacebookAvatarVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxIcon,aw);SetGraphItemVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxBorder,aw);SetTextAreaVisibility(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_txtScore,aw)}function z(aA,aw,az,ax,ay){SetTextAreaString(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_txtName,GetShortenedStringTextArea(aw,GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_txtName),true);SetTextAreaString(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_txtScore,Text_FormatNumber(az));SetTextAreaString(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_txtRank,""+aA);if(ay==null){SetParamValue(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxIcon,GtsData.GUI_GRAPHITEM_SPRITEID,DATA.SPRITE_DATA_PORTRAIT_00+ax);SetParamValue(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxIcon,GtsData.GUI_GRAPHITEM_FRAMEID,PORTRAIT_00.FRAME_CHARACTER_SHOP)}else{gui_setAvatarImageUser(oss_GetFacebookUserEx(A[am]),am);GUI_SetFacebookAvatarLoaded(GameData.k_gameLeaderboardsScrollItem_Player,GameData.k_LeaderboardsScrollItem_gfxIcon,am)}}LowAPI.extendObject(K,{GameState_LEADERBOARDS:R,},true)})(window);