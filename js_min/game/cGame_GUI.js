(function(ac,v){var bo=LowAPI.Gen_Array([GameData.k_gameTotal],null);var aO=-1;var aZ=-1;var br=false;var ab=0;var bu=0;var d=false;var bq=LowAPI.Gen_Array([10],0);var aK=LowAPI.Gen_Array([10],0);var P=LowAPI.Gen_Array([10],null);var p=LowAPI.Gen_Array([10],0);var au=LowAPI.Gen_Array([10],0);var u=LowAPI.Gen_Array([10],0);var aN=null;function aV(bA,bz){bo[bA]=bz}function av(bB,bA,bz){if(bo[bB]==null){throw new Error("GUI_MessageManager_handleMessage: gui type ["+bB+"] is undefined. Please make sure to register any type.")}else{bo[bB](bA,bz)}}function S(bz){m_spritesGUI=bz;m_gameData=LowAPI.Gen_Array([GameData.k_gameTotal],null);m_gameDataClean=LowAPI.Gen_Array([GameData.k_gameTotal],null);m_gameUpdateAnimsLastFrame=LowAPI.Gen_Array([GameData.k_gameTotal],0);m_gameDataFlags=LowAPI.Gen_Array([GameData.k_gameTotal],null);m_gameDataStrings=LowAPI.Gen_Array([GameData.k_gameTotal],null);for(var bA=0;bA<GameData.k_gameTotal;bA++){m_gameData[bA]=null;m_gameDataClean[bA]=null;m_gameUpdateAnimsLastFrame[bA]=s_game_currentFrameNB-1;m_gameDataFlags[bA]=null;m_gameDataStrings[bA]=null}}function h(bz,bB){var bA=m_gameData[bz][bB];var bC=bA[GtsData.GUI_TEMPLATE_IDX];return bC}function ai(bA){var bz=Pack_ReadData(bA);var bG=0;var bF=0;while(bG<bz.length){bF++;bG+=(GtsData.GUI_TEMPLATE_PARAM_COUNT<<1);bG+=((Mem_GetShort(bz,bG)+1)<<1)}bG=0;m_gameData[bA]=LowAPI.Gen_Array([bF],null);m_gameDataClean[bA]=LowAPI.Gen_Array([bF],null);m_gameDataFlags[bA]=LowAPI.Gen_Array([bF],0);m_gameDataStrings[bA]=LowAPI.Gen_Array([bF],null);for(var bE=0;bE<bF;bE++){var bD=GtsData.GUI_TEMPLATE_PARAM_COUNT+1+Mem_GetShort(bz,bG+(GtsData.GUI_TEMPLATE_PARAM_COUNT<<1));m_gameDataClean[bA][bE]=LowAPI.Gen_Array([bD],0);m_gameData[bA][bE]=LowAPI.Gen_Array([bD],0);m_gameDataStrings[bA][bE]=null;var bC=m_gameDataClean[bA][bE];for(var bB=0;bB<bD;bB++){bC[bB]=Mem_GetShort(bz,bG);bG+=2}}aC(bA);bx(bA);bz=null}function aC(bz,bC){var bC=!LowAPI.isUndefined(bC)?bC:false;for(var bB=0;bB<m_gameData[bz].length;bB++){var bA=bC?m_gameData[bz][bB]:m_gameDataClean[bz][bB];if(bA[GtsData.GUI_TEMPLATE_IDX]==GtsData.GUI_GRAPHITEM){var bD=bA[GtsData.GUI_GRAPHITEM_ANIMID];if(bD>=0){switch(bA[GtsData.GUI_GRAPHITEM_FRAMEID]){case k_GUI_GraphItem_AnimID_Type_Once:bD|=k_GraphItem_AnimType_Once;break;case k_GUI_GraphItem_AnimID_Type_Once_Disappear:bD|=k_GraphItem_AnimType_Once_Disappear;break}bA[GtsData.GUI_GRAPHITEM_FRAMEID]=0;bA[GtsData.GUI_GRAPHITEM_ANIMID]=bD.castToShort()}}}}function F(bD,bz,bB){var bC=m_gameData[bD][bz];var bA=bC[GtsData.GUI_GRAPHITEM_ANIMID]&k_GraphItem_AnimTypeMask;bC[GtsData.GUI_GRAPHITEM_FRAMEID]=0;bC[GtsData.GUI_GRAPHITEM_ANIMID]=(bB|bA)}function V(bA){if(m_gameData[bA]&&m_gameData[bA].length!=m_gameDataClean[bA].length){for(var bz=0;bz<m_gameData[bA].length;bz++){m_gameData[bA][bz]=null}m_gameData[bA]=null;m_gameDataFlags[bA]=null;m_gameDataStrings[bA]=null;m_gameData[bA]=LowAPI.Gen_Array([m_gameDataClean[bA].length],null);for(var bz=0;bz<m_gameDataClean[bA].length;bz++){m_gameData[bA][bz]=LowAPI.Gen_Array([m_gameDataClean[bA][bz].length],0)}m_gameDataFlags[bA]=LowAPI.Gen_Array([m_gameData[bA].length],0);m_gameDataStrings[bA]=LowAPI.Gen_Array([m_gameData[bA].length],null)}}function bx(bz){if(!m_gameData[bz]){return}V(bz);for(var bC=m_gameDataClean[bz].length-1;bC>=0;bC--){var bB=GtsData.GUI_TEMPLATE_PARAM_COUNT+1+m_gameDataClean[bz][bC][GtsData.GUI_TEMPLATE_PARAM_COUNT];for(var bA=bB-1;bA>=0;bA--){m_gameData[bz][bC][bA]=m_gameDataClean[bz][bC][bA]}m_gameDataFlags[bz][bC]=0;if((m_gameData[bz][bC][GtsData.GUI_TEMPLATE_IDX]==GtsData.GUI_TEXTAREAITEM)&&(m_gameData[bz][bC][GtsData.GUI_TEXTAREAITEM_TEXTID]>=0)){m_gameDataStrings[bz][bC]=getString(m_gameData[bz][bC][GtsData.GUI_TEXTAREAITEM_TEXTID],IDefine.INDEX_MAIN)}else{if((m_gameData[bz][bC][GtsData.GUI_TEMPLATE_IDX]==GtsData.GUI_BUTTON)&&(m_gameData[bz][bC][GtsData.GUI_BUTTON_TEXTID]>=0)){m_gameDataStrings[bz][bC]=getString(m_gameData[bz][bC][GtsData.GUI_BUTTON_TEXTID],IDefine.INDEX_MAIN)}else{m_gameDataStrings[bz][bC]=null}}}}function L(bz,bC){var bB=GtsData.GUI_TEMPLATE_PARAM_COUNT+1+m_gameDataClean[bz][bC][GtsData.GUI_TEMPLATE_PARAM_COUNT];for(var bA=bB-1;bA>=0;bA--){m_gameData[bz][bC][bA]=m_gameDataClean[bz][bC][bA]}m_gameDataStrings[bz][bC]=null;if((m_gameData[bz][bC][GtsData.GUI_TEMPLATE_IDX]==GtsData.GUI_TEXTAREAITEM)&&(m_gameData[bz][bC][GtsData.GUI_TEXTAREAITEM_TEXTID]!=-1)){m_gameDataStrings[bz][bC]=getString(m_gameData[bz][bC][GtsData.GUI_TEXTAREAITEM_TEXTID],IDefine.INDEX_MAIN)}else{if((m_gameData[bz][bC][GtsData.GUI_TEMPLATE_IDX]==GtsData.GUI_BUTTON)&&(m_gameData[bz][bC][GtsData.GUI_BUTTON_TEXTID]!=-1)){m_gameDataStrings[bz][bC]=getString(m_gameData[bz][bC][GtsData.GUI_BUTTON_TEXTID],IDefine.INDEX_MAIN)}else{m_gameDataStrings[bz][bC]=null}}}function U(bz,bA,bB){return m_gameData[bz][bA][bB]}function W(bz,bA,bC,bB){m_gameData[bz][bA][bC]=bB.castToInt()}function bp(bz,bA){return U(bz,bA,GtsData.GUI_TEMPLATE_IDX)}function ar(bz){return m_gameData[bz].length}function bv(bA,bz){var bz=!LowAPI.isUndefined(bz)?bz:s_game_frameDT;if(m_gameUpdateAnimsLastFrame[bA]==s_game_currentFrameNB){return}m_gameUpdateAnimsLastFrame[bA]=s_game_currentFrameNB;for(var bB=0;bB<m_gameData[bA].length;bB++){if((m_gameData[bA][bB][GtsData.GUI_TEMPLATE_IDX]==GtsData.GUI_GRAPHITEM)&&(m_gameData[bA][bB][GtsData.GUI_GRAPHITEM_VISIBLE]!=0)){a2(bA,bB,bz)}}}function a2(bH,bD,bz){var bL,bI,bE;var bC;var bB=0;bC=m_gameData[bH][bD];if(bC[GtsData.GUI_GRAPHITEM_VISIBLE]==0){return}bE=bC[GtsData.GUI_GRAPHITEM_ANIMID];bB=bE&k_GraphItem_AnimTypeMask;bE&=~(k_GraphItem_AnimTypeMask);bI=bC[GtsData.GUI_GRAPHITEM_FRAMEID];if(bE>=0){var bA=bC[GtsData.GUI_GRAPHITEM_SPRITEID];var bK=s_ASpriteArray[bA];if(bK!=null){var bF=bC[GtsData.GUI_GRAPHITEM_CRTAFRAMETIME];bF+=bz;var bJ=bK.GetAFrames(bE);var bG=bK.GetAFrameTime(bE,bI)*k_layerAnimBaseFrameTime;if(bF>=bG){if(bB!=k_GraphItem_AnimType_Once){bF=0;bC[GtsData.GUI_GRAPHITEM_FRAMEID]=((bI+1)%bJ).castToShort()}}bC[GtsData.GUI_GRAPHITEM_CRTAFRAMETIME]=bF.castToShort()}else{Warn("PaintGraphItem: Sprite index "+bA+" null")}}bC=m_gameData[bH][bD];var bA=bC[GtsData.GUI_GRAPHITEM_SPRITEID];var bK=m_spritesGUI[bA];bI=bC[GtsData.GUI_GRAPHITEM_FRAMEID];bE=bC[GtsData.GUI_GRAPHITEM_ANIMID];if((bE>=0)&&(bK!=null)){var bF=bC[GtsData.GUI_GRAPHITEM_CRTAFRAMETIME];if(GLLibConfig.sprite_animFPS==1000){bF++}else{bF+=bz}if((bE&(k_GraphItem_AnimType_Once|k_GraphItem_AnimType_Once_Disappear))!=0){bE&=~(k_GraphItem_AnimTypeMask);var bJ=bK.GetAFrames(bE);if(bI<bJ-1){var bG=bK.GetAFrameTime(bE,bI)*k_layerAnimBaseFrameTime;if(bF>=bG){bF=0;bC[GtsData.GUI_GRAPHITEM_FRAMEID]=((bI+1)%bJ).castToShort()}}else{bC[GtsData.GUI_GRAPHITEM_CRTAFRAMETIME]=1}}else{var bJ=bK.GetAFrames(bE);var bG=bK.GetAFrameTime(bE,bI)*k_layerAnimBaseFrameTime;if(bF>=bG){bF=0;bC[GtsData.GUI_GRAPHITEM_FRAMEID]=((bI+1)%bJ).castToShort()}}bC[GtsData.GUI_GRAPHITEM_CRTAFRAMETIME]=bF.castToShort()}}function ak(bE,bJ,bI,bz,bB){var bJ=!LowAPI.isUndefined(bJ)?bJ:0;var bI=!LowAPI.isUndefined(bI)?bI:0;var bz=!LowAPI.isUndefined(bz)?bz:0;var bB=!LowAPI.isUndefined(bB)?bB:32767;var bA=0;var bG=GetClipX();var bF=GetClipY();var bH=GetClipWidth();var bD=GetClipHeight();var bC=false;for(bA=0;bA<m_gameData[bE].length;bA++){if((bA>=bz)&&(bA<=bB)){bC|=ax(bE,bA,bJ,bI)}}if(bC){SetClip(bG,bF,bH,bD)}}function ax(bB,bE,bA,bz){var bD=false;var bC=m_gameData[bB][bE];var bF=bC[GtsData.GUI_TEMPLATE_IDX];switch(bF){case GtsData.GUI_GRAPHITEM:if(bC[GtsData.GUI_GRAPHITEM_VISIBLE]!=0){w(bB,bE,bA,bz)}break;case GtsData.GUI_BUTTON:if(bC[GtsData.GUI_BUTTON_VISIBLE]!=0){a7(bB,bE,bA,bz)}break;case GtsData.GUI_CLIPZONE:bD=true;a1(bB,bE);break;case GtsData.GUI_TEXTAREAITEM:if((m_gameDataStrings[bB][bE]!=null)&&(bC[GtsData.GUI_TEXTAREAITEM_VISIBLE]!=0)){f(m_gameDataStrings[bB][bE],bB,bE,bA,bz)}break;case GtsData.GUI_RECT:M(bB,bE,bA,bz);break;case GtsData.GUI_GRADIENT_RECT:if(bC[GtsData.GUI_GRADIENT_RECT_VISIBLE]!=0){PaintGradientRectItem(bB,bE,bA,bz)}break;case GtsData.GUI_GUI_PROGRESSBAR:bc(bB,bE,bA,bz);break;case GtsData.GUI_GUI_FACEBOOKAVATAR:if(bC[GtsData.GUI_GUI_FACEBOOKAVATAR_VISIBLE]!=0){a6(bB,bE,bA,bz)}break;case GtsData.GUI_GUI_SLIDER:GUI_PaintSlider(bB,bE,bA,bz);break}return bD}function ba(bA,bz){return(U(bA,bz,GtsData.GUI_GRAPHITEM_VISIBLE)!=0)}function X(bA,bz,bB){m_gameData[bA][bz][GtsData.GUI_GRAPHITEM_VISIBLE]=(bB?GtsData.GUI_BOOLEAN_LIST_TRUE:GtsData.GUI_BOOLEAN_LIST_FALSE).castToShort()}function aM(bz,bA){return(U(bz,bA,GtsData.GUI_BUTTON_VISIBLE)!=0)}function b(){if(arguments){switch(arguments.length){case 3:if(typeof arguments[2]=="number"){return al.apply(this,arguments)}else{return aX.apply(this,arguments)}}}throw new Error("InvalidArguments")}function aX(bz,bB,bA){m_gameDataStrings[bz][bB]=bA}function al(bz,bB,bA){W(bz,bB,GtsData.GUI_BUTTON_TEXTID,bA);m_gameDataStrings[bz][bB]=getString(m_gameData[bz][bB][GtsData.GUI_BUTTON_TEXTID],IDefine.INDEX_MAIN)}function a(bz,bA){return m_gameDataStrings[bz][bA]}function x(bz,bB,bA){m_gameData[bz][bB][GtsData.GUI_BUTTON_VISIBLE]=(bA?GtsData.GUI_BOOLEAN_LIST_TRUE:GtsData.GUI_BOOLEAN_LIST_FALSE).castToShort()}function by(bA,bB,bz){if(bz){m_gameDataFlags[bA][bB]|=(GAME_GUI_FLAGS_PRESSED)}else{m_gameDataFlags[bA][bB]&=~(GAME_GUI_FLAGS_PRESSED)}}function a3(bz,bB,bA){if(bA){m_gameDataFlags[bz][bB]&=~(GAME_GUI_FLAGS_DISABLED)}else{m_gameDataFlags[bz][bB]|=(GAME_GUI_FLAGS_DISABLED)}}function aU(bz,bA){return((m_gameDataFlags[bz][bA]&(GAME_GUI_FLAGS_PRESSED))!=0)}function bt(bz,bA){return((m_gameDataFlags[bz][bA]&(GAME_GUI_FLAGS_DISABLED))!=0)}function O(bA,bz){return(U(bA,bz,GtsData.GUI_TEXTAREAITEM_VISIBLE)!=0)}function I(bA,bz,bB){m_gameData[bA][bz][GtsData.GUI_TEXTAREAITEM_VISIBLE]=(bB?GtsData.GUI_BOOLEAN_LIST_TRUE:GtsData.GUI_BOOLEAN_LIST_FALSE).castToShort()}function r(bB,bz){var bA=U(bB,bz,GtsData.GUI_TEXTAREAITEM_FONT);bw(bA);var bD=aW(bB,bz);s_sprFont.UpdateStringSize(bD);var bC=ASprite.GetCurrentStringWidth();setUseOldFont();return bC}function ah(bA,bC){var bz=U(bA,bC,GtsData.GUI_BUTTON_FONT);bw(bz);var bD=a(bA,bC);s_sprFont.UpdateStringSize(bD);var bB=ASprite.GetCurrentStringWidth();setUseOldFont();return bB}function J(bC,bA,bF){var bB=(bA==GtsData.GUI_FONTS____SYSTEM___);var bD=0;var bE=null;if(bB){bD=g.stringWidth(bC)}else{bw(bA);s_sprFont.UpdateStringSize(bC);bD=ASprite.GetCurrentStringWidth()}if(bD>bF){var bz=bC+"...";do{bz=bz.substring(0,bz.length-4)+"...";if(bB){bD=g.stringWidth(bz)}else{s_sprFont.UpdateStringSize(bz);bD=ASprite.GetCurrentStringWidth()}}while(bD>bF);if(!bB){setUseOldFont()}return bz}else{if(!bB){setUseOldFont()}return bC}}function e(bC,bB,bz){var bA=U(bB,bz,GtsData.GUI_TEXTAREAITEM_FONT);var bD=U(bB,bz,GtsData.GUI_TEXTAREAITEM_WIDTH);return J(bC,bA,bD)}function j(bE,bB,bD,bA,bz){var bC=m_gameData[bB][bD];Q(bE,bB,bD,bC[GtsData.GUI_POSX]+bA,bC[GtsData.GUI_POSY]+bz)}function E(bC,bz,bB){var bA=m_gameData[bz][bB];bC[0]=bA[GtsData.GUI_POSX];bC[1]=bA[GtsData.GUI_POSY];bC[2]=bA[GtsData.GUI_POSX]+bA[GtsData.GUI_RECT_AREA_WIDTH];bC[3]=bA[GtsData.GUI_POSY]+bA[GtsData.GUI_RECT_AREA_HEIGHT];return}function Q(bz,bF,bE,bJ,bI){var bJ=bJ;var bI=bI;if(arguments.length<4){bJ=0;bI=0}var bD=((m_gameDataFlags[bF][bE]&(GAME_GUI_FLAGS_PRESSED))!=0);var bB=((m_gameDataFlags[bF][bE]&(GAME_GUI_FLAGS_DISABLED))!=0);var bC=m_gameData[bF][bE];var bA=bC[GtsData.GUI_BUTTON_SPRITEID];var bH=s_ASpriteArray[bA];if(bH==null){Warn("PaintGraphItem: Sprite index "+bA+" null");return}var bG;if(bB){if(bC[GtsData.GUI_BUTTON_FRAMEIDDISABLED]!=-1){bG=bC[GtsData.GUI_BUTTON_FRAMEIDDISABLED]}else{bG=bC[GtsData.GUI_BUTTON_FRAMEID]}}else{bG=bD?bC[GtsData.GUI_BUTTON_FRAMEIDPRESSED]:bC[GtsData.GUI_BUTTON_FRAMEID]}bH.GetFrameRect(bz,bG,bJ,bI,0)}function be(bB,bz,bC,bA){var bA=!LowAPI.isUndefined(bA)?bA:false;m_gameDataStrings[bB][bz]=bC;if(bA){if(text_stringUsesExoticChars(bC)){W(bB,bz,GtsData.GUI_TEXTAREAITEM_FONT,GtsData.GUI_FONTS____SYSTEM___)}}}function aW(bA,bz){return m_gameDataStrings[bA][bz]}function w(){if(arguments){switch(arguments.length){case 2:return aB.apply(this,arguments);case 3:return az.apply(this,arguments);case 4:return ay.apply(this,arguments);case 5:return aw.apply(this,arguments)}}throw new Error("InvalidArguments")}function aB(bA,bz){w(g,bA,bz,0,0)}function az(bB,bA,bz){w(bB,bA,bz,0,0)}function ay(bC,bA,bB,bz){w(g,bC,bA,bB,bz)}function aw(bD,bE,bH,bM,bK){var bA=m_gameData[bE][bH];var bJ=((m_gameDataFlags[bE][bH]&(GAME_GUI_FLAGS_GRAYSCALE))!=0);var bL=((m_gameDataFlags[bE][bH]&(GAME_GUI_FLAGS_TRANSPARENT))!=0);var bz=bA[GtsData.GUI_GRAPHITEM_SPRITEID];var bG=bA[GtsData.GUI_GRAPHITEM_FRAMEID];var bB=bA[GtsData.GUI_GRAPHITEM_ANIMID];var bI=s_ASpriteArray[bz];if(bI==null){Warn("PaintGraphItem: Sprite index "+bz+" null");return}var bC=0;if(bA[GtsData.GUI_GRAPHITEM_PALETTE]>0){bC=bI.GetCurrentPalette();bI.SetCurrentPalette(bA[GtsData.GUI_GRAPHITEM_PALETTE])}if(bJ){throw new Eror("Not supported yet!");PFX_EnableEffect(GLPixEffects.k_EFFECT_GRAYSCALE)}if(bL){throw new Eror("Not supported yet!");PFX_EnableEffect(GLPixEffects.k_EFFECT_BLEND);PFX_SetParam(GLPixEffects.k_EFFECT_BLEND,GLPixEffects.k_PARAM_BLEND_AMOUNT,64)}try{if(bB<0){bI.PaintFrame(bD,bG,bA[GtsData.GUI_POSX]+bM,bA[GtsData.GUI_POSY]+bK,0)}else{bB&=~(k_GraphItem_AnimTypeMask);bI.PaintAFrame(bD,bB,bG,bA[GtsData.GUI_POSX]+bM,bA[GtsData.GUI_POSY]+bK,0)}}catch(bF){Err("Error when paint sprite idx "+bz);throw bF}if(bL){PFX_DisableEffect(GLPixEffects.k_EFFECT_BLEND)}if(bJ){PFX_DisableEffect(GLPixEffects.k_EFFECT_GRAYSCALE)}if(bA[GtsData.GUI_GRAPHITEM_PALETTE]>0){bI.SetCurrentPalette(bC)}}function a7(bU,bA,bB,bM,bL){if(arguments.length===4){bL=arguments[3],bM=arguments[2],bB=arguments[1],bA=arguments[0];bU=GLLib.statics.g}var bN=m_gameData[bA][bB];var bT=((m_gameDataFlags[bA][bB]&(GAME_GUI_FLAGS_PRESSED))!=0);j(s_gui_outRect,bA,bB,bM,bL);bT=bT&&c(Input_GetPointerPosX_SYNC(),Input_GetPointerPosY_SYNC(),s_gui_outRect[0],s_gui_outRect[1],s_gui_outRect[2],s_gui_outRect[3]);var bO=((m_gameDataFlags[bA][bB]&(GAME_GUI_FLAGS_SHOW_IGP_NEW))!=0);var bW=((m_gameDataFlags[bA][bB]&(GAME_GUI_FLAGS_DISABLED))!=0);var bG=((m_gameDataFlags[bA][bB]&(GAME_GUI_FLAGS_GRAYSCALE))!=0);var bK=((m_gameDataFlags[bA][bB]&(GAME_GUI_FLAGS_TRANSPARENT))!=0);var bH=bN[GtsData.GUI_BUTTON_SPRITEID];var bV=bT?bN[GtsData.GUI_BUTTON_PALETTEPRESSED]:bN[GtsData.GUI_BUTTON_PALETTE];if(bW){bV=bN[GtsData.GUI_BUTTON_PALETTEDISABLED]}var bD;if(bW){if(bN[GtsData.GUI_BUTTON_FRAMEIDDISABLED]!=-1){bD=bN[GtsData.GUI_BUTTON_FRAMEIDDISABLED]}else{bD=bN[GtsData.GUI_BUTTON_FRAMEID]}}else{bD=bT?bN[GtsData.GUI_BUTTON_FRAMEIDPRESSED]:bN[GtsData.GUI_BUTTON_FRAMEID]}var bQ=s_ASpriteArray[bH];if(bQ==null){Warn("PaintGraphItem: Sprite index "+bH+" null");return}var bE=0;if(bV>0){bE=bQ.GetCurrentPalette();bQ.SetCurrentPalette(bV)}if(bG){PFX_EnableEffect(GLPixEffects.k_EFFECT_GRAYSCALE)}if(bK){PFX_EnableEffect(GLPixEffects.k_EFFECT_BLEND);PFX_SetParam(GLPixEffects.k_EFFECT_BLEND,GLPixEffects.k_PARAM_BLEND_AMOUNT,64)}bQ.PaintFrame(bU,bD,bN[GtsData.GUI_POSX]+bM,bN[GtsData.GUI_POSY]+bL,0);if(bV>0){bQ.SetCurrentPalette(bE)}if(bN[GtsData.GUI_BUTTON_OVERSPRITEID]>=0){var bY=bT?bN[GtsData.GUI_BUTTON_OVERPALPRESSED]:bN[GtsData.GUI_BUTTON_OVERPAL];var bR=s_ASpriteArray[bN[GtsData.GUI_BUTTON_OVERSPRITEID]];bE=bR.GetCurrentPalette();bR.SetCurrentPalette(bY);var bC=bN[GtsData.GUI_BUTTON_OVERFRAMEID];bR.PaintFrame(bU,bC,bN[GtsData.GUI_POSX]+bM+bN[GtsData.GUI_BUTTON_OVEROFFSETX],bN[GtsData.GUI_POSY]+bL+bN[GtsData.GUI_BUTTON_OVEROFFSETY],0);bR.SetCurrentPalette(bE)}if(m_gameDataStrings[bA][bB]!=null){aN=m_gameDataStrings[bA][bB];var bP=bN[GtsData.GUI_BUTTON_FONT];bw(bP);var bz=bN[GtsData.GUI_BUTTON_TEXTPALETTE];var bX=0;if(bz>0){bX=s_sprFont.GetCurrentPalette();s_sprFont.SetCurrentPalette(bz)}if((typeof aN=="string")&&bN[GtsData.GUI_BUTTON_MULTILINETEXT]==1){var bS=GetScreenWidth();var bI=1;var bJ=aq(bS,bI);var bF=s_sprFont.WraptextB(aN,bS,bI,Language.CN);s_sprFont.DrawPageB(bU,aN,bF,bN[GtsData.GUI_POSX]+bM+bN[GtsData.GUI_BUTTON_TEXTOFFSETX],bN[GtsData.GUI_POSY]+bL+bN[GtsData.GUI_BUTTON_TEXTOFFSETY],0,-1,VCENTER|HCENTER)}else{s_sprFont.DrawString(bU,aN,bN[GtsData.GUI_POSX]+bM+bN[GtsData.GUI_BUTTON_TEXTOFFSETX],bN[GtsData.GUI_POSY]+bL+bN[GtsData.GUI_BUTTON_TEXTOFFSETY],VCENTER|HCENTER)}if(bz>0){s_sprFont.SetCurrentPalette(bX)}}if(bK){PFX_DisableEffect(GLPixEffects.k_EFFECT_BLEND)}if(bG){PFX_DisableEffect(GLPixEffects.k_EFFECT_GRAYSCALE)}}function a1(bz,bB){var bA=m_gameData[bz][bB];SetClip(bA[GtsData.GUI_POSX],bA[GtsData.GUI_POSY],bA[GtsData.GUI_CLIPZONE_WIDTH],bA[GtsData.GUI_CLIPZONE_HEIGHT])}function M(bP,bO,bM,bK,bH){var bB,bA,bR,bL,bI;if(typeof bH=="undefined"){bB=g;bA=bP;bR=bO;bL=bM;bI=bK}else{bB=bP;bA=bO;bR=bM;bL=bK;bI=bH}var bN=m_gameData[bA][bR];var bT=bN[GtsData.GUI_RECT_DELAY];var bG=bN[GtsData.GUI_POSX]+bL;var bE=bN[GtsData.GUI_POSY]+bI;var bJ=bN[GtsData.GUI_RECT_WIDTH];var bS=bN[GtsData.GUI_RECT_HEIGHT];var bD=bN[GtsData.GUI_RECT_RED_COLOR]&255;var bF=bN[GtsData.GUI_RECT_GREEN_COLOR]&255;var bz=bN[GtsData.GUI_RECT_BLUE_COLOR]&255;var bC=bN[GtsData.GUI_RECT_ALPHA_COLOR]&255;var bQ=(bC<<24)|(bD<<16)|(bF<<8)|bz;if(bC==0){}else{SetARGBColor(bQ);FillRect(bB,bG,bE,bJ,bS)}}function f(){if(arguments){switch(arguments.length){case 2:return bj.apply(this,arguments);case 3:if(typeof arguments[0]=="number"){return aG.apply(this,arguments)}else{if(arguments[0] instanceof Graphics){return aA.apply(this,arguments)}else{return aE.apply(this,arguments)}}case 4:return bi.apply(this,arguments);case 5:if(typeof arguments[0]=="number"){return ao.apply(this,arguments)}else{return an.apply(this,arguments)}case 6:return bf.apply(this,arguments);case 7:return bd.apply(this,arguments)}}throw new Error("InvalidArguments")}function aG(bB,bA,bz){f(Text_GetString(bB),bA,bz,0,0)}function ao(bD,bC,bz,bB,bA){f(g,Text_GetString(bD),bC,bz,false,bB,bA)}function bf(bD,bC,bz,bE,bB,bA){f(g,Text_GetString(bD),bC,bz,bE,bB,bA)}function bj(bA,bz){f(m_gameDataStrings[bA][bz],bA,bz,0,0)}function aE(bB,bA,bz){f(bB,bA,bz,0,0)}function aA(bB,bA,bz){f(bB,null,bA,bz,false,0,0)}function bi(bB,bC,bA,bz){f(bB,bC,bA,bz,false,0,0)}function an(bD,bC,bz,bB,bA){f(g,bD,bC,bz,false,bB,bA)}function bd(bE,bG,bF,bB,bz,bI,bH){if(bG==null){return}var bA=m_gameData[bF][bB];var bD=bA[GtsData.GUI_TEXTAREAITEM_DELAY];var bC=bA[GtsData.GUI_TEXTAREAITEM_TEXTID];at(bE,bG,bA[GtsData.GUI_POSX]+bI,bA[GtsData.GUI_POSY]+bH,bA[GtsData.GUI_TEXTAREAITEM_WIDTH],bA[GtsData.GUI_TEXTAREAITEM_HEIGHT],bA[GtsData.GUI_TEXTAREAITEM_V_ALIGN],bA[GtsData.GUI_TEXTAREAITEM_H_ALIGN],bA[GtsData.GUI_TEXTAREAITEM_FONT],bA[GtsData.GUI_TEXTAREAITEM_PALETTE],bA[GtsData.GUI_TEXTAREAITEM_SPECIALPROP])}function at(bU,bK,bH,bG,bI,bT,bB,bJ,bM,bL,bD){if(bK==null){return}var bQ=0;var bz=0;var bO=0;var bN=0;switch(bB){case GtsData.GUI_V_ALIGN_OPTIONS_TOP:bQ=TOP;bN=bG;break;case GtsData.GUI_V_ALIGN_OPTIONS_CENTER:bQ=VCENTER;bN=bG+(bT>>1);break;case GtsData.GUI_V_ALIGN_OPTIONS_BOTTOM:bQ=BOTTOM;bN=bG+bT;break}switch(bJ){case GtsData.GUI_H_ALIGN_OPTIONS_LEFT:bQ|=LEFT;bO=bH;break;case GtsData.GUI_H_ALIGN_OPTIONS_CENTER:bQ|=HCENTER;bO=bH+(bI>>1);break;case GtsData.GUI_H_ALIGN_OPTIONS_RIGHT:bQ|=RIGHT;bO=bH+bI;break}aN=bK;if(s_sprFont==null||bM==GtsData.GUI_FONTS____SYSTEM___){aN="";for(var bR=0;bR<bK.length;bR++){if(bK[bR]!="\\"){aN+=bK[bR]}else{bR++}}var bS=0;switch(bB){case GtsData.GUI_V_ALIGN_OPTIONS_TOP:bS|=Graphics.TOP;break;case GtsData.GUI_V_ALIGN_OPTIONS_CENTER:bS|=Graphics.BASELINE;break;case GtsData.GUI_V_ALIGN_OPTIONS_BOTTOM:bS|=Graphics.BOTTOM;break}switch(bJ){case GtsData.GUI_H_ALIGN_OPTIONS_LEFT:bS|=Graphics.LEFT;break;case GtsData.GUI_H_ALIGN_OPTIONS_CENTER:bS|=Graphics.HCENTER;break;case GtsData.GUI_H_ALIGN_OPTIONS_RIGHT:bS|=Graphics.RIGHT;break}if(typeof getSystemFontFromGUI!="undefined"){SetFont(getSystemFontFromGUI(bM))}SetColor(0,0,0);DrawString(aN,bO+1,bN+1,bQ);SetColor(255,255,255);DrawString(aN,bO,bN,bQ)}else{if(s_sprFont!=null){bw(bM);var bF=s_sprFont.GetCurrentPalette();if(bL>=0){s_sprFont.SetCurrentPalette(bL)}if((typeof aN=="string")&&bD==GtsData.GUI_TEXT_OPTIONS_MULTIPLE_LINES){var bE=aq(bI,bT);var bA=s_sprFont.WraptextB(aN,bI,bT,false);s_sprFont.DrawPageB(bU,aN,bA,bO,bN,0,-1,bQ)}else{if(bD==GtsData.GUI_TEXT_OPTIONS_HORIZONTAL_SCROLL){Z(bU,aN,bH,bG,bI,bT,bB,bJ)}else{if(bD==GtsData.GUI_TEXT_OPTIONS_VERTICAL_SCROLL){var bA=s_sprFont.WraptextB(aN,bI,bT,false);var bC=s_sprFont.GetLineHeight()+s_sprFont.GetLineSpacing();var bV=bA[0]*bC+bT;if(bT>bA[0]*bC){bV+=LowAPI.Float2Int((bT-(bA[0]*bC))/2)}SetClip(bH,bG,bI,bT);if(ab<bV&&ab+bT>=bV){Dbg("cGame_gui.js: VERTICAL SCROLL A!");s_sprFont.DrawPageB(bU,aN,bA,bO,bN+bV-ab,0,-1,bQ)}else{Dbg("cGame_gui.js: VERTICAL SCROLL B!");s_sprFont.DrawPageB(bU,aN,bA,bO,bN-ab,0,-1,bQ)}if(LowAPI.Float2Int(ab+((IDefine.VERTICAL_SCROLL_ADD_Y_DT*s_game_frameDT)/1000))>=bV){K()}if(bu>IDefine.VERTICAL_SCROLL_START_DELAY_DT){ab+=LowAPI.Float2Int((IDefine.VERTICAL_SCROLL_ADD_Y_DT*s_game_frameDT)/1000)}else{bu+=s_game_frameDT}if(Input_IsPointerDragged_SYNC()&&c(Input_GetPointerPosX_SYNC(),Input_GetPointerPosY_SYNC(),bH,bG,bH+bI,bG+bT)){d=true}if(Input_IsPointerReleased_SYNC()){d=false}if(d){ab-=Input_GetDragOffsetY_SYNC();if(ab<=0){ab=0}bu=0}SetClip(0,0,GetScreenWidth(),GetScreenHeight())}else{if(bD==GtsData.GUI_TEXT_OPTIONS_FONT_ADAPTATION){if(bM==GtsData.GUI_FONTS_FONT_BIG){s_sprFont.UpdateStringSize(aN);var bP=ASprite.GetCurrentStringWidth();if(bP>bI){bw(GtsData.GUI_FONTS_FONT_MID)}}}if(typeof aN=="string"){aq(bI,bT)}s_sprFont.DrawString(bU,aN,bO,bN,bQ)}}}s_sprFont.SetCurrentPalette(bF)}}setUseOldFont()}function bw(bz){if(bz==GtsData.GUI_FONTS_FONT_BIG){setUseBigFont()}else{if(bz==GtsData.GUI_FONTS_FONT_MID){setUseMidlFont()}else{setUseMidlFont()}}}function K(){ab=0;bu=0}function Z(bF,bH,bK,bI,bM,bD,bJ,bE){var bG=0;var bC=0;var bA=0;switch(bJ){case GtsData.GUI_V_ALIGN_OPTIONS_TOP:bG=TOP;bA=bI;break;case GtsData.GUI_V_ALIGN_OPTIONS_CENTER:bG=VCENTER;bA=bI+(bD>>1);break;case GtsData.GUI_V_ALIGN_OPTIONS_BOTTOM:bG=BOTTOM;bA=bI+bD;break}switch(bE){case GtsData.GUI_H_ALIGN_OPTIONS_LEFT:bG|=LEFT;bC=bK;break;case GtsData.GUI_H_ALIGN_OPTIONS_CENTER:bG|=HCENTER;bC=bK+(bM>>1);break;case GtsData.GUI_H_ALIGN_OPTIONS_RIGHT:bG|=RIGHT;bC=bK+bM;break}var bO=s_sprFont.GetFontHeight();var bL=bA-(bO>>1);s_sprFont.UpdateStringSize(bH);var bB=ASprite._text_w;if(bB>bM){var bz=Y(bH);if(bz==IDefine.INVALID_VALUE){var bN=z();if(bN!=IDefine.INVALID_VALUE){a9(bN,bH,bM);bq[bN]+=s_game_frameDT;SetClip(bK,0,bM,GLLibConfiguration.screenHeight);s_sprFont.DrawString(bF,bH,bK,bL,0);SetClip(0,0,GetScreenWidth(),GetScreenHeight())}}else{bq[bz]+=s_game_frameDT;SetClip(bK,0,bM,GLLibConfiguration.screenHeight);s_sprFont.DrawString(bF,bH,bK-p[bz],bL,0);SetClip(0,0,GetScreenWidth(),GetScreenHeight())}}else{s_sprFont.DrawString(bF,aN,bC,bA,bG)}}function Y(bB){var bz=IDefine.INVALID_VALUE;for(var bA=0;bA<IDefine.SIZE_TEN;bA++){if(P[bA]!=null&&bB==P[bA]){bz=bA;break}}return bz}function z(){var bz=IDefine.INVALID_VALUE;for(var bA=0;bA<IDefine.SIZE_TEN;bA++){if(P[bA]==null){bz=bA;break}}return bz}function a9(bz,bB,bA){bq[bz]=0;aK[bz]=0;P[bz]=bB;p[bz]=0;au[bz]=bA;u[bz]=IDefine.STRING_SCROLL_SUSPEND}function A(){for(var bA=0;bA<IDefine.SIZE_TEN;bA++){if(P[bA]!=null){aK[bA]+=s_game_frameDT;s_sprFont.UpdateStringSize(P[bA]);var bz=ASprite._text_w;u[bA]--;if(u[bA]>0){continue}p[bA]+=IDefine.STRING_SCROLL_SPEED;if(p[bA]>bz){p[bA]-=bz;p[bA]-=au[bA]}else{if(p[bA]==0){u[bA]=IDefine.STRING_SCROLL_SUSPEND}}if(aK[bA]-bq[bA]>=2*IDefine.SECOND_MILLIONSECONDS){destroyScrollString(bA)}}}}function aq(bJ,bE){var bI=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];for(var bD=0,bC=0;bD<aN.length;bD++){var bG=aN.charAt(bD);if(bG=="^"){var bB=0;try{bB=Integer.parseInt(aN.substring(bD+1,bD+3))}catch(bF){bB=-1}var bK=IDefine.SCREEN_W;var bA=LowAPI.Float2Int(bK/s_sprFont.GetSpaceWidth()+(bK%s_sprFont.GetSpaceWidth()!=0?3:2));bK=bA*s_sprFont.GetSpaceWidth();var bH=aN.substring(0,bD);for(var bz=0;bz<bA;bz++){bH+=(160).castToChar()}var bL=s_sprFont.WraptextB(bH,bJ,bE);bI[bC]=bB;bI[bC+1]=bL[0];bI[bC+2]=bL[bL[0]*2]-(bK>>1);aN=bH+aN.substring(bD+3);bC+=3}}return bI}function n(bC,bz,bE){var bB=GUI_INPUT_EVENTS.NO_ACTIVATED_BUTTON;var bA;bA=ar(bC);if(Input_CheckState_SYNC(INPUT_FLAG_PRESSED)){var bG=false;var bH=false;for(var bF=(bA-1);(bF>=0)&&(bB==GUI_INPUT_EVENTS.NO_ACTIVATED_BUTTON);bF--){switch(bp(bC,bF)){case GtsData.GUI_BUTTON:var bD=aa(bC,bF,bz,bE);if(bD){bB=bF}break}}}return bB}function t(bD,bz,bG,bA){var bz=bz;var bG=bG;var bA=bA;if(arguments.length<4){bA=-1}if(arguments.length<3){bz=0;bG=0}var bC=GUI_INPUT_EVENTS.NO_ACTIVATED_BUTTON;var bB;bB=ar(bD);if((bA>=0)){var bE=m(bD,bA,bz,bG);if(bE){bC=bA}}else{if(Input_CheckState_SYNC(INPUT_FLAG_PRESSED|INPUT_FLAG_DRAGGED|INPUT_FLAG_RELEASED)){var bI=false;var bJ=false;for(var bH=(bB-1);(bH>=0)&&(bC==GUI_INPUT_EVENTS.NO_ACTIVATED_BUTTON);bH--){switch(bp(bD,bH)){case GtsData.GUI_LAYERZONE:if(Input_CheckState_SYNC(INPUT_FLAG_PRESSED)){bJ|=gui_ProcessInput__processLayerZone(bD,bH,bz,bG);bI=true}break;case GtsData.GUI_BUTTON:var bE=m(bD,bH,bz,bG);if(bE){bC=bH}break;case GtsData.GUI_GUI_SLIDER:var bE=gui_ProcessInput__processSlider(bD,bH,bz,bG);if(bE){bC=bH}break}}if(bI&&(false==bJ)){var bF=gui_ResetFocusLayer(bD);if(bF){Input_ResetPointerEvents()}}if(bD==s_gui_FocusLayer){Input_ResetPointerEvents()}}}if(T(bD)){s_gui_tempPrevFocusLayer=-1;return GUI_INPUT_EVENTS.LOST_FOCUS}return bC}function aa(bB,bA,bC,bD){var bz=false;if(bt(bB,bA)){return bz}if(!aM(bB,bA)){return bz}j(s_gui_outRect,bB,bA,bC,bD);if(c(Input_GetPointerPosX_SYNC(),Input_GetPointerPosY_SYNC(),s_gui_outRect[0],s_gui_outRect[1],s_gui_outRect[2],s_gui_outRect[3])){if(Input_CheckState_SYNC(INPUT_FLAG_PRESSED)){bz=true}}return bz}function m(bA,bz,bC,bD){var bB=false;if(bt(bA,bz)){return bB}if(!aM(bA,bz)){return bB}j(s_gui_outRect,bA,bz,bC,bD);if(c(Input_GetPointerPosX_SYNC(),Input_GetPointerPosY_SYNC(),s_gui_outRect[0],s_gui_outRect[1],s_gui_outRect[2],s_gui_outRect[3])){var bE=false;if(Input_CheckState_SYNC(INPUT_FLAG_PRESSED)){bE=true;ag();by(bA,bz,true)}if(Input_CheckState_SYNC(INPUT_FLAG_DRAGGED)){bE=true;ag();by(bA,bz,true)}if(Input_CheckState_SYNC(INPUT_FLAG_RELEASED)){bE=true;by(bA,bz,false);bB=true}if(bE){Input_ResetPointerEvents()}}else{by(bA,bz,false)}return bB}function c(bF,bE,bB,bD,bz,bC){if(arguments.length===3){throw new Error("TBC");var bA=arguments[2];if(bA.length!=4){return false}bB=bA[0];bD=bA[1];bz=bA[2];bC=bA[3]}if(bF>=bB&&bF<=bz&&bE>=bD&&bE<=bC){return true}return false}function T(bz){return(s_gui_tempPrevFocusLayer==bz)}function ag(){if(m_gameData!=null){for(var bz=0;bz<m_gameData.length;bz++){a0(bz)}}}function a0(bz){if(m_gameData[bz]!=null){for(var bA=0;bA<m_gameData[bz].length;bA++){if(h(bz,bA)==GtsData.GUI_BUTTON){by(bz,bA,false)}}}}function bg(bz,bC,bA,bB){s_gui_clipData[0]=GetClipX();s_gui_clipData[1]=GetClipY();s_gui_clipData[2]=GetClipWidth();s_gui_clipData[3]=GetClipHeight();SetClip(bz,bC,bA,bB)}function ae(){SetClip(s_gui_clipData[0],s_gui_clipData[1],s_gui_clipData[2],s_gui_clipData[3])}function k(bG,bE,bI,bH){var bB=m_gameData[bG][bE];var bF=bB[GtsData.GUI_GUI_PROGRESSBAR_MAX];var bD=bB[GtsData.GUI_GUI_PROGRESSBAR_MIN];var bz=bB[GtsData.GUI_GUI_PROGRESSBAR_PROGRESS];var bC=(bB[GtsData.GUI_GUI_PROGRESSBAR_INVERSE]>0);Assert((bF-bD)!=0," Div By Zero painting progrss bar with values: max: "+bF+"; min: "+bD+"; itemIndex: "+bE);var bA=LowAPI.Float2Int(Math_IntToFixedPoint(bz-bD)/(bF-bD));switch(bB[GtsData.GUI_GUI_PROGRESSBAR_ORIENTATION]){case GtsData.GUI_BAR_ORIENTATION_HORIZONTAL:bA=Math_FixedPointToInt(bA*bB[GtsData.GUI_GUI_PROGRESSBAR_WIDTH]);if(bC){s_gui_outRect[0]=bB[GtsData.GUI_POSX]+bB[GtsData.GUI_GUI_PROGRESSBAR_WIDTH]-bA+bI;s_gui_outRect[1]=bB[GtsData.GUI_POSY]+bH;s_gui_outRect[2]=bA;s_gui_outRect[3]=bB[GtsData.GUI_GUI_PROGRESSBAR_HEIGHT]}else{s_gui_outRect[0]=bB[GtsData.GUI_POSX]+bI;s_gui_outRect[1]=bB[GtsData.GUI_POSY]+bH;s_gui_outRect[2]=bA;s_gui_outRect[3]=bB[GtsData.GUI_GUI_PROGRESSBAR_HEIGHT]}break;case GtsData.GUI_BAR_ORIENTATION_VERTICAL:bA=Math_FixedPointToInt(bA*bB[GtsData.GUI_GUI_PROGRESSBAR_HEIGHT]);if(bC){s_gui_outRect[0]=bB[GtsData.GUI_POSX]+bI;s_gui_outRect[1]=bB[GtsData.GUI_POSY]+bB[GtsData.GUI_GUI_PROGRESSBAR_HEIGHT]-bA+bH;s_gui_outRect[2]=bB[GtsData.GUI_GUI_PROGRESSBAR_WIDTH];s_gui_outRect[3]=bA}else{s_gui_outRect[0]=bB[GtsData.GUI_POSX]+bI;s_gui_outRect[1]=bB[GtsData.GUI_POSY]+bH;s_gui_outRect[2]=bB[GtsData.GUI_GUI_PROGRESSBAR_WIDTH];s_gui_outRect[3]=bA}break}}function bc(bH,bD,bK,bJ){var bB=m_gameData[bH][bD];var bF=[GetClipX(),GetClipY(),GetClipWidth(),GetClipHeight()];var bI=[0,0,0,0];var bG=bB[GtsData.GUI_GUI_PROGRESSBAR_MAX];var bC=bB[GtsData.GUI_GUI_PROGRESSBAR_MIN];var bA=bB[GtsData.GUI_GUI_PROGRESSBAR_PROGRESS];if(LowAPI.Float2Int((bA*100)/(bG-bC))<bB[GtsData.GUI_GUI_PROGRESSBAR_MINPERCENTBLINK]){if((s_game_currentFrameNB&1)==0){return}}var bz=m_spritesGUI[bB[GtsData.GUI_GUI_PROGRESSBAR_SPRITEID]];bz.SetCurrentPalette(bB[GtsData.GUI_GUI_PROGRESSBAR_PALETTE]);k(bH,bD,bK,bJ);var bE=MathEx_GetRectIntersection(bI,bF[0],bF[1],bF[2],bF[3],s_gui_outRect[0],s_gui_outRect[1],s_gui_outRect[2],s_gui_outRect[3]);if(bE){SetClip(bI[0],bI[1],bI[2],bI[3]);bz.PaintFrame(g,bB[GtsData.GUI_GUI_PROGRESSBAR_FRAMEID],bB[GtsData.GUI_POSX]+bK,bB[GtsData.GUI_POSY]+bJ,0);SetClip(bF[0],bF[1],bF[2],bF[3])}}function aT(bA,bz,bB){var bC=m_gameData[bA][bz];bB=((bB)<(bC[GtsData.GUI_GUI_PROGRESSBAR_MIN])?(bC[GtsData.GUI_GUI_PROGRESSBAR_MIN]):((bB)>(bC[GtsData.GUI_GUI_PROGRESSBAR_MAX])?(bC[GtsData.GUI_GUI_PROGRESSBAR_MAX]):(bB)));m_gameData[bA][bz][GtsData.GUI_GUI_PROGRESSBAR_PROGRESS]=bB}function a5(bA,bB,bz){m_gameData[bA][bB][GtsData.GUI_GUI_FACEBOOKAVATAR_IMAGEIDX]=bz}function a6(bN,bM,bK,bI,bG){var bQ,bz,bP,bJ,bH;if(bK==v){bQ=window.g;bz=bN;bP=bM;bJ=0;bH=0}else{if(bI==v){bQ=bN;bz=bM;bP=bK;bJ=0;bH=0}else{if(bG==v){bQ=window.g;bz=bN;bP=bM;bJ=bK;bH=bI}else{bQ=bN;bz=bM;bP=bK;bJ=bI;bH=bG}}}var bL=m_gameData[bz][bP];var bC=((m_gameDataFlags[bz][bP]&(GAME_GUI_FLAGS_GRAYSCALE))!=0);var bF=((m_gameDataFlags[bz][bP]&(GAME_GUI_FLAGS_TRANSPARENT))!=0);var bD=bL[GtsData.GUI_GUI_FACEBOOKAVATAR_SPRITEID];var bA=bL[GtsData.GUI_GUI_FACEBOOKAVATAR_FRAMEID];var bE=bL[GtsData.GUI_GUI_FACEBOOKAVATAR_IMAGEIDX];if(bE==-1||(s_ImageUsers[bE]==null)||(s_ImageUsers[bE].getImage()==null)){var bO=s_ASpriteArray[bD];if(bO==null){return}var bB=0;if(bL[GtsData.GUI_GUI_FACEBOOKAVATAR_PALETTE]>0){bB=bO.GetCurrentPalette();bO.SetCurrentPalette(bL[GtsData.GUI_GUI_FACEBOOKAVATAR_PALETTE])}if(bC){PFX_EnableEffect(GLPixEffects.k_EFFECT_GRAYSCALE)}if(bF){PFX_EnableEffect(GLPixEffects.k_EFFECT_BLEND);PFX_SetParam(GLPixEffects.k_EFFECT_BLEND,GLPixEffects.k_PARAM_BLEND_AMOUNT,64)}bO.PaintFrame(bQ,bA,bL[GtsData.GUI_POSX]+bJ,bL[GtsData.GUI_POSY]+bH,0);if(bF){PFX_DisableEffect(GLPixEffects.k_EFFECT_BLEND)}if(bC){PFX_DisableEffect(GLPixEffects.k_EFFECT_GRAYSCALE)}if(bL[GtsData.GUI_GRAPHITEM_PALETTE]>0){bO.SetCurrentPalette(bB)}}else{if((s_ImageUsers[bE]!=null)&&(s_ImageUsers[bE].getImage()!=null)){DrawImage(s_ImageUsers[bE].getImage(),bL[GtsData.GUI_POSX]+bJ,bL[GtsData.GUI_POSY]+bH,TOP|LEFT)}}}function G(bz,bB,bA){m_gameData[bz][bB][GtsData.GUI_GUI_FACEBOOKAVATAR_VISIBLE]=(bA?GtsData.GUI_BOOLEAN_LIST_TRUE:GtsData.GUI_BOOLEAN_LIST_FALSE)}function N(bA,bz){if(bz==m_gameData[bA].length){return}var bE=LowAPI.Gen_Array([bz],null);var bD=LowAPI.Gen_Array([bz],0);var bC=LowAPI.Gen_Array([bz],null);var bB=0;while((bB<m_gameData[bA].length)&&(bB<bz)){bE[bB]=m_gameData[bA][bB];bD[bB]=m_gameDataFlags[bA][bB];bC[bB]=m_gameDataStrings[bA][bB];bB++}m_gameData[bA]=bE;m_gameDataFlags[bA]=bD;m_gameDataStrings[bA]=bC}function bm(bL,bJ,bH,bF,bE){var bK,bz,bA,bB,bD;if(bF==v){bK=bL,bz=bL,bA=bJ,bB=bH,bD=1}else{bK=bL,bz=bJ,bA=bH,bB=bF,bD=bE}var bM,bC;for(var bI=0;bI<bD;bI++){bM=bA+bI;bC=bB+bI;m_gameData[bz][bC]=null;m_gameData[bz][bC]=LowAPI.Gen_Array([m_gameDataClean[bK][bM].length],0);for(var bG=0;bG<m_gameData[bK][bM].length;bG++){m_gameData[bz][bC][bG]=m_gameData[bK][bM][bG]}m_gameDataFlags[bz][bC]=m_gameDataFlags[bK][bM];if(m_gameDataStrings[bK][bM]!=null){m_gameDataStrings[bz][bC]=m_gameDataStrings[bK][bM].toString()}}}function a4(bz,bA){s_ImageUsers[bA]=bz}function aS(bL,bK,bJ,bD,bG){var bA=U(bL,bJ,GtsData.GUI_GRAPHITEM_SPRITEID);var bI=U(bL,bJ,GtsData.GUI_GRAPHITEM_FRAMEID);var bF=m_spritesGUI[bA];if(bF!=null){var bz=bF.GetFrameWidth(bI);bF.GetFrameRect(s_gui_outRect,bI,0,0,0);var bB=s_gui_outRect[2];var bC=r(bL,bK);var bH=bC+bG+bz;var bE=LowAPI.Float2Int(bD-(bH/2));W(bL,bK,GtsData.GUI_POSX,bE);W(bL,bJ,GtsData.GUI_POSX,bE+bH-bB)}}function aI(){return aO}function a8(){return aZ}function ad(bB,bA,bz){guiMgr_iCurrentLayerType=bB;av(bB,bA,bz)}function D(bz){return s_guiMgr_aGuiLayers[bz]}function bn(bz){return guiMgr_layerActive[bz]}function bb(bA,bz){guiMgr_lastLayerActive[bA]=guiMgr_layerActive[bA];guiMgr_layerActive[bA]=bz}function bh(bz){return((guiMgr_layerFlags[bz]&(GUI_LAYER_FLAG__LOCKED))!=0)}function i(bA,bz){if(bz){guiMgr_layerFlags[bA]|=(GUI_LAYER_FLAG__BLOCKSINPUT)}else{guiMgr_layerFlags[bA]&=~(GUI_LAYER_FLAG__BLOCKSINPUT)}}function H(bA,bz){if(bz){guiMgr_layerFlags[bA]|=(GUI_LAYER_FLAG__BLOCKSPAINT)}else{guiMgr_layerFlags[bA]&=~(GUI_LAYER_FLAG__BLOCKSPAINT)}}function am(bz){return((guiMgr_layerFlags[bz]&(GUI_LAYER_FLAG__WIP))!=0)}function aJ(){if(guiMgr_layerActive==null){guiMgr_layerActive=LowAPI.Gen_Array([GUI_LAYERS_TOTAL],false)}if(guiMgr_lastLayerActive==null){guiMgr_lastLayerActive=LowAPI.Gen_Array([GUI_LAYERS_TOTAL],false)}if(guiMgr_layerFlags==null){guiMgr_layerFlags=LowAPI.Gen_Array([GUI_LAYERS_TOTAL],0)}if(guiMgr_layerState==null){guiMgr_layerState=LowAPI.Gen_Array([GUI_LAYERS_TOTAL],0)}if(guiMgr_wasPaintedLastFrame==null){guiMgr_wasPaintedLastFrame=LowAPI.Gen_Array([GUI_LAYERS_TOTAL],false)}if(guiMgr_layerOffsetData==null){guiMgr_layerOffsetData=LowAPI.Gen_Array([GUI_LAYERS_TOTAL,GUILAYER_DATA_TOTAL],0)}if(guiMgr_layerNbInitCalls==null){guiMgr_layerNbInitCalls=LowAPI.Gen_Array([GUI_LAYERS_TOTAL],0)}for(var bz=0;bz<GUI_LAYERS_TOTAL;bz++){guiMgr_layerActive[bz]=false;guiMgr_lastLayerActive[bz]=false;guiMgr_layerFlags[bz]=0;guiMgr_layerNbInitCalls[bz]=0;guiMgr_layerState[bz]=GUI_STATE_IDLE;guiMgr_wasPaintedLastFrame[bz]=false;guiMgr_layerOffsetData[bz][GUILAYER_DATA_GLOBALOFFSETX]=0;guiMgr_layerOffsetData[bz][GUILAYER_DATA_GLOBALOFFSETY]=0;guiMgr_layerOffsetData[bz][GUILAYER_DATA_LOCALOFFSET]=0;guiMgr_layerOffsetData[bz][GUILAYER_DATA_TIMER]=0}aj(false)}function aj(bA){for(var bz=0;bz<GUI_LAYERS_TOTAL;bz++){bb(bz,bA)}}function aL(bz){return guiMgr_layerState[bz]}function aR(bA,bz){guiMgr_layerState[bA]=bz}function aD(bF,bz,bA,bD){var bA=bA;var bD=bD;if(arguments.length<4){bD=0}if(arguments.length<3){bA=false}guiMgr_layerFlags[bF]=bD;if(bz||(!bz&&!bA)){bb(bF,bz)}if(bz){B(bF)}if(bA&&guiMgr_layerActive[bF]){y(bF,bz)}if(bz&&!guiMgr_layerActive[bF]){guiMgr_lastLayerActive[bF]=false}var bB=D(bF);var bE=ar(bB);var bC=(bE-1);Dbg("detect layer: "+bB);for(bC;bC>=0;bC--){switch(bp(bB,bC)){case GtsData.GUI_BUTTON:if(U(bB,bC,GtsData.GUI_BUTTON_REQUESTADS)>0){if(bz&&s_isShowAdNewRun){s_isShowAdNewRun=false;j(s_gui_outRect,bB,bC,0,0);isShowAdScreen=true;showAdButton.x=s_gui_outRect[0];showAdButton.y=s_gui_outRect[1];showAdButton.w=s_gui_outRect[2];showAdButton.h=s_gui_outRect[3];showAdButton.layer=bB;showAdButton.btn=bC;showAdButton.adType=U(bB,bC,GtsData.GUI_BUTTON_REQUESTADS)}else{isShowAdScreen=false}}}}}function bl(){l(guiMgr_iCurrentLayerType)}function l(bz){for(var bB=0;bB<GUI_LAYERS_TOTAL;bB++){var bA=D(bB);if(bA==bz){R(bB);return}}}function R(bz){aD(bz,false,false)}function s(bz){bx(s_guiMgr_aGuiLayers[bz]);guiMgr_layerOffsetData[bz][GUILAYER_DATA_GLOBALOFFSETX]=0;guiMgr_layerOffsetData[bz][GUILAYER_DATA_GLOBALOFFSETY]=0;guiMgr_layerFlags[bz]=0}function aH(bA){for(var bz=0;bz<GUI_LAYERS_TOTAL;bz++){if(D(bz)==bA){return bz}}return -1}function C(){for(var bz=0;bz<GUI_LAYERS_TOTAL;bz++){bx(bz)}}function ap(){var bA=false;for(var bz=0;bz<GUI_LAYERS_TOTAL;bz++){bA=aF(bz,bA);if(guiMgr_layerActive[bz]&&((guiMgr_layerFlags[bz]&(GUI_LAYER_FLAG__BLOCKSINPUT))!=0)){break}}}function aF(bH,bG){var bD=-1;var bE;var bB=bG;bE=D(bH);var bz=aI();if((bz>=0)&&(bz!=bE)){return false}if(guiMgr_layerActive[bH]&&(bh(bH)==false)){var bC=guiMgr_layerOffsetData[bH][GUILAYER_DATA_GLOBALOFFSETX];var bA=guiMgr_layerOffsetData[bH][GUILAYER_DATA_GLOBALOFFSETY];var bF=n(bE,bC,bA);bD=t(bE,bC,bA,a8());aQ(bE,bF);af(bE,bD)}return bB}function bs(){for(var bz=0;bz<GUI_LAYERS_TOTAL;bz++){aY(bz);if(guiMgr_lastLayerActive[bz]&&((guiMgr_layerFlags[bz]&(GUI_LAYER_FLAG__BLOCKSINPUT))!=0)){break}}}function bk(){var bB=(GUI_LAYERS_TOTAL-1);for(var bz=0;bz<GUI_LAYERS_TOTAL;bz++){if(guiMgr_lastLayerActive[bz]&&((guiMgr_layerFlags[bz]&(GUI_LAYER_FLAG__BLOCKSPAINT))!=0)){bB=bz;break}}var bA=false;for(var bz=(GUI_LAYERS_TOTAL-1);bz>=0;bz--){var bC=D(bz);if((bz<=bB)&&guiMgr_lastLayerActive[bz]){if(false==guiMgr_wasPaintedLastFrame[bz]){guiMgr_wasPaintedLastFrame[bz]=true;ad(bC,GUI_MESSAGE_GET_FOCUS)}q(bz);if(am(bz)){bA=true}}else{if(guiMgr_wasPaintedLastFrame[bz]){guiMgr_wasPaintedLastFrame[bz]=false;ad(bC,GUI_MESSAGE_LOST_FOCUS)}}if(guiMgr_lastLayerActive[bz]==true&&guiMgr_layerActive[bz]==false){while(guiMgr_layerNbInitCalls[bz]>0){guiMgr_layerNbInitCalls[bz]--;ad(bC,GUI_MESSAGE_CLOSE)}}guiMgr_lastLayerActive[bz]=guiMgr_layerActive[bz]}if(bA){s_sprFont.DrawString(g,"(Layout in progress)",0,0,0)}}function B(bA){var bz=D(bA);o();s(bA);ad(bz,GUI_MESSAGE_INITIALIZE);guiMgr_layerNbInitCalls[bA]++}function aY(bA){if((guiMgr_layerActive[bA])){var bz=D(bA);ad(bz,GUI_MESSAGE_UPDATE)}}function q(bA){var bz=D(bA);s_guiMgr_bAllowLayerPaintAfterPrePaint=true;ad(bz,GUI_MESSAGE_BEFORE_PAINT);if(s_guiMgr_bAllowLayerPaintAfterPrePaint){ak(bz,guiMgr_layerOffsetData[bA][GUILAYER_DATA_GLOBALOFFSETX],guiMgr_layerOffsetData[bA][GUILAYER_DATA_GLOBALOFFSETY])}ad(bz,GUI_MESSAGE_AFTER_PAINT)}function af(bz,bA){ad(bz,GUI_MESSAGE_INPUT_EVENT,bA)}function aQ(bz,bA){ad(bz,GUI_MESSAGE_INPUT_PRESS,bA)}function y(bB,bA){var bz=D(bB);if(bA){ad(bz,GUI_MESSAGE_INTRO)}else{ad(bz,GUI_MESSAGE_OUTRO)}}function o(){for(var bB=0;bB<s_guiMgr_aGuiLayers.length;bB++){var bz=s_guiMgr_aGuiLayers[bB];if(m_gameData[bz]){for(var bA=0;bA<m_gameData[bz].length;bA++){if(h(bz,bA)==GtsData.GUI_BUTTON){by(bz,bA,false)}}}}}function aP(){SetARGBColor(2130706432);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight)}LowAPI.extendObject(ac,{_register_gui_message:aV,gui_InitGameLayers:S,GetItemType:h,LoadGameLayerData:ai,SetGraphitemAnim:F,LayerResetCleanSize:V,ResetLayerData:bx,ResetElementData:L,GetParamValue:U,SetParamValue:W,GetType:bp,GetNumLayerElements:ar,gui_UpdateGameLayerAnims:bv,gui_UpdateGraphItemAnim:a2,PaintAllVisibleItems:ak,PaintItem:ax,GetGraphItemVisibility:ba,SetGraphItemVisibility:X,IsButtonVisible:aM,SetButtonText:b,GetButtonText:a,SetButtonVisibility:x,SetButtonPressed:by,SetButtonEnabled:a3,IsButtonPressed:aU,IsButtonDisabled:bt,IsTextAreaVisible:O,SetTextAreaVisibility:I,GetTextAreaTextWidth:r,GetButtonTextWidth:ah,GetShortenedStringTextArea:e,GetButtonRectOnGUI:j,GetRectAreaRect:E,GetButtonRect:Q,SetTextAreaString:be,GetTextAreaString:aW,PaintGraphItem:w,PaintButton:a7,DoClipZone:a1,PaintRectItem:M,PaintTextAreaItem:f,PaintTextArea:at,setVerticalScrollPara:K,setGUIFont:bw,WraptextSpeIcon:aq,gui_ProcessPressed:n,gui_ProcessInput:t,gui_ProcessInput__processPressed:aa,gui_ProcessInput__processButton:m,isPointInRect:c,gui_IsFocusLost:T,gui_ResetAllLayerButtonsPressedState:ag,gui_ResetLayerButtonsPressedState:a0,gui_SetClip:bg,gui_RestoreClip:ae,GUI_GetProgressBarClipArea:k,GUI_PaintProgressBar:bc,GUI_SetProgressBarProgress:aT,GUI_SetFacebookAvatarLoaded:a5,SetFacebookAvatarVisibility:G,GUI_PaintFacebookAvatar:a6,ResizeLayerNumElems:N,CloneLayerElemData:bm,gui_setAvatarImageUser:a4,gui_alignXTextAndIcon:aS,guiMgr_GetTargetButton_GuiLayerType:aI,guiMgr_GetTargetButton_ElemIdx:a8,guiMgr_SendMessage:ad,guiMgr_GetLayerType:D,guiMgr_GetLayerActiveState:bn,guiMgr_SetLayerActiveState:bb,guiMgr_GetLayerLockState:bh,guiMgr_SetLayerInputBlockState:i,guiMgr_SetLayerPaintBlockState:H,guiMgr_GetLayerWIPState:am,guiMgr_InitGUIManager:aJ,guiMgr_SetLayerActiveStateAll:aj,guiMgr_GetGUILayerState:aL,guiMgr_SetGUILayerState:aR,guiMgr_ActivateGUILayer:aD,guiMgr_CloseCurrentLayer:bl,guiMgr_ResetGUILayer:s,guiMgr_GetGUILayerIndex:aH,guiMgr_ResetAllGUILayers:C,guiMgr_processInputAllGuiLayers:ap,guiMgr_processLayerInput:aF,guiMgr_updateLayers:bs,guiMgr_PaintGUILayers:bk,guiMgr_InitGUILayerInitialize:B,guiMgr_UpdateGUILayer:aY,guiMgr_PaintGUILayer:q,guiMgr_processClick:af,guiMgr_InitGUILayerIntroOutro:y,guiMgr_ResetAllLayerButtonPressedState:o,guiMgr_PaintDarkBackGround:aP,updateScrollString:A,},true)})(window);