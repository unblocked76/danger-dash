(function(k){var a=0;function m(){this.__cActor__initialization__();this._ID=a++}var f=-1;m.ACTOR_TYPE_NONE=-1;m.ACTOR_TYPE_PLAYER=0;m.ACTOR_TYPE_MONSTER=m.ACTOR_TYPE_PLAYER+1;m.ACTOR_TYPE_VISUALACTOR=m.ACTOR_TYPE_MONSTER+1;m.ACTOR_TYPE_SIZE=m.ACTOR_TYPE_VISUALACTOR+1;m.s_listRoots=LowAPI.Gen_Array([IActorLists.ACTOR_LIST_NUM],null);m.s_listTails=LowAPI.Gen_Array([IActorLists.ACTOR_LIST_NUM],null);m.s_listFlags=LowAPI.Gen_Array([IActorLists.ACTOR_LIST_NUM],0);m.ACTORLIST_NO_Z=(2147483648).castToInt();m.STATE_MESSAGE_ENTER=0;m.STATE_MESSAGE_EXIT=m.STATE_MESSAGE_ENTER+1;m.STATE_MESSAGE_BEGIN_STEP=m.STATE_MESSAGE_EXIT+1;m.STATE_MESSAGE_INPUT_EVENT=m.STATE_MESSAGE_BEGIN_STEP+1;m.STATE_MESSAGE_STEP=m.STATE_MESSAGE_INPUT_EVENT+1;m.STATE_MESSAGE_END_STEP=m.STATE_MESSAGE_STEP+1;m.STATE_MESSAGE_PAINT=m.STATE_MESSAGE_END_STEP+1;m.STATE_MESSAGE_PAINT_ONBUFFER=m.STATE_MESSAGE_PAINT+1;m.LAST_CONTROL_STATE=m.STATE_MESSAGE_PAINT_ONBUFFER;m.ENTITY_MESSAGE_WAKEUP=m.LAST_CONTROL_STATE+1;m.ENTITY_MESSAGE_TRIGGER=m.ENTITY_MESSAGE_WAKEUP+1;m.ENTITY_STATE_IDLE=0;m.ENTITY_STATE_JUMPING=m.ENTITY_STATE_IDLE+1;m.ENTITY_STATE_SLIDING=m.ENTITY_STATE_JUMPING+1;m.ENTITY_STATE_DEAD=m.ENTITY_STATE_SLIDING+1;m.ENTITY_STATE_DROWNED=m.ENTITY_STATE_DEAD+1;m.ENTITY_STATE_FASTFALL=m.ENTITY_STATE_DROWNED+1;m.ENTITY_LAST_GENERIC_STATE=m.ENTITY_STATE_DROWNED;m.MAP_AVATAR_STATE_MOVING=m.ENTITY_LAST_GENERIC_STATE+1;m.HORIZONTAL_SPEED=4;m.s_timeEnteredState=0;var l={};l.LEFT=0;l.MIDDLE=l.LEFT+1;l.RIGHT=l.MIDDLE+1;l.NUMBER_OF_LANES=l.RIGHT+1;m.TRACK_LANES=l;m.m_iPositionForFinalLane=0;m.m_bForceLaneChange=false;m.s_trackInitialPoint=75;m.JUMPING_HEIGHT=6500;m.JUMPING_ACCELARATION=7;m.TIME_PLAYER_IS_FLUTTERING=1000;m.MAXIMUM_JUMPING_VELOCITY=10;m.GRAVITY=2;m.HOVERING_THRESHOLD_SPEED=6000;m.HOVERING_END_THRESHOLD_SPEED=-100;m.FALLING_THRESHOLD_HEIGHT=30;m.s_stateToSwitchAfterJumping=0;m.s_isPlayerJumping=false;m.s_isPlayerHovering=false;m.s_isPlayerFalling=false;m.s_timePlayerArrivedToHoveringPosition=0;m.SLIDING_HEIGHT=GLLibConfiguration.screenHeight-30;m.SLIDING_ACCELARATIONS=7;m.s_stateToSwitchAfterSliding=0;m.s_isPlayerStartSliding=false;m.s_isPlayerSliding=false;m.s_isPlayerEndSliding=false;m.s_timePlayerReachedToTheGround=0;m.FASTFALL_INITIAL_SPEED=-20;m.s_actor_bAcceptedInput=false;m.PLAYER_WIDTH=159;m.PLAYER_HEIGHT=100;m.PLAYER_LENGTH=50;m.k_offroad_side_left=1;m.k_offroad_side_right=2;m.MAX_Z_DIFF_FOR_COLLISIONS=100;m.goInsideTurnSpeed=4;m.s_activationSegment=0;m.s_activationWarning=false;m.s_use_damage_system=false;m.s_soft_damage_offset=0;m.s_draw_damage_before_add_sprite=false;m.k_collision_additional_offset=50;m.k_car_height=200;m._carLastAnim=0;m._carRequestedAnim=0;m.s_fxAnim=0;m.s_fxTime=0;m.s_fxTotalTime=0;m.s_fxLoop=false;m.s_fxPriority=0;m.s_fxZoomedAnim=false;m.s_fxZoomMultiplier=0;m.s_fxYTranslation=0;m.s_playerCarSprite=null;m.s_carsFxSprite=null;m.s_carsShadowSprite=null;m.s_carsShadowFrame=0;m.s_carsSparkSprite=null;m.s_playerTestTime=0;m.s_playerTestDist=0;m.s_playerDeltaLatFromTurn=0;m.sLastBrakeTime=0;m.s_timer=0;m.s_isContingJumping=false;m.s_countJumpingExploit=0;m.k_collDataCarLeftObjRightDistance=0;m.k_collDataCarRightObjLeftDistance=1;m.k_collDataLeftColOccured=2;m.k_collDataRightColOccured=3;m.k_collDataLeftLimit=4;m.k_collDataRightLimit=5;m.k_collDataF3dLeft=6;m.k_collDataF3dRight=7;m.k_collDataF3dHeight=8;m.k_collDataColType=9;m.k_collDataSize=10;m.s_collisionData=LowAPI.Gen_Array([m.k_collDataSize],0);m.s_collisionDataLeftRight=LowAPI.Gen_Array([m.k_collDataSize],0);m._speedCoef=0;m._speedVCoef=0;m._moveDepthCoef=0;m.k_different_fork_car_distance=100000000;m.CINETIC_LINES_MAX_PARTICLES=20;m.CINETIC_LINES_BASE_SPEED=30;m.CINETIC_LINES_PLAYER_SPEED_REDUCTION=100;m.s_particles=null;m.k_max_particles_in_scene=100;m.s_auxActor=null;m.prototype.__cActor__initialization__=function(){this.reviveDt=0;this.m_iLastState=-1;this.m_iCurrentState=m.ENTITY_STATE_IDLE;this.m_iNextState=-1;this.m_bLockSwitching=false;this.m_bExitCurrentState=false;this.m_bEnterNextState=true;this._computedProjection=false;this._afterTakedownTimer=0;this._segmentToLead=900;this._accelerationAddInLead=0;this._damageState=null;this._changeLaneOffset=0;this._doChangeLane=false;this._money=0;this._invincibleTime=0;this._carIsOnSpringBoard=false;this._carFallingDownTimer=0;this._urbanHavocDestroyedObjectsCount=0;this._team=0;this._takedownCount=0;this._id=0;this._type=0;this._lastTakedownTime=0;this._alive=false;this._shadow=false;this._invert=false;this._preferredLane=2;this._speed=0;this._speedOld=0;this._deltaSpeed=0;this._deltaAccel=0;this._isReviveAccel=false;this._deltaDepth=0;this._deltaDepthOld=0;this._maxSpeedAchieved=0;this._steering=0;this._speedAngle=0;this._mainAxisAngle=0;this._maxDiffCarCameraAngle;this._curveRadius=0;this._centripetalForceDirection=0;this._centripetalForceDirectionOld=0;this._autoTurn=false;this._segOn=0;this._relocateToMe=false;this._segsPassedFromStartLine=0;this._segOld=0;this._segXOn=0;this._segXOld=0;this._segRespawn=0;this._segYOn=0;this._segYOld=0;this._segXCollisionOff=0;this._segZOn=0;this._segZOnOld=0;this._segZOnMax=0;this._lapOn=0;this._lapOld=0;this._drawX=0;this._drawY=0;this._drawShadowY=0;this._drawZoom=0;this._drawZoom100=0;this._segExtract=0;this._deltaX=0;this._zSpeed=0;this._zSpeedOld=0;this._isFlying=false;this._flyTime=0;this._jumpCount=0;this._collisionJustOccured=false;this._collisionOccured=false;this._collisionTakeDownLeft=false;this._collisionTime=0;this._timeAfterLastTakedown=0;this._collisionType=0;this._in_collision=false;this.time_without_collision=0;this._bRevenge=false;this._carAnim=0;this._car=0;this._aiAtt_overallSkill=0;this._aiAtt_brakeEfficacy=0;this._aiAtt_accelEfficacy=0;this._aiAtt_autoBrakeSeg=0;this._aiAtt_autoBreakSpeed=0;this._aiAtt_optLineMagnetism=0;this._carFrame=0;this._carFrameTakedown=0;this._carFrameTakedownOffset=0;this._carTakedownDrawFlags=0;this.wouldCollisionLeft=false;this.wouldCollisionUpright=false;this.wouldCollisionRight=false;this.wouldCollisionOnground=false;this.hoveringDelta=0;this.hoveringTrigger=false;this.m_iCurrentTrack=0;this.m_next=null;this.m_prev=null;this.m_actorListID=-1;this.m_type=0;this.velocity=0;this.m_x=0;this.m_y=0;this.m_z=0;this.m_offsetX=0;this.m_offsetY=0;this.m_prevX=0;this.m_prevY=0;this.m_vx=0;this.m_vy=0;this.m_vz=0;this.m_screenX=0;this.m_screenY=0;this.m_lastZ=0;this.m_flags=0;this.m_paletteID=0;this.m_data=null;this.m_animationPlayer=null};m.ActorLists_UpdateAll=function(){for(var r=0;r<IActorLists.ACTOR_LIST_NUM;r++){m.ActorLists_UpdateList(r)}};m.ActorLists_UpdateList=function(t){if((m.s_listFlags[t]&IActorListFlags.ACTOR_LIST_FLAG_UPDATE)==0){var s=m.s_listRoots[t];var r=null;while(s!=null){r=s.m_next;s.StateMachine_Update();s.StateMachine_SendMessage(m.STATE_MESSAGE_STEP);s=r}}};m.ActorLists_UpdateListPosition=function(A,s,z,w){var t=0;var r=0;if((m.s_listFlags[A]&IActorListFlags.ACTOR_LIST_FLAG_UPDATE)==0){var v=m.s_listRoots[A];var u=null;while(v!=null){u=v.m_next;if(v.m_y<z){r=z-v.m_y;v.m_y+=LowAPI.Float2Int(w*s_game_frameDT/1000)}else{if(v.m_y>z){r=z-v.m_y;v.m_y-=LowAPI.Float2Int(w*s_game_frameDT/1000)}else{r=0}}if(r<0&&v.m_y<z){v.m_y=z}else{if(r>0&&v.m_y>z){v.m_y=z}}if(r<0){r=-r}if(v.m_x<s){t=s-v.m_x;v.m_x+=LowAPI.Float2Int(w*s_game_frameDT*t/(r*1000));if(v.m_x>s){v.m_x=s}}else{if(v.m_x>s){t=v.m_x-s;v.m_x-=LowAPI.Float2Int(w*s_game_frameDT*t/(r*1000));if(v.m_x<s){v.m_x=s}}else{t=1}}if(t==0){t=1}v=u}}};m.ActorLists_DrawList=function(t,r){if(arguments.length<2){r=false}if((m.s_listFlags[t]&IActorListFlags.ACTOR_LIST_FLAG_DRAW)==0){var s=m.s_listRoots[t];while(s!=null){if((s.m_flags&IActorFlags.INVISIBLE)==0){if(r){s.StateMachine_SendMessage(m.STATE_MESSAGE_PAINT_ONBUFFER)}else{s.StateMachine_SendMessage(m.STATE_MESSAGE_PAINT)}}s=s.m_next}}};m.ActorLists_ClearAll=function(){for(var r=0;r<IActorLists.ACTOR_LIST_NUM;r++){m.ActorLists_ClearList(r)}i()};m.ActorLists_ClearList=function(r){while(m.s_listRoots[r]!=null){m.s_listRoots[r].Remove()}};m.ActorLists_GetFirstActor=function(r){if(r>=m.s_listRoots.length){return null}return m.s_listRoots[r]};m.ActorLists_GetNextActor=function(r){if(r==null){return null}return r.m_next};m.ActorLists_InsertInList=function(t,u){if(t.m_actorListID==u){return}t.m_actorListID=u;t.m_lastZ=t.GetZOrder();var r=null;var s=m.s_listRoots[u];while((s!=null)&&((t.m_lastZ>s.GetZOrder())||(t.m_lastZ==m.ACTORLIST_NO_Z))){r=s;s=s.m_next}t.m_prev=r;t.m_next=s;if(r==null){m.s_listRoots[u]=t}else{r.m_next=t}if(s!=null){s.m_prev=t}else{m.s_listTails[u]=t}};m.prototype.Remove=function(){if(this.m_actorListID==-1){return}if(this.m_prev!=null){this.m_prev.m_next=this.m_next}else{m.s_listRoots[this.m_actorListID]=this.m_next}if(this.m_next!=null){this.m_next.m_prev=this.m_prev}else{m.s_listTails[this.m_actorListID]=this.m_prev}this.m_actorListID=-1;this.m_next=null;this.m_prev=null};m.prototype.GetZOrder=function(){return this.m_z};m.prototype.SendMessage_ACTOR_TYPE_VISUALACTOR=function(r){switch(this.m_iCurrentState){case m.ENTITY_STATE_IDLE:this._handleMessage_ACTOR_TYPE_VISUALACTOR_ENTITY_STATE_IDLE(r);break;default:break}};m.CreateVisualActor=function(r){return m.Create(m.ACTOR_TYPE_VISUALACTOR,r)};m.VisualActor_CreateAnimFx=function(){if(arguments){switch(arguments.length){case 6:return m._VisualActor_CreateAnimFx_IIIIII.apply(this,arguments);case 7:var r=typeof arguments[6];if(r=="number"){return m._VisualActor_CreateAnimFx_IIIIIII.apply(this,arguments)}else{return m._VisualActor_CreateAnimFx_IIIIIIZ.apply(this,arguments)}case 9:var s=typeof arguments[8];if(s=="number"){return m._VisualActor_CreateAnimFx_IIIIIIIII.apply(this,arguments)}else{return m._VisualActor_CreateAnimFx_IIIIIIIIZ.apply(this,arguments)}}}throw new Error("InvalidArguments")};m._VisualActor_CreateAnimFx_IIIIIIZ=function(r,A,w,t,s,v,u){return m.VisualActor_Create(r,A,w,t,s,true,v,0,0,false,-1,-1,false,true,1,u,0)};m._VisualActor_CreateAnimFx_IIIIII=function(r,w,v,t,s,u){return m.VisualActor_CreateAnimFx(r,w,v,t,s,u,0)};m._VisualActor_CreateAnimFx_IIIIIII=function(r,A,w,t,s,v,u){return m.VisualActor_Create(r,A,w,t,s,true,v,0,0,false,-1,-1,false,true,1,true,u)};m._VisualActor_CreateAnimFx_IIIIIIIIZ=function(A,w,v,B,u,s,C,r,t){return m.VisualActor_Create(A,w,v,B,u,true,s,0,0,t,-1,r,false,false,-1,true,C)};m._VisualActor_CreateAnimFx_IIIIIIIII=function(A,w,v,B,r,u,t,C,s){return m.VisualActor_Create(A,w,v,B,r,u,true,t,0,0,false,-1,s,false,false,-1,true,C)};m.VisualActor_CreateAnimFxPalette=function(r,A,w,u,s,t,v){return m.VisualActor_Create(r,A,w,u,s,t,true,v,0,0,false,-1,-1,false,true,1,true,0)};m.VisualActor_Create=function(){if(arguments){switch(arguments.length){case 15:return m._VisualActor_Create_IIIIIZIIIZIIZZI.apply(this,arguments);case 17:return m._VisualActor_Create_IIIIIZIIIZIIZZIZI.apply(this,arguments);case 18:return m._VisualActor_Create_IIIIIIZIIIZIIZZIZI.apply(this,arguments)}}throw new Error("InvalidArguments")};m._VisualActor_Create_IIIIIZIIIZIIZZI=function(F,E,D,H,B,u,C,A,v,w,r,t,G,s,I){return m.VisualActor_Create(F,E,D,H,B,u,C,A,v,w,r,t,G,s,I,true,0)};m._VisualActor_Create_IIIIIZIIIZIIZZIZI=function(G,F,E,I,B,u,D,A,v,w,r,t,H,s,K,C,J){return m.VisualActor_Create(G,F,E,I,0,B,u,D,A,v,w,r,t,H,s,K,C,J)};m._VisualActor_Create_IIIIIIZIIIZIIZZIZI=function(v,u,t,C,G,B,D,J,K,I,r,L,E,F,w,A,H,s){m.s_auxActor=m.CreateVisualActor(J);m.s_auxActor.m_x=v;m.s_auxActor.m_y=u;m.s_auxActor.m_z=t;m.s_auxActor.m_vz=D?1:0;m.s_auxActor.m_data=LowAPI.Gen_Array([IVisualActor.ACTOR_DATA_LEN],0);m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_FOLLOWPLAYER]=r?1:0;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_FRAME]=B;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_SPRITE]=C;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_ISANIMATION]=D?1:0;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_DESTROYTIME]=E;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_FROMGUI]=F?1:0;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_PET]=L;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_DESTROYAFTERANIM]=w?1:0;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_WORLDCOORDINATES]=H?1:0;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_CREATION_DELAY_MS]=s;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_PLAYER_ACTION]=PLAYER_ACTION.NONE;m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_PALETTE]=G;if(m.s_auxActor.m_data[IVisualActor.ACTOR_DATA_ISANIMATION]>0){m.s_auxActor.m_animationPlayer=new GLLibPlayer(s_ASpriteArray[C],m.s_auxActor.m_x,m.s_auxActor.m_y);m.s_auxActor.m_animationPlayer.SetAnim(B,A);m.s_auxActor.m_animationPlayer.SetPalette(G)}m.s_auxActor.m_offsetX=K;m.s_auxActor.m_offsetY=I;m.s_auxActor.m_screenX=m.s_auxActor.m_x;m.s_auxActor.m_screenY=m.s_auxActor.m_y;m.s_auxActor.m_screenX+=m.s_auxActor.m_offsetX;m.s_auxActor.m_screenY+=m.s_auxActor.m_offsetY;return m.s_auxActor};m.prototype._handleMessage_ACTOR_TYPE_VISUALACTOR_ENTITY_STATE_IDLE=function(s){if(s==m.STATE_MESSAGE_ENTER){}if(s==m.STATE_MESSAGE_INPUT_EVENT){m.s_actor_bAcceptedInput=false}if(s==m.STATE_MESSAGE_STEP){if(this.m_data[IVisualActor.ACTOR_DATA_CREATION_DELAY_MS]>0){this.m_data[IVisualActor.ACTOR_DATA_CREATION_DELAY_MS]-=s_game_frameDT;if(this.m_data[IVisualActor.ACTOR_DATA_CREATION_DELAY_MS]>0){return}}if(this.m_data[IVisualActor.ACTOR_DATA_ISANIMATION]>0&&this.m_data[IVisualActor.ACTOR_DATA_DESTROYAFTERANIM]>0){if(this.m_animationPlayer.IsAnimOver()){this.Remove()}}else{if(this.m_data[IVisualActor.ACTOR_DATA_DESTROYTIME]>0){this.m_vz+=s_game_frameDT;if(this.m_vz>this.m_data[IVisualActor.ACTOR_DATA_DESTROYTIME]){this.Remove()}}}this.m_screenX=this.m_x;this.m_screenY=this.m_y;this.m_screenX+=this.m_offsetX;this.m_screenY+=this.m_offsetY;if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){this.m_animationPlayer.Update(s_game_frameDT)}if(this.m_data[IVisualActor.ACTOR_DATA_WORLDCOORDINATES]!=0){this.m_screenX+=this.m_offsetX;this.m_screenY+=this.m_offsetY}if(this.m_data[IVisualActor.ACTOR_DATA_ISANIMATION]>0){this.m_animationPlayer.SetPos(this.m_screenX,this.m_screenY)}}if(s==m.STATE_MESSAGE_PAINT){if(this.m_data[IVisualActor.ACTOR_DATA_CREATION_DELAY_MS]>0){return}if(this.m_data[IVisualActor.ACTOR_DATA_ISANIMATION]>0){if(this.m_data[IVisualActor.ACTOR_DATA_FOLLOWPLAYER]>0){this.m_animationPlayer.SetPos(this.m_screenX+s_player._drawX,this.m_screenY+s_player._drawY)}else{this.m_animationPlayer.SetPos(this.m_screenX,this.m_screenY)}this.m_animationPlayer.Render()}else{var r;if(this.m_data[IVisualActor.ACTOR_DATA_FROMGUI]>0){r=m_spritesGUI[this.m_data[IVisualActor.ACTOR_DATA_SPRITE]]}else{r=s_ASpriteArray[this.m_data[IVisualActor.ACTOR_DATA_SPRITE]]}if(this.m_data[IVisualActor.ACTOR_DATA_FOLLOWPLAYER]>0){r.PaintFrame(g,this.m_data[IVisualActor.ACTOR_DATA_FRAME],this.m_screenX+s_player._drawX,this.m_screenY+s_player._drawY,0)}else{r.PaintFrame(g,this.m_data[IVisualActor.ACTOR_DATA_FRAME],this.m_screenX,this.m_screenY,0)}}}};m.prototype.SendMessage_ACTOR_TYPE_PLAYER=function(r){switch(this.m_iCurrentState){case m.ENTITY_STATE_IDLE:this._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_IDLE(r);break;case m.ENTITY_STATE_JUMPING:this._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_JUMPING(r);break;case m.ENTITY_STATE_SLIDING:this._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_SLIDING(r);break;case m.ENTITY_STATE_DEAD:this._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_DEAD(r);break;case m.ENTITY_STATE_DROWNED:this._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_DROWNED(r);break;case m.ENTITY_STATE_FASTFALL:this._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_FASTFALL(r);break;default:break}};m.CreatePlayer=function(r){return m.Create(m.ACTOR_TYPE_PLAYER,r)};m.Player_Create=function(A,w,v,B,u,s,r,C,t){m.s_auxActor=m.CreatePlayer(u);m.s_auxActor.m_x=A;m.s_auxActor.m_y=w;m.s_auxActor.m_z=v;m.s_auxActor.velocity=s_arrayTweaks[ITweaks.LANE_CHANGE_SPEED][0];m.s_auxActor.m_data=LowAPI.Gen_Array([IPlayer.ACTOR_DATA_LEN],0);m.s_auxActor.m_data[IPlayer.ACTOR_DATA_FRAME]=0;m.s_auxActor.m_data[IPlayer.ACTOR_DATA_SPRITE]=B;m.s_auxActor.m_data[IPlayer.ACTOR_DATA_WORLDCOORDINATES]=t?1:0;m.s_auxActor.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]=l.MIDDLE;m.s_auxActor.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]=l.MIDDLE;m.s_auxActor.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]=m.MAXIMUM_JUMPING_VELOCITY;m.s_auxActor.m_animationPlayer=new GLLibPlayer(s_ASpriteArray[B],m.s_auxActor.m_x,m.s_auxActor.m_y);m.s_auxActor.m_animationPlayer.SetAnim(0,-1);m.s_auxActor.m_animationPlayer.SetPalette(s_game_characterIndex);m.s_auxActor.m_offsetX=s;m.s_auxActor.m_offsetY=r;m.s_auxActor.m_screenX=m.s_auxActor.m_x;m.s_auxActor.m_screenY=m.s_auxActor.m_y;m.s_auxActor.m_screenX+=m.s_auxActor.m_offsetX;m.s_auxActor.m_screenY+=m.s_auxActor.m_offsetY;m.s_auxActor.InitPlayer();return m.s_auxActor};m.prototype.InitPlayer=function(){var w=0;var A;m.m_bForceLaneChange=false;A=1;var z=Game.k_segment_length>>1;var t=0;var y=-(Game.k_segment_length>>1);var x=(s_trackLaneCount>>1);var u=(s_cTrack[s_iBifurcationTrack_Main].s_trackTabFlags[0])&1;var s=(s_cTrack[s_iBifurcationTrack_Main].s_trackTabFlags[0]>>1)&1;var B=LowAPI.Float2Int(s_trackRoadHalfWidth/s_trackLaneCount);var r=Math_FixedPointToInt((Math_IntToFixedPoint(-(x-u)+(x-s))>>1)*s_trackRoadHalfWidth);var v=s_trackRoadHalfWidth>>2;v=0;this.reInitPlayer(w,A,z,r,t);this._id=0;this.SetSpeed(0);this._deltaAccel=0;this._isReviveAccel=false;this._money=0;game_ResetPlayerAction()};m.prototype.reInitPlayer=function(t,s,u,r,v){this._relocateToMe=false;this.respawnCar();this._urbanHavocDestroyedObjectsCount=0;this._carAnim=0;this._steering=0;this._speedAngle=0;this._mainAxisAngle=0;this._segXOn=r;this._segXOld=this._segXOn;this._segXCollisionOff=0;this._lapOn=t;this._segOn=s;this._segYOn=u;this.yMove(v);this._speedAngle=0;this._mainAxisAngle=0;this._lapOld=this._lapOn;this._segYOld=this._segYOn;this._segOld=this._segOn;this._segZOn=0;this._segZOnOld=0;this._zSpeed=0;this._flyTime=0;this._jumpCount=0;this.SetSpeed(0);this._speedOld=0;this._deltaSpeed=0;this._deltaDepth=0;this._deltaDepthOld=0;this._collisionOccured=false;this._collisionTime=0;this._shadow=false;this._alive=true;this._invert=false;this._centripetalForceDirectionOld=(Math_Rand(0,2)*2)-1;this._autoTurn=false;this._isFlying=false;this.m_iCurrentTrack=0};var h=[];var n=0;var e=-1;var b=0;window.CHASE__camSegOn_MovIfCatched=0;window.CHASE__camPosOn_MovIfCatched=0;function d(){if(h&&h.length>0&&CHASE__camSegOn_MovIfCatched<=1){CHASE__camPosOn_MovIfCatched+=50;if(CHASE__camPosOn_MovIfCatched>=Game.k_segment_length){CHASE__camPosOn_MovIfCatched-=Game.k_segment_length;CHASE__camSegOn_MovIfCatched++}}}function q(){if(s_game_distance>=((Math_Rand(15,20)*100*1000)*(b+1))){if(!(h&&h.length>0)){p(2)}}}function p(r){if(s_bIntroOver&&!s_game_isTutorialAvailable){if(h&&h.length>0){s_player.player_DoDeath(m.ENTITY_STATE_DEAD,true,e)}else{h=[];n=s_game_distance+Math_Rand(100,200)*1000;Track_startCameraShake(700,60);if(r==1){e=SOUND_TYPE.START_TIGERS_SFX;playSound(SOUND_TYPE.START_TIGERS_SFX,false);c(r,Math_Rand(300,500)*(-1));c(r,Math_Rand(100,300)*(-1));c(r,Math_Rand(0,50));c(r,Math_Rand(300,500));c(r,Math_Rand(100,300))}else{if(r==2){b++;c(r,0)}else{Warn("CHASE : unknown monster type")}}}}}function c(t,s){var r;if(t==1){r=m.Monster_Create(0,0,s_player._deltaDepth,DATA.SPRITE_DATA_WILDTIGER,IActorLists.MAIN,0,0,-1,true);r.isChasing=true;r.reInitMonster(s_player._lapOn,s_player._segOn,s_player._segYOn-Math_Rand(50,100),s,0);h.push(r)}else{if(t==2){r=m.Monster_Create(0,0,s_player._deltaDepth,DATA.SPRITE_DATA_ROCK_ANIM_64,IActorLists.MAIN,0,0,-1,true);r.isChasing=true;r.shadow="none";r.reInitMonster(s_player._lapOn,s_player._segOn,s_player._segYOn+0,s-510,0);r.m_data[IPlayer.ACTOR_DATA_FRAME]=0;h.push(r)}else{Warn("CHASE : unknown monster type")}}Dbg("[Monster]["+r._ID+"] Added.");return r}function o(r){for(var s=0;s<h.length;s++){if(h[s]._ID==r._ID){h.splice(s,1);r.Remove();r=null;break}}}function i(){if(h){for(var r=0;r<h.length;r++){h[r].Remove();h[r]=null;h.splice(r,1)}}h=[];n=0;window.CHASE__camSegOn_MovIfCatched=0;window.CHASE__camPosOn_MovIfCatched=0;e=-1;b=0}function j(r){if(s_game_distance>=n){o(r)}else{r.yMove(s_game_distance_moved);r.m_iCurrentTrack=s_player.m_iCurrentTrack}}m.update_setPlayerMoveToLane=function(r){if(s_player.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]!=s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]){return}switch(s_player.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]){case l.LEFT:if(r){p(1)}else{CurrentExploits_AddExploitValue(IExploit.EX_T_CHANGE_LANE);Achievements_AddAchievementValue(IExploit.EX_T_CHANGE_LANE);s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]=l.MIDDLE;if(s_player.m_iCurrentState==m.ENTITY_STATE_IDLE){if(s_isRidingTiger){s_player.m_animationPlayer.SetAnim(WILDTIGER.ANIM_CHANGE_LANE_RIGHT,1)}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_CHANGE_LANE_RIGHT,1)}}playSound(SOUND_TYPE.PLAYER_SIDE_MOVE_SFX,false)}break;case l.MIDDLE:if(r){CurrentExploits_AddExploitValue(IExploit.EX_T_CHANGE_LANE);Achievements_AddAchievementValue(IExploit.EX_T_CHANGE_LANE);s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]=l.LEFT;if(s_player.m_iCurrentState==m.ENTITY_STATE_IDLE){if(s_isRidingTiger){s_player.m_animationPlayer.SetAnim(WILDTIGER.ANIM_CHANGE_LANE_LEFT,1)}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_CHANGE_LANE_LEFT,1)}}}else{CurrentExploits_AddExploitValue(IExploit.EX_T_CHANGE_LANE);Achievements_AddAchievementValue(IExploit.EX_T_CHANGE_LANE);s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]=l.RIGHT;if(s_player.m_iCurrentState==m.ENTITY_STATE_IDLE){if(s_isRidingTiger){s_player.m_animationPlayer.SetAnim(WILDTIGER.ANIM_CHANGE_LANE_RIGHT,1)}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_CHANGE_LANE_RIGHT,1)}}}playSound(SOUND_TYPE.PLAYER_SIDE_MOVE_SFX,false);break;case l.RIGHT:if(r){CurrentExploits_AddExploitValue(IExploit.EX_T_CHANGE_LANE);Achievements_AddAchievementValue(IExploit.EX_T_CHANGE_LANE);s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]=l.MIDDLE;if(s_player.m_iCurrentState==m.ENTITY_STATE_IDLE){if(s_isRidingTiger){s_player.m_animationPlayer.SetAnim(WILDTIGER.ANIM_CHANGE_LANE_LEFT,1)}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_CHANGE_LANE_LEFT,1)}}playSound(SOUND_TYPE.PLAYER_SIDE_MOVE_SFX,false)}else{p(1)}break}m.m_iPositionForFinalLane=m.update_getCenterPositionOfLane(s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE])};m.update_updatePlayerHorizontalPosition=function(s){if(s_player.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]!=s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]){var t=s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]<s_player.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE];var r=t?-s_player.velocity*s:s_player.velocity*s;if(t){if(s_player._segXOn+r>m.m_iPositionForFinalLane){s_player._segXOn+=r}else{s_player._segXOn=m.m_iPositionForFinalLane;s_player.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]=s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]}}else{if(s_player._segXOn+r<m.m_iPositionForFinalLane){s_player._segXOn+=r}else{s_player._segXOn=m.m_iPositionForFinalLane;s_player.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]=s_player.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]}}}};m.update_getCenterPositionOfLane=function(r){var s=LowAPI.Float2Int((s_trackRoadHalfWidth*2)/l.NUMBER_OF_LANES);return LowAPI.Float2Int(-s_trackRoadHalfWidth+(r*s)+(s/2))};m.update_getLaneFromPosition=function(r){var s=LowAPI.Float2Int((s_trackRoadHalfWidth*2)/l.NUMBER_OF_LANES);r=-r;if(r<s){return l.RIGHT}else{if(r<s*2){return l.MIDDLE}else{return l.LEFT}}};m.prototype.updatePlayer=function(t,u,s){if(arguments.length<3){s=true}if(arguments.length<2){u=true}this._collisionJustOccured=false;var r=(this._segZOn==0);this._centripetalForceDirection=0;if(s){this.UpdateYPos(t)}if(this._isFlying){this._carIsOnSpringBoard=false;this._zSpeedOld=this._zSpeed;if(u){if(this.hoveringDelta>0){this.hoveringDelta-=t}else{this._zSpeed-=t*s_arrayTweaks[ITweaks.GRAVITY][0]}}else{this._zSpeed-=LowAPI.Float2Int(t*s_arrayTweaks[ITweaks.GRAVITY][0]/2)}this._segZOn+=LowAPI.Float2Int(Math_FixedPointToInt(this._zSpeed)*t/10);if(this._segZOn<0){this._isFlying=false;this._zSpeed=0;this._segZOn=0}}r=(this._segZOn==0);if(this._segXOn>=(s_trackRoadHalfWidth+s_trackOffRoadWidth)){this._segXOn=s_trackRoadHalfWidth+s_trackOffRoadWidth}else{if(this._segXOn<=(-(s_trackRoadHalfWidth+s_trackOffRoadWidth))){this._segXOn=-(s_trackRoadHalfWidth+s_trackOffRoadWidth)}}this.updateCameraAngle(t);if(u){this.checkCollisionWithObjectsAndOffroads()}if(s_isRidingTiger){cam_SetDepthFollowData(CAM_MOUNT_EFFECT_TIME,s_camDistOffsetFP,CAM_MOUNT_EFFECT_AMPLITUDE,0)}};m.prototype.UpdateYPos=function(s){var r;this._segXOld=this._segXOn;this._segYOld=this._segYOn;this._segZOnOld=this._segZOn;if(this._segOn!=this._segOld){this._segRespawn=-1}this._segOld=this._segOn;this._lapOld=this._lapOn;this._speedOld=this._speed;if(this._speed>s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED][0]&&s_game_speedUpDt==0){this._speed-=LowAPI.Float2Int((s_arrayTweaks[ITweaks.SPEED_DECREASE][0]*s/s_arrayTweaks[ITweaks.SPEED_DECREASE_TIME][0]))}this._deltaAccel+=s;if(this._deltaAccel>=500){this._deltaAccel-=500;if(this._speed<s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED][0]){if(!s_game_isTutorialAvailable){if(this._isReviveAccel){this._speed+=LowAPI.Float2Int(s_arrayTweaks[ITweaks.PLAYER_REVIVE_ACCEL_PER_SECOND][0]/2)}else{this._speed+=LowAPI.Float2Int(s_arrayTweaks[ITweaks.PLAYER_ACCEL_PER_SECOND][0]/2)}if(this._speed>s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED][0]){this._speed=s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED][0]}}}if(this._speed>this._maxSpeedAchieved){this._maxSpeedAchieved=this._speed;this._isReviveAccel=false}}if(s_game_speedUpDt>0){if(s_game_speedUpActive){this._speed+=s_arrayTweaks[ITweaks.SPEED_BOOST][0];s_game_speedUpActive=false}if(s_game_speedUpDt>0){s_game_speedUpDt-=s;if(s_game_speedUpDt<=0){s_game_speedUpDt=0;this._speed-=s_arrayTweaks[ITweaks.SPEED_BOOST][0]}}}if(s_game_speedDownDt>0){if(s_game_speedDownActive){this._speed-=s_arrayTweaks[ITweaks.SPEED_DECREASE][0];s_game_speedDownActive=false}if(s_game_speedDownDt>0){s_game_speedDownDt-=s;if(s_game_speedDownDt<=0){s_game_speedDownDt=0;this._speed+=s_arrayTweaks[ITweaks.SPEED_DECREASE][0]}}}if(s<=0){s=1}this.SetSpeed(this._speed);if(s_iIntroState==GAME_INTROSTATE_IN_HEADSTART){this._deltaDepth=LowAPI.Float2Int((s*s_arrayTweaks[ITweaks.PLAYER_HEADSTART_SPEED][0])/1000)}else{this._deltaDepth=LowAPI.Float2Int((s*this._speed)/1000)}this.yMove(this._deltaDepth);s_game_distance_moved=this._deltaDepth;s_game_distance_real+=this._deltaDepth;s_game_distSinceLastRelic+=this._deltaDepth;s_game_distance_revive+=this._deltaDepth;if(!tutorial_Update_TutorialStepDistance(this._deltaDepth)){s_iDistInLevel+=this._deltaDepth}};m.prototype.StartJump=function(x,w,u,v){if(arguments.length<4){v=false}var r=1;if(u){r=-1}var s=x;this._zSpeed=r*s;this._isFlying=true;if(s_game_characterIndex!=1){playSound(SOUND_TYPE.PLAYER_JUMP_SFX,false)}else{playSound(SOUND_TYPE.PLAYER_JUMP_SFX_F,false)}};m.prototype.yMove=function(r){var r=LowAPI.Float2Int(r);this._segYOn+=r;while(this._segYOn>=Game.k_segment_length){if(this._type==m.ACTOR_TYPE_PLAYER){s_camCumuledCap+=s_cTrack[this.m_iCurrentTrack].s_trackTabAng[this._segOn];s_camCumuledHeight+=s_cTrack[this.m_iCurrentTrack].s_trackTabInc[this._segOn]}this._segYOn-=Game.k_segment_length;this._segOn++;if(this._segOn>=s_mainTrackNbSegment){this._lapOn++;this._segOn=0}if(this._type==m.ACTOR_TYPE_PLAYER){if(m.m_bForceLaneChange||((r>0)&&(s_cTrack[this.m_iCurrentTrack].s_roadStatus[this._segOn]==TRACKSEGMENT_STATUS.MAINTRACK_END))){var s=(s_trackRoadHalfWidth*2)/l.NUMBER_OF_LANES;if(((this._segXOn==0)&&m.m_bForceLaneChange)||(this._segXOn>0)){this.m_iCurrentTrack=s_iBifurcationTrack_Right;Track_displaceTrackOffset(-2*s);this._segXOn-=2*s;if(this._segXOn<-s){this._segXOn=-s}this.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]=l.LEFT;this.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]=l.LEFT;s_camLatOffset-=2*s;if(s_camLatOffset<-s){s_camLatOffset=-s}CurrentExploits_AddExploitValue(IExploit.EX_T_TURN_RIGHT);Achievements_AddAchievementValue(IExploit.EX_T_TURN_RIGHT);m.m_bForceLaneChange=false}else{if(this._segXOn<0){this.m_iCurrentTrack=s_iBifurcationTrack_Left;Track_displaceTrackOffset(2*s);this._segXOn+=2*s;if(this._segXOn>s){this._segXOn=s}this.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]=l.RIGHT;this.m_data[IPlayer.ACTOR_DATA_FINAL_LANE]=l.RIGHT;s_camLatOffset+=2*s;if(s_camLatOffset>s){s_camLatOffset=s}CurrentExploits_AddExploitValue(IExploit.EX_T_TURN_LEFT);Achievements_AddAchievementValue(IExploit.EX_T_TURN_LEFT);m.m_bForceLaneChange=false}else{this.player_DoDeath(m.ENTITY_STATE_DEAD,true,SOUND_TYPE.COLLISION_WALL_SFX);m.m_bForceLaneChange=true}}}}}if(s_cTrack[this.m_iCurrentTrack].s_roadStatus[this._segOn]==TRACKSEGMENT_STATUS.SLOWDOWN_TIME){bulletTime_SetFrameFactor_Percent(25)}while(this._segYOn<0){if(this._type==m.ACTOR_TYPE_PLAYER){s_camCumuledCap+=s_cTrack[this.m_iCurrentTrack].s_trackTabAng[this._segOn];s_camCumuledHeight+=s_cTrack[this.m_iCurrentTrack].s_trackTabInc[this._segOn]}this._segYOn+=(Game.k_segment_length);this._segOn--;if(this._segOn<0){this._segOn=s_mainTrackNbSegment-1;this._lapOn--}}};m.prototype.drawPlayer=function(F,E){if(BuildConf.k_use_player_car_shadow){this.drawShadow(F,E)}if(this.m_iCurrentState==m.ENTITY_STATE_DROWNED){SetClip(g,0,0,s_screenWidth,E)}else{SetClip(g,0,0,s_screenWidth,s_screenHeight)}s_game_shadowAnimPlayer.SetPos(F,s_player._drawShadowY);s_game_shadowAnimPlayer.Render();s_game_slideDustAnimPlayer.SetPos(F,E);var L=s_camera_distance+s_camDistOffsetFP;if(L==IDevice.k_camera_distance&&s_game_characterIndex!=1){if(this.m_animationPlayer!=null){this.m_animationPlayer.SetPos(F,E);var H=this.m_animationPlayer.GetSprite();var N=this.m_animationPlayer.GetAnim();var r=this.m_animationPlayer.GetFrame();var G=this.m_animationPlayer.GetAnimFrame();var K=H.GetAFrameFlags(N,r);var w=0;var y=0;var s=0;var M=0;var D=0;var C=0;var J=0;var I=0;this.m_animationPlayer.Render()}}else{var H=this.m_animationPlayer.GetSprite();var N=this.m_animationPlayer.GetAnim();var r=this.m_animationPlayer.GetFrame();var G=this.m_animationPlayer.GetAnimFrame();var z=H.GetAFramesOX(N,r);var v=H.GetAFramesOY(N,r);var K=H.GetAFrameFlags(N,r);var w=0;var y=0;var s=0;var M=0;var D=0;var C=0;var J=0;var I=0;if((K&ASprite.FLAG_FLIP_X)!=0){z=-z}var t=100;var u=LowAPI.Float2Int((1000*s_camFocale)/IDevice.k_camera_distance);var B=LowAPI.Float2Int((1000*s_camFocale)/((L==0)?1:L));t=LowAPI.Float2Int((B*100)/u);if(s_isRidingTiger){H.SetCurrentPalette(1)}else{H.SetCurrentPalette(0)}if(H.IsFrameIndexTableBuild(G)){H.PaintFrameScaledA6(g,G,LowAPI.Float2Int(F+((z*t)/100)),LowAPI.Float2Int(E+((v*t)/100)),K,t,t)}else{var A=LowAPI.Float2Int((F+((z*t)/100)));var x=LowAPI.Float2Int((E+((v*t)/100)));H.PaintFrameScaled(g,G,A,x,K,t,t)}}if(s_game_ankhDt>0){s_game_ankhEffectAnimPlayer.SetPos(F,E-180);s_game_ankhEffectAnimPlayer.Render()}if(s_game_goldRushDt>0){s_game_goldRushEffectAnimPlayer.SetPos(F,E-30);s_game_goldRushEffectAnimPlayer.Render()}if(s_bagOfCoinsEmitter!=null){s_bagOfCoinsEmitter.drawAnimParticles(g,s_ASpriteArray[DATA.SPRITE_DATA_COIN_EFFECT],COIN_EFFECT.ANIM_COIN,0,0,false)}if(s_bagOfCoinsSparkleEmitter!=null){s_bagOfCoinsSparkleEmitter.drawAnimParticles(g,s_ASpriteArray[DATA.SPRITE_DATA_GOLD_EFFECT],GOLD_EFFECT.ANIM_PARTICLE2,0,0,false)}if(s_goldrushSparkleEmitter!=null){s_goldrushSparkleEmitter.drawAnimParticles(g,s_ASpriteArray[DATA.SPRITE_DATA_GOLD_EFFECT],GOLD_EFFECT.ANIM_PARTICLE2,0,0,false)}if(s_goldrushLineEmitter!=null){s_goldrushLineEmitter.drawAnimParticles(g,s_ASpriteArray[DATA.SPRITE_DATA_GOLD_EFFECT],GOLD_EFFECT.ANIM_STROKE_0,12,0,0,false)}if(s_FeverModeEmitter!=null){s_FeverModeEmitter.drawAnimParticles(g,s_ASpriteArray[DATA.SPRITE_DATA_GOLD_EFFECT],GOLD_EFFECT.ANIM_STROKE_0,12,0,0,false)}SetClip(g,0,0,s_screenWidth,s_screenHeight);this.DrawParticlesCommon()};m.prototype.player_DoDeath=function(r,t,s){if(s<0){playSound(SOUND_TYPE.COLLISION_WALL_SFX,false)}else{playSound(s,false)}Track_startCameraShake(1000,80);Vibrate(300);if(s_isFeverMode){game_SetFeverMode(false)}s_game_revivePlayer=(s_game_ankhDt>0)||s_bExtraLifeAvailableInSession;s_game_revivePlayerUsingExtraLife=(s_game_ankhDt<=0);if(s_game_revivePlayer){s_game_ankhDt=0;CurrentExploits_AddExploitValue(IExploit.EX_T_REVIVE);Achievements_AddAchievementValue(IExploit.EX_T_REVIVE)}s_game_distance_moved=0;if(t){this._segYOn=0}this.SetSpeed(0);this.StateMachine_SwitchState(r)};m.prototype._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_IDLE=function(s){if(s==m.STATE_MESSAGE_ENTER){cam_SetVertFollowData(false,IDevice.k_camera_height,s_camHauTargetFollowSpeed);if(s_isRidingTiger){s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=WILDTIGER.ANIM_RUN}else{s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_RUN}if(s_player.m_animationPlayer.GetAnim()==CHARACTER_00.ANIM_JUMP_LAND){}else{s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],-1)}}if(s==m.STATE_MESSAGE_INPUT_EVENT){m.s_actor_bAcceptedInput=false}if(s==m.STATE_MESSAGE_STEP){game_Update_CheckInputHorizontallyAndVertically();switch(s_lastPlayerAction){case PLAYER_ACTION.DRAG_UP:if(!s_isRidingTiger){this.StateMachine_SwitchState(m.ENTITY_STATE_JUMPING)}game_ResetPlayerAction();break;case PLAYER_ACTION.DRAG_DOWN:if(!s_isRidingTiger){this.StateMachine_SwitchState(m.ENTITY_STATE_SLIDING)}game_ResetPlayerAction();break;case PLAYER_ACTION.DRAG_LEFT:if(!this.wouldCollisionLeft){m.update_setPlayerMoveToLane(true);game_ResetPlayerAction()}break;case PLAYER_ACTION.DRAG_RIGHT:if(!this.wouldCollisionRight){m.update_setPlayerMoveToLane(false);game_ResetPlayerAction()}break;case PLAYER_ACTION.DOUBLE_TAP:if(game_IsCoinBarFull()){game_SetFeverMode(true);game_ResetPlayerAction()}break}m.update_updatePlayerHorizontalPosition(s_game_frameDT);this.updatePlayer(s_dt);if(this.m_animationPlayer.IsAnimOver()){if(s_isRidingTiger){this.m_animationPlayer.SetAnim(WILDTIGER.ANIM_RUN,-1)}else{this.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_RUN,-1)}}if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){var r=this.getPlayerFrameDT();if(s_game_speedUpDt>0){this.m_animationPlayer.Update(LowAPI.Float2Int(s_game_frameDT*3/2))}else{if(s_game_speedDownDt>0){this.m_animationPlayer.Update(LowAPI.Float2Int(s_game_frameDT*2/3))}else{this.m_animationPlayer.Update(r)}}}}if(s==m.STATE_MESSAGE_PAINT){this.drawPlayer(this._drawX,this._drawY)}if(s==m.STATE_MESSAGE_PAINT_ONBUFFER){}};m.prototype.getPlayerFrameDT=function(){if(s_game_speedUpDt>0){return LowAPI.Float2Int(s_game_frameDT*3/2)}else{if(s_game_speedDownDt>0){return LowAPI.Float2Int(s_game_frameDT*2/3)}else{if(this.m_animationPlayer.GetAnim()==CHARACTER_00.ANIM_RUN||this.m_animationPlayer.GetAnim()==CHARACTER_00.ANIM_TIGER_RUN){var r=0;if(this._speed>=s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED][0]){r=s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED_ANIM_MULTIPLIER][0]}else{if(this._speed<=s_arrayTweaks[ITweaks.PLAYER_INITIAL_SPEED][0]){r=s_arrayTweaks[ITweaks.PLAYER_MIN_SPEED_ANIM_MULTIPLIER][0]}else{r=s_arrayTweaks[ITweaks.PLAYER_MIN_SPEED_ANIM_MULTIPLIER][0]+(this._speed-s_arrayTweaks[ITweaks.PLAYER_INITIAL_SPEED][0])*(s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED_ANIM_MULTIPLIER][0]-s_arrayTweaks[ITweaks.PLAYER_MIN_SPEED_ANIM_MULTIPLIER][0])/(s_arrayTweaks[ITweaks.PLAYER_MAX_SPEED][0]-s_arrayTweaks[ITweaks.PLAYER_INITIAL_SPEED][0])}}return LowAPI.Float2Int(s_game_frameDT*r/100)}else{return(s_game_frameDT)}}}};m.prototype._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_JUMPING=function(r){if(r==m.STATE_MESSAGE_ENTER){cam_SetVertFollowData(false,LowAPI.Float2Int(IDevice.k_camera_height+(s_player._segZOn/2)),CAM_HEIGHT_FOLLOW_SPEED_INSTANT);if(s_isRidingTiger){}else{s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_JUMP_START}m.s_stateToSwitchAfterJumping=m.ENTITY_STATE_IDLE;s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]=m.MAXIMUM_JUMPING_VELOCITY;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],1);m.s_isPlayerJumping=true;m.s_isPlayerFalling=false;m.s_isPlayerHovering=false;s_player.hoveringTrigger=true;this.StartJump(s_arrayTweaks[ITweaks.JUMP_SPEED][0],s_game_frameDT,false);m.s_isContingJumping=true}if(r==m.STATE_MESSAGE_INPUT_EVENT){m.s_actor_bAcceptedInput=false}if(r==m.STATE_MESSAGE_STEP){if(!m.s_isPlayerJumping&&!m.s_isPlayerHovering&&!m.s_isPlayerFalling){if(s_isRidingTiger){Track_startCameraShake(400,40)}this.StateMachine_SwitchState(m.s_stateToSwitchAfterJumping)}game_Update_CheckInputHorizontallyAndVertically();switch(s_lastPlayerAction){case PLAYER_ACTION.DRAG_DOWN:this.StateMachine_SwitchState(m.ENTITY_STATE_FASTFALL);break;case PLAYER_ACTION.DRAG_LEFT:m.update_setPlayerMoveToLane(true);break;case PLAYER_ACTION.DRAG_RIGHT:m.update_setPlayerMoveToLane(false);break;case PLAYER_ACTION.DRAG_UP:if(m.s_isPlayerHovering||m.s_isPlayerFalling){m.s_stateToSwitchAfterJumping=m.ENTITY_STATE_JUMPING}break}game_ResetPlayerAction();m.update_updatePlayerHorizontalPosition(s_game_frameDT);m.update_calculatePlayerPositionForJumping();this.updatePlayer(s_dt);if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){this.m_animationPlayer.Update(s_game_frameDT)}cam_SetVertFollowData(false,LowAPI.Float2Int(IDevice.k_camera_height+(s_player._segZOn/2)),CAM_HEIGHT_FOLLOW_SPEED_INSTANT)}if(r==m.STATE_MESSAGE_PAINT){this.drawPlayer(this._drawX,this._drawY)}if(r==m.STATE_MESSAGE_EXIT){cam_SetVertFollowData(false,IDevice.k_camera_height,CAM_HEIGHT_FOLLOW_SPEED_INSTANT);if(!m.s_isContingJumping){m.s_countJumpingExploit=1}}};m.update_calculatePlayerPositionForJumping=function(){var t=s_game_totalExecutionTime-m.s_timeEnteredState;if(m.s_isPlayerJumping){var r=LowAPI.Float2Int(s_game_frameDT/10);s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]-=LowAPI.Float2Int(m.GRAVITY*r/10);s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]=Math_Max(s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY],1);var s=s_player.m_y-s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]*r;if(s_player._zSpeed<=m.HOVERING_THRESHOLD_SPEED){m.s_isPlayerJumping=false;m.s_isPlayerHovering=true;if(s_isRidingTiger){}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_TRANSITION,1)}s_player.m_y=m.JUMPING_HEIGHT;m.s_timePlayerArrivedToHoveringPosition=s_game_totalExecutionTime;s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]=m.MAXIMUM_JUMPING_VELOCITY}else{s_player.m_y=s;if(s_player.m_animationPlayer.IsAnimOver()){if(s_isRidingTiger){}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_UP,-1)}}}}else{if(m.s_isPlayerHovering){if(s_player.hoveringTrigger&&s_player._zSpeed<=0){s_player.hoveringTrigger=false;s_player._zSpeed=0;s_player.hoveringDelta=s_arrayTweaks[ITweaks.HOVERING_TIME][0]}if(s_player._zSpeed<=m.HOVERING_END_THRESHOLD_SPEED){m.s_isPlayerHovering=false;m.s_isPlayerFalling=true;if(s_isRidingTiger){}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_FALL,1)}}else{if(s_player.m_animationPlayer.IsAnimOver()){if(s_isRidingTiger){}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_TRANSITION_IDLE,-1)}}}}else{if(m.s_isPlayerFalling){var r=LowAPI.Float2Int(s_game_frameDT/10);s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]-=LowAPI.Float2Int(m.GRAVITY*r/10);s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]=Math_Max(s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY],1);var s=s_player.m_y+s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]*r;if(s_player.IsOnGround()){m.s_isPlayerFalling=false;s_player.m_y=PLAYER_START_POS_Y;m.s_timePlayerArrivedToHoveringPosition=s_game_totalExecutionTime;s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]=m.MAXIMUM_JUMPING_VELOCITY;if(s_isRidingTiger){}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_LAND,1)}m.VisualActor_CreateAnimFx(s_player._drawX,s_player._drawY,-9,DATA.SPRITE_DATA_DUST,DUST.ANIM_DUST,IActorLists.EFFECTS);playSound(SOUND_TYPE.PLAYER_JUMP_LAND_SFX,false)}else{s_player.m_y=s;if(s_player.m_animationPlayer.IsAnimOver()){if(s_isRidingTiger){}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_FALL_LOOP,1)}}}}}}};m.prototype._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_SLIDING=function(r){if(r==m.STATE_MESSAGE_ENTER){cam_SetVertFollowData(false,IDevice.k_camera_height+CAM_HEIGHT_OFFSET_SLIDING,CAM_HEIGHT_FOLLOW_SPEED_STANDARD);s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_SLIDE_INTRO;m.s_stateToSwitchAfterSliding=m.ENTITY_STATE_IDLE;s_player.m_data[IPlayer.ACTOR_DATA_SLIDING_VELOCITY]=s_player.velocity;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],1);m.s_isPlayerStartSliding=true;m.s_isPlayerSliding=false;m.s_isPlayerEndSliding=false;playSound(SOUND_TYPE.PLAYER_SLIDE_SFX,false);s_game_shadowAnimPlayer.SetAnim(SHADOW.ANIM_SHADOW_SLIM,-1)}if(r==m.STATE_MESSAGE_INPUT_EVENT){m.s_actor_bAcceptedInput=false}if(r==m.STATE_MESSAGE_STEP){if(!m.s_isPlayerStartSliding&&!m.s_isPlayerSliding&&!m.s_isPlayerEndSliding){s_game_shadowAnimPlayer.SetAnim(SHADOW.ANIM_SHADOW_ANIM,-1);this.StateMachine_SwitchState(m.s_stateToSwitchAfterSliding)}game_Update_CheckInputHorizontallyAndVertically();switch(s_lastPlayerAction){case PLAYER_ACTION.DRAG_UP:s_player.m_data[IPlayer.ACTOR_DATA_SLIDING_VELOCITY]+=m.SLIDING_ACCELARATIONS;m.s_stateToSwitchAfterSliding=m.ENTITY_STATE_JUMPING;m.s_timePlayerReachedToTheGround=0;break;case PLAYER_ACTION.DRAG_LEFT:m.update_setPlayerMoveToLane(true);break;case PLAYER_ACTION.DRAG_RIGHT:m.update_setPlayerMoveToLane(false);break;case PLAYER_ACTION.DRAG_DOWN:m.s_stateToSwitchAfterSliding=m.ENTITY_STATE_SLIDING;break}game_ResetPlayerAction();m.update_updatePlayerHorizontalPosition(s_game_frameDT);m.update_calculatePlayerPositionForSliding();this.updatePlayer(s_dt);if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){this.m_animationPlayer.Update(s_game_frameDT)}}if(r==m.STATE_MESSAGE_PAINT){s_game_slideDustAnimPlayer.Render();this.drawPlayer(this._drawX,this._drawY)}if(r==m.STATE_MESSAGE_PAINT_ONBUFFER){}if(r==m.STATE_MESSAGE_EXIT){cam_SetVertFollowData(false,IDevice.k_camera_height,CAM_HEIGHT_FOLLOW_SPEED_STANDARD)}};m.update_calculatePlayerPositionForSliding=function(){if(m.s_isPlayerStartSliding){var r=s_player.m_y+s_player.m_data[IPlayer.ACTOR_DATA_SLIDING_VELOCITY];if(r>=m.SLIDING_HEIGHT){m.s_isPlayerStartSliding=false;m.s_isPlayerSliding=true;s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_SLIDE_LOOP;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],-1);s_player.m_y=m.SLIDING_HEIGHT;m.s_timePlayerReachedToTheGround=s_game_totalExecutionTime}else{if(s_player.m_animationPlayer.IsAnimOver()){s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_SLIDE_LOOP;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],-1)}s_player.m_y=r;s_player.m_data[IPlayer.ACTOR_DATA_SLIDING_VELOCITY]+=m.SLIDING_ACCELARATIONS}}if(m.s_isPlayerSliding){if(m.s_timePlayerReachedToTheGround+s_arrayTweaks[ITweaks.SLIDING_TIME][0]<s_game_totalExecutionTime){if(!s_player.wouldCollisionUpright){m.s_isPlayerSliding=false;m.s_isPlayerEndSliding=true;s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_SLIDE_END;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],1)}}}if(m.s_isPlayerEndSliding){var r=s_player.m_y-s_player.m_data[IPlayer.ACTOR_DATA_SLIDING_VELOCITY];if(r<=PLAYER_START_POS_Y){m.s_isPlayerEndSliding=false;r=PLAYER_START_POS_Y}else{s_player.m_y=r;s_player.m_data[IPlayer.ACTOR_DATA_SLIDING_VELOCITY]-=m.SLIDING_ACCELARATIONS}}};m.prototype._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_DEAD=function(r){if(r==m.STATE_MESSAGE_ENTER){s_player.SetSpeed(0);this.reviveDt=0;if(this._zSpeed>0){this._zSpeed=0}if(s_player.IsOnGround()){s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_STOMP;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],1)}else{s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_STOMP_START;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],1)}s_game_shadowAnimPlayer.SetAnim(SHADOW.ANIM_SHADOW_STATIC,-1);if(s_player._speed!=0){m.VisualActor_CreateAnimFx(0,0,-10,DATA.SPRITE_DATA_DUST,DUST.ANIM_STOMP_EFFECT,IActorLists.EFFECTS,true)}}if(r==m.STATE_MESSAGE_INPUT_EVENT){m.s_actor_bAcceptedInput=false}if(r==m.STATE_MESSAGE_STEP){this.updatePlayer(s_dt,false,false);if(s_player.IsOnGround()){if(s_player.m_animationPlayer.IsAnimOver()&&s_player.m_animationPlayer.GetAnim()!=CHARACTER_00.ANIM_STOMP&&s_player.m_animationPlayer.GetAnim()!=CHARACTER_00.ANIM_STOMP_FALLEND){s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_STOMP_FALLEND,1)}this.reviveDt+=s_game_frameDT;if(this.reviveDt>=2000){if(s_game_revivePlayer||s_game_isTutorialAvailable){s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_SLIDE_END,1);this.revivePlayer()}else{if(s_iCurrentRunContinues<4){game_StartContinueCountdown()}else{game_EndGame()}}}else{d()}}else{if(s_player.m_animationPlayer.IsAnimOver()){if(s_player.m_animationPlayer.GetAnim()==CHARACTER_00.ANIM_STOMP_START){s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_STOMP_FALL,1)}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_STOMP_FALLIDLE,1)}}}if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){this.m_animationPlayer.Update(s_game_frameDT)}}if(r==m.STATE_MESSAGE_PAINT){this.drawPlayer(this._drawX,this._drawY)}if(r==m.STATE_MESSAGE_PAINT_ONBUFFER){}};m.prototype.revivePlayer=function(){playSound(SOUND_TYPE.PLAYER_REVIVE_SFX,false);s_game_revivePlayer=false;s_player.SetSpeed(s_arrayTweaks[ITweaks.PLAYER_INITIAL_SPEED][0]);s_player._isReviveAccel=true;s_game_invulnerableDt=LowAPI.Float2Int(s_game_ankhTimeTotal/8);this.yMove(-tutorial_GetAndReset_TutorialStepDistance());if(s_game_revivePlayerUsingExtraLife&&!s_game_isTutorialAvailable){s_game_revivePlayerUsingExtraLife=false;game_useExtraLife()}s_player.StateMachine_SwitchState(m.ENTITY_STATE_IDLE);m.VisualActor_CreateAnimFx(0,0,-10,DATA.SPRITE_DATA_REVIVE,REVIVE.ANIM_REVIVE,IActorLists.EFFECTS,0,1000,true);s_game_shadowAnimPlayer.SetAnim(SHADOW.ANIM_SHADOW_ANIM,-1);game_ResetPlayerAction()};m.prototype._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_DROWNED=function(r){if(r==m.STATE_MESSAGE_ENTER){this.reviveDt=0;if(this._zSpeed>0){this._zSpeed=0}s_player.m_data[IPlayer.ACTOR_DATA_FRAME]=CHARACTER_00.ANIM_DROWNING;s_player.m_animationPlayer.SetAnim(s_player.m_data[IPlayer.ACTOR_DATA_FRAME],1);s_game_shadowAnimPlayer.SetAnim(-1,-1)}if(r==m.STATE_MESSAGE_INPUT_EVENT){m.s_actor_bAcceptedInput=false}if(r==m.STATE_MESSAGE_STEP){this.SetSpeed(this._speed-(2*s_game_frameDT));this.updatePlayer(s_dt,false,true);if(s_player.IsOnGround()){this.reviveDt+=s_game_frameDT;if(this.reviveDt>=2000){if(s_game_revivePlayer||s_game_isTutorialAvailable){this.revivePlayer()}else{if(s_iCurrentRunContinues<4){game_StartContinueCountdown()}else{game_EndGame()}}}}if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){this.m_animationPlayer.Update(s_game_frameDT)}}if(r==m.STATE_MESSAGE_PAINT){this.drawPlayer(this._drawX,this._drawY)}if(r==m.STATE_MESSAGE_PAINT_ONBUFFER){}};m.prototype._handleMessage_ACTOR_TYPE_PLAYER_ENTITY_STATE_FASTFALL=function(r){if(r==m.STATE_MESSAGE_ENTER){this._zSpeed=Math_IntToFixedPoint(m.FASTFALL_INITIAL_SPEED);cam_SetVertFollowData(false,LowAPI.Float2Int(IDevice.k_camera_height+(s_player._segZOn/2)),CAM_HEIGHT_FOLLOW_SPEED_INSTANT);s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_FALL_LOOP,-1);m.s_isPlayerJumping=false;m.s_isPlayerFalling=true;m.s_isPlayerHovering=false;s_player.hoveringTrigger=true}if(r==m.STATE_MESSAGE_INPUT_EVENT){m.s_actor_bAcceptedInput=false}if(r==m.STATE_MESSAGE_STEP){game_Update_CheckInputHorizontallyAndVertically();game_ResetPlayerAction();m.update_updatePlayerHorizontalPosition(s_game_frameDT);if(s_player.IsOnGround()){m.s_isPlayerFalling=false;s_player.m_y=PLAYER_START_POS_Y;m.s_timePlayerArrivedToHoveringPosition=s_game_totalExecutionTime;s_player.m_data[IPlayer.ACTOR_DATA_JUMPING_VELOCITY]=m.MAXIMUM_JUMPING_VELOCITY;if(s_isRidingTiger){}else{s_player.m_animationPlayer.SetAnim(CHARACTER_00.ANIM_JUMP_LAND,1)}m.VisualActor_CreateAnimFx(s_player._drawX,s_player._drawY,-9,DATA.SPRITE_DATA_DUST,DUST.ANIM_DUST,IActorLists.EFFECTS);playSound(SOUND_TYPE.PLAYER_JUMP_LAND_SFX,false);if(s_isRidingTiger){Track_startCameraShake(400,40)}this.StateMachine_SwitchState(m.ENTITY_STATE_SLIDING)}this.updatePlayer(s_dt);if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){this.m_animationPlayer.Update(s_game_frameDT)}cam_SetVertFollowData(false,LowAPI.Float2Int(IDevice.k_camera_height+(s_player._segZOn/2)),CAM_HEIGHT_FOLLOW_SPEED_INSTANT)}if(r==m.STATE_MESSAGE_PAINT){this.drawPlayer(this._drawX,this._drawY)}if(r==m.STATE_MESSAGE_EXIT){cam_SetVertFollowData(false,IDevice.k_camera_height,CAM_HEIGHT_FOLLOW_SPEED_INSTANT)}};m.prototype.SendMessage_ACTOR_TYPE_MONSTER=function(r){switch(this.m_iCurrentState){case m.ENTITY_STATE_IDLE:this._handleMessage_ACTOR_TYPE_MONSTER_ENTITY_STATE_IDLE(r);break;default:break}};m.CreateMonster=function(r){return m.Create(m.ACTOR_TYPE_MONSTER,r)};m.Monster_Create=function(A,w,v,B,u,s,r,C,t){m.s_auxActor=m.CreateMonster(u);m.s_auxActor.m_x=A;m.s_auxActor.m_y=w;m.s_auxActor.m_z=v;m.s_auxActor.velocity=s_arrayTweaks[ITweaks.LANE_CHANGE_SPEED][0];m.s_auxActor.m_data=LowAPI.Gen_Array([IMonster.ACTOR_DATA_LEN],0);m.s_auxActor.m_data[IMonster.ACTOR_DATA_FRAME]=0;m.s_auxActor.m_data[IMonster.ACTOR_DATA_SPRITE]=B;m.s_auxActor.m_data[IMonster.ACTOR_DATA_WORLDCOORDINATES]=t?1:0;m.s_auxActor.m_animationPlayer=new GLLibPlayer(s_ASpriteArray[B],m.s_auxActor.m_x,m.s_auxActor.m_y);m.s_auxActor.m_animationPlayer.SetAnim(WILDTIGER.ANIM_RUN,-1);m.s_auxActor.m_animationPlayer.SetPalette(s_game_characterIndex);m.s_auxActor.m_offsetX=s;m.s_auxActor.m_offsetY=r;m.s_auxActor.m_screenX=m.s_auxActor.m_x;m.s_auxActor.m_screenY=m.s_auxActor.m_y;m.s_auxActor.m_screenX+=m.s_auxActor.m_offsetX;m.s_auxActor.m_screenY+=m.s_auxActor.m_offsetY;m.s_auxActor.InitMonster();return m.s_auxActor};m.prototype.InitMonster=function(){var w=0;var A;A=1;var z=0;var t=0;var y=-(Game.k_segment_length>>1);var x=(s_trackLaneCount>>1);var u=(s_cTrack[s_iBifurcationTrack_Main].s_trackTabFlags[0])&1;var s=(s_cTrack[s_iBifurcationTrack_Main].s_trackTabFlags[0]>>1)&1;var B=LowAPI.Float2Int(s_trackRoadHalfWidth/s_trackLaneCount);var r=Math_FixedPointToInt((Math_IntToFixedPoint(-(x-u)+(x-s))>>1)*s_trackRoadHalfWidth);var v=s_trackRoadHalfWidth>>2;v=0;this.reInitMonster(w,A,z+this.m_z,this.m_x,t);this._id=0;this.SetSpeed(0);this._deltaAccel=0;this._isReviveAccel=false;this._money=0};m.prototype.reInitMonster=function(t,s,u,r,v){this._relocateToMe=false;this.respawnCar();this._urbanHavocDestroyedObjectsCount=0;this._carAnim=0;this._steering=0;this._speedAngle=0;this._mainAxisAngle=0;this._segXOn=r;this._segXOld=this._segXOn;this._segXCollisionOff=0;this._lapOn=t;this._segOn=s;this._segYOn=u;this.yMove(v);this._speedAngle=0;this._mainAxisAngle=0;this._lapOld=this._lapOn;this._segYOld=this._segYOn;this._segOld=this._segOn;this._segZOn=0;this._segZOnOld=0;this._zSpeed=0;this._flyTime=0;this._jumpCount=0;this.SetSpeed(0);this._speedOld=0;this._deltaSpeed=0;this._deltaDepth=0;this._deltaDepthOld=0;this._collisionOccured=false;this._collisionTime=0;this._shadow=false;this._alive=true;this._invert=false;this._centripetalForceDirectionOld=(Math_Rand(0,2)*2)-1;this._autoTurn=false;this._isFlying=false;this.m_iCurrentTrack=0};m.prototype.updateMonster=function(t,u,s){if(arguments.length<3){s=true}if(arguments.length<2){u=true}var r=(this._segZOn==0);if(this["isChasing"]!=undefined&&this["isChasing"]==true){j(this)}else{if(s&&s_iIntroState!=GAME_INTROSTATE_IN_HEADSTART){this.yMove(s_game_distance_moved)}if(s_bIntroOver){this.Remove()}}};m.prototype.drawMonster=function(v,s){if(s_player._speed<=0){return}if(this.m_iCurrentState==m.ENTITY_STATE_DROWNED){SetClip(g,0,0,s_screenWidth,s)}else{SetClip(g,0,0,s_screenWidth,s_screenHeight)}if(BuildConf.k_use_player_car_shadow&&this["shadow"]!="none"){this.drawShadow(v,s);s_game_shadowAnimPlayer.SetPos(v,this._drawShadowY);s_game_shadowAnimPlayer.Render();s_game_slideDustAnimPlayer.SetPos(v,s)}var D=s_camera_distance+s_camDistOffsetFP+this.distToActor(s_player);this.m_animationPlayer.SetPalette(0);this.m_animationPlayer.GetSprite().SetCurrentPalette(0);if(D==IDevice.k_camera_distance){if(this.m_animationPlayer!=null){this.m_animationPlayer.SetPos(v,s);this.m_animationPlayer.Render()}}else{var z=this.m_animationPlayer.GetSprite();var F=this.m_animationPlayer.GetAnim();var t=this.m_animationPlayer.GetFrame();var A=this.m_animationPlayer.GetAnimFrame();var y=z.GetAFramesOX(F,t);var w=z.GetAFramesOY(F,t);var E=z.GetAFrameFlags(F,t);if((E&ASprite.FLAG_FLIP_X)!=0){y=-y}var x=100;var C=LowAPI.Float2Int((1000*s_camFocale)/IDevice.k_camera_distance);var B=LowAPI.Float2Int((1000*s_camFocale)/((D==0)?1:D));x=LowAPI.Float2Int((B*100)/C);if(z.IsFrameIndexTableBuild(A)){z.PaintFrameScaledA6(g,A,LowAPI.Float2Int(v+((y*x)/100)),LowAPI.Float2Int(s+((w*x)/100)),E,x,x)}else{var u=LowAPI.Float2Int((v+((y*x)/100)));var r=LowAPI.Float2Int((s+((w*x)/100)));z.PaintFrameScaled(g,A,u,r,E,x,x)}}SetClip(g,0,0,s_screenWidth,s_screenHeight);this.DrawParticlesCommon()};m.prototype.slowMonster=function(){this.SetSpeed(-10)};m.prototype._handleMessage_ACTOR_TYPE_MONSTER_ENTITY_STATE_IDLE=function(r){var s=this.m_data[IPlayer.ACTOR_DATA_FRAME];if(s==null||s==undefined||s<0){s=WILDTIGER.ANIM_RUN}if(r==m.STATE_MESSAGE_ENTER){this.m_animationPlayer.SetAnim(s,-1);this.m_animationPlayer.RandomizeAnim()}if(r==m.STATE_MESSAGE_INPUT_EVENT){}if(r==m.STATE_MESSAGE_STEP){this.updateMonster(s_dt);if(this.m_animationPlayer.IsAnimOver()){this.m_animationPlayer.SetAnim(s,-1)}if(this.m_animationPlayer!=null&&((this.m_flags&IActorFlags.NO_COMPUTEDELTAFRAMES)==0)){this.m_animationPlayer.Update(s_game_frameDT)}}if(r==m.STATE_MESSAGE_PAINT){this.drawMonster(this._drawX,this._drawY)}if(r==m.STATE_MESSAGE_PAINT_ONBUFFER){}};m.prototype.StateMachine_SendMessage=function(r){switch(this.m_type){case m.ACTOR_TYPE_VISUALACTOR:this.SendMessage_ACTOR_TYPE_VISUALACTOR(r);break;case m.ACTOR_TYPE_PLAYER:this.SendMessage_ACTOR_TYPE_PLAYER(r);break;case m.ACTOR_TYPE_MONSTER:this.SendMessage_ACTOR_TYPE_MONSTER(r);break;default:break}};m.prototype.StateMachine_SwitchState=function(s,r){if(arguments.length<2){r=false}if(this.m_bLockSwitching){return this.m_iNextState}m.s_timeEnteredState=s_game_totalExecutionTime;this.m_iNextState=s;this.m_bExitCurrentState=true;this.m_bLockSwitching=r;return -1};m.prototype.StateMachine_Update=function(){if(this.m_bExitCurrentState){if(this.m_iLastState!=-1){this.StateMachine_SendMessage(m.STATE_MESSAGE_EXIT)}this.m_bExitCurrentState=false;this.m_bEnterNextState=true;this.m_iLastState=this.m_iCurrentState;this.m_iCurrentState=this.m_iNextState;this.m_iNextState=-1;this.m_bLockSwitching=false}if(this.m_bEnterNextState){this.m_bEnterNextState=false;this.StateMachine_SendMessage(m.STATE_MESSAGE_ENTER)}};m.prototype.respawnCar=function(){this._collisionOccured=false;this._collisionTime=0;this._segXOn=0;this._segYOn=LowAPI.Float2Int(Game.k_segment_length/2);this.yMove(Game.k_segment_length);this._segOld=this._segOn;this._segRespawn=this._segOn;this.SetSpeed(0)};m.prototype.getOffRoadLimitRight=function(r){if(arguments.length<1){r=this._segOn}var s=(s_cTrack[s_iBifurcationTrack_Main].s_trackTabFlags[r]>>1)&1;return s_trackRoadHalfWidth-(s*s_trackLaneWidth)};m.prototype.SetSpeed=function(r){if(r-this._speed>KMH_2_MPS(100)){return}this._speed=r;if(this._speed<0){this._speed=0}};m.prototype.GetCollisionWidth=function(){return m.PLAYER_WIDTH};m.prototype.checkCollisionWithObjectsAndOffroads=function(){if(!this._alive){return}var H,A;var t;var C;var z=m.PLAYER_LENGTH;var u;this.wouldCollisionLeft=false;this.wouldCollisionUpright=false;this.wouldCollisionRight=false;this.wouldCollisionOnground=false;var E=(this._segYOn+z>Game.k_segment_length);var w;for(var v=0;v<=(E?1:0);v++){w=(v==0);var x=this._segOn+v;if(x>=s_mainTrackNbSegment){break}u=(x*s_trackMaxObjSegmentsIngame)-1;for(var y=0;y<s_trackMaxObjSegmentsIngame;y++){u++;H=s_cTrack[this.m_iCurrentTrack].s_offRoadItem[u];t=GetOffroadObjectType(H);var s=(t==Game.k_f3d_object_add_type);if(t==(Game.k_f3d_object_type)||s){A=GetOffroadObjectIndex(H)}else{if(t==(Game.k_item_type)){var r=GetOffroadObjectIndex(H);var F=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_f3d_index];var D=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_xposition];var B=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_yposition];if(s_f3dObjectsCollision[F]==null){continue}this.wouldCollisionLeft|=this.isCollisionLeft(r,m.s_collisionDataLeftRight,F,D,B,false);this.wouldCollisionUpright|=this.isCollisionUpright(r,m.s_collisionDataLeftRight,F,D,B,false);this.wouldCollisionOnground|=this.isCollisionOnground(r,m.s_collisionDataLeftRight,F,D,B,false);var G=this.isCollision(m.s_collisionData,F,D,B,false);this.wouldCollisionRight|=this.isCollisionRight(r,m.s_collisionDataLeftRight,F,D,B,false);if(G){G=this.WouldCollideInCurrentState(r)}if(G){this.ProcessItemsCollision(r,x,w)}else{if((x==this._segOn)&&(f!=this._segOn)){this.CheckObjectsExploits(r)}}}}}}if(m.s_countJumpingExploit>0){if(s_player.m_iCurrentState==m.ENTITY_STATE_DEAD){m.s_countJumpingExploit=0}else{m.s_countJumpingExploit++;if(m.s_countJumpingExploit>=5){CurrentExploits_AddExploitValue(IExploit.EX_T_JUMP_OVER);Achievements_AddAchievementValue(IExploit.EX_T_JUMP_OVER);m.s_countJumpingExploit=0}}}f=this._segOn};m.prototype.WouldCollideInCurrentState=function(r){var s=true;var u=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_type_id];var t=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_state];if(t==k_item_state_enable){switch(u){case k_item_type_obstacleMiddle:s=(this.m_iCurrentState==m.ENTITY_STATE_IDLE);break;case k_item_type_obstacleHigh:s=((this.m_iCurrentState==m.ENTITY_STATE_IDLE||this.m_iCurrentState==m.ENTITY_STATE_JUMPING));break;case k_item_type_destructibleLow:case k_item_type_obstacleGround:s=(this.m_iCurrentState!=m.ENTITY_STATE_JUMPING);break;case k_item_type_obstacleWater:s=(this.m_iCurrentState!=m.ENTITY_STATE_JUMPING);break}}return s};m.prototype.ProcessItemsCollision=function(r,s,C){if(this._type!=m.ACTOR_TYPE_PLAYER){return}var x=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_type_id];var y=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_state];var t=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_value];var A=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_f3d_index];var u=LowAPI.Float2Int(r/s_trackMaxObjSegmentsIngame);var z=this.distToActor(s_player);var B=false;if(y==k_item_state_enable){switch(x){case k_item_type_bronzeCoin:this._money+=t;game_CollectCoin(BRONZE_COIN);if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_silverCoin:this._money+=t;s_game_silverCoins++;game_CollectCoin(SILVER_COIN);if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_goldCoin:case k_item_type_goldSilverCoin:case k_item_type_goldBronzeCoin:this._money+=t;game_CollectCoin(GOLD_COIN);if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_ankhPowerup:m.VisualActor_CreateAnimFxPalette(s_player._drawX,s_player._drawY-130,-10,DATA.SPRITE_DATA_CRATES,0,CRATES.ANIM_BREAKCRATE_001,IActorLists.EFFECTS);game_CollectAnkh();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_goldRushPowerup:game_CollectGoldRush();m.VisualActor_CreateAnimFxPalette(s_player._drawX,s_player._drawY-130,-10,DATA.SPRITE_DATA_CRATES,0,CRATES.ANIM_BREAKCRATE_001,IActorLists.EFFECTS);if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_bagOfCoinsPowerup:m.VisualActor_CreateAnimFxPalette(s_player._drawX,s_player._drawY-130,-10,DATA.SPRITE_DATA_CRATES,0,CRATES.ANIM_BREAKCRATE_001,IActorLists.EFFECTS);game_CollectBagOfCoins();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_coinCrate:m.VisualActor_CreateAnimFxPalette(s_player._drawX,s_player._drawY-130,-10,DATA.SPRITE_DATA_CRATES,0,CRATES.ANIM_BREAKCRATE_001,IActorLists.EFFECTS);game_CollectCoinCrate();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_mountPowerup:m.VisualActor_CreateAnimFxPalette(s_player._drawX,s_player._drawY-130,-10,DATA.SPRITE_DATA_CRATES,0,CRATES.ANIM_BREAKCRATE_001,IActorLists.EFFECTS);game_CollectMount();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_gem:game_CollectGem();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_artifactPowerup:m.VisualActor_CreateAnimFxPalette(s_player._drawX,s_player._drawY-130,-10,DATA.SPRITE_DATA_CRATES,0,CRATES.ANIM_BREAKCRATE_001,IActorLists.EFFECTS);game_CollectArtifact();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_obstacleLight:if(s_isRidingTiger){game_LoseTiger()}else{if(s_game_invulnerableDt==0){this.player_DoDeath(m.ENTITY_STATE_DEAD,C,SOUND_TYPE.COLLISION_WALL_SFX)}}break;case k_item_type_obstacleTall:if(s_isRidingTiger){game_LoseTiger()}else{if(s_game_invulnerableDt==0){this.player_DoDeath(m.ENTITY_STATE_DEAD,C,SOUND_TYPE.COLLISION_WALL_SFX)}}break;case k_item_type_obstacleMiddle:if(s_isRidingTiger){game_LoseTiger()}else{if(s_game_invulnerableDt==0){this.player_DoDeath(m.ENTITY_STATE_DEAD,C,SOUND_TYPE.COLLISION_WALL_SFX)}}break;case k_item_type_obstacleHigh:if(s_isRidingTiger){game_LoseTiger()}else{if(s_game_invulnerableDt==0){this.player_DoDeath(m.ENTITY_STATE_DEAD,C,SOUND_TYPE.COLLISION_WALL_SFX)}}break;case k_item_type_obstacleGround:if(s_isRidingTiger){game_LoseTiger()}else{if(s_game_invulnerableDt==0){this.player_DoDeath(m.ENTITY_STATE_DEAD,C,SOUND_TYPE.COLLISION_WALL_SFX)}}break;case k_item_type_obstacleWater:if(s_isRidingTiger){game_LoseTiger()}else{if(s_game_invulnerableDt==0){this.player_DoDeath(m.ENTITY_STATE_DROWNED,C,SOUND_TYPE.COLLISION_WATER_SFX)}}break;case k_item_type_speedUp:game_CollectSpeedUp();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_speedDown:game_CollectSpeedDown();if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}break;case k_item_type_destructible:case k_item_type_destructibleLow:case k_item_type_destructibleHigh:var w=-1;if(x==k_item_type_destructibleLow){w=m.ENTITY_STATE_SLIDING}var v=game_GetDestructiblePalette(A);game_CollectDestructible(s,A,v);if(z==0||z>0&&z<Game.k_item_respawn_distance){B=true}Track_startCameraShake(800,80);Vibrate(300);break;case k_item_type_tutorialGoal:if(s_game_isTutorialAvailable){tutorial_notifyAction(TUTORIAL_ACTION.HIT_GOAL);B=true}break;case k_item_type_tutorialPause2Action:if(s_game_isTutorialAvailable){B=true}break;default:break}}if(B){s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_state]=k_item_state_catched}};m.prototype.CheckObjectsExploits=function(u){if(this._type!=m.ACTOR_TYPE_PLAYER){return}var y=s_cTrack[this.m_iCurrentTrack].s_missionItemData[u][k_item_type_id];var t=s_cTrack[this.m_iCurrentTrack].s_missionItemData[u][k_item_state];var s=s_cTrack[this.m_iCurrentTrack].s_missionItemData[u][k_item_value];var w=s_cTrack[this.m_iCurrentTrack].s_missionItemData[u][k_item_f3d_index];var r=s_cTrack[this.m_iCurrentTrack].s_missionItemData[u][k_item_seg_index];var x=this.distToActor(s_player);var v=false;if(t==k_item_state_enable){switch(y){case k_item_type_bronzeCoin:break;case k_item_type_silverCoin:break;case k_item_type_goldCoin:case k_item_type_goldSilverCoin:case k_item_type_goldBronzeCoin:break;case k_item_type_ankhPowerup:break;case k_item_type_goldRushPowerup:break;case k_item_type_bagOfCoinsPowerup:break;case k_item_type_coinCrate:break;case k_item_type_relic1Powerup:case k_item_type_relic2Powerup:case k_item_type_relic3Powerup:break;case k_item_type_mountPowerup:break;case k_item_type_artifactPowerup:break;case k_item_type_obstacleLight:break;case k_item_type_obstacleTall:break;case k_item_type_obstacleMiddle:if(this.m_iCurrentState==m.ENTITY_STATE_JUMPING&&this.wouldCollisionOnground){CurrentExploits_AddExploitValue(IExploit.EX_T_JUMP_OVER);Achievements_AddAchievementValue(IExploit.EX_T_JUMP_OVER)}else{if(this.m_iCurrentState==m.ENTITY_STATE_SLIDING&&this.wouldCollisionUpright){CurrentExploits_AddExploitValue(IExploit.EX_T_SLIDE_UNDER);Achievements_AddAchievementValue(IExploit.EX_T_SLIDE_UNDER)}}break;case k_item_type_obstacleHigh:if(this.m_iCurrentState==m.ENTITY_STATE_SLIDING&&this.wouldCollisionUpright){CurrentExploits_AddExploitValue(IExploit.EX_T_SLIDE_UNDER);Achievements_AddAchievementValue(IExploit.EX_T_SLIDE_UNDER)}break;case k_item_type_obstacleGround:if(this.m_iCurrentState==m.ENTITY_STATE_JUMPING&&this.wouldCollisionOnground){if(m.s_isContingJumping){m.s_isContingJumping=false}}break;case k_item_type_obstacleWater:break}}if(v){s_cTrack[this.m_iCurrentTrack].s_missionItemData[u][k_item_state]=k_item_state_catched}};m.prototype.isCollisionLeft=function(r,t,w,y,v,x){if(arguments.length<6){throw new Error("InvalidParameters")}var u=this._segXOn;switch(this.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]){case l.LEFT:return false;case l.MIDDLE:this._segXOn=m.update_getCenterPositionOfLane(l.LEFT);break;case l.RIGHT:this._segXOn=m.update_getCenterPositionOfLane(l.MIDDLE);break}var s=this.isCollision(t,w,y,v,x);this._segXOn=u;if(r==-1){return s}var z=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_type_id];return(s&&this.isObstacleObject(z))};m.prototype.isCollisionRight=function(r,t,w,y,v,x){if(arguments.length<6){throw new Error("InvalidParameters")}var u=this._segXOn;switch(this.m_data[IPlayer.ACTOR_DATA_CURRENT_LANE]){case l.LEFT:this._segXOn=m.update_getCenterPositionOfLane(l.MIDDLE);break;case l.MIDDLE:this._segXOn=m.update_getCenterPositionOfLane(l.RIGHT);break;case l.RIGHT:return false}var s=this.isCollision(t,w,y,v,x);this._segXOn=u;if(r==-1){return s}var z=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_type_id];return(s&&this.isObstacleObject(z))};m.prototype.isCollisionUpright=function(r,t,w,y,v,x){if(arguments.length<6){throw new Error("InvalidParameters")}var u=this._segZOn;this._segZOn-=100;var s=this.isCollision(t,w,y,v,x);this._segZOn=u;if(r==-1){return s}var z=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_type_id];return(s&&this.isObstacleObject(z))};m.prototype.isCollisionOnground=function(r,t,w,y,v,x){if(arguments.length<6){throw new Error("InvalidParameters")}var u=this._segZOn;this._segZOn=0;var s=this.isCollision(t,w,y,v,x);this._segZOn=u;if(r==-1){return s}var z=s_cTrack[this.m_iCurrentTrack].s_missionItemData[r][k_item_type_id];return(s&&this.isObstacleObject(z))};m.prototype.isObstacleObject=function(r){switch(r){case k_item_type_bronzeCoin:case k_item_type_silverCoin:case k_item_type_goldCoin:case k_item_type_goldBronzeCoin:case k_item_type_goldSilverCoin:return false;case k_item_type_obstacleLight:case k_item_type_obstacleTall:case k_item_type_obstacleMiddle:case k_item_type_obstacleHigh:case k_item_type_obstacleGround:case k_item_type_obstacleWater:case k_item_type_destructible:case k_item_type_destructibleLow:case k_item_type_destructibleHigh:return true;default:return false}};m.prototype.isCollision=function(B,C,H,G,y){if(s_f3dObjectsCollision[C]!=null){var E=LowAPI.Float2Int(this.GetCollisionWidth()/2);var z=LowAPI.Float2Int(this.GetCollisionWidth()/2);var s,J,v;var K,I;var A=s_f3dObjectsCollision[C][Game.k_f3dObjects_collisions_height];B[m.k_collDataColType]=s_f3dObjectsCollision[C][Game.k_f3dObjects_collisions_height];if(A!=0&&(this._segZOn>A+G||this._segZOn+m.k_car_height<G)){return false}if(y){var D=getOffRoadLimitLeft();s=-s_f3dObjectsCollision[C][Game.k_f3dObjects_collisions_right_index]-H+D;J=-s_f3dObjectsCollision[C][Game.k_f3dObjects_collisions_left_index]-H+D}else{var t=this.getOffRoadLimitRight();s=s_f3dObjectsCollision[C][Game.k_f3dObjects_collisions_left_index]+H+t;J=s_f3dObjectsCollision[C][Game.k_f3dObjects_collisions_right_index]+H+t}v=s_f3dObjectsCollision[C][Game.k_f3dObjects_collisions_height];B[m.k_collDataF3dLeft]=s;B[m.k_collDataF3dRight]=J;B[m.k_collDataF3dHeight]=v;var F=this._segXOn-E;var w=this._segXOn+z;K=J-F;I=w-s;B[m.k_collDataCarLeftObjRightDistance]=K;B[m.k_collDataCarRightObjLeftDistance]=I;B[m.k_collDataLeftLimit]=J+E+3;B[m.k_collDataRightLimit]=s-z-3;var r=(J>F)&&(J<w);var u=(s>F)&&(s<w);var x=(F>s)&&(w<J);B[m.k_collDataLeftColOccured]=r?1:0;B[m.k_collDataRightColOccured]=u?1:0;return r||u||x}else{return false}};m.prototype.compute2dProjection=function(t){var s,B,A,v,r;var u;r=Math_FixedPointToInt(s_cTrack[this.m_iCurrentTrack].s_worldVecY[t]*this._segYOn)+s_cTrack[this.m_iCurrentTrack].s_worldPosY[t];if(r<=0){return false}s=Math_FixedPointToInt(s_cTrack[this.m_iCurrentTrack].s_worldVecX[t]*this._segYOn)+this._segXOn+s_cTrack[this.m_iCurrentTrack].s_worldPosX[t];s=LowAPI.Float2Int((k_middle_region_x)+((s*s_camFocale)/r));if(this._type==m.ACTOR_TYPE_PLAYER){v=-s_camHau-s_camHauOffset}else{v=Math_FixedPointToInt(s_cTrack[this.m_iCurrentTrack].s_worldVecZ[t]*this._segYOn)+s_cTrack[this.m_iCurrentTrack].s_worldPosZ[t]}if(this._segZOn==0){A=LowAPI.Float2Int(s_viewProjCenter-((v*s_camFocale)/r));B=A}else{A=LowAPI.Float2Int(s_viewProjCenter-((v*s_camFocale)/r));v+=this._segZOn;B=LowAPI.Float2Int(s_viewProjCenter-((v*s_camFocale)/r))}u=LowAPI.Float2Int((Math_IntToFixedPoint(IDevice.k_camera_distance-s_camera_distance))/r);this._drawX=s;this._drawY=B;this._drawShadowY=A;var w=LowAPI.Float2Int(s_math_F_1+s_math_F_05/2);if(u>w){u=w}this._drawZoom=u;this._drawZoom100=Math_FixedPointToInt(u*100);this._computedProjection=true;return true};m.prototype.IsOnGround=function(){return(this._segZOn==0)};m.prototype.updateCameraAngle=function(r){var s=this._mainAxisAngle-s_cameraAngle;if(this._centripetalForceDirection==0){if(s>0){this._mainAxisAngle-=LowAPI.Float2Int(k_camera_angle_turn_speed*r/BuildConf.k_static_dt_value);if(this._mainAxisAngle<s_cameraAngle){this._mainAxisAngle=s_cameraAngle}}else{if(s<0){this._mainAxisAngle+=LowAPI.Float2Int(k_camera_angle_turn_speed*r/BuildConf.k_static_dt_value);if(this._mainAxisAngle>s_cameraAngle){this._mainAxisAngle=s_cameraAngle}}}if(s>k_max_car_camera_angle_in_turn){s_cameraAngle=this._mainAxisAngle-k_max_car_camera_angle_in_turn}else{if(s<-k_max_car_camera_angle_in_turn){s_cameraAngle=this._mainAxisAngle+k_max_car_camera_angle_in_turn}}}};m.prototype.distToActor=function(r){return m.GetDist(this._lapOn,this._segOn,this._segYOn,r._lapOn,r._segOn,r._segYOn)};m.GetDist=function(x,z,v,w,y,u){var t;var s;var r=s_mainTrackNbSegment;t=(x-w)*r;s=(m.GetDistToLapBegin(z)-m.GetDistToLapBegin(y));t+=s;return(t<<Game.k_segment_base)+v-u};m.GetDistToLapBegin=function(r){var s=0;if(s==0){s=r}return s};m.prototype.drawShadow=function(r,A){SetClip(g,0,0,s_screenWidth,s_screenHeight);if(this._segZOn==0){var s=s;s%=k_skyObjectLayerWidth;var t=LowAPI.Float2Int(s_screenWidth/2);var z;if(s>=0){z=s-t}else{z=Math_Abs(-t+s)}var u=Math_IntToFixedPoint(4);var w=0;var v=0}};m.initParticleSystem=function(){m.s_particles=[];for(var r=0;r<m.k_max_particles_in_scene;r++){m.s_particles[r]=new cParticle()}};m.initParticle=function(r,A,t,w,v,z,s){if(arguments.length<7){s=-1}var u=0;while(u<m.k_max_particles_in_scene&&m.s_particles[u].isAlive()){u++}if(u<m.k_max_particles_in_scene){m.s_particles[u].initParticle(r,A,t,w,v,z,s)}};m.UpdateParticles=function(t,r){if(arguments.length<2){r=-1}for(var s=0;s<m.k_max_particles_in_scene;s++){if(m.s_particles[s].isAlive()){if(r==-1){m.s_particles[s].updateParticle(t)}else{if(m.s_particles[s].mType==r){m.s_particles[s].updateParticle(t)}}}}};m.GetParticlesNum=function(u,v,r){var s=0;for(var t=0;t<m.k_max_particles_in_scene;t++){if(m.s_particles[t].isAlive()&&m.s_particles[t].mType==u&&(LowAPI.isUndefined(v)||m.s_particles[t].mKey==v)&&(LowAPI.isUndefined(r)||m.s_particles[t].mSegment==r)){s++}}return s};m.prototype.DrawParticlesCommon=function(){for(var r=0;r<m.k_max_particles_in_scene;r++){if(m.s_particles[r].isAlive()&&m.s_particles[r].mSegment==-1&&m.s_particles[r].mType!=cParticle.PARTICLE_TYPE_CURSOR_LEFT&&m.s_particles[r].mType!=cParticle.PARTICLE_TYPE_CURSOR_RIGHT){m.s_particles[r].renderParticle(g)}}};m.GenerateSpeedEffectParticles=function(){if(cParticle.showSpecialSpeedLine()){if(m.GetParticlesNum(cParticle.PARTICLE_TYPE_SPEED_LINE)<(m.CINETIC_LINES_MAX_PARTICLES*3)){for(var r=0;r<3;r++){m.initParticle(LowAPI.Float2Int(s_screenWidth/2),s_viewProjCenter,cParticle.PARTICLE_TYPE_SPEED_LINE,m.CINETIC_LINES_BASE_SPEED+LowAPI.Float2Int(s_player._speed/m.CINETIC_LINES_PLAYER_SPEED_REDUCTION),0,null)}}}else{if(m.GetParticlesNum(cParticle.PARTICLE_TYPE_SPEED_LINE)<m.CINETIC_LINES_MAX_PARTICLES){m.initParticle(LowAPI.Float2Int(s_screenWidth/2),s_viewProjCenter,cParticle.PARTICLE_TYPE_SPEED_LINE,m.CINETIC_LINES_BASE_SPEED+LowAPI.Float2Int(s_player._speed/m.CINETIC_LINES_PLAYER_SPEED_REDUCTION),0,null)}}};m.Create=function(r,t,u){if(arguments.length<3){u=0}var s=new m();s.m_type=r;s._type=r;s.m_z=u;if(t>-1){m.ActorLists_InsertInList(s,t)}s.m_animationPlayerSparkles=null;return s};LowAPI.extendObject(k,{cActor:m,CHASE__removeAllMonsters:i,},true)})(window);