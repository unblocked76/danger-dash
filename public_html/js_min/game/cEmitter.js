(function(c){function b(C,m,v,x,w,z,j,k,n,y,D,o,l,r,q,E,g,f,i,p,B,t,s,u,A,F,h){this.m_particles_Count=0;this.m_particles_Left=0;this.m_particles_Sleeping=0;this.m_particles_TimeToCreate=0;this.m_particles_TimeToLive=0;this.m_particles_fVelX_min=0;this.m_particles_fVelX_max=0;this.m_particles_fVelY_min=0;this.m_particles_fVelY_max=0;this.m_particles_fMaxVelocX=0;this.m_particles_fMaxVelocY=0;this.m_emitter_maxParticles=0;this.m_aParticles_fixedPos_X=null;this.m_aParticles_fixedPos_Y=null;this.m_aParticles_fixedVel_X=null;this.m_aParticles_fixedVel_Y=null;this.m_aParticles_TimeOfLife=null;this.m_emitter_srcRect=[0,0,0,0];this.m_emitter_dstRect=[0,0,0,0];this.m_emitter_dstRectCenter_fX=0;this.m_emitter_dstRectCenter_fY=0;this.m_emitter_iDstForce=0;this.m_emitter_fGravity_X=0;this.m_emitter_fGravity_Y=0;this.m_emitter_bouncingRect=[0,0,0,0];this.m_emitter_iBouncingAbsortionDiv=0;this.m_emitter_fMinVelocForBouncing=0;this.m_frictionFactor=1;if(m==undefined){this._constructor_1_(C)}else{this._constructor_full_(C,m,v,x,w,z,j,k,n,y,D,o,l,r,q,E,g,f,i,p,B,t,s,u,A,F,h)}}var d=b;var e=b.prototype;e.getParticleCount=function(){return this.m_particles_Count};e.setTimeToLive=function(f){this.m_particles_TimeToLive=f};e.getTimeToLive=function(){return this.m_particles_TimeToLive};e.setTimeToCreate=function(f){this.m_particles_TimeToCreate=f};e.getTimeToCreate=function(){return this.m_particles_TimeToCreate};e.setFixVelocYrank=function(f,g){this.m_particles_fVelY_min=f;this.m_particles_fVelY_max=g};e.setFixVelocXrank=function(f,g){this.m_particles_fVelX_min=f;this.m_particles_fVelX_max=g};e.setFixGravity=function(g,f){this.m_emitter_fGravity_X=g;this.m_emitter_fGravity_Y=f};e.setFixMaxVeloc=function(g,f){this.m_particles_fMaxVelocX=g;this.m_particles_fMaxVelocY=f};e.setSrcRect=function(f,j,g,i){this.m_emitter_srcRect[0]=f;this.m_emitter_srcRect[1]=j;this.m_emitter_srcRect[2]=g;this.m_emitter_srcRect[3]=i};e.getSrcRect=function(f){f[0]=this.m_emitter_srcRect[0];f[1]=this.m_emitter_srcRect[1];f[2]=this.m_emitter_srcRect[2];f[3]=this.m_emitter_srcRect[3]};e.setFrictionFactor=function(f){this.m_frictionFactor=(f>=1)?f:1};e.getFrictionFactor=function(){return this.m_frictionFactor};e.setDstRect=function(f,j,g,i){this.m_emitter_dstRect[0]=f;this.m_emitter_dstRect[1]=j;this.m_emitter_dstRect[2]=g;this.m_emitter_dstRect[3]=i;this.m_emitter_dstRectCenter_fX=LowAPI.Float2Int(Math_IntToFixedPoint(2*f+g)/2);this.m_emitter_dstRectCenter_fY=LowAPI.Float2Int(Math_IntToFixedPoint(2*j+i)/2)};e.getDstRect=function(f){f[0]=this.m_emitter_dstRect[0];f[1]=this.m_emitter_dstRect[1];f[2]=this.m_emitter_dstRect[2];f[3]=this.m_emitter_dstRect[3]};e.setDstForce=function(f){this.m_emitter_iDstForce=f};e.getDstForce=function(){return this.m_emitter_iDstForce};e.setBouncingRect=function(f,j,g,i){this.m_emitter_bouncingRect[0]=f;this.m_emitter_bouncingRect[1]=j;this.m_emitter_bouncingRect[2]=g;this.m_emitter_bouncingRect[3]=i};e.getBouncingRect=function(f){f[0]=this.m_emitter_bouncingRect[0];f[1]=this.m_emitter_bouncingRect[1];f[2]=this.m_emitter_bouncingRect[2];f[3]=this.m_emitter_bouncingRect[3]};e.setBouncingAbsortionDiv=function(f){this.m_emitter_iBouncingAbsortionDiv=f};e.getBouncingAbsortionDiv=function(){return this.m_emitter_iBouncingAbsortionDiv};e.setFixMinVelocForBouncing=function(f){this.m_emitter_fMinVelocForBouncing=f};e.getFixMinVelocForBouncing=function(){return this.m_emitter_fMinVelocForBouncing};e._constructor_1_=function(f){this.m_emitter_maxParticles=f;this.m_aParticles_fixedPos_X=LowAPI.Gen_Array([f],0);this.m_aParticles_fixedPos_Y=LowAPI.Gen_Array([f],0);this.m_aParticles_fixedVel_X=LowAPI.Gen_Array([f],0);this.m_aParticles_fixedVel_Y=LowAPI.Gen_Array([f],0);this.m_aParticles_TimeOfLife=LowAPI.Gen_Array([f],0);this.m_particles_Count=f};e._constructor_full_=function(C,m,v,x,w,z,j,k,n,y,D,o,l,r,q,E,g,f,i,p,B,t,s,u,A,F,h){this._constructor_1_(C);this.setTimeToCreate(m);this.setTimeToLive(v);this.setSrcRect(x,w,z,j);this.setFixVelocXrank(k,n);this.setFixVelocYrank(y,D);this.setFixGravity(o,l);this.setFixMaxVeloc(r,q);this.setFrictionFactor(E);this.setDstRect(g,f,i,p);this.setDstForce(B);this.setBouncingRect(t,s,u,A);this.setBouncingAbsortionDiv(F);this.setFixMinVelocForBouncing(h)};e.initialize=function(g){if(g==undefined){g=this.m_particles_Count}Assert(g<=this.m_emitter_maxParticles," param error: _iNumberOfPartcles ("+g+") should be less or equal than m_emitter_maxParticles ("+this.m_emitter_maxParticles+")");this.m_particles_Count=g;this.m_particles_Left=g;this.m_emitter_dstRectCenter_fX=LowAPI.Float2Int(Math_IntToFixedPoint(2*this.m_emitter_dstRect[0]+this.m_emitter_dstRect[2])/2);this.m_emitter_dstRectCenter_fY=LowAPI.Float2Int(Math_IntToFixedPoint(2*this.m_emitter_dstRect[1]+this.m_emitter_dstRect[3])/2);for(var f=0;f<this.m_particles_Count;f++){this.m_aParticles_fixedVel_X[f]=Math_Rand(this.m_particles_fVelX_min,this.m_particles_fVelX_max+1);this.m_aParticles_fixedVel_Y[f]=Math_Rand(this.m_particles_fVelY_min,this.m_particles_fVelY_max+1);if(this.m_particles_TimeToCreate>0){this.m_aParticles_TimeOfLife[f]=-LowAPI.Float2Int((f*this.m_particles_TimeToCreate)/this.m_particles_Count)}else{this.m_aParticles_TimeOfLife[f]=0}}};e.update=function(k){var j=0;var u=0;var i=0;var t=0;if(this.m_emitter_iDstForce!=0){j=this.m_emitter_dstRect[0];u=this.m_emitter_dstRect[1];i=j+this.m_emitter_dstRect[2]-1;t=u+this.m_emitter_dstRect[3]-1}var C=0;var m=0;var B=0;var l=0;if(this.m_emitter_iBouncingAbsortionDiv>0){C=this.m_emitter_bouncingRect[0];m=this.m_emitter_bouncingRect[1];B=C+this.m_emitter_bouncingRect[2]-1;l=m+this.m_emitter_bouncingRect[3]-1}this.m_particles_Left=0;this.m_particles_Sleeping=0;for(var x=0;x<this.m_particles_Count;x++){if(!this.isDead(x)){this.m_particles_Left++;var y=this.isAlive(x);var n=this.isSleeping(x);if(false==y){this.m_particles_Sleeping++}else{var p=Math_FixedPointToInt(this.m_aParticles_fixedPos_X[x]);var o=Math_FixedPointToInt(this.m_aParticles_fixedPos_Y[x]);this.m_aParticles_fixedPos_X[x]+=LowAPI.Float2Int((this.m_aParticles_fixedVel_X[x]*k)/1000);this.m_aParticles_fixedPos_Y[x]+=LowAPI.Float2Int((this.m_aParticles_fixedVel_Y[x]*k)/1000);var w=this.m_aParticles_fixedPos_X[x];var v=this.m_aParticles_fixedPos_Y[x];var D=this._getDistToDest(w,v);var g=this._getDstAccX(w,D);var f=this._getDstAccY(v,D);var A=this.m_emitter_fGravity_X+g;var z=this.m_emitter_fGravity_Y+f;this.m_aParticles_fixedVel_X[x]+=LowAPI.Float2Int((A*k)/1000);this.m_aParticles_fixedVel_Y[x]+=LowAPI.Float2Int((z*k)/1000);if(this.m_particles_fMaxVelocX>0){this.m_aParticles_fixedVel_X[x]=((this.m_aParticles_fixedVel_X[x])<(-this.m_particles_fMaxVelocX)?(-this.m_particles_fMaxVelocX):((this.m_aParticles_fixedVel_X[x])>(+this.m_particles_fMaxVelocX)?(+this.m_particles_fMaxVelocX):(this.m_aParticles_fixedVel_X[x])))}if(this.m_particles_fMaxVelocY>0){this.m_aParticles_fixedVel_Y[x]=((this.m_aParticles_fixedVel_Y[x])<(-this.m_particles_fMaxVelocY)?(-this.m_particles_fMaxVelocY):((this.m_aParticles_fixedVel_Y[x])>(+this.m_particles_fMaxVelocY)?(+this.m_particles_fMaxVelocY):(this.m_aParticles_fixedVel_Y[x])))}if(this.m_frictionFactor>1){var r=this.m_frictionFactor-1;this.m_aParticles_fixedVel_X[x]=LowAPI.Float2Int((this.m_aParticles_fixedVel_X[x]*r)/this.m_frictionFactor);this.m_aParticles_fixedVel_Y[x]=LowAPI.Float2Int((this.m_aParticles_fixedVel_Y[x]*r)/this.m_frictionFactor)}var s=Math_FixedPointToInt(w);var q=Math_FixedPointToInt(v);if(this.m_emitter_iDstForce!=0){if(this._isPointInRect(s,q,j,u,i,t)){this.m_aParticles_TimeOfLife[x]=this.m_particles_TimeToLive}}if(this.m_emitter_iBouncingAbsortionDiv>0){var h=false;if(s<C){h=true;if((Math_Abs(this.m_aParticles_fixedVel_X[x])<=this.m_emitter_fMinVelocForBouncing)||(p==C)){s=C;this.m_aParticles_fixedVel_X[x]=0}else{this.m_aParticles_fixedVel_X[x]=-this.m_aParticles_fixedVel_X[x];s=C}}else{if(s>B){h=true;if((Math_Abs(this.m_aParticles_fixedVel_X[x])<=this.m_emitter_fMinVelocForBouncing)||(p==B)){s=B;this.m_aParticles_fixedVel_X[x]=0}else{this.m_aParticles_fixedVel_X[x]=-this.m_aParticles_fixedVel_X[x];s=B}}}if(q<m){h=true;if((Math_Abs(this.m_aParticles_fixedVel_Y[x])<=this.m_emitter_fMinVelocForBouncing)||(o==m)){q=m;this.m_aParticles_fixedVel_Y[x]=0}else{this.m_aParticles_fixedVel_Y[x]=-this.m_aParticles_fixedVel_Y[x];q=m}}else{if(q>l){h=true;if((Math_Abs(this.m_aParticles_fixedVel_Y[x])<=this.m_emitter_fMinVelocForBouncing)||(o==l)){q=l;this.m_aParticles_fixedVel_Y[x]=0}else{this.m_aParticles_fixedVel_Y[x]=-this.m_aParticles_fixedVel_Y[x];q=l}}}if(h){this.m_aParticles_fixedVel_X[x]=LowAPI.Float2Int(this.m_aParticles_fixedVel_X[x]/this.m_emitter_iBouncingAbsortionDiv);this.m_aParticles_fixedVel_Y[x]=LowAPI.Float2Int(this.m_aParticles_fixedVel_Y[x]/this.m_emitter_iBouncingAbsortionDiv);this.m_aParticles_fixedPos_X[x]=Math_IntToFixedPoint(s);this.m_aParticles_fixedPos_Y[x]=Math_IntToFixedPoint(q)}}}this.m_aParticles_TimeOfLife[x]+=k;if(n&&!this.isSleeping(x)){this.m_aParticles_fixedPos_X[x]=Math_IntToFixedPoint(this.m_emitter_srcRect[0]+Math_Rand(0,this.m_emitter_srcRect[2]));this.m_aParticles_fixedPos_Y[x]=Math_IntToFixedPoint(this.m_emitter_srcRect[1]+Math_Rand(0,this.m_emitter_srcRect[3]))}}}};e.drawParticles=function(l,j,k,i,h){for(var g=0;g<this.getParticleCount();g++){if(this.isAlive(g)){var f=Math_FixedPointToInt(this.getFixPosX(g))+i;var m=Math_FixedPointToInt(this.getFixPosY(g))+h;j.PaintFrame(l,k,f,m,0)}}};e.drawAnimParticles=function(i,h,g,f,m,l,k,j){if(j!=undefined){return this._drawAnimParticles_GraphicsASpriteIIIIZI_(i,h,g,f,m,l,k,j)}else{if(k!=undefined){if(typeof k=="boolean"){return this._drawAnimParticles_GraphicsASpriteIIIIZ_(i,h,g,f,m,l,k)}else{return this._drawAnimParticles_GraphicsASpriteIIZI_(i,h,g,f,m,l,k)}}else{if(l!=undefined){return this._drawAnimParticles_GraphicsASpriteIIIZ_(i,h,g,f,m,l)}else{throw new Error("Invalid parameters")}}}};e._drawAnimParticles_GraphicsASpriteIIIZ_=function(k,j,i,h,g,f){this.drawAnimParticles(k,j,i,h,g,f,GLLibConfiguration.sprite_animFPS)};e._drawAnimParticles_GraphicsASpriteIIZI_=function(l,k,j,i,h,g,f){this.drawAnimParticles(l,k,j,1,i,h,g,f)};e._drawAnimParticles_GraphicsASpriteIIIIZ_=function(l,k,j,i,h,g,f){this.drawAnimParticles(l,k,j,i,h,g,f,GLLibConfiguration.sprite_animFPS)};e._drawAnimParticles_GraphicsASpriteIIIIZI_=function(k,f,r,m,i,g,j,s){for(var q=0;q<this.getParticleCount();q++){if(this.isAlive(q)){var p=Math_FixedPointToInt(this.getFixPosX(q))+i;var n=Math_FixedPointToInt(this.getFixPosY(q))+g;var l=this.getTimeOfLife(q);var o=0;if(m<=1){o=r}else{o=r+this.getVelAngle(q,m)}var h=this._getAnimFrameByTime(f,o,l,s,j?1:-1);if(h>=0){f.PaintAFrame(k,o,h,p,n,0)}else{this.m_aParticles_TimeOfLife[q]=this.m_particles_TimeToLive}}}};e.getParticleLeft=function(){return this.m_particles_Left};e.getParticleSleeping=function(){return this.m_particles_Sleeping};e.getFixPosX=function(f){Assert(f<this.m_particles_Count," param error _iParticleIdx ("+f+") should be less than number of particles ("+this.m_particles_Count+")");return this.m_aParticles_fixedPos_X[f]};e.getFixPosY=function(f){Assert(f<this.m_particles_Count," param error _iParticleIdx ("+f+") should be less than number of particles ("+this.m_particles_Count+")");return this.m_aParticles_fixedPos_Y[f]};e.isAlive=function(f){Assert(f<this.m_particles_Count," param error _iParticleIdx ("+f+") should be less than number of particles ("+this.m_particles_Count+")");return;(this.m_aParticles_TimeOfLife[f]>0)&&(this.m_aParticles_TimeOfLife[f]<this.m_particles_TimeToLive)};e.isDead=function(f){Assert(f<this.m_particles_Count," param error _iParticleIdx ("+f+") should be less than number of particles ("+this.m_particles_Count+")");return;(this.m_aParticles_TimeOfLife[f]>=this.m_particles_TimeToLive)};e.isSleeping=function(f){Assert(f<this.m_particles_Count," param error _iParticleIdx ("+f+") should be less than number of particles ("+this.m_particles_Count+")");return;(this.m_aParticles_TimeOfLife[f]<=0)};e.stop=function(){for(var f=0;f<this.getParticleCount();f++){this.m_aParticles_TimeOfLife[f]=this.m_particles_TimeToLive}};e.applySrcRectOffset=function(g,f){this.m_emitter_srcRect[0]+=g;this.m_emitter_srcRect[1]+=f};e.setSrcRectPosition=function(g,f){this.m_emitter_srcRect[0]=g;this.m_emitter_srcRect[1]=f};e.getTimeOfLife=function(f){Assert(f<this.m_particles_Count," param error _iParticleIdx ("+f+") should be less than number of particles ("+this.m_particles_Count+")");return this.m_aParticles_TimeOfLife[f]};e._getAnimFrameByTime=function(k,o,h,f,j){var i=LowAPI.Float2Int(h/f);var n=0;for(var l=0;l<k.GetAFrames(o);l++){n+=k.GetAFrameTime(o,l)}if((j>0)&&(LowAPI.Float2Int(i/n)>=j)){return -1}var m=i%n;var g=-1;do{g++;m-=k.GetAFrameTime(o,g)}while(m>=0);return g};e._isPointInRect=function(k,j,g,i,f,h){if(k>=g&&k<=f&&j>=i&&j<=h){return true}return false};e._getDistToDest=function(i,g){if(this.m_emitter_iDstForce==0){return 0}var h=Math_FixedPointToInt(this.m_emitter_dstRectCenter_fX-i);var f=Math_FixedPointToInt(this.m_emitter_dstRectCenter_fY-g);return Math_IntToFixedPoint(Math_Norm(h,f,30))};e._getDstAccX=function(f,g){if(this.m_emitter_iDstForce==0){return 0}var h=this.m_emitter_iDstForce*(this.m_emitter_dstRectCenter_fX-f);return Math_FixedPoint_Divide(h,g)};e._getDstAccY=function(f,g){if(this.m_emitter_iDstForce==0){return 0}var h=this.m_emitter_iDstForce*(this.m_emitter_dstRectCenter_fY-f);return Math_FixedPoint_Divide(h,g)};e.getVelAngle=function(f,g){var h=Math_Atan(this.m_aParticles_fixedVel_X[f],-this.m_aParticles_fixedVel_Y[f]);if(h>=Math_IntToFixedPoint(1)){h=0}return LowAPI.Float2Int(h*g/Math_IntToFixedPoint(1))};function a(y,l,s,u,t,w,i,j,m,v,z,n,k,q,p,A,g,f,h,o,x){var r=new b(y,l,s,u,t,w,i,j,m,v,z,n,k,q,p,A,g,f,h,o,x,0,0,0,0,0,0);return r}d.createEmitterPoint=function(r,j,q,u,t,f,n,l,s,i,p,m,k,h,g,o){return a(r,j,q,u,t,f,n,l,s,i,p,m,k,h,g,o,0,0,0,0,0)};LowAPI.extendObject(c,{cEmitter:b,},true)})(window);