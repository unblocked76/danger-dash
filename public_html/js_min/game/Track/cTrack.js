(function(e,a){var j=64;var l=192;var b=16;var i=32;var f=0;var k=15;var h=[[DATA.OBJECTS_BOX1,DATA.OBJECTS_BOX2,DATA.OBJECTS_BOX3],[DATA.OBJECTS_BOX1_COIN,DATA.OBJECTS_BOX2_COIN,DATA.OBJECTS_BOX3_COIN],[DATA.OBJECTS_BOX1_TIGER,DATA.OBJECTS_BOX2_TIGER,DATA.OBJECTS_BOX3_TIGER],[DATA.OBJECTS_BOX1_GOLD,DATA.OBJECTS_BOX2_GOLD,DATA.OBJECTS_BOX3_GOLD],[DATA.OBJECTS_GENERIC_DIAMOND,DATA.OBJECTS_GENERIC_DIAMOND,DATA.OBJECTS_GENERIC_DIAMOND],];var d={POWERUP:0,COIN:1,TIGER:2,RELIC:3,GEM:4,LEFT:0,CENTER:0,RIGHT:0,};function c(){this.s_roadIndex=null;this.s_roadTypeIndex=null;this.s_roadStatus=null;this.s_roadCustomParam=null;this.s_roadMainIndex=0;this.s_trackMaxObjSegmentsExported=0;this.s_trackTabAng=null;this.s_trackRoadBreak=null;this.s_trackTabInc=null;this.s_trackTabFlags=null;this.s_trackSegEnvironment=null;this.s_trackType=0;this.s_missionID=4;this.s_missionItemData=null;this.s_worldNum=null;this.s_worldPosX=null;this.s_worldPosY=null;this.s_worldPosZ=null;this.s_worldVecX=null;this.s_worldVecY=null;this.s_worldVecZ=null;this.s_worldRatio=null;this.s_worldYclip=null;this.s_worldXclip=null;this.s_worldXclipW=null;this.s_worldObjectNb=null;this.s_worldObjectList=null;this.s_worldRoadMin=0;this.s_f3dRatio=null;this.s_offRoadItemOffsetL=null;this.s_offRoadItemOffsetR=null;this.s_roadX1=null;this.s_roadY1=null;this.s_roadL1=null;this.s_f3dPaletteAnim=null;this.s_f3dTextureAnimData=null;this.s_offRoadProRightCircuit=null;this.s_offRoadProLeftCircuit=null;this.s_offRoadItemTransformIndex=0;this.s_offRoadItemTransforms=null;this.s_offRoadItem=null;this.s_offRoadItemAnim=null;this.s_offRoadItemAnimTime=null;this.s_offRoadOffsetX=null;this.s_offRoadOffsetY=null;this.s_offRoadItemPalette=null;this.s_offRoadZone=null;this.s_worldAngle=null;this.s_iOffsetX=0;this.s_segmentSlant=null;this.s_lastColOffroadLeft=0;this.s_lastColOffroadRight=0;this.s_isTextureAnimActivationNeeded=false;this.s_iNextMainTrackAppendSegment=0;this.s_iNextMissionObjectID=0;this.constructor()}c.k_f3dTextureAnimMaxObjects=BuildConf.k_track_road_max_segment*2+2;c.k_f3dTextureAnimMaxTextures=IDefine.TEXTURE_ANIM_MAX_TEXTURES;c.k_f3dTextureAnimSegment=0;c.k_f3dTextureAnimSpriteId=c.k_f3dTextureAnimSegment+1;c.k_f3dTextureAnimId=c.k_f3dTextureAnimSpriteId+1;c.k_f3dTextureAnimKey=c.k_f3dTextureAnimId+1;c.k_f3dTextureAnimTimer=c.k_f3dTextureAnimKey+1;c.k_f3dTextureAnimInitTime=c.k_f3dTextureAnimTimer+1;c.k_f3dTextureAnimMaxTime=c.k_f3dTextureAnimInitTime+1;c.k_f3dTextureAnimType=c.k_f3dTextureAnimMaxTime+1;c.k_f3dTextureAnimState=c.k_f3dTextureAnimType+1;c.k_f3dTextureAnimFrame=c.k_f3dTextureAnimState+1;c.k_f3dTextureAnimOffX=c.k_f3dTextureAnimFrame+1;c.k_f3dTextureAnimOffY=c.k_f3dTextureAnimOffX+1;c.k_f3dTextureAnimF3DId=c.k_f3dTextureAnimOffY+1;c.k_f3dTextureAnimSkipOffset=c.k_f3dTextureAnimF3DId+1;c.k_f3dTextureAnimDatasize=c.k_f3dTextureAnimSkipOffset+1;c.k_f3dTextureAnimStateInactive=-1;c.k_f3dTextureAnimStateActive=0;c.k_f3dTextureAnimStateFinished=1;c.k_f3dTextureAnimStateWait=2;c.k_texturesPalettesInfo_Key=0;c.k_texturesPalettesInfo_Palette=1;c.k_f3dPaletteAnimTimer=0;c.k_f3dPaletteAnimMaxTime=c.k_f3dPaletteAnimTimer+1;c.k_f3dPaletteAnimCurrPal=c.k_f3dPaletteAnimMaxTime+1;c.k_f3dPaletteAnimPalAmount=c.k_f3dPaletteAnimCurrPal+1;c.k_f3dPaletteAnimDatasize=c.k_f3dPaletteAnimPalAmount+1;c.s_isPaletteAnimNeeded=false;c.s_paletteAnimSpriteIndex=0;c.s_paletteAnimCurrPal=0;c.k_segment_object_f3d_flag_flip_shape=2048;c.k_segment_object_f3d_flag_flip_texture=1024;c.k_offroad_item_flag_invert=1;c.k_offroad_item_f3d_flag_just_invert_position=2;c.k_lod_segment_far=9;c.k_lod_segment_middle=7;c.k_lod_segment_near=2;c.k_fog_bright_color=-1;c.k_fog_bright_distance_x=10;c.k_fog_dark_distance_x=200;c.k_f3d_show_condition_start_line=1;c.k_f3d_show_condition_time_plane=2;c.prototype.constructor=function(){this.cTrack_Init()};c.prototype.Unload=function(){if(this.s_f3dTextureAnimData!=null){for(var n=0;n<this.s_f3dTextureAnimData.length;n++){this.s_f3dTextureAnimData[n]=null}this.s_f3dTextureAnimData=null}if(this.s_f3dPaletteAnim!=null){for(var n=0;n<this.s_f3dPaletteAnim.length;n++){this.s_f3dPaletteAnim[n]=null}this.s_f3dPaletteAnim=null}this.s_worldNum=null;this.s_worldPosX=null;this.s_worldPosY=null;this.s_worldPosZ=null;this.s_worldVecX=null;this.s_worldAngle=null;this.s_worldVecY=null;this.s_worldVecZ=null;this.s_worldRatio=null;this.s_worldYclip=null;this.s_worldXclip=null;this.s_worldXclipW=null;this.s_worldObjectNb=null;this.s_trackRoadBreak=null;this.s_offRoadOffsetX=null;this.s_offRoadOffsetY=null;this.s_offRoadItemPalette=null;if(this.s_worldObjectList!=null){for(var n=0;n<this.s_worldObjectList.length;n++){this.s_worldObjectList[n]=null}this.s_worldObjectList=null}if(this.s_offRoadItemAnim!=null){for(var n=0;n<this.s_offRoadItemAnim.length;n++){if(this.s_offRoadItemAnim[n]!=null){for(var m=0;m<this.s_offRoadItemAnim[n].length;m++){this.s_offRoadItemAnim[n][m]=null}this.s_offRoadItemAnim[n]=null}}this.s_offRoadItemAnim=null}if(this.s_offRoadItemAnimTime!=null){for(var n=0;n<this.s_offRoadItemAnimTime.length;n++){this.s_offRoadItemAnimTime[n]=null}this.s_offRoadItemAnimTime=null}this.s_roadIndex=null;this.s_roadTypeIndex=null;this.s_roadX1=null;this.s_roadY1=null;this.s_roadL1=null;this.s_f3dRatio=null;this.s_offRoadItemOffsetL=null;this.s_offRoadItemOffsetR=null;this.s_roadStatus=null;this.s_roadCustomParam=null;this.s_trackTabAng=null;this.s_trackTabInc=null;this.s_trackTabFlags=null;this.s_offRoadProRightCircuit=null;this.s_offRoadProLeftCircuit=null;this.s_offRoadItem=null;this.s_offRoadZone=null;this.s_segmentSlant=null;this.s_iOffsetX=0};c.prototype.cTrack_Init=function(){this.s_worldNum=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldPosX=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldPosY=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldPosZ=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldAngle=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldVecX=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldVecY=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldVecZ=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldRatio=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldYclip=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldXclip=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldXclipW=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldObjectNb=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_worldObjectList=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2,10],null);this.s_roadX1=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_roadY1=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_roadL1=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_f3dRatio=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_offRoadItemOffsetL=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_offRoadItemOffsetR=LowAPI.Gen_Array([(BuildConf.k_track_road_max_segment+1)*2],0);this.s_roadIndex=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_roadStatus=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_roadCustomParam=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_trackTabAng=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_trackTabInc=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_trackTabFlags=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_trackRoadBreak=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],false);this.s_trackSegEnvironment=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_offRoadProRightCircuit=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_offRoadProLeftCircuit=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_segmentSlant=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_f3dPaletteAnim=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],null);this.s_offRoadZone=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS],0);this.s_offRoadItem=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS*s_trackMaxObjSegmentsIngame],0);this.s_offRoadOffsetX=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS*s_trackMaxObjSegmentsIngame],0);this.s_offRoadOffsetY=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS*s_trackMaxObjSegmentsIngame],0);this.s_offRoadItemPalette=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS*s_trackMaxObjSegmentsIngame],0);this.s_f3dTextureAnimData=LowAPI.Gen_Array([MAINTRACK_NUM_SEGMENTS*s_trackMaxObjSegmentsIngame,c.k_f3dTextureAnimDatasize],0);this.s_missionItemData=LowAPI.Gen_Array([MAX_MISSION_OBJS_IN_MAIN_TRACK],null);this.s_missionID=0;this.s_iNextMainTrackAppendSegment=0;this.s_iNextMissionObjectID=0};c.prototype.cTrack_Reset=function(){this.Unload();this.cTrack_Init()};c.prototype.Track_updateTextureAnims=function(){if(arguments){switch(arguments.length){case 0:return this._Track_updateTextureAnims_0.apply(this,arguments);case 1:return this._Track_updateTextureAnims_1.apply(this,arguments)}}throw new Error("InvalidArguments")};c.prototype._Track_updateTextureAnims_1=function(o){var m;var n;if(this.s_f3dTextureAnimData[o][c.k_f3dTextureAnimKey]>=0){n=this.s_f3dTextureAnimData[o];if(n[c.k_f3dTextureAnimSegment]<s_camSegOn&(s_player._lapOn>0&!s_isStartAnimsAddNeeded)){this.StopTextureAnimation(o);return}else{if(n[c.k_f3dTextureAnimTimer]>=0){n[c.k_f3dTextureAnimTimer]-=Math_fixedPointTimeToInt(s_dt)}}if(n[c.k_f3dTextureAnimTimer]<0){if(n[c.k_f3dTextureAnimType]==k_f3d_anim_type_permanent){this.StartTextureAnimation(o)}else{if(n[c.k_f3dTextureAnimType]==k_f3d_anim_type_permanent_wait){if(!BuildConf.k_use_texture){return}if(n[c.k_f3dTextureAnimState]==c.k_f3dTextureAnimStateActive){n[c.k_f3dTextureAnimState]=c.k_f3dTextureAnimStateWait;n[c.k_f3dTextureAnimTimer]=Math_Rand(0,n[c.k_f3dTextureAnimInitTime]).castToShort()}else{if(n[c.k_f3dTextureAnimState]==c.k_f3dTextureAnimStateWait||n[c.k_f3dTextureAnimState]==c.k_f3dTextureAnimStateInactive){n[c.k_f3dTextureAnimState]=c.k_f3dTextureAnimStateActive;this.StartTextureAnimation(o)}}}else{if(n[c.k_f3dTextureAnimType]==k_f3d_anim_type_activation){if(!BuildConf.k_use_texture){return}if(n[c.k_f3dTextureAnimState]==c.k_f3dTextureAnimStateActive){this.StopTextureAnimation(o);n[c.k_f3dTextureAnimState]=c.k_f3dTextureAnimStateFinished}else{if(n[c.k_f3dTextureAnimState]==c.k_f3dTextureAnimStateInactive&&this.s_isTextureAnimActivationNeeded){this.StartTextureAnimation(o)}}}}}}else{this.UpdateTextureAnimation(n)}}};c.prototype._Track_updateTextureAnims_0=function(){var q;var m,p;var o,n;for(q=0;q<BuildConf.k_track_road_max_segment;q++){for(n=0;n<s_trackMaxObjSegmentsIngame;n++){p=this.s_worldNum[q];o=p*s_trackMaxObjSegmentsIngame+n;if(this.s_f3dTextureAnimData[o][c.k_f3dTextureAnimKey]>=0){this.Track_updateTextureAnims(o)}}}this.s_isTextureAnimActivationNeeded=false;if(s_player._segOn>s_mainTrackNbSegment-BuildConf.k_track_road_max_segment){s_isStartAnimsAddNeeded=true}else{if(s_player._segOn>BuildConf.k_track_road_max_segment&s_player._lapOn>0){s_isStartAnimsAddNeeded=false}}};c.prototype.UpdateTextureAnimation=function(r){var o,n,s,q,m,p;p=r[c.k_f3dTextureAnimSpriteId];m=r[c.k_f3dTextureAnimId];o=r[c.k_f3dTextureAnimTimer];n=r[c.k_f3dTextureAnimInitTime];q=s_textures[p].GetAFrames(m);s=GetValueBetweenPointsByTime(0,q-1,n-o,n,false);r[c.k_f3dTextureAnimFrame]=s_textures[p].GetAnimFrame(m,s).castToShort();r[c.k_f3dTextureAnimOffX]=s_textures[p].GetAFramesOX(m,s).castToShort();r[c.k_f3dTextureAnimOffY]=s_textures[p].GetAFramesOY(m,s).castToShort()};c.prototype.StartTextureAnimation=function(p){if(!BuildConf.k_use_texture){return}var o=this.s_f3dTextureAnimData[p][c.k_f3dTextureAnimMaxTime];var n=Math_Rand(LowAPI.Float2Int((o*8)/10),o).castToShort();this.s_f3dTextureAnimData[p][c.k_f3dTextureAnimTimer]=n;this.s_f3dTextureAnimData[p][c.k_f3dTextureAnimInitTime]=n;var q=this.s_f3dTextureAnimData[p][c.k_f3dTextureAnimSpriteId];var m=this.s_f3dTextureAnimData[p][c.k_f3dTextureAnimId];var r=0;this.s_f3dTextureAnimData[p][c.k_f3dTextureAnimFrame]=s_textures[q].GetAnimFrame(m,r).castToShort();this.s_f3dTextureAnimData[p][c.k_f3dTextureAnimState]=c.k_f3dTextureAnimStateActive};c.prototype.StopTextureAnimation=function(m){this.s_f3dTextureAnimData[m][c.k_f3dTextureAnimTimer]=-1;this.s_f3dTextureAnimData[m][c.k_f3dTextureAnimSegment]=-1;this.s_f3dTextureAnimData[m][c.k_f3dTextureAnimKey]=-1;this.s_f3dTextureAnimData[m][c.k_f3dTextureAnimSpriteId]=-1};c.prototype.GetF3DTextureAnimData=function(o,m,n){if(this.s_f3dTextureAnimData[o][c.k_f3dTextureAnimKey]==m&&this.s_f3dTextureAnimData[o][c.k_f3dTextureAnimF3DId]==n){return this.s_f3dTextureAnimData[o]}return null};c.prototype.AddF3DTextureAnim=function(r,u,m,s,o,q,t,n){var p;if(this.GetF3DTextureAnimData(r,u,t)!=null){return}p=this.s_f3dTextureAnimData[r];if(p[c.k_f3dTextureAnimKey]==-1){p[c.k_f3dTextureAnimKey]=u;p[c.k_f3dTextureAnimMaxTime]=o;p[c.k_f3dTextureAnimSpriteId]=m;p[c.k_f3dTextureAnimId]=s;p[c.k_f3dTextureAnimType]=q;p[c.k_f3dTextureAnimSegment]=r;p[c.k_f3dTextureAnimF3DId]=t;p[c.k_f3dTextureAnimSkipOffset]=n;p=null}};c.prototype.InitF3DTextureAnimArray=function(){for(var n=0;n<this.s_f3dTextureAnimData.length;n++){for(var m=0;m<this.s_f3dTextureAnimData[n].length;m++){this.s_f3dTextureAnimData[n][m]=-1}}};c.prototype.activate_objects=function(t,p){if(t!=0){this.s_isTextureAnimActivationNeeded=true;for(var v=0;v<(2*BuildConf.k_track_road_max_segment);v++){if(v==BuildConf.k_track_road_max_segment){continue}var u=p+v;if(u>=s_mainTrackNbSegment){u%=s_mainTrackNbSegment}for(var n=0;n<s_trackMaxObjSegmentsIngame;n++){var r=true;var o=this.s_offRoadItem[u*s_trackMaxObjSegmentsIngame+n];var s=GetOffroadObjectIndex(o);if((s==t||t==-1)&&r){this.activate_object(u*s_trackMaxObjSegmentsIngame+n)}}}}};c.prototype.activate_object=function(s){try{var m=this.s_offRoadItem[s];var q=GetOffroadObjectIndex(m);this.s_isTextureAnimActivationNeeded=true;if(s_f3dObjectsTransformTo[q]!=null&&s_f3dObjectsTransformTo[q].length!=0){var n=-1;if(s_f3dObjectsTransformTo[q][0]==Game.k_transform_type_simple){var r=1;n=r}else{if(s_f3dObjectsTransformTo[q][0]==Game.k_transform_type_speed&&s_f3dObjectsTransformTo[q].length>2){n=1}}if(n!=-1){this.s_offRoadItemTransforms[this.s_offRoadItemTransformIndex]=s.castToShort();this.s_offRoadItemTransforms[this.s_offRoadItemTransformIndex+1]=(q).castToShort();this.s_offRoadItemTransformIndex+=2;this.s_offRoadItem[s]&=~65535;this.s_offRoadItem[s]|=s_f3dObjectsTransformTo[q][n];q=s_f3dObjectsTransformTo[q][n]}}if(BuildConf.k_use_f3d_anim){if(s_f3dObjectsAnims[q]!=null&&s_f3dObjectsAnims[q].length>0){this.s_offRoadItemAnim[s]=LowAPI.Gen_Array([s_f3dObjectsAnims[q].length,Game.k_offroad_anim_size],0);this.s_offRoadItemAnimTime[s]=LowAPI.Gen_Array([s_f3dObjectsAnims[q].length]);if(s_f3dObjectsAnimRepeat[q]){for(var p=0;p<this.s_offRoadItemAnim[s].length;p++){this.s_offRoadItemAnim[s][p][Game.k_offroad_anim_active_object]=1}}}if(s_f3dObjectsAnims[q]!=null&&s_f3dObjectsAnims[q].length>0&&this.s_offRoadItemAnim[s]!=null){for(var p=0;p<this.s_offRoadItemAnim[s].length;p++){this.s_offRoadItemAnim[s][p][Game.k_offroad_anim_active_object]=1;this.s_offRoadItemAnim[s][p][Game.k_offroad_anim_animation_done]=0;this.s_offRoadItemAnim[s][p][Game.k_offroad_anim_current_step]=0;this.s_offRoadItemAnimTime[s][p]=Math_fixedPointTimeToInt(s_raceTime);this.s_offRoadItemAnim[s][p][Game.k_offroad_anim_end_x]=s_f3dObjectsAnims[q][p][1+Game.k_f3dObjectsAnims_x];this.s_offRoadItemAnim[s][p][Game.k_offroad_anim_end_z]=s_f3dObjectsAnims[q][p][1+Game.k_f3dObjectsAnims_y];this.s_offRoadItemAnim[s][p][Game.k_offroad_anim_end_y]=s_f3dObjectsAnims[q][p][1+Game.k_f3dObjectsAnims_z]}}}this.AddF3DTexureAnims(s)}catch(o){Err("Error when active objects on roadIndex:   "+s);Err(o)}};c.prototype.getCurveAngle=function(n){var m=0;var o=n;if(this.s_trackTabAng[n]!=0){while(this.s_trackTabAng[n]*this.s_trackTabAng[o]>0){m+=this.s_trackTabAng[o];o=(o+1)%s_mainTrackNbSegment;if(o==n){break}}return m}return 0};c.prototype.getOffRoadProperty=function(n,m,o){var p=(n==cActor.k_offroad_side_right)?this.s_offRoadProRightCircuit[m]:this.s_offRoadProLeftCircuit[m];return s_offRoadPro[p*OffRoadPro.k_num+o]};c.prototype.AddMissionObjectToList=function(o,n){var m=-1;var q=n*k_item_data_length;if(this.s_missionItemData[this.s_iNextMissionObjectID]==null){this.s_missionItemData[this.s_iNextMissionObjectID]=LowAPI.Gen_Array([k_item_data_length],0)}for(var p=0;p<k_item_data_length;p++){this.s_missionItemData[this.s_iNextMissionObjectID][p]=o[q];q++}m=this.s_iNextMissionObjectID;this.s_iNextMissionObjectID++;if(this.s_iNextMissionObjectID>=MAX_MISSION_OBJS_IN_MAIN_TRACK){this.s_iNextMissionObjectID%=MAX_MISSION_OBJS_IN_MAIN_TRACK}return m};c.prototype.track_getMissionItemType=function(m){return this.s_missionItemData[m][k_item_type_id]};c.prototype.track_getMissionItemSegment=function(m){return this.s_missionItemData[m][k_item_seg_index]};c.prototype.track_getMissionItemLane=function(m){return cActor.update_getLaneFromPosition(this.s_missionItemData[m][k_item_xposition])};c.prototype.track_setMissionItemData=function(n,m,p,o){this.s_missionItemData[n][k_item_type_id]=m;this.s_missionItemData[n][k_item_f3d_index]=p;this.s_missionItemData[n][k_item_value]=o};c.prototype.track_enableMissionItem=function(n,m){this.s_missionItemData[n][k_item_state]=m?k_item_state_enable:k_item_state_disable};c.prototype.track_hideMissionItem=function(m,n){this.s_missionItemData[m][k_item_state]=n?k_item_state_off:k_item_state_enable};c.prototype.track_preprocessMissionItems=function(p,r){var o=p;for(var n=0;n<r;n++){var q=this.track_getMissionItemType(o);switch(q){case k_item_type_coinGeneric:var s=game_ChooseCoin(this.track_getMissionItemSegment(o));if(s_game_goldRushDt>0){this.track_setMissionItemData(o,-coinTypeIndex[s],DATA.OBJECTS_COIN_GOLD,s_game_coinValue[s])}else{this.track_setMissionItemData(o,coinTypeIndex[s],coinObject[s],s_game_coinValue[s])}break;case k_item_type_powerupGeneric:var m=game_ChoosePowerUp();if(m==k_item_type_none){this.track_hideMissionItem(o,true)}else{if(m==k_item_type_coinGeneric){var s=game_ChooseCoin(this.track_getMissionItemSegment(o));if(s_game_goldRushDt>0){this.track_setMissionItemData(o,-coinTypeIndex[s],DATA.OBJECTS_COIN_GOLD,s_game_coinValue[s])}else{this.track_setMissionItemData(o,coinTypeIndex[s],coinObject[s],s_game_coinValue[s])}}else{if(m==k_item_type_artifactPowerup){this.track_setMissionItemData(o,k_item_type_artifactPowerup,h[d.RELIC][this.track_getMissionItemLane(o)],0)}else{if(m==k_item_type_coinCrate){this.track_setMissionItemData(o,k_item_type_coinCrate,h[d.COIN][this.track_getMissionItemLane(o)],0)}else{if(m==k_item_type_mountPowerup){this.track_setMissionItemData(o,k_item_type_mountPowerup,h[d.TIGER][this.track_getMissionItemLane(o)],0);s_bJustGeneratedTigerPowerup=true}else{this.track_setMissionItemData(o,m,h[d.POWERUP][this.track_getMissionItemLane(o)],0)}}}}}break}o++;if(o>=MAX_MISSION_OBJS_IN_MAIN_TRACK){o%=MAX_MISSION_OBJS_IN_MAIN_TRACK}}};c.prototype.track_switchgoldCoins=function(o){for(var m=0;m<this.s_missionItemData.length;m++){if(this.s_missionItemData[m]==null){return}var n=this.s_missionItemData[m][k_item_type_id];switch(n){case k_item_type_bronzeCoin:if(o){this.track_setMissionItemData(m,k_item_type_goldBronzeCoin,DATA.OBJECTS_COIN_GOLD,s_game_coinValue[GOLD_COIN])}break;case k_item_type_silverCoin:if(o){this.track_setMissionItemData(m,k_item_type_goldSilverCoin,DATA.OBJECTS_COIN_GOLD,s_game_coinValue[GOLD_COIN])}break;case k_item_type_goldBronzeCoin:if(!o){this.track_setMissionItemData(m,k_item_type_bronzeCoin,DATA.OBJECTS_COIN_BRONZE,s_game_coinValue[BRONZE_COIN])}break;case k_item_type_goldSilverCoin:if(!o){this.track_setMissionItemData(m,k_item_type_silverCoin,DATA.OBJECTS_COIN_SILVER,s_game_coinValue[SILVER_COIN])}break}}};c.prototype.track_isPowerUpOnTrack=function(){for(var m=0;m<this.s_missionItemData.length;m++){if(this.s_missionItemData[m]==null){return false}var n=this.s_missionItemData[m][k_item_type_id];switch(n){case k_item_type_ankhPowerup:case k_item_type_goldRushPowerup:case k_item_type_bagOfCoinsPowerup:case k_item_type_mountPowerup:return true}}return false};c.prototype.InitF3DAnim=function(p){if(s_f3dObjectsAnims[p].length>0){for(var n=0;n<this.s_offRoadItem.length;n++){if((this.s_offRoadItem[n]&65535)==p){this.s_offRoadItemAnim[n]=LowAPI.Gen_Array([s_f3dObjectsAnims[p].length,Game.k_offroad_anim_size],0);this.s_offRoadItemAnimTime[n]=LowAPI.Gen_Array([s_f3dObjectsAnims[p].length],0);if(s_f3dObjectsAnimRepeat[p]){for(var o=0;o<this.s_offRoadItemAnim[n].length;o++){this.s_offRoadItemAnim[n][o][Game.k_offroad_anim_active_object]=1}}}}}};c.prototype.AddPaletteAnim=function(n,q,p){var m,r;for(var o=0;o<this.s_offRoadItem.length;o++){r=GetOffroadObjectIndex(this.s_offRoadItem[o]);if(r==n){m=LowAPI.Float2Int(o/s_trackMaxObjSegmentsIngame);this.AddPaletteAnimToSeg(m,q,p)}}};c.prototype.AddPaletteAnimToSeg=function(m,o,n){this.s_f3dPaletteAnim[m]=LowAPI.Gen_Array([c.k_f3dPaletteAnimDatasize]);this.s_f3dPaletteAnim[m][c.k_f3dPaletteAnimTimer]=Math_fixedPointTime(o);this.s_f3dPaletteAnim[m][c.k_f3dPaletteAnimMaxTime]=Math_fixedPointTime(o);this.s_f3dPaletteAnim[m][c.k_f3dPaletteAnimCurrPal]=0;this.s_f3dPaletteAnim[m][c.k_f3dPaletteAnimPalAmount]=n};c.prototype.UpdatePaletteAnim=function(r){var o;var n,m,q;for(var p=0;p<this.s_f3dPaletteAnim.length;p++){if(this.s_f3dPaletteAnim[p]!=null){o=this.s_f3dPaletteAnim[p];if(o[c.k_f3dPaletteAnimTimer]<0){o[c.k_f3dPaletteAnimTimer]=o[c.k_f3dPaletteAnimMaxTime];o[c.k_f3dPaletteAnimCurrPal]=0}else{n=o[c.k_f3dPaletteAnimTimer];m=o[c.k_f3dPaletteAnimMaxTime];q=o[c.k_f3dPaletteAnimPalAmount];o[c.k_f3dPaletteAnimCurrPal]=GetValueBetweenPointsByTime(0,q,m-n,m+1,false).castToShort();o[c.k_f3dPaletteAnimTimer]-=r}}}};c.prototype.mission_enableAllItems=function(o){for(var n=0;n<this.s_missionItemData.length;n++){for(var m=k_item_state;m<this.s_missionItemData[n].length;m+=k_item_data_length){this.s_missionItemData[n][m]=k_item_state_enable}}};c.prototype.ExtractWorld=function(r,x,p,P,N,L){var P=LowAPI.Float2Int(P);var N=LowAPI.Float2Int(N);var L=LowAPI.Float2Int(L);var I,H;var K,Q,v;var R;var q,o,n;var E,D,B;var z,G,M;var y=0,F=0,J=0;var T,u,O;var S;var C;var w;w=N-s_camera_distance;K=x;Q=p;v=this.s_trackTabInc[K]-s_camIncOn;q=P;o=N;n=L;if(r){for(I=0;I<BuildConf.k_track_road_max_segment;I++){var m=K-I;if(m<0){m+=s_mainTrackNbSegment}}}C=Math_FixedPointToInt(s_player._segYOn*math_Sin(v));if(s_player._segOn!=s_camSegOn){C+=Math_FixedPointToInt(math_Sin(this.s_trackTabInc[s_camSegOn]-s_camIncOn)<<(Game.k_segment_base))}n-=C+s_camHauOffset;D=0;var t=r?0:(BuildConf.k_track_road_max_segment+1);var s;for(I=t;I<t+BuildConf.k_track_road_max_segment;I++){this.s_worldObjectNb[I]=0;this.s_worldNum[I]=K;if(this.s_roadStatus[K]==TRACKSEGMENT_STATUS.IGNORE){K=getNextSeg(K)}else{if(this.s_roadStatus[K]==TRACKSEGMENT_STATUS.MAINTRACK_END){s_iBifurcationSegment=K}if(this.s_roadStatus[K]==TRACKSEGMENT_STATUS.BIFURCATION_START){var A=s_cTrack[s_iBifurcationTrack_Main];Q=A.s_worldAngle[I];v=A.s_trackTabInc[K]-s_camIncOn;E=A.s_worldVecX[I];D=A.s_worldVecY[I];B=A.s_worldVecZ[I];q=A.s_worldPosX[I];o=A.s_worldPosY[I];w=o-s_camera_distance;n=A.s_worldPosZ[I]-Track_getRoundHeightOffset(w);this.s_worldPosX[I]=A.s_worldPosX[I];this.s_worldPosY[I]=A.s_worldPosY[I];this.s_worldPosZ[I]=A.s_worldPosZ[I];this.s_worldVecX[I]=A.s_worldVecX[I];this.s_worldVecY[I]=A.s_worldVecY[I];this.s_worldVecZ[I]=A.s_worldVecZ[I];this.s_worldAngle[I]=A.s_worldAngle[I]}else{this.s_worldAngle[I]=Q;E=-math_Sin(Q);D=Math_Cos(v);B=math_Sin(v);if(I==(BuildConf.k_track_road_max_segment-1)){B=LowAPI.Float2Int((s_camPosOn*B)/Game.k_segment_length)}this.s_worldPosX[I]=q;this.s_worldPosY[I]=o;this.s_worldPosZ[I]=n+Track_getRoundHeightOffset(w);this.s_worldVecX[I]=E;this.s_worldVecY[I]=D;this.s_worldVecZ[I]=B}if(I==(BuildConf.k_track_road_max_segment-1)){o=BuildConf.k_track_road_max_segment*Game.k_segment_length;w=BuildConf.k_track_road_max_segment*Game.k_segment_length}z=q-s_trackRoadHalfWidth;G=o;M=n+Track_getRoundHeightOffset(w);q+=Math_fixedPointAdjust(E,GLLibConfig.math_fixedPointBase,Game.k_segment_base);s=Math_fixedPointAdjust(D,GLLibConfig.math_fixedPointBase,Game.k_segment_base);o+=s;n+=Math_fixedPointAdjust(B,GLLibConfig.math_fixedPointBase,Game.k_segment_base);y=q-s_trackRoadHalfWidth;F=o;J=n+Track_getRoundHeightOffset(w+s);this.Track_clipWorld(I,o,D,z,G,M,y,F,J);K=getNextSeg(K);w+=s;Q+=this.s_trackTabAng[K];v=this.s_trackTabInc[K]-s_camIncOn}}this.s_roadL1[I]=0;this.s_worldRatio[I]=0;if(F>=k_viewClip_3D_world&&D>0){S=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/F);u=s_viewProjCenter-Math_FixedPointToInt(J*S);T=k_middle_region_x+Math_FixedPointToInt(y*S);O=Math_FixedPointToInt((s_trackRoadHalfWidth<<1)*S);if(BuildConf.k_track_road_spr_ep==2){u=((u+1)&4294967294).castToInt()}o=BuildConf.k_track_road_max_segment*Game.k_segment_length;w=BuildConf.k_track_road_max_segment*Game.k_segment_length;this.s_worldPosX[I]=q;this.s_worldPosY[I]=o;this.s_worldPosZ[I]=n+Track_getRoundHeightOffset(w);if(O<BuildConf.k_track_road_spr_size_min){T+=(O-BuildConf.k_track_road_spr_size_min)>>1;O=BuildConf.k_track_road_spr_size_min}this.s_roadX1[I]=T;this.s_roadY1[I]=u;this.s_roadL1[I]=O;this.s_worldRatio[I]=S}};c.prototype.Track_clipWorld=function(r,w,v,B,n,u,A,m,t){var q;var o;var z;var s;var x;this.s_roadL1[r]=0;this.s_worldRatio[r]=0;var p=k_viewClip_3D_road;if(m>=p){if(n<p){B=LowAPI.Float2Int((((A-B)*(p-n))/(m-n))+B);u=LowAPI.Float2Int((((t-u)*(p-n))/(m-n))+u);n=p}x=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/n);z=s_viewProjCenter-Math_FixedPointToInt(u*x);o=k_middle_region_x+Math_FixedPointToInt(B*x);s=Math_FixedPointToInt((s_trackRoadHalfWidth<<1)*x);if((BuildConf.k_track_road_spr_ep)==2){z=((z+1)&4294967294).castToInt()}if(s<BuildConf.k_track_road_spr_size_min){o+=(s-BuildConf.k_track_road_spr_size_min)>>1;s=BuildConf.k_track_road_spr_size_min}else{if(s>(BuildConf.k_track_road_spr_size_max<<1)){q=s-(BuildConf.k_track_road_spr_size_max<<1);o+=LowAPI.Float2Int((q>>1)+((q*(s_camLatOn))/(s_trackRoadHalfWidth<<1)));s=(BuildConf.k_track_road_spr_size_max<<1)}}this.s_roadX1[r]=o;this.s_roadY1[r]=z;this.s_roadL1[r]=s}if(m>=k_viewClip_3D_world){n=w-Math_fixedPointAdjust(v,GLLibConfig.math_fixedPointBase,Game.k_segment_base);if(n<k_viewClip_F3D){n=k_viewClip_F3D}this.s_f3dRatio[r]=LowAPI.Float2Int(Math_Abs(Math_IntToFixedPoint(s_camFocale)/n));if(n<k_viewClip_3D_world){n=k_viewClip_3D_world}this.s_worldRatio[r]=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/n)}};c.prototype.Track_drawGridLine=function(K,y,B,C,A,M,t){var L,I,H,E,J,G,F,D;var p,o,n;var z,x;var s=this.s_worldPosX[K];var r=this.s_worldPosY[K];var q=this.s_worldPosZ[K];var m=K+1;if(m>=BuildConf.k_track_road_max_segment){return}p=r+Math_fixedPointAdjust(LowAPI.Float2Int(Math_IntToFixedPoint(B)/Game.k_segment_length),GLLibConfig.math_fixedPointBase,Game.k_segment_base);o=r+Math_fixedPointAdjust(LowAPI.Float2Int(Math_IntToFixedPoint(B+A)/Game.k_segment_length),GLLibConfig.math_fixedPointBase,Game.k_segment_base);n=r+Math_fixedPointAdjust(LowAPI.Float2Int(Math_IntToFixedPoint(B+A-M)/Game.k_segment_length),GLLibConfig.math_fixedPointBase,Game.k_segment_base);if(p==0||o==0||n==0){return}var w=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/p);var v=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/o);var u=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/n);if(w<=0||v<=0||u<=0){return}L=LowAPI.Float2Int(y+(((this.s_worldPosX[m]-s)*(p-r))/(this.s_worldPosY[m]-r))+s);I=L+C;H=LowAPI.Float2Int(y+(((this.s_worldPosX[m]-s)*(o-r))/(this.s_worldPosY[m]-r))+s);E=H+C;J=L+M;G=I-M;F=LowAPI.Float2Int(y+M+(((this.s_worldPosX[m]-s)*(n-r))/(this.s_worldPosY[m]-r))+s);D=F+C-(M<<1);z=q;x=q;L=(k_middle_region_x)+Math_FixedPointToInt(L*w);I=(k_middle_region_x)+Math_FixedPointToInt(I*w);H=(k_middle_region_x)+Math_FixedPointToInt(H*v);E=(k_middle_region_x)+Math_FixedPointToInt(E*v);J=(k_middle_region_x)+Math_FixedPointToInt(J*w);G=(k_middle_region_x)+Math_FixedPointToInt(G*w);F=(k_middle_region_x)+Math_FixedPointToInt(F*u);D=(k_middle_region_x)+Math_FixedPointToInt(D*u);p=s_viewProjCenter-Math_FixedPointToInt(z*w);o=s_viewProjCenter-Math_FixedPointToInt(x*v);n=s_viewProjCenter-Math_FixedPointToInt(z*u);g.setColor(t);FillTriangle(L,p,J,p,H,o);FillTriangle(G,p,I,p,E,o);FillTriangle(J,p,H,o,F,n);FillTriangle(G,p,D,n,E,o);DrawLine(g,H,o,E,o)};c.prototype.drawF3DAddType=function(m,p,v){var q=((m&3840)>>8);if(this.s_missionID==q){var s=m&255;var o=s_missionF3dObjAddData[s_missionID][s];var u=((o&28672)>>12);var t=(o&256)!=0;var n=((o&32768))!=0;if((u==s_player._lapOn||n||((u==s_player._lapOn+1)))&&(!t)){var r=(o&(c.k_segment_object_f3d_flag_flip_shape|c.k_segment_object_f3d_flag_flip_texture))}}};c.prototype.Track_drawSegmentObjects=function(n,m){var r=n?0:(BuildConf.k_track_road_max_segment+1);var o=r+BuildConf.k_track_road_max_segment-1-m;SetClipWrapper(0,0,GetScreenWidth(),this.s_worldYclip[o]);var q;var p,s;q=this.s_worldObjectList[o];p=this.s_worldObjectNb[o];for(s=0;s<p;s++){q[s].StateMachine_SendMessage(cActor.STATE_MESSAGE_PAINT)}SetClipWrapper(0,0,GetScreenWidth(),GetScreenHeight())};c.prototype.Track_addActorToDrawList=function(q,t){if(!q._alive&&!q._shadow){return}var s=t?0:(BuildConf.k_track_road_max_segment+1);var m=-1;for(var o=s;o<s+BuildConf.k_track_road_max_segment;o++){if(q._segOn==this.s_worldNum[o]){m=o;break}}if(m<0){return}q._segExtract=m;if((m<(s+BuildConf.k_track_road_max_segment-1))||((m==(s+BuildConf.k_track_road_max_segment-1))&&(q._segYOn<s_camPosOn))){if(!q._computedProjection&&q.compute2dProjection(m)){var p=this.s_worldObjectNb[m];var r=this.s_worldObjectList[m];var o=0;if(p<r.length){while((o<p)&&(r[o]._segYOn>=q._segYOn)){o++}for(var n=p;n>o;n--){r[n]=r[n-1]}r[o]=q;this.s_worldObjectNb[m]++}}}};c.prototype.DrawWorld=function(Q,W){var L,Y;var ad;var s;var J;var I;var H;var B,A,y,x;var al,aj,ai,ah;var R,P,O,M;var r;var aa;var p;var z;var U,T,S;var t=0;var v=Q?0:(BuildConf.k_track_road_max_segment+1);var ac=v+BuildConf.k_track_road_max_segment-1-W;if(!Q){for(var ab=0;ab<BuildConf.k_track_road_max_segment;ab++){if(this.s_worldNum[ac]==this.s_worldNum[ab]){return}}}if(this.s_roadStatus[this.s_worldNum[ac]]==TRACKSEGMENT_STATUS.IGNORE){return}L=ac;SetClipWrapper(0,0,GetScreenWidth(),this.s_worldYclip[L]);if(Math_Abs(this.s_worldAngle[L])>=k_world_angle_limit){return}Y=this.s_worldNum[L];J=this.s_worldPosX[L]+this.s_iOffsetX;I=this.s_worldPosY[L];H=this.s_worldPosZ[L];if(I>s_trackStartFog){aa=LowAPI.Float2Int(((I-s_trackStartFog)<<IDefine.PERCENT_BASE)/((BuildConf.k_track_road_max_segment<<Game.k_segment_base)-s_trackStartFog))}else{aa=0}if((Y==0)&&(I>k_viewClip_3D_world)){r=k_grid_color;if(aa>0){r=InterpolateColor255(s_trackColorFogCurrent,r,aa)}var F=(s_trackLaneCount>>1);var ag=(this.s_trackTabFlags[L])&1;var V=(this.s_trackTabFlags[L]>>1)&1;var X=(s_trackRoadHalfWidth<<1)/s_trackLaneCount;var D=this.s_worldPosX[L]+((F-ag)*-X)+this.s_iOffsetX;var w=this.s_worldPosX[L]+((F-V)*X)+this.s_iOffsetX;al=this.s_worldPosY[L];if(al==0){al=1}var m=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/al);B=k_middle_region_x+Math_FixedPointToInt(D*m);A=k_middle_region_x+Math_FixedPointToInt(w*m);al=s_viewProjCenter-Math_FixedPointToInt(this.s_worldPosZ[L]*m);aj=Math_FixedPointToInt(this.s_worldVecY[L]*k_finishLineHeight)+this.s_worldPosY[L];if(aj==0){aj=1}var ak=LowAPI.Float2Int(Math_IntToFixedPoint(s_camFocale)/aj);y=k_middle_region_x+Math_FixedPointToInt(D*ak);x=k_middle_region_x+Math_FixedPointToInt(w*ak);aj=s_viewProjCenter-Math_FixedPointToInt(this.s_worldPosZ[L]*ak);SetColor(r);FillTriangleWrapper(B,al,y,aj,x,aj);FillTriangleWrapper(B,al,x,aj,A,al)}var C=0;var K;for(var Z=0;Z<s_trackMaxObjSegmentsIngame;Z++){C=Y*s_trackMaxObjSegmentsIngame+Z;z=this.s_offRoadItem[C];K=GetOffroadObjectType(z);U=this.s_offRoadOffsetX[C];T=this.s_offRoadOffsetY[C];S=0;if(BuildConf.k_use_f3d_palettes){t=this.s_offRoadItemPalette[C]}if((z!=0)&&(z>>16&1)!=1){if(K==Game.k_f3d_object_type){ad=(z>>17&3);p=z&65535;this.Track_drawF3dObj(p,t,L,U+((ad!=0)?(-this.s_iOffsetX):this.s_iOffsetX),T,S,ad,C);continue}else{if(((z>>28)&15)==Game.k_f3d_object_add_type&&(s_challengeUseItemsToSegment>=s_challengeUseItemsFromSegment?(this.s_worldNum[L]>=s_challengeUseItemsFromSegment&&this.s_worldNum[L]<=s_challengeUseItemsToSegment):(this.s_worldNum[L]>=s_challengeUseItemsFromSegment||this.s_worldNum[L]<=s_challengeUseItemsToSegment))){p=z&65535;ad=(z>>17&3);this.Track_drawF3dObj(p,0,L,U+((ad!=0)?(-this.s_iOffsetX):this.s_iOffsetX),T,S,ad,C);continue}}if(K==Game.k_item_type){var o=(z&4095);var N;var E;var q;var G;var af;N=this.s_missionItemData[o];E=N[k_item_xposition];q=N[k_item_yposition];G=N[k_item_state];p=N[k_item_f3d_index];af=(N[k_item_flipProperty]==0)?0:c.k_offroad_item_flag_invert;var u=false;if(G==k_item_state_enable){try{this.Track_drawF3dObj(p,0,L,E+this.s_iOffsetX,q,0,af,C)}catch(ae){Err(ae)}}}}}SetClipWrapper(0,0,GetScreenWidth(),GetScreenHeight())};c.prototype.Track_updateF3dAnims=function(){};c.prototype.AddF3DTexureAnims=function(t){var r=this.s_offRoadItem[t];var q=r&65535;var m;var x=s_f3dObjectsLength[q];var v=-1;var o=-1;var u=-1;var n=0;var y=false;var p=0;var w;for(var s=0;s<x;s++){m=s_f3dObjects[q][s];if(m[k_f3d_command]==k_f3d_cmd_set_anim){y=true;v=m[k_f3d_command_anim_idx];o=m[k_f3d_command_anim_time];u=m[k_f3d_command_anim_type];n=m[k_f3d_command_offset_skip]}else{if(m[k_f3d_command]==k_f3d_cmd_set_texture){if(y){w=m[k_f3d_command_texture_index];if(BuildConf.k_use_texture_anim){this.AddF3DTextureAnim(t.castToShort(),p,w.castToShort(),v,o,u,q.castToShort(),n)}y=false;p++}}}}};c.GetF3DTextureInfo=function(r,q){var x=s_f3dObjectsLength[q];var m;var w,s;if(r==null){r=LowAPI.Gen_Array([ITextureInfo.size],0)}for(var t=0;t<x;t++){m=s_f3dObjects[q][t];if(m[k_f3d_command]==k_f3d_cmd_set_texture){s=m[k_f3d_command_texture_params];w=m[k_f3d_command_texture_index];var o=getTextureCommand(w,s);var v=getTextureSriteIndex(o);var n=getTextureFrame(o);var p=getTexturePalette(o);if(BuildConf.k_use_textures_day_night){for(var u=0;u<s_texturesPalettesInfo[v].length;u+=2){p=s_texturesPalettesInfo[v][u+1]+s_texturesPalettesAmount[v]}}r[ITextureInfo.sprite]=v;r[ITextureInfo.frame]=n;r[ITextureInfo.pal]=p}}return r};c.prototype.Track_drawF3dObj=function(n,ar,au,al,ai,ag,a4,aZ){var aL;var a5;var T,R,P;var v,s,p;var bc,bb,ba;var N=-1,a9=-1;var W=0;track_setF3dClip(n);var aN=(a4&c.k_offroad_item_flag_invert)!=0;var Z=(a4&c.k_offroad_item_f3d_flag_just_invert_position)!=0;var aA,ay,aw;var aT=this.s_worldPosX[au];var aS=this.s_worldPosY[au];var aR=this.s_worldPosZ[au];var A=this.s_worldPosX[au+1];var be=this.s_worldPosY[au+1];var a2=this.s_worldPosZ[au+1];var ao,an,am,S,Q,O,x,t,q;var aU=0;var bg=s_f3dObjectsLength[n];var ah;var ak=0;var aQ=0;var X=0;var y=0;var bi=0;var aa=-1;var aD=-1;var aE=-1;var u=0;var o=false;var aC=true;var D=0;for(var aB=0;aB<bg;aB++){var M=al;var K=ai;var I=ag;aL=s_f3dObjects[n][aB];if(aL[k_f3d_command]==k_f3d_cmd_set_color){if(BuildConf.k_use_f3d_palettes){if(ar==0){W=aL[k_f3d_command_b]+(aL[k_f3d_command_g]<<8)+(aL[k_f3d_command_r]<<16)}else{W=s_f3dPalettes[n][ar-1][aU];aU++}}else{W=aL[k_f3d_command_b]+(aL[k_f3d_command_g]<<8)+(aL[k_f3d_command_r]<<16)}}else{if(aL[k_f3d_command]==k_f3d_cmd_set_texture){aQ=aL[k_f3d_command_texture_params];ak=aL[k_f3d_command_texture_index];X=aL[k_f3d_command_texture_night_index];y=aL[k_f3d_command_texture_night_params];if(o&&(au==BuildConf.k_track_road_max_segment-1||s_isStartAnimsAddNeeded)){if(BuildConf.k_use_texture_anim){this.AddF3DTextureAnim(aZ.castToShort(),bi.castToShort(),ak,aa,aD,aE,n.castToShort(),u)}o=false}if(ak==X){if(c.s_isPaletteAnimNeeded){if(c.s_paletteAnimSpriteIndex==-1||c.s_paletteAnimSpriteIndex==ak){c.s_paletteAnimSpriteIndex=ak}else{c.s_paletteAnimSpriteIndex=-1;c.s_isPaletteAnimNeeded=false}}}else{c.s_paletteAnimSpriteIndex=-1;c.s_isPaletteAnimNeeded=false}}else{if(aL[k_f3d_command]==k_f3d_cmd_set_pal_day||aL[k_f3d_command]==k_f3d_cmd_set_pal_night){}else{if(aL[k_f3d_command]==k_f3d_cmd_set_anim){o=true;aC=false;aa=aL[k_f3d_command_anim_idx];aD=aL[k_f3d_command_anim_time];aE=aL[k_f3d_command_anim_type];u=aL[k_f3d_command_offset_skip]}else{if(aL[k_f3d_command]==k_f3d_cmd_set_day_night_color){}else{if(aL[k_f3d_command]==k_f3d_cmd_triangle){ah=aL[k_f3d_command_layer];S=aL[k_f3d_command_y1]+I;Q=aL[k_f3d_command_y2]+I;O=aL[k_f3d_command_y3]+I;aA=Game.k_segment_length-S;ay=Game.k_segment_length-Q;aw=Game.k_segment_length-O;v=(((be*S)>>Game.k_segment_base)+((aS*aA)>>Game.k_segment_base));s=(((be*Q)>>Game.k_segment_base)+((aS*ay)>>Game.k_segment_base));p=(((be*O)>>Game.k_segment_base)+((aS*aw)>>Game.k_segment_base));var C=v>s?v:s;C=C>p?C:p;if(C<k_viewClip_F3D){continue}T=(aN?this.s_offRoadItemOffsetL[au]:this.s_offRoadItemOffsetR[au]);R=T;P=T;N=T;ao=aL[k_f3d_command_x1]+M;an=aL[k_f3d_command_x2]+M;am=aL[k_f3d_command_x3]+M;x=aL[k_f3d_command_z1]+K;t=aL[k_f3d_command_z2]+K;q=aL[k_f3d_command_z3]+K;if(aN){T+=-ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=-an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base));P+=-am+(((A*O)>>Game.k_segment_base)+((aT*aw)>>Game.k_segment_base))}else{T+=ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base));P+=am+(((A*O)>>Game.k_segment_base)+((aT*aw)>>Game.k_segment_base))}bc=x+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base));bb=t+(((a2*Q)>>Game.k_segment_base)+((aR*ay)>>Game.k_segment_base));ba=q+(((a2*O)>>Game.k_segment_base)+((aR*aw)>>Game.k_segment_base));if((aL[k_f3d_command_flags]&(k_tri_flag_perspective|k_tri_flag_perspective_h))==0){var aG=GetFogColor(Math_Max(v,Math_Max(s,p)),W,s_iSegmentFogColor);Track_drawTriangle(T,v,bc,R,s,bb,P,p,ba,N,a9,aG,aL[k_f3d_command_flags],true,a4)}else{if((aL[k_f3d_command_flags]&(k_tri_flag_perspective))!=0){a9=q+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base))}else{N+=am+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base))}var Y=getTextureCommand(ak,aQ);var aX=getTextureCommand(X,y);var aW=getTextureSriteIndex(Y);var H=getTextureSriteIndex(X);var a1=getTextureFrame(Y);var aF=getTextureFrame(aX);var m=(getTexturePalette(Y)).castToByte();var L=(getTexturePalette(aX)).castToByte();if(aW==H&&a1==aF){var az=a1;if(BuildConf.k_use_texture_anim){var a7=this.GetF3DTextureAnimData(aZ.castToShort(),bi.castToShort(),n.castToShort());if(a7!=null&&a7[c.k_f3dTextureAnimSpriteId]==aW){if(a7!=null&&a7[c.k_f3dTextureAnimTimer]>0&&a7[c.k_f3dTextureAnimState]!=c.k_f3dTextureAnimStateWait){az=a7[c.k_f3dTextureAnimFrame]}}}var bd;if(c.s_isPaletteAnimNeeded){bd=c.s_paletteAnimCurrPal}else{if(BuildConf.k_use_textures_day_night){bd=c.GetTexturePalette(aW,m,L)}else{bd=m}}var aV=getTextureCommand(aW,az,bd);try{Track_drawTriangle(T,v,bc,R,s,bb,P,p,ba,N,a9,aV,aL[k_f3d_command_flags],true,a4)}catch(bf){Err("Error when draw texture:  "+aV);throw bf}}else{Track_drawTriangle(T,v,bc,R,s,bb,P,p,ba,N,a9,Y,aL[k_f3d_command_flags],true,a4)}}}else{if(aL[k_f3d_command]==k_f3d_cmd_custom_texture_rect){ah=aL[k_f3d_command_line_layer];S=aL[k_f3d_command_y1]+I;Q=aL[k_f3d_command_y2]+I;aA=Game.k_segment_length-S;ay=Game.k_segment_length-Q;v=(((be*S)>>Game.k_segment_base)+((aS*aA)>>Game.k_segment_base));if(v<k_viewClip_F3D){continue}s=(((be*Q)>>Game.k_segment_base)+((aS*ay)>>Game.k_segment_base));T=(aN?this.s_offRoadItemOffsetL[au]:this.s_offRoadItemOffsetR[au]);R=T;ao=aL[k_f3d_command_x1]+M;an=aL[k_f3d_command_x2]+M;x=aL[k_f3d_command_z1]+K;t=aL[k_f3d_command_z2]+K;if(aN){T+=-ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=-an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}else{T+=ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}bc=x+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base));bb=t+(((a2*Q)>>Game.k_segment_base)+((aR*ay)>>Game.k_segment_base));T=LowAPI.Float2Int((k_middle_region_x)+(T*s_camFocale)/v);R=LowAPI.Float2Int((k_middle_region_x)+(R*s_camFocale)/s);bc=LowAPI.Float2Int(s_viewProjCenter-(bc*s_camFocale)/v);bb=LowAPI.Float2Int(s_viewProjCenter-(bb*s_camFocale)/s);if(T==R&&bc==bb){continue}var aK;if(T>R){aK=T;T=R;R=aK}if(bc>bb){aK=bc;bc=bb;bb=aK}var aG=GetFogColor(v,W,s_iSegmentFogColor);var a6=this.s_roadCustomParam[LowAPI.Float2Int(aZ/s_trackMaxObjSegmentsIngame)];drawScaledImageRGB(s_cFriendRecordImageRGB[a6],s_cFriendRecordImageWidth[a6],s_cFriendRecordImageHeight[a6],T,bc,R-T,bb-bc)}else{if(aL[k_f3d_command]==k_f3d_cmd_rectangle){ah=aL[k_f3d_command_line_layer];S=aL[k_f3d_command_y1]+I;Q=aL[k_f3d_command_y2]+I;aA=Game.k_segment_length-S;ay=Game.k_segment_length-Q;v=(((be*S)>>Game.k_segment_base)+((aS*aA)>>Game.k_segment_base));if(v<k_viewClip_F3D){continue}s=(((be*Q)>>Game.k_segment_base)+((aS*ay)>>Game.k_segment_base));T=(aN?this.s_offRoadItemOffsetL[au]:this.s_offRoadItemOffsetR[au]);R=T;ao=aL[k_f3d_command_x1]+M;an=aL[k_f3d_command_x2]+M;x=aL[k_f3d_command_z1]+K;t=aL[k_f3d_command_z2]+K;if(aN){T+=-ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=-an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}else{T+=ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}bc=x+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base));bb=t+(((a2*Q)>>Game.k_segment_base)+((aR*ay)>>Game.k_segment_base));T=LowAPI.Float2Int((k_middle_region_x)+(T*s_camFocale)/v);R=LowAPI.Float2Int((k_middle_region_x)+(R*s_camFocale)/s);bc=LowAPI.Float2Int(s_viewProjCenter-(bc*s_camFocale)/v);bb=LowAPI.Float2Int(s_viewProjCenter-(bb*s_camFocale)/s);if(T==R&&bc==bb){continue}var aK;if(T>R){aK=T;T=R;R=aK}if(bc>bb){aK=bc;bc=bb;bb=aK}var aG=GetFogColor(v,W,s_iSegmentFogColor);SetColor(aG);FillRectWrapper(T,bc,R-T,bb-bc)}else{if(aL[k_f3d_command]==k_f3d_cmd_line){ah=aL[k_f3d_command_line_layer];S=aL[k_f3d_command_y1]+I;Q=aL[k_f3d_command_y2]+I;aA=Game.k_segment_length-S;ay=Game.k_segment_length-Q;v=(((be*S)>>Game.k_segment_base)+((aS*aA)>>Game.k_segment_base));s=(((be*Q)>>Game.k_segment_base)+((aS*ay)>>Game.k_segment_base));if(v<k_viewClip_F3D&&s<k_viewClip_F3D){continue}T=(aN?this.s_offRoadItemOffsetL[au]:this.s_offRoadItemOffsetR[au]);R=T;ao=aL[k_f3d_command_x1]+M;an=aL[k_f3d_command_x2]+M;x=aL[k_f3d_command_z1]+K;t=aL[k_f3d_command_z2]+K;bc=x+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base));bb=t+(((a2*Q)>>Game.k_segment_base)+((aR*ay)>>Game.k_segment_base));if(aN){T+=-ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=-an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}else{T+=ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}if(v<k_viewClip_F3D){T=LowAPI.Float2Int(R-(R-T)*(s-k_viewClip_F3D)/(s-v));bc=LowAPI.Float2Int(bb-(bb-bc)*(s-k_viewClip_F3D)/(s-v));v=k_viewClip_F3D}else{if(s<k_viewClip_F3D){R=LowAPI.Float2Int(T-(T-R)*(v-k_viewClip_F3D)/(v-s));bb=LowAPI.Float2Int(bc-(bc-bb)*(v-k_viewClip_F3D)/(v-s));s=k_viewClip_F3D}}T=LowAPI.Float2Int((k_middle_region_x)+(T*s_camFocale)/v);R=LowAPI.Float2Int((k_middle_region_x)+(R*s_camFocale)/s);bc=LowAPI.Float2Int(s_viewProjCenter-(bc*s_camFocale)/v);bb=LowAPI.Float2Int(s_viewProjCenter-(bb*s_camFocale)/s);if(T==R&&bc==bb){continue}var aG=GetFogColor(v,W,s_iSegmentFogColor);SetColor(aG);DrawLine(T,bc,R,bb)}else{if(aL[k_f3d_command]==k_f3d_cmd_texture_rect){var V=(aL[k_f3d_command_rect_flags]&k_rect_flag_ignore_height)!=0;if(!BuildConf.k_use_texture){continue}ah=aL[k_f3d_command_rect_layer];S=aL[k_f3d_command_y1]+I;Q=aL[k_f3d_command_y2]+I;aA=Game.k_segment_length-S;ay=Game.k_segment_length-Q;v=(((be*S)>>Game.k_segment_base)+((aS*aA)>>Game.k_segment_base));if(v<k_viewClip_F3D){continue}s=(((be*Q)>>Game.k_segment_base)+((aS*ay)>>Game.k_segment_base));if(s==0){continue}T=(aN?this.s_offRoadItemOffsetL[au]:this.s_offRoadItemOffsetR[au]);R=T;ao=aL[k_f3d_command_x1]+M;an=aL[k_f3d_command_x2]+M;x=aL[k_f3d_command_z1]+(V?0:K);t=aL[k_f3d_command_z2]+(V?0:K);if(aN){T+=-ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=-an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}else{T+=ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base));R+=an+(((A*Q)>>Game.k_segment_base)+((aT*ay)>>Game.k_segment_base))}bc=x+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base));bb=t+(((a2*Q)>>Game.k_segment_base)+((aR*ay)>>Game.k_segment_base));T=LowAPI.Float2Int((k_middle_region_x)+(T*s_camFocale)/v);R=LowAPI.Float2Int((k_middle_region_x)+(R*s_camFocale)/s);bc=LowAPI.Float2Int(s_viewProjCenter-(bc*s_camFocale)/v);bb=LowAPI.Float2Int(s_viewProjCenter-(bb*s_camFocale)/s);if(T==R&&bc==bb){continue}var aK;if(T>R){aK=T;T=R;R=aK}if(bc>bb){aK=bc;bc=bb;bb=aK}var Y=getTextureCommand(ak,aQ);var aX=getTextureCommand(X,y);var aW=getTextureSriteIndex(Y);var H=getTextureSriteIndex(X);var a1=getTextureFrame(Y);var aF=getTextureFrame(aX);var m=(getTexturePalette(Y)).castToByte();var L=(getTexturePalette(aX)).castToByte();var a0=Z?ASprite.FLAG_FLIP_X:0;if(true){var bd;if(BuildConf.k_use_textures_day_night){bd=c.GetTexturePalette(aW,m,L)}else{bd=m}var az=a1;var aI=0,aH=0;var aJ=true;if(BuildConf.k_use_texture_anim){var a7=this.GetF3DTextureAnimData(aZ.castToShort(),bi.castToShort(),n.castToShort());if(a7!=null&&a7[c.k_f3dTextureAnimSpriteId]==aW){if(a7!=null&&a7[c.k_f3dTextureAnimTimer]>0&&a7[c.k_f3dTextureAnimState]!=c.k_f3dTextureAnimStateWait){aJ=(a7[c.k_f3dTextureAnimSkipOffset]!=0);az=a7[c.k_f3dTextureAnimFrame];aI=a7[c.k_f3dTextureAnimOffX];aH=a7[c.k_f3dTextureAnimOffY];if(Z){aI*=-1}}}}var af,at,B=0,z=0;var aP=0,aO=0;var aY=s_textures[aW].GetFrameRectCount(az);if(aY>0){var a3=[0,0,0,0];s_textures[aW].GetFrameRect(az,0,a3,0);B=a3[0];z=a3[1];af=a3[2];at=a3[3];if(aY==2){s_textures[aW].GetFrameRect(az,1,a3,0);B=a3[0]-B;z=a3[1]-z}else{B=0;z=0}}else{af=s_textures[aW].GetFrameWidth(az);at=s_textures[aW].GetFrameHeight(az)}if(af==0){continue}if(at==0){continue}var U=LowAPI.Float2Int(((R-T)*100)/af);var ae=LowAPI.Float2Int(((bb-bc)*100)/at);aP=LowAPI.Float2Int(((B+aI)*U)/100);aO=LowAPI.Float2Int(((z+aH)*ae)/100);if(c.s_isPaletteAnimNeeded){bd=c.s_paletteAnimCurrPal}var bh=s_textures[aW].GetCachedFrameImage((bd*FOG_TEXTURE_PALETTES*NUM_ENVIRONMENTS),az);if(bh!=null){var ap=GLLib.statics.g._getContext2d();var G=T+aP;var F=bc+aO;var aM={x:0,y:0,width:af,height:at};var aq={x:G,y:F,width:(af*U/100)|0,height:(at*ae/100)|0};_DrawImage(ap,bh.m_image.getHTMLCanvasElement(),aM,aq)}else{Warn("Error when draw texture rect: sprite = "+aW+", frame = "+az+", pal = "+bd)}if(!aC){bi++;aC=true}}}else{if(aL[k_f3d_command]==k_f3d_cmd_bound_rect){ah=aL[k_f3d_command_rect_layer];S=aL[k_f3d_command_y1]+I;Q=aL[k_f3d_command_y2]+I;aA=Game.k_segment_length-S;ay=Game.k_segment_length-Q;v=(((be*S)>>Game.k_segment_base)+((aS*aA)>>Game.k_segment_base));if(v<k_viewClip_F3D){continue}s=(((be*Q)>>Game.k_segment_base)+((aS*ay)>>Game.k_segment_base));if(s==0){continue}ao=aL[k_f3d_command_x1]+M;an=aL[k_f3d_command_x2]+M;x=aL[k_f3d_command_z1]+K;t=aL[k_f3d_command_z2]+K;bc=x+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base));bb=t+(((a2*Q)>>Game.k_segment_base)+((aR*ay)>>Game.k_segment_base));bc=LowAPI.Float2Int(s_viewProjCenter-(bc*s_camFocale)/v);bb=LowAPI.Float2Int(s_viewProjCenter-(bb*s_camFocale)/s);if(bc==bb){continue}var aK;if(bc>bb){aK=bc;bc=bb;bb=aK}D=LowAPI.Float2Int(((bb-bc)*100)/100)}else{if(aL[k_f3d_command]==k_f3d_cmd_particles){if(aL[Game.k_f3d_command_particles_type]==Game.k_f3d_particles_type_fireworks){var ad=aL[Game.k_f3d_command_particles_x];var ac=aL[Game.k_f3d_command_particles_y];var ab=aL[Game.k_f3d_command_particles_z];var aj=aL[Game.k_f3d_command_particles_color_r];var av=aL[Game.k_f3d_command_particles_color_g];var ax=aL[Game.k_f3d_command_particles_color_b];var a8=aL[Game.k_f3d_command_particles_max_count];var J=RGB2Int(aj,av,ax);ao=ad+M;S=ac+I;x=ab+K;aA=Game.k_segment_length-S;T=(aN?this.s_offRoadItemOffsetL[au]:this.s_offRoadItemOffsetR[au]);v=(((be*S)>>Game.k_segment_base)+((aS*aA)>>Game.k_segment_base));if(v==0){continue}bc=x+(((a2*S)>>Game.k_segment_base)+((aR*aA)>>Game.k_segment_base));if(aN){T+=-ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base))}else{T+=ao+(((A*S)>>Game.k_segment_base)+((aT*aA)>>Game.k_segment_base))}T=LowAPI.Float2Int((k_middle_region_x)+(T*s_camFocale)/v);bc=LowAPI.Float2Int(s_viewProjCenter-(bc*s_camFocale)/v);var E=this.s_worldNum[au]}}}}}}}}}}}}}}};c.GetTexturePalette=function(p,o,n){var q=s_texturesPalettesAmount[p];if(o!=n){for(var m=0;m<s_texturesPalettesInfo[p].length;m+=2){if(s_texturesPalettesInfo[p][m]==GetPalettePairKey(o,n)){q=s_texturesPalettesInfo[p][m+1]+s_texturesPalettesAmount[p]}}}else{q=o+s_texturesPalettesAmount[p]}return q};c.Track_drawOffroadLeftZone=function(o,n,y,x,s,r,w,v,A,p,q,C){var m,B,z;var u,t;t=s;if(n>o){if(o<w){t=LowAPI.Float2Int(r+(((s-r)*(w-n))/(o-n))+1);o=w}t-=1;m=o;u=t;B=n}else{if(n<w){n=w}m=n;u=r;B=o}z=Math_Max(y,x);if(z>w){if(B>w){if(q){SetColor(C);FillRectWrapper(0,r,Math_Max(o,n),s_gameRegion_bottom-r)}if(o>n){SetColor(p);FillTriangleWrapper(B,t,n,r,m,t);FillRectWrapper(m,t,B-m,s_gameRegion_bottom-t)}SetColor(A);FillTriangleWrapper(B,t,n,r,o,u);if(t!=s){FillRectWrapper(m,t,B-m,s-t)}}SetColor(A);if(z>B){FillRectWrapper(B,r,z-B,s-r)}}};c.Track_drawOffroadRightZone=function(x,w,A,z,q,p,y,C,n,B,r,D,s){var v,u,t;var o,m;m=q;if(w<x){if(x>n){m=LowAPI.Float2Int(p+(((q-p)*(n-w))/(x-w))+1);x=n}m-=1;v=x;u=w;o=m}else{if(w>n){w=n}v=w;u=x;o=p}t=Math_Min(A,z);if(t<n){if(u<n){if(D){SetColor(s);FillRectWrapper(Math_Min(x,w),p,s_screenWidth-Math_Min(x,w),s_gameRegion_bottom-p)}if(x<w){SetColor(r);FillTriangleWrapper(u,m,w,p,v,m);FillRectWrapper(u,m,v-u,s_gameRegion_bottom-m)}SetColor(B);FillTriangleWrapper(u,m,w,p,x,o);if(m!=q){FillRectWrapper(w,m,v-u,q-m)}}SetColor(B);if(t<u){if(t<y){t=y}FillRectWrapper(t,p,u-t,q-p)}}};c.prototype.Track_fillOffroad=function(s,z,A,y,x,r,m,u,t,H,o,w,n,D,G){var E;var I=(D&(1<<6))!=0;var v=(D&(2<<6))!=0;var F=(G&(1<<6))!=0;var C=(G&(2<<6))!=0;D&=63;D<<=1;G&=63;G<<=1;E=Math_Max(y,x)+((BuildConf.k_track_road_spr_size_step)>>1);E=Math_Min(E,o);var q=this.getOffRoadProperty(cActor.k_offroad_side_left,A,OffRoadPro.k_offset_y);u+=q;t+=q;if(H<E){SetColor(w);if(!I&&!F){FillRectWrapper(H,t,E-H,u-t)}else{if(D==0||y<=H){FillRectWrapper(H,t,E-H,u-t);if(G!=0){var J=t-Math_FixedPointToInt(Math_Tan(G)*(x-H+((BuildConf.k_track_road_spr_size_step)>>1)));FillTriangleWrapper(H,J,H,t,x,t)}}else{var B=u-Math_FixedPointToInt(Math_Tan(D)*(y-H+((BuildConf.k_track_road_spr_size_step)>>1)));if(u>=s_gameRegion_bottom&&B<s_gameRegion_bottom){SetColor(this.s_lastColOffroadLeft);FillTriangleWrapper(H,B,H,u,y,u)}SetColor(w);FillTriangleWrapper(H,B,y,u,x,t);if(G!=0){var J=t-Math_FixedPointToInt(Math_Tan(G)*(x-H+((BuildConf.k_track_road_spr_size_step)>>1)));if(J<B){FillTriangleWrapper(H,B,x,t,H,J)}}else{if(t<B){FillTriangleWrapper(H,t,H,B,x,t)}}}}}y+=r;x+=m;E=Math_Min(y,x)-((BuildConf.k_track_road_spr_size_step)>>1);E=Math_Max(E,H);var p=this.getOffRoadProperty(cActor.k_offroad_side_right,A,OffRoadPro.k_offset_y);u+=p;t+=p;if(o>E){SetColor(n);if(!v&&!C){FillRectWrapper(E,t,o-E,u-t)}else{if(D==0||y>=o){FillRectWrapper(E,t,o-E,u-t);if(G!=0){if(o>x){var J=t-Math_FixedPointToInt(Math_Tan(G)*(o-x+((BuildConf.k_track_road_spr_size_step)>>1)));FillTriangleWrapper(o,J,x,t,o,t)}}}else{var B=u-Math_FixedPointToInt(Math_Tan(D)*(o-y+((BuildConf.k_track_road_spr_size_step)>>1)));SetColor(n);if(u>=s_gameRegion_bottom&&B<s_gameRegion_bottom){SetColor(this.s_lastColOffroadRight);FillTriangleWrapper(y,u,o,u,o,B)}FillTriangleWrapper(y,u,o,B,x,t);if(G!=0){if(o>x){var J=t-Math_FixedPointToInt(Math_Tan(G)*(o-x+((BuildConf.k_track_road_spr_size_step)>>1)));if(J<B){FillTriangleWrapper(x,t,o,B,o,J)}}}else{if(t<B){FillTriangleWrapper(x,t,o,B,o,t)}}}}}};c.prototype.Track_drawOffRoad=function(aw,ad,U,ae){var V,am,z,at;var u;var t,ai,N,r,ah,L,W;var aq,ao,B,A;var K,J,M;var Q,S;K=Q=S=M=J=0;var I,H,G;var ay;var P,O;var Z,Y;var v,C=0,y=0;var an=0;var au=0,ac=0;var al=0,X=0;var ax=0,F=0;var x=false;var E=false,ab=false;var o,ag;this.s_worldRoadMin=s_gameRegion_bottom;V=s_gameRegion_bottom;am=s_gameRegion_left;z=s_screenWidth;at=am+z;var w=0,n=0;var m=this.s_segmentSlant!=null;var s=this.s_lastColOffroadLeft;var T=this.s_lastColOffroadRight;var D=aw?0:(BuildConf.k_track_road_max_segment+1);var ap=D+BuildConf.k_track_road_max_segment-1-ad;o=false;ag=false;if(this.s_roadL1[ap]==0||this.s_roadL1[ap+1]==0){return}if(Math_Abs(this.s_worldAngle[ap])>=k_world_angle_limit){return}if(!aw&&this.s_worldNum[ap]==this.s_worldNum[ap-D]){return}u=this.s_worldNum[ap];if(m){w=this.s_segmentSlant[u];n=this.s_segmentSlant[(u+1)%s_mainTrackNbSegment]}this.s_worldYclip[ap]=V;this.s_worldXclip[ap]=am;this.s_worldXclipW[ap]=z;t=this.s_roadX1[ap];ai=this.s_roadY1[ap];N=this.s_roadL1[ap];r=this.s_roadX1[ap+1];ah=this.s_roadY1[ap+1];L=this.s_roadL1[ap+1];au=(this.s_trackTabFlags[u])&1;ac=(this.s_trackTabFlags[u]>>1)&1;if((au>0)||(ac>0)){if((au+ac)>=s_trackLaneCount){aq=t+(N>>1);ao=r+(L>>1);B=0;A=0}else{Z=LowAPI.Float2Int(N/s_trackLaneCount);Y=LowAPI.Float2Int(L/s_trackLaneCount);I=Z*au;H=Y*au;aq=t+I;B=N-(I+Z*ac);ao=r+H;A=L-(H+Y*ac);this.s_offRoadItemOffsetL[ap]=-s_trackRoadHalfWidth+(s_trackLaneWidth*au);this.s_offRoadItemOffsetR[ap]=s_trackRoadHalfWidth-(s_trackLaneWidth*ac)}}else{aq=t;ao=r;B=N;A=L;this.s_offRoadItemOffsetL[ap]=-s_trackRoadHalfWidth;this.s_offRoadItemOffsetR[ap]=s_trackRoadHalfWidth}if((au!=al)||(ac!=X)){x=false}al=au;X=ac;if((ai>=s_gameRegion_top)&&(ah<=s_gameRegion_bottom)){ay=this.s_worldPosY[ap];if(ay>s_trackStartFog){an=LowAPI.Float2Int(((ay-s_trackStartFog)<<IDefine.PERCENT_BASE)/((BuildConf.k_track_road_max_segment*Game.k_segment_length)-s_trackStartFog))}else{an=0}at=am+z;if(ah<s_gameRegion_top){ah=s_gameRegion_top}if((this.s_worldXclipW[ap]>0)){var aa=(u&1)==0?OffRoadPro.k_color1:OffRoadPro.k_color2;y=this.getOffRoadProperty(cActor.k_offroad_side_right,u,aa);C=this.getOffRoadProperty(cActor.k_offroad_side_left,u,aa);y=InterpolateColor255(s_iSegmentFogColor,y,an);C=InterpolateColor255(s_iSegmentFogColor,C,an);var ar=this.getOffRoadProperty(cActor.k_offroad_side_right,u,OffRoadPro.k_color3);var p=this.getOffRoadProperty(cActor.k_offroad_side_left,u,OffRoadPro.k_color3);ar=InterpolateColor255(s_iSegmentFogColor,ar,an);p=InterpolateColor255(s_iSegmentFogColor,p,an);if((this.s_offRoadZone[u]&192)==j){Y=this.s_offRoadZone[u]&(k);var ak=false;var aj=false;var R=this.s_worldNum[ap+1];if((this.s_offRoadZone[R]&192)!=j){ak=true;aj=true;x=false}else{if(((s_offroadZoneType[this.s_offRoadZone[R]&k]&1)==0)&&((s_offroadZoneType[Y]&1)!=0)){ak=true;x=false}else{if(((s_offroadZoneType[this.s_offRoadZone[R]&k]&2)==0)&&((s_offroadZoneType[Y]&2)!=0)){aj=true;x=false}}}v=s_offroadZoneColors[Y][u&1];v=InterpolateColor255(s_trackColorFogCurrent,v,an);Z=s_offroadZoneDistance[Y];P=this.s_worldRatio[ap];if(!x){E=false;ab=false;Y=s_offroadZoneType[Y];O=this.s_worldRatio[ap+1];H=Math_FixedPointToInt(Z*O);if((Y&1)!=0){ax=ao-H;E=true}if((Y&2)!=0){F=ao+A+H;ab=true}x=true}Z=Math_FixedPointToInt(Z*P);G=0;if(E){H=ax;I=aq-Z;ax=I;var av=am;if(!aw){var af=this.s_roadX1[ap-BuildConf.k_track_road_max_segment];var q=this.s_roadL1[ap-BuildConf.k_track_road_max_segment];av=Math_Max(am,af+q)}this.Track_drawOffroadLeftZone(I,H,LowAPI.Float2Int(aq+((BuildConf.k_track_road_spr_size_step)/2)),LowAPI.Float2Int(ao+((BuildConf.k_track_road_spr_size_step)/2)),ai,ah,av,at,C,v,ak,p);o=true;s_isBottomFillNeeded=true;G=Math_Max(aq,ao)}if(ab){H=F;I=aq+B+Z;F=I;this.Track_drawOffroadRightZone(I,H,LowAPI.Float2Int(aq+B-((BuildConf.k_track_road_spr_size_step)/2)),LowAPI.Float2Int(ao+A-((BuildConf.k_track_road_spr_size_step)/2)),ai,ah,G,am,at,y,v,aj,ar);ag=true;s_isBottomFillNeeded=true}}if(U){if(ae){this.Track_fillOffroad(o,ag,u,LowAPI.Float2Int(s_screenWidth/2),LowAPI.Float2Int(s_screenWidth/2),0,0,ai,ah,0,s_screenWidth,C,y,w,n)}else{this.Track_fillOffroad(o,ag,u,aq,ao,B,A,ai,ah,am,at,C,y,w,n)}}}}if(ai>=s_gameRegion_bottom){if(m&&this.s_segmentSlant[u]!=0){this.s_lastColOffroadLeft=C;this.s_lastColOffroadRight=y}else{this.s_lastColOffroadLeft=16711935;this.s_lastColOffroadRight=16711935}}if(ap+1<D+BuildConf.k_track_road_max_segment){u=this.s_worldNum[ap+1]}if((this.s_offRoadZone[u]&i)!=0){x=false}this.s_worldXclip[D+BuildConf.k_track_road_max_segment]=am;this.s_worldXclipW[D+BuildConf.k_track_road_max_segment]=z};LowAPI.extendObject(e,{cTrack:c,},true)})(window);