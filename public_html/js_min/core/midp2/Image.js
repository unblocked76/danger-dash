if(typeof javax=="undefined"){javax=function(){}}if(typeof javax.microedition=="undefined"){javax.microedition=function(){}}if(typeof javax.microedition.lcdui=="undefined"){javax.microedition.lcdui=function(){}}javax.microedition.lcdui.Image=function(b,a){if((b|0)<=0||(a|0)<=0){throw new Error("InvalidParameters")}this.m_HTMLCanvasElement=document.createElement("canvas");this.m_HTMLCanvasElement.width=b;this.m_HTMLCanvasElement.height=a;this.m_Graphics=null;this.ID=Midp2Image.s_inst_counter++;this.m_TextureInfo=null};Midp2Image=javax.microedition.lcdui.Image;Midp2Image.s_inst_counter=0;Midp2Image.decodeImageData=function(h,e,c,m){var b;var p=new Uint8Array(h,e,c);var j=p.length;if(j<4){return null}var q=p[0];var o=p[1];var n=p[2];var l=p[3];if(q==137&&o==80&&n==78&&l==71){b="image/png"}else{if(q==255&&o==216){b="image/jpeg"}else{if(q==71&&o==73&&n==70){b="image/gif"}else{Assert(false,"decodeImageData # Wrong data!");return null}}}var g="";for(var f=0;f<j;f++){g+=String.fromCharCode(p[f])}var k=window.btoa(g);var d=new __JS_HTMLImageElement_Contructor__();d.onload=function(){m(d)};d.src="data:"+b+";base64,"+k;return d};Midp2Image.prototype._getRGB=function(k,g,e,l,j,q,o){var d=this.m_HTMLCanvasElement;if(d.width!=q||d.height!=o){throw new Error("InvalidParameters")}var r=d.getContext("2d");var s=r.getImageData(l,j,q,o);var p=s.data;var h=0;for(var t=j;t<j+o;t++){for(var u=l;u<l+q;u++){var i=p[h++]&255;var m=p[h++]&255;var c=p[h++]&255;var f=p[h++]&255;var n=(f<<24)|(i<<16)|(m<<8)|(c);k[g+(u-l)+(t-j)*e]=n}}};Midp2Image.prototype._setRGB=function(l,h,i,p,n,d,q,e){throw new Error("lnthieu: To opt performance, pls avoid using this function");var g=this.m_HTMLCanvasElement;if(g.width!=d||g.height!=q){throw new Error("InvalidParameters")}var r=g.getContext("2d");var c=r.createImageData(g.width,g.height);var k=c.data;var j=0;for(var m=n;m<n+q;m++){for(var o=p;o<p+d;o++){var f=l[h+(o-p)+(m-n)*i];k[j++]=(f>>16)&255;k[j++]=(f>>8)&255;k[j++]=(f>>0)&255;k[j++]=e?(f>>24)&255:255}}r.putImageData(c,0,0)};Midp2Image.prototype.getHTMLCanvasElement=function(){return this.m_TextureInfo||this.m_HTMLCanvasElement};Midp2Image.prototype.getID=function(){return this.ID};Midp2Image.prototype.cacheAsTexture=function(){if(GLLib.statics.g._getContext2d().cacheAsTexture){if(this.m_TextureInfo!=null){throw new Error("TBC: the image cached.")}this.m_TextureInfo=GLLib.statics.g._getContext2d().cacheAsTexture(this.getHTMLCanvasElement());this.m_HTMLCanvasElement=null;this.m_Graphics=null}};Midp2Image.createImage=function(){if(arguments){switch(arguments.length){case 1:if(arguments[0] instanceof Midp2Image){return Midp2Image._createImage_1_1.apply(this,arguments)}else{if(arguments[0] instanceof InputStream){return Midp2Image._createImage_1_2.apply(this,arguments)}else{return Midp2Image._createImage_1_3.apply(this,arguments)}}case 2:return Midp2Image._createImage_2.apply(this,arguments);case 3:return Midp2Image._createImage_3.apply(this,arguments);case 6:return Midp2Image._createImage_6.apply(this,arguments)}}throw new Error("InvalidArguments")};Midp2Image._createImage_3=function(a,d,b){var c=Midp2Image.createImage(1,1);Midp2Image.decodeImageData(a,d,b,function(e){if(c.m_HTMLCanvasElement!=null){c.m_HTMLCanvasElement.width=e.width;c.m_HTMLCanvasElement.height=e.height;c.m_HTMLCanvasElement.getContext("2d").drawImage(e,0,0);if(c.m_Graphics!=null){throw new Error("TBC: lost update")}}else{if(c.m_TextureInfo!=null){c.m_TextureInfo=GLLib.statics.g._getContext2d().cacheAsTexture(e,c.m_TextureInfo)}}});return c};Midp2Image._createImage_1_1=function(b){var c=Midp2Image.createImage(1,1);var a=document.createElement("img");a.src=b;a.onload=function(){c.m_HTMLCanvasElement.width=a.width;c.m_HTMLCanvasElement.height=a.height;c.m_HTMLCanvasElement.getContext("2d").drawImage(a,0,0)}};Midp2Image._createImage_6=function(e,b,f,d,a,c){throw new Error("Not implemented yet!")};Midp2Image._createImage_1_2=function(a){throw new Error("Not implemented yet!")};Midp2Image._createImage_2=function(b,a){var c=new Midp2Image(b,a);return c};Midp2Image._createImage_1_3=function(a){throw new Error("Not implemented yet!")};Midp2Image.createRGBImage=function(e,b,a,c){var d=Midp2Image.createImage(b,a);d._setRGB(e,0,b,0,0,b,a,c);return d};Midp2Image.prototype.getGraphics=function(){if(this.m_TextureInfo!=null){throw new Error("Not allow!")}if(this.m_Graphics==null){this.m_Graphics=new Graphics(this.m_HTMLCanvasElement)}return this.m_Graphics};Midp2Image.prototype.getWidth=function(){return this.m_TextureInfo!=null?this.m_TextureInfo.width:this.m_HTMLCanvasElement.width};Midp2Image.prototype.getHeight=function(){return this.m_TextureInfo!=null?this.m_TextureInfo.height:this.m_HTMLCanvasElement.height};Midp2Image.prototype.getRGB=function(g,e,d,b,f,c,a){this._getRGB(g,e,d,b,f,c,a)};Midp2Image.prototype.isMutable=function(){return true};