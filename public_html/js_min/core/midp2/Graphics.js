(function(a,g){function c(h){if(typeof h=="undefined"||!(h instanceof HTMLCanvasElement)){throw new Error("Invalid parameter")}this.m_HTMLCanvasElement=h;this.m_CanvasRenderingContext2D=h.getContext("2d");this.setDefault()}c.m_count_instance=0;c.HCENTER=1;c.VCENTER=2;c.LEFT=4;c.RIGHT=8;c.TOP=16;c.BOTTOM=32;c.ANCHOR_NONE=c.TOP|c.LEFT;c.BASELINE=64;function b(m,l){var l=typeof l!="undefined"?l:true;m>>>=0;var h=m&255,k=(m&65280)>>>8,j=(m&16711680)>>>16;if(l){var i=(((m&4278190080)>>>24)/255);return"rgba("+j+", "+k+", "+h+",  "+i+")"}else{return"rgb("+j+", "+k+", "+h+")"}}c.prototype.setDefault=function(){this.m_CanvasRenderingContext2D.globalAlpha=1;this.m_CanvasRenderingContext2D.lineWidth=1;this.m_ExtraData={color:0,color_changed:false,clip:{x:0,y:0,width:-1,height:-1},};var k="bold";var h=24;var l="Arial";var i=document.createElement("canvas");i.width=this.m_HTMLCanvasElement.width;i.height=this.m_HTMLCanvasElement.height;var j=i.getContext("2d");j.font=[k,h+"px",l].join(" ");this.textCanvas=i;this.textCtx=j;this.textImage=this.m_CanvasRenderingContext2D.cacheAsTexture?this.m_CanvasRenderingContext2D.cacheAsTexture(i):i;this.m_instance_id=c.m_count_instance++};c.prototype._scale=function(i,h){this.m_CanvasRenderingContext2D.scale(i,h)};c.prototype._save=function(){this.m_CanvasRenderingContext2D.save()};c.prototype._restore=function(){this.m_CanvasRenderingContext2D.restore()};c.prototype._getWidth=function(){return this.m_HTMLCanvasElement.width};c.prototype._getHeight=function(){return this.m_HTMLCanvasElement.height};c.prototype._getContext2d=function(){return this.m_CanvasRenderingContext2D};c.prototype._getCanvasElement=function(){return this.m_HTMLCanvasElement};c.prototype._BuildClip=function(p){var l=this.getClipX();var k=this.getClipY();var o=this.getClipWidth();var n=this.getClipHeight();if(p.x+p.width<=l){return false}else{if(p.x>=l+o){return false}else{if(p.y+p.height<=k){return false}else{if(p.y>=k+n){return false}else{var j=Math.max(l,p.x);var i=Math.max(k,p.y);var m=Math.min(l+o,p.x+p.width);var h=Math.min(k+n,p.y+p.height);return{x:j,y:i,width:m-j,height:h-i}}}}}};c.prototype._DrawImageAffineClip=function(u,h,Q,j,x,m){var r=(x==0&&(m==c.ANCHOR_NONE||m==0));var J=this.getClipX();var D=this.getClipY();var O=J+this.getClipWidth();var v=D+this.getClipHeight();var M=j.x;var i=j.y;var L=M+j.width;var A=i+j.height;if(r&&L<=J){return false}else{if(r&&M>=O){return false}else{if(r&&A<=D){return false}else{if(r&&i>=v){return false}else{if(x!=0){u.save()}var n=e(j.width,j.height,x,m);var l=d(j.width,j.height,x,m);var F;var P;var k;var q;j.x+=n;j.y+=l;var K;var C;var N;var y;var E=function(S,R,U){var T=S;T=Math.max(T,R);T=Math.min(T,U);return T};var w=((j.width)/2);var G=((j.height)/2);var t;var s;if(x<=Sprite.TRANS_ROT180){t=j.x+w;s=j.y+G}else{t=j.x+G;s=j.y+w}if(x==Sprite.TRANS_ROT270){F=s+w;k=s-w;P=t-G;q=t+G;K=E(F,D,v);N=E(k,D,v);C=E(P,J,O);y=E(q,J,O);u.translate(0+j.x,j.width+j.y);j.x=0;j.y=0;u.rotate(-Math.PI/2)}else{if(x==Sprite.TRANS_MIRROR_ROT270){F=s-w;k=s+w;P=t-G;q=t+G;K=E(F,D,v);N=E(k,D,v);C=E(P,J,O);y=E(q,J,O);u.translate(j.x,j.y);j.x=0;j.y=0;u.rotate(-Math.PI/2);u.scale(-1,1)}else{if(x==Sprite.TRANS_ROT90){F=s-w;k=s+w;P=t+G;q=t-G;K=E(F,D,v);N=E(k,D,v);C=E(P,J,O);y=E(q,J,O);u.translate(j.height+j.x,0+j.y);j.x=0;j.y=0;u.rotate(Math.PI/2)}else{if(x==Sprite.TRANS_MIRROR_ROT90){F=s+w;k=s-w;P=t+G;q=t-G;K=E(F,D,v);N=E(k,D,v);C=E(P,J,O);y=E(q,J,O);u.translate(j.height+j.x,j.width+j.y);j.x=0;j.y=0;u.rotate(Math.PI/2);u.scale(-1,1)}else{if(x==Sprite.TRANS_ROT180){F=t+w;k=t-w;P=s+G;q=s-G;K=E(F,J,O);N=E(k,J,O);C=E(P,D,v);y=E(q,D,v);u.translate(j.width+j.x,j.height+j.y);j.x=0;j.y=0;u.rotate(Math.PI)}else{if(x==Sprite.TRANS_MIRROR){F=t+w;k=t-w;P=s-G;q=s+G;K=E(F,J,O);N=E(k,J,O);C=E(P,D,v);y=E(q,D,v);u.translate(j.width+j.x,j.y);j.x=0;j.y=0;u.scale(-1,1)}else{if(x==Sprite.TRANS_MIRROR_ROT180){F=t-w;k=t+w;P=s+G;q=s-G;K=E(F,J,O);N=E(k,J,O);C=E(P,D,v);y=E(q,D,v);u.translate(j.x,j.height+j.y);j.x=0;j.y=0;u.scale(1,-1)}else{F=t-w;k=t+w;P=s-G;q=s+G;K=E(F,J,O);N=E(k,J,O);C=E(P,D,v);y=E(q,D,v)}}}}}}}var z=Math.abs(K-F)|0;var o=Math.abs(C-P)|0;var I=(Math.abs(N-k)+z)|0;var p=(Math.abs(y-q)+o)|0;var B={x:j.x+z,y:j.y+o,width:j.width-I,height:j.height-p};var H={x:Q.x+z,y:Q.y+o,width:B.width,height:B.height};if(B.width>0&&B.height>0){u.drawImage(h,H.x,H.y,H.width,H.height,B.x,B.y,B.width,B.height)}if(x!=0){u.restore()}}}}}};function f(i,j,h,k){i.drawImage(j,h.x,h.y,h.width,h.height,k.x,k.y,k.width,k.height)}var e=function(k,h,j,i){if(j<=Sprite.TRANS_ROT180){if((i&c.HCENTER)!=0){return -(k>>1)}else{if((i&c.RIGHT)!=0){return -k}}}else{if((i&c.HCENTER)!=0){return -(h>>1)}else{if((i&c.RIGHT)!=0){return -h}}}return 0};var d=function(k,h,j,i){if(j<=Sprite.TRANS_ROT180){if((i&c.VCENTER)!=0){return -(h>>1)}else{if((i&c.BOTTOM)!=0){return -h}}}else{if((i&c.VCENTER)!=0){return -(k>>1)}else{if((i&c.BOTTOM)!=0){return -k}}}return 0};c.prototype.setARGBColor=function(h){if(this.m_ExtraData.color!=h){this.m_ExtraData.color=h;this.m_ExtraData.color_changed=true}};c.prototype.setColor=function(k,j,i){var n;if(i!=g){var m=k;var l=j;var h=i;n=255<<24|(m&255)<<16|(l&255)<<8|(h&255)}else{n=(4278190080)|(k<<8)>>>8}this.setARGBColor(n)};c.prototype.getColor=function(){var h=(this.m_ExtraData.color<<8)>>>8;return h};c.prototype.getDisplayColor=function(h){return h};c.prototype.setClip=function(i,l,k,h){if(this.m_ExtraData.clip.x!=i||this.m_ExtraData.clip.y!=l||this.m_ExtraData.clip.width!=k||this.m_ExtraData.clip.height!=h){if(false){var j=this.m_CanvasRenderingContext2D;j.restore();j.save();j.beginPath();j.moveTo(i,l);j.lineTo(i+k,l);j.lineTo(i+k,l+h);j.lineTo(i,l+h);j.closePath();j.clip()}this.m_ExtraData.clip.x=i;this.m_ExtraData.clip.y=l;this.m_ExtraData.clip.width=k;this.m_ExtraData.clip.height=h}};c.prototype.getClipX=function(){return this.m_ExtraData.clip.x|0};c.prototype.getClipY=function(){return this.m_ExtraData.clip.y|0};c.prototype.getClipWidth=function(){return this.m_ExtraData.clip.width!=-1?this.m_ExtraData.clip.width:this.m_HTMLCanvasElement.width};c.prototype.getClipHeight=function(){return this.m_ExtraData.clip.height!=-1?this.m_ExtraData.clip.height:this.m_HTMLCanvasElement.height};c.prototype.drawRegion=function(h,o,n,i,p,j,k,m,l){if(IS_DEBUG_MODE){if((o|0)!==o||(n|0)!==n||(i|0)!==i||(p|0)!==p||(k|0)!==k||(m|0)!==m){throw new Error("Invaild parameters")}}this._DrawImageAffineClip(this.m_CanvasRenderingContext2D,h.getHTMLCanvasElement(),{x:o,y:n,width:i,height:p},{x:k,y:m,width:i,height:p},j,l)};c.prototype.fillTriangle=function(k,m,i,l,h,j){if(IS_DEBUG_MODE){if((k|0)!==k||(m|0)!==m||(i|0)!==i||(l|0)!==l||(h|0)!==h||(j|0)!==j){throw new Error("Invaild parameters")}}if(this.m_ExtraData.color_changed){this.m_ExtraData.color_changed=!this.m_ExtraData.color_changed;this.m_CanvasRenderingContext2D.fillStyle=b(this.m_ExtraData.color)}this.m_CanvasRenderingContext2D.beginPath();this.m_CanvasRenderingContext2D.moveTo(k,m);this.m_CanvasRenderingContext2D.lineTo(i,l);this.m_CanvasRenderingContext2D.lineTo(h,j);this.m_CanvasRenderingContext2D.closePath();this.m_CanvasRenderingContext2D.fill()};c.prototype.drawRGB=function(o,m,l,i,n,j,h,k){throw new Error("Not supported!")};c.prototype.drawImage=function(j,i,n,l){if(IS_DEBUG_MODE){if((i|0)!==i||(n|0)!==n){throw new Error("Invaild parameters")}}var k=Sprite.TRANS_NONE;var m=j.getWidth();var h=j.getHeight();this._DrawImageAffineClip(this.m_CanvasRenderingContext2D,j.getHTMLCanvasElement(),{x:0,y:0,width:m,height:h},{x:i,y:n,width:m,height:h},k,l)};c.prototype.drawLine=function(i,k,h,j){if(IS_DEBUG_MODE){if((i|0)!==i||(k|0)!==k||(h|0)!==h||(j|0)!==j){throw new Error("Invaild parameters")}}if(this.m_ExtraData.color_changed){this.m_ExtraData.color_changed=!this.m_ExtraData.color_changed;this.m_CanvasRenderingContext2D.fillStyle=b(this.m_ExtraData.color)}this.m_CanvasRenderingContext2D.save();var l=this.m_CanvasRenderingContext2D.lineWidth;var m=(l%2)/2;this.m_CanvasRenderingContext2D.translate(m,m);this.m_CanvasRenderingContext2D.beginPath();this.m_CanvasRenderingContext2D.moveTo(i,k);this.m_CanvasRenderingContext2D.lineTo(h,j);this.m_CanvasRenderingContext2D.closePath();this.m_CanvasRenderingContext2D.stroke();this.m_CanvasRenderingContext2D.restore()};c.prototype.fillRect=function(i,l,j,h){if(IS_DEBUG_MODE){if((i|0)!==i||(l|0)!==l||(j|0)!==j||(h|0)!==h){throw new Error("Invaild parameters")}}if(this.m_ExtraData.color_changed){this.m_ExtraData.color_changed=!this.m_ExtraData.color_changed;this.m_CanvasRenderingContext2D.fillStyle=b(this.m_ExtraData.color)}var k=this._BuildClip({x:i,y:l,width:j,height:h});if(k&&k.width>=0&&k.height>=0){this.m_CanvasRenderingContext2D.fillRect(k.x,k.y,k.width,k.height)}};c.prototype.drawString=function(n,p,o,m){if(true){var i="bold";var k=n.indexOf("[fm]")>=0?16:24;var l="Arial";this.textCtx.font=[i,k+"px",l].join(" ");var j=this.textCtx;var r=this.textCanvas;var q=this.textImage;j.save();j.clearRect(0,0,r.width,r.height);j.fillStyle=b(this.m_ExtraData.color);n=n.replace("[fm]","");var h=this.stringWidth(n);if((m&c.RIGHT)!=0){p-=h}else{if((m&c.HCENTER)!=0){p-=h/2}}if((m&c.BOTTOM)!=0){}else{if((m&c.BASELINE)!=0){}else{j.textBaseline="top"}}j.beginPath();j.moveTo(this.getClipX(),this.getClipY());j.lineTo(this.getClipX()+this.getClipWidth(),this.getClipY());j.lineTo(this.getClipX()+this.getClipWidth(),this.getClipY()+this.getClipHeight());j.lineTo(this.getClipX(),this.getClipY()+this.getClipHeight());j.closePath();j.clip();j.fillText(n,p,o);j.restore();if(this.m_CanvasRenderingContext2D.cacheAsTexture){this.m_CanvasRenderingContext2D.cacheAsTexture(r,q)}this.m_CanvasRenderingContext2D.drawImage(q,0,0)}else{if(this.m_ExtraData.color_changed){this.m_ExtraData.color_changed=!this.m_ExtraData.color_changed;this.m_CanvasRenderingContext2D.fillStyle=b(this.m_ExtraData.color)}this.m_CanvasRenderingContext2D.save();var h=this.stringWidth(n);if((m&c.RIGHT)!=0){p-=h}else{if((m&c.HCENTER)!=0){p-=h/2}}if((m&c.BOTTOM)!=0){}else{if((m&c.BASELINE)!=0){}else{this.m_CanvasRenderingContext2D.textBaseline="top"}}this.m_CanvasRenderingContext2D.fillText(n,p,o);this.m_CanvasRenderingContext2D.restore()}};c.prototype.stringWidth=function(h){return this.textCtx.measureText(h).width|0};c.prototype.translate=function(h,i){this.m_CanvasRenderingContext2D.translate(h,i)};c.prototype.drawXPerspective=function(p,J,P,z,y,x,w){if(J>=P){return false}var N=z;var H=J;var M=y;var G=J;var L=x;var E=P;var K=w;var D=P;if(this.glDrawImagePerspective){this.glDrawImagePerspective(p.getHTMLCanvasElement(),N,H,M,G,K,D,L,E)}else{var l=p.getWidth();var Q=p.getHeight();var O=(D-H);var I=3;var A=Math.min(this.getClipY()+this.getClipHeight(),D);var t=(K-N);var B=(D-H);var C=(L-M);var F=function(X){var Y=X/Q;var V=N+t*Y;var W=H+B*Y;var U=M+C*Y;return{X0:V,Y0:W,X1:U}};var S=Q/O;var R=O/Q;var s=0;while(s<Q){var r=F(s);if(r.Y0>=A){break}var v=r.X1-r.X0;var h=0;var T=0;var k=0;var o=0;var j=Math.min(Math.min(1,S),Q-s);h=j;T=(h*R);for(var q=s+j;q<=Q;q+=j){var m=F(q);var n=r.X0-m.X0;var u=m.X1-r.X1;if(Math.abs(m.Y0-r.Y0)>=Math.min(R,I)){if(Math.abs(n)+Math.abs(u)>I*2){break}}k=n;o=u;h=q-s;T=m.Y0-r.Y0}var i=(r.Y0|0);T=Math.ceil(Math.min(T,A-r.Y0)+(r.Y0%1));if(T<=0||h<=0){break}this.m_CanvasRenderingContext2D.drawImage(p.getHTMLCanvasElement(),0,s|0,l,h,Math.round(r.X0-(k/2)),i,Math.round(v+((Math.abs(k)+Math.abs(o))/2)),T);if(i+T>=A){break}s+=h}}return true};c.prototype.drawYPerspective=function(m,l,B,h,U,T,S){if(l>=B){return false}var K=l;var x=h;var J=B;var w=U;var I=B;var t=T;var H=l;var s=S;if(this.glDrawImagePerspective){this.glDrawImagePerspective(m.getHTMLCanvasElement(),K,x,J,w,H,s,I,t)}else{var v=this.m_CanvasRenderingContext2D;var j=m.getWidth();var M=m.getHeight();var r=(J-K);var D=1;var P=Math.min(this.getClipX()+this.getClipWidth(),J);var C=(J-K);var F=(w-x);var y=(t-s);var u=function(Y){var Z=Y/j;var W=K+C*Z;var X=x+F*Z;var V=s+y*Z;return{X0:W,Y0:X,Y3:V}};var Q=j/r;var O=r/j;var E=0;while(E<j){var o=u(E);if(o.X0>=P){break}var R=o.Y3-o.Y0;var N=0;var p=0;var L=0;var z=0;var i=Math.min(Math.min(1,Q),j-E);N=i;p=(N*O);for(var n=E+i;n<=j;n+=i){var k=u(n);var A=o.Y0-k.Y0;var G=k.Y3-o.Y3;if(Math.abs(k.X0-o.X0)>=Math.min(O,D)){if(Math.abs(A)+Math.abs(G)>D*2){break}}L=A;z=G;N=n-E;p=k.X0-o.X0}var q=(o.X0|0);p=Math.ceil(Math.min(p,P-o.X0)+(o.X0%1));if(p<=0||N<=0){break}v.drawImage(m.getHTMLCanvasElement(),E|0,0,N,M,q,Math.round(o.Y0-(L/2)),p,Math.round(R+((Math.abs(L)+Math.abs(z))/2)));if(q+p>=P){break}E+=N}}return true};a.Graphics=c;a._DrawImage=f})(window);